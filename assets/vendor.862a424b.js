let t=!0,e=!0;function n(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function r(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(t,r){if(t!==e)return i.apply(this,arguments);const s=t=>{const e=n(t);e&&(r.handleEvent?r.handleEvent(e):r(e))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(r,s),i.apply(this,[t,s])};const s=r.removeEventListener;r.removeEventListener=function(t,n){if(t!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(n))return s.apply(this,arguments);const r=this._eventMap[e].get(n);return this._eventMap[e].delete(n),0===this._eventMap[e].size&&delete this._eventMap[e],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[t,r])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(t){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),t&&this.addEventListener(e,this["_on"+e]=t)},enumerable:!0,configurable:!0})}function i(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(t=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function s(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(e=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function o(){if("object"==typeof window){if(t)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function a(t,n){e&&console.warn(t+" is deprecated, please use "+n+" instead.")}function u(t){return"[object Object]"===Object.prototype.toString.call(t)}function l(t){return u(t)?Object.keys(t).reduce((function(e,n){const r=u(t[n]),i=r?l(t[n]):t[n],s=r&&!Object.keys(i).length;return void 0===i||s?e:Object.assign(e,{[n]:i})}),{}):t}function c(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach((r=>{r.endsWith("Id")?c(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach((e=>{c(t,t.get(e),n)}))})))}function h(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===e)return i;const s=[];return t.forEach((t=>{"track"===t.type&&t.trackIdentifier===e.id&&s.push(t)})),s.forEach((e=>{t.forEach((n=>{n.type===r&&n.trackId===e.id&&c(t,n,i)}))})),i}const d=o;function p(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(t){if("object"!=typeof t||t.mandatory||t.optional)return t;const e={};return Object.keys(t).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof t[n]?t[n]:{ideal:t[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==r.ideal){e.optional=e.optional||[];let t={};"number"==typeof r.ideal?(t[i("min",n)]=r.ideal,e.optional.push(t),t={},t[i("max",n)]=r.ideal,e.optional.push(t)):(t[i("",n)]=r.ideal,e.optional.push(t))}void 0!==r.exact&&"number"!=typeof r.exact?(e.mandatory=e.mandatory||{},e.mandatory[i("",n)]=r.exact):["min","max"].forEach((t=>{void 0!==r[t]&&(e.mandatory=e.mandatory||{},e.mandatory[i(t,n)]=r[t])}))})),t.advanced&&(e.optional=(e.optional||[]).concat(t.advanced)),e},i=function(t,i){if(e.version>=61)return i(t);if((t=JSON.parse(JSON.stringify(t)))&&"object"==typeof t.audio){const e=function(t,e,n){e in t&&!(n in t)&&(t[n]=t[e],delete t[e])};e((t=JSON.parse(JSON.stringify(t))).audio,"autoGainControl","googAutoGainControl"),e(t.audio,"noiseSuppression","googNoiseSuppression"),t.audio=r(t.audio)}if(t&&"object"==typeof t.video){let s=t.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const o=e.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let e;if(delete t.video.facingMode,"environment"===s.exact||"environment"===s.ideal?e=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(e=["front"]),e)return n.mediaDevices.enumerateDevices().then((n=>{let o=(n=n.filter((t=>"videoinput"===t.kind))).find((t=>e.some((e=>t.label.toLowerCase().includes(e)))));return!o&&n.length&&e.includes("back")&&(o=n[n.length-1]),o&&(t.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),t.video=r(t.video),d("chrome: "+JSON.stringify(t)),i(t)}))}t.video=r(t.video)}return d("chrome: "+JSON.stringify(t)),i(t)},s=function(t){return e.version>=64?t:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[t.name]||t.name,message:t.message,constraint:t.constraint||t.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(t,e,r){i(t,(t=>{n.webkitGetUserMedia(t,e,(t=>{r&&r(s(t))}))}))}.bind(n),n.mediaDevices.getUserMedia){const t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return i(e,(e=>t(e).then((t=>{if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((t=>{t.stop()})),new DOMException("","NotFoundError");return t}),(t=>Promise.reject(s(t))))))}}}function f(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function g(t){if("object"==typeof t&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",(n=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((t=>t.track&&t.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[e.stream],this.dispatchEvent(i)})),e.stream.getTracks().forEach((n=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((t=>t.track&&t.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[e.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else r(t,"track",(t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t)))}function m(t){if("object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(t,e){return{track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=t.createDTMFSender(e):this._dtmf=null),this._dtmf},_pc:t}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,r){let i=n.apply(this,arguments);return i||(i=e(this,t),this._senders.push(i)),i};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){r.apply(this,arguments);const e=this._senders.indexOf(t);-1!==e&&this._senders.splice(e,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){this._senders=this._senders||[],n.apply(this,[t]),t.getTracks().forEach((t=>{this._senders.push(e(this,t))}))};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){this._senders=this._senders||[],r.apply(this,[t]),t.getTracks().forEach((t=>{const e=this._senders.find((e=>e.track===t));e&&this._senders.splice(this._senders.indexOf(e),1)}))}}else if("object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function y(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[t,n,r]=arguments;if(arguments.length>0&&"function"==typeof t)return e.apply(this,arguments);if(0===e.length&&(0===arguments.length||"function"!=typeof t))return e.apply(this,[]);const i=function(t){const e={};return t.result().forEach((t=>{const n={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach((e=>{n[e]=t.stat(e)})),e[n.id]=n})),e},s=function(t){return new Map(Object.keys(t).map((e=>[e,t[e]])))};if(arguments.length>=2){const r=function(t){n(s(i(t)))};return e.apply(this,[r,t])}return new Promise(((t,n)=>{e.apply(this,[function(e){t(s(i(e)))},n])})).then(n,r)}}function b(t){if(!("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const t=n.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){const t=this;return this._pc.getStats().then((e=>h(e,t.track,!0)))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t}),r(t,"track",(t=>(t.receiver._pc=t.srcElement,t))),t.RTCRtpReceiver.prototype.getStats=function(){const t=this;return this._pc.getStats().then((e=>h(e,t.track,!1)))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const t=arguments[0];let e,n,r;return this.getSenders().forEach((n=>{n.track===t&&(e?r=!0:e=n)})),this.getReceivers().forEach((e=>(e.track===t&&(n?r=!0:n=e),e.track===t))),r||e&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function v(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((t=>this._shimmedLocalStreams[t][0]))};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,n){if(!n)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=e.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){this._shimmedLocalStreams=this._shimmedLocalStreams||{},t.getTracks().forEach((t=>{if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError")}));const e=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((t=>-1===e.indexOf(t)));this._shimmedLocalStreams[t.id]=[t].concat(r)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[t.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},t&&Object.keys(this._shimmedLocalStreams).forEach((e=>{const n=this._shimmedLocalStreams[e].indexOf(t);-1!==n&&this._shimmedLocalStreams[e].splice(n,1),1===this._shimmedLocalStreams[e].length&&delete this._shimmedLocalStreams[e]})),i.apply(this,arguments)}}function x(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return v(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((t=>this._reverseStreams[t.id]))};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(e){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach((t=>{if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[e.id]){const n=new t.MediaStream(e.getTracks());this._streams[e.id]=n,this._reverseStreams[n.id]=e,e=n}r.apply(this,[e])};const i=t.RTCPeerConnection.prototype.removeStream;function s(t,e){let n=e.sdp;return Object.keys(t._reverseStreams||[]).forEach((e=>{const r=t._reverseStreams[e],i=t._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:e.type,sdp:n})}function o(t,e){let n=e.sdp;return Object.keys(t._reverseStreams||[]).forEach((e=>{const r=t._reverseStreams[e],i=t._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:e.type,sdp:n})}t.RTCPeerConnection.prototype.removeStream=function(t){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[t.id]||t]),delete this._reverseStreams[this._streams[t.id]?this._streams[t.id].id:t.id],delete this._streams[t.id]},t.RTCPeerConnection.prototype.addTrack=function(e,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((t=>t===e)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((t=>t.track===e));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[n.id];if(s)s.addTrack(e),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new t.MediaStream([e]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((t=>t.track===e))},["createOffer","createAnswer"].forEach((function(e){const n=t.RTCPeerConnection.prototype[e],r={[e](){const t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[e=>{const n=s(this,e);t[0].apply(null,[n])},e=>{t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((t=>s(this,t)))}};t.RTCPeerConnection.prototype[e]=r[e]}));const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const t=u.get.apply(this);return""===t.type?t:s(this,t)}}),t.RTCPeerConnection.prototype.removeTrack=function(t){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let e;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((e=>t.track===e))&&(e=this._streams[n])})),e&&(1===e.getTracks().length?this.removeStream(this._reverseStreams[e.id]):e.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}}function w(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){const n=t.RTCPeerConnection.prototype[e],r={[e](){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[e]=r[e]}))}function k(t,e){r(t,"negotiationneeded",(t=>{const n=t.target;if(!(e.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return t}))}var I=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",shimMediaStream:f,shimOnTrack:g,shimGetSendersWithDtmf:m,shimGetStats:y,shimSenderReceiverGetStats:b,shimAddTrackRemoveTrackWithNative:v,shimAddTrackRemoveTrack:x,shimPeerConnection:w,fixNegotiationNeeded:k,shimGetUserMedia:p,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&("function"==typeof e?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then((e=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,s=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:s||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),t.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function S(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(t,e,r){a("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(t).then(e,r)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const t=function(t,e,n){e in t&&!(n in t)&&(t[n]=t[e],delete t[e])},e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),t(n.audio,"autoGainControl","mozAutoGainControl"),t(n.audio,"noiseSuppression","mozNoiseSuppression")),e(n)},r&&r.prototype.getSettings){const e=r.prototype.getSettings;r.prototype.getSettings=function(){const n=e.apply(this,arguments);return t(n,"mozAutoGainControl","autoGainControl"),t(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const e=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),t(n,"autoGainControl","mozAutoGainControl"),t(n,"noiseSuppression","mozNoiseSuppression")),e.apply(this,[n])}}}}function T(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function C(t,e){if("object"!=typeof t||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){const n=t.RTCPeerConnection.prototype[e],r={[e](){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[e]=r[e]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[t,i,s]=arguments;return r.apply(this,[t||null]).then((t=>{if(e.version<53&&!i)try{t.forEach((t=>{t.type=n[t.type]||t.type}))}catch(pg){if("TypeError"!==pg.name)throw pg;t.forEach(((e,r)=>{t.set(r,Object.assign({},e,{type:n[e.type]||e.type}))}))}return t})).then(i,s)}}function N(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender)return;if(t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const t=n.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function E(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender)return;if(t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t}),r(t,"track",(t=>(t.receiver._pc=t.srcElement,t))),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function R(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(t){a("removeStream","removeTrack"),this.getSenders().forEach((e=>{e.track&&t.getTracks().includes(e.track)&&this.removeTrack(e)}))})}function $(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function _(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;void 0===t&&(t=[]),t=[...t];const n=t.length>0;n&&t.forEach((t=>{if("rid"in t){if(!/^[a-z0-9]{0,16}$/i.test(t.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in t&&!(parseFloat(t.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in t&&!(parseFloat(t.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=e.apply(this,arguments);if(n){const{sender:e}=r,n=e.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=t,e.sendEncodings=t,this.setParametersPromises.push(e.setParameters(n).then((()=>{delete e.sendEncodings})).catch((()=>{delete e.sendEncodings}))))}return r})}function A(t){if("object"!=typeof t||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const t=e.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function D(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>e.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):e.apply(this,arguments)}}function F(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>e.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):e.apply(this,arguments)}}var O=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",shimOnTrack:T,shimPeerConnection:C,shimSenderGetStats:N,shimReceiverGetStats:E,shimRemoveStream:R,shimRTCDataChannel:$,shimAddTransceiver:_,shimGetParameters:A,shimCreateOffer:D,shimCreateAnswer:F,shimGetUserMedia:S,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)}return!0===n.video?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})}});function L(t){if("object"==typeof t&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach((n=>e.call(this,n,t))),t.getVideoTracks().forEach((n=>e.call(this,n,t)))},t.RTCPeerConnection.prototype.addTrack=function(t,...n){return n&&n.forEach((t=>{this._localStreams?this._localStreams.includes(t)||this._localStreams.push(t):this._localStreams=[t]})),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(t);if(-1===e)return;this._localStreams.splice(e,1);const n=t.getTracks();this.getSenders().forEach((t=>{n.includes(t.track)&&this.removeTrack(t)}))})}}function P(t){if("object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=t=>{t.streams.forEach((t=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(t))return;this._remoteStreams.push(t);const e=new Event("addstream");e.stream=t,this.dispatchEvent(e)}))})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((e=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(e)>=0)return;t._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}))}),e.apply(t,arguments)}}}function M(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(t,e){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return e?(i.then(t,e),Promise.resolve()):i},e.createAnswer=function(t,e){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return e?(i.then(t,e),Promise.resolve()):i};let a=function(t,e,n){const r=i.apply(this,[t]);return n?(r.then(e,n),Promise.resolve()):r};e.setLocalDescription=a,a=function(t,e,n){const r=s.apply(this,[t]);return n?(r.then(e,n),Promise.resolve()):r},e.setRemoteDescription=a,a=function(t,e,n){const r=o.apply(this,[t]);return n?(r.then(e,n),Promise.resolve()):r},e.addIceCandidate=a}function z(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,n=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=t=>n(B(t))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(t,n,r){e.mediaDevices.getUserMedia(t).then(n,r)}.bind(e))}function B(t){return t&&void 0!==t.video?Object.assign({},t,{video:l(t.video)}):t}function U(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(t,n){if(t&&t.iceServers){const e=[];for(let n=0;n<t.iceServers.length;n++){let r=t.iceServers[n];void 0===r.urls&&r.url?(a("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,e.push(r)):e.push(t.iceServers[n])}t.iceServers=e}return new e(t,n)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function V(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function W(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(t){if(t){void 0!==t.offerToReceiveAudio&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);const e=this.getTransceivers().find((t=>"audio"===t.receiver.track.kind));!1===t.offerToReceiveAudio&&e?"sendrecv"===e.direction?e.setDirection?e.setDirection("sendonly"):e.direction="sendonly":"recvonly"===e.direction&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive"):!0!==t.offerToReceiveAudio||e||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==t.offerToReceiveVideo&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);const n=this.getTransceivers().find((t=>"video"===t.receiver.track.kind));!1===t.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==t.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function G(t){"object"!=typeof t||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var j=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",shimLocalStreamsAPI:L,shimRemoteStreamsAPI:P,shimCallbacksAPI:M,shimGetUserMedia:z,shimConstraints:B,shimRTCIceServerUrls:U,shimTrackEventTransceiver:V,shimCreateOfferLegacy:W,shimAudioContext:G}),H="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function q(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}function K(t){var e={exports:{}};return t(e,e.exports),e.exports}var X=K((function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split("\n").map((t=>t.trim()))},e.splitSections=function(t){return t.split("\nm=").map(((t,e)=>(e>0?"m="+t:t).trim()+"\r\n"))},e.getDescription=function(t){const n=e.splitSections(t);return n&&n[0]},e.getMediaSections=function(t){const n=e.splitSections(t);return n.shift(),n},e.matchPrefix=function(t,n){return e.splitLines(t).filter((t=>0===t.indexOf(n)))},e.parseCandidate=function(t){let e;e=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" ");const n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let r=8;r<e.length;r+=2)switch(e[r]){case"raddr":n.relatedAddress=e[r+1];break;case"rport":n.relatedPort=parseInt(e[r+1],10);break;case"tcptype":n.tcpType=e[r+1];break;case"ufrag":n.ufrag=e[r+1],n.usernameFragment=e[r+1];break;default:void 0===n[e[r]]&&(n[e[r]]=e[r+1])}return n},e.writeCandidate=function(t){const e=[];e.push(t.foundation);const n=t.component;"rtp"===n?e.push(1):"rtcp"===n?e.push(2):e.push(n),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.address||t.ip),e.push(t.port);const r=t.type;return e.push("typ"),e.push(r),"host"!==r&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(e.push("tcptype"),e.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(e.push("ufrag"),e.push(t.usernameFragment||t.ufrag)),"candidate:"+e.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let e=t.substring(9).split(" ");const n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=3===e.length?parseInt(e[2],10):1,n.numChannels=n.channels,n},e.writeRtpMap=function(t){let e=t.payloadType;void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType);const n=t.channels||t.numChannels||1;return"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(1!==n?"/"+n:"")+"\r\n"},e.parseExtmap=function(t){const e=t.substring(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1],attributes:e.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&"sendrecv"!==t.direction?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+"\r\n"},e.parseFmtp=function(t){const e={};let n;const r=t.substring(t.indexOf(" ")+1).split(";");for(let i=0;i<r.length;i++)n=r[i].trim().split("="),e[n[0].trim()]=n[1];return e},e.writeFmtp=function(t){let e="",n=t.payloadType;if(void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const r=[];Object.keys(t.parameters).forEach((e=>{void 0!==t.parameters[e]?r.push(e+"="+t.parameters[e]):r.push(e)})),e+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return e},e.parseRtcpFb=function(t){const e=t.substring(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},e.writeRtcpFb=function(t){let e="",n=t.payloadType;return void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach((t=>{e+="a=rtcp-fb:"+n+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"})),e},e.parseSsrcMedia=function(t){const e=t.indexOf(" "),n={ssrc:parseInt(t.substring(7,e),10)},r=t.indexOf(":",e);return r>-1?(n.attribute=t.substring(e+1,r),n.value=t.substring(r+1)):n.attribute=t.substring(e+1),n},e.parseSsrcGroup=function(t){const e=t.substring(13).split(" ");return{semantics:e.shift(),ssrcs:e.map((t=>parseInt(t,10)))}},e.getMid=function(t){const n=e.matchPrefix(t,"a=mid:")[0];if(n)return n.substring(6)},e.parseFingerprint=function(t){const e=t.substring(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},e.getDtlsParameters=function(t,n){return{role:"auto",fingerprints:e.matchPrefix(t+n,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,e){let n="a=setup:"+e+"\r\n";return t.fingerprints.forEach((t=>{n+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"})),n},e.parseCryptoLine=function(t){const e=t.substring(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+("object"==typeof t.keyParams?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+"\r\n"},e.parseCryptoKeyParams=function(t){if(0!==t.indexOf("inline:"))return null;const e=t.substring(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,n){return e.matchPrefix(t+n,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,n){const r=e.matchPrefix(t+n,"a=ice-ufrag:")[0],i=e.matchPrefix(t+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(t){let e="a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n";return t.iceLite&&(e+="a=ice-lite\r\n"),e},e.parseRtpParameters=function(t){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(t)[0].split(" ");n.profile=r[2];for(let s=3;s<r.length;s++){const i=r[s],o=e.matchPrefix(t,"a=rtpmap:"+i+" ")[0];if(o){const r=e.parseRtpMap(o),s=e.matchPrefix(t,"a=fmtp:"+i+" ");switch(r.parameters=s.length?e.parseFmtp(s[0]):{},r.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+i+" ").map(e.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}e.matchPrefix(t,"a=extmap:").forEach((t=>{n.headerExtensions.push(e.parseExtmap(t))}));const i=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return n.codecs.forEach((t=>{i.forEach((e=>{t.rtcpFeedback.find((t=>t.type===e.type&&t.parameter===e.parameter))||t.rtcpFeedback.push(e)}))})),n},e.writeRtpDescription=function(t,n){let r="";r+="m="+t+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((t=>void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((t=>{r+=e.writeRtpMap(t),r+=e.writeFmtp(t),r+=e.writeRtcpFb(t)}));let i=0;return n.codecs.forEach((t=>{t.maxptime>i&&(i=t.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((t=>{r+=e.writeExtmap(t)})),r},e.parseRtpEncodingParameters=function(t){const n=[],r=e.parseRtpParameters(t),i=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),o=e.matchPrefix(t,"a=ssrc:").map((t=>e.parseSsrcMedia(t))).filter((t=>"cname"===t.attribute)),a=o.length>0&&o[0].ssrc;let u;const l=e.matchPrefix(t,"a=ssrc-group:FID").map((t=>t.substring(17).split(" ").map((t=>parseInt(t,10)))));l.length>0&&l[0].length>1&&l[0][0]===a&&(u=l[0][1]),r.codecs.forEach((t=>{if("RTX"===t.name.toUpperCase()&&t.parameters.apt){let e={ssrc:a,codecPayloadType:parseInt(t.parameters.apt,10)};a&&u&&(e.rtx={ssrc:u}),n.push(e),i&&(e=JSON.parse(JSON.stringify(e)),e.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},n.push(e))}})),0===n.length&&a&&n.push({ssrc:a});let c=e.matchPrefix(t,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substring(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substring(5),10)*.95-16e3:void 0,n.forEach((t=>{t.maxBitrate=c}))),n},e.parseRtcpParameters=function(t){const n={},r=e.matchPrefix(t,"a=ssrc:").map((t=>e.parseSsrcMedia(t))).filter((t=>"cname"===t.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=e.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const s=e.matchPrefix(t,"a=rtcp-mux");return n.mux=s.length>0,n},e.writeRtcpParameters=function(t){let e="";return t.reducedSize&&(e+="a=rtcp-rsize\r\n"),t.mux&&(e+="a=rtcp-mux\r\n"),void 0!==t.ssrc&&t.cname&&(e+="a=ssrc:"+t.ssrc+" cname:"+t.cname+"\r\n"),e},e.parseMsid=function(t){let n;const r=e.matchPrefix(t,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=e.matchPrefix(t,"a=ssrc:").map((t=>e.parseSsrcMedia(t))).filter((t=>"msid"===t.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},e.parseSctpDescription=function(t){const n=e.parseMLine(t),r=e.matchPrefix(t,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const s=e.matchPrefix(t,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const o=e.matchPrefix(t,"a=sctpmap:");if(o.length>0){const t=o[0].substring(10).split(" ");return{port:parseInt(t[0],10),protocol:t[1],maxMessageSize:i}}},e.writeSctpDescription=function(t,e){let n=[];return n="DTLS/SCTP"!==t.protocol?["m="+t.kind+" 9 "+t.protocol+" "+e.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+e.port+"\r\n"]:["m="+t.kind+" 9 "+t.protocol+" "+e.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+e.port+" "+e.protocol+" 65535\r\n"],void 0!==e.maxMessageSize&&n.push("a=max-message-size:"+e.maxMessageSize+"\r\n"),n.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,n,r){let i;const s=void 0!==n?n:2;i=t||e.generateSessionId();return"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},e.getDirection=function(t,n){const r=e.splitLines(t);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return"0"===t.split(" ",2)[1]},e.parseMLine=function(t){const n=e.splitLines(t)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.parseOLine=function(t){const n=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;const n=e.splitLines(t);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},t.exports=e})),Y=Object.freeze(Object.assign(Object.create(null),X,{[Symbol.toStringTag]:"Module",default:X}));function Q(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(t){if("object"==typeof t&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substring(2)),t.candidate&&t.candidate.length){const n=new e(t),r=X.parseCandidate(t.candidate);for(const t in r)t in n||Object.defineProperty(n,t,{value:r[t]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new e(t)},t.RTCIceCandidate.prototype=e.prototype,r(t,"icecandidate",(e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e)))}function J(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||r(t,"icecandidate",(t=>{if(t.candidate){const e=X.parseCandidate(t.candidate.candidate);"relay"===e.type&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[e.priority>>24])}return t}))}function Z(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(t){if(!t||!t.sdp)return!1;const e=X.splitSections(t.sdp);return e.shift(),e.some((t=>{const e=X.parseMLine(t);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")}))},r=function(t){const e=t.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;const n=parseInt(e[1],10);return n!=n?-1:n},i=function(t){let n=65536;return"firefox"===e.browser&&(n=e.version<57?-1===t?16384:2147483637:e.version<60?57===e.version?65535:65536:2147483637),n},s=function(t,n){let r=65536;"firefox"===e.browser&&57===e.version&&(r=65535);const i=X.matchPrefix(t.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substring(19),10):"firefox"===e.browser&&-1!==n&&(r=2147483637),r},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===e.browser&&e.version>=76){const{sdpSemantics:t}=this.getConfiguration();"plan-b"===t&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const t=r(arguments[0]),e=i(t),n=s(arguments[0],t);let o;o=0===e&&0===n?Number.POSITIVE_INFINITY:0===e||0===n?Math.max(e,n):Math.min(e,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>o}),this._sctp=a}return o.apply(this,arguments)}}function tt(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(t,e){const n=t.send;t.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===t.readyState&&e.sctp&&i>e.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+e.sctp.maxMessageSize+" bytes)");return n.apply(t,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const t=n.apply(this,arguments);return e(t,this),t},r(t,"datachannel",(t=>(e(t.channel,t.target),t)))}function et(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((t=>{const n=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=t=>{const e=t.target;if(e._lastConnectionState!==e.connectionState){e._lastConnectionState=e.connectionState;const n=new Event("connectionstatechange",t);e.dispatchEvent(n)}return t},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function nt(t,e){if(!t.RTCPeerConnection)return;if("chrome"===e.browser&&e.version>=71)return;if("safari"===e.browser&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(e){if(e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")){const n=e.sdp.split("\n").filter((t=>"a=extmap-allow-mixed"!==t.trim())).join("\n");t.RTCSessionDescription&&e instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:e.type,sdp:n}):e.sdp=n}return n.apply(this,arguments)}}function rt(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===e.browser&&e.version<78||"firefox"===e.browser&&e.version<68||"safari"===e.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function it(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let t=arguments[0]||{};if("object"!=typeof t||t.type&&t.sdp)return n.apply(this,arguments);if(t={type:t.type,sdp:t.sdp},!t.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}if(t.sdp||"offer"!==t.type&&"answer"!==t.type)return n.apply(this,[t]);const e="offer"===t.type?this.createOffer:this.createAnswer;return e.apply(this).then((t=>n.apply(this,[t])))})}var st=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",shimRTCIceCandidate:Q,shimRTCIceCandidateRelayProtocol:J,shimMaxMessageSize:Z,shimSendThrowTypeError:tt,shimConnectionState:et,removeExtmapAllowMixed:nt,shimAddIceCandidateNullOrEmpty:rt,shimParameterlessSetLocalDescription:it});!function({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=o,a=function(t){const e={browser:null,version:null};if(void 0===t||!t.navigator)return e.browser="Not a browser.",e;const{navigator:r}=t;if(r.mozGetUserMedia)e.browser="firefox",e.version=n(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===t.isSecureContext&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=n(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=n(r.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype}return e}(t),u={browserDetails:a,commonShim:st,extractVersion:n,disableLog:i,disableWarnings:s,sdp:Y};switch(a.browser){case"chrome":if(!I||!w||!e.shimChrome)return r("Chrome shim is not included in this adapter release."),u;if(null===a.version)return r("Chrome shim can not determine version, not shimming."),u;r("adapter.js shimming chrome."),u.browserShim=I,rt(t,a),it(t),p(t,a),f(t),w(t,a),g(t),x(t,a),m(t),y(t),b(t),k(t,a),Q(t),J(t),et(t),Z(t,a),tt(t),nt(t,a);break;case"firefox":if(!O||!C||!e.shimFirefox)return r("Firefox shim is not included in this adapter release."),u;r("adapter.js shimming firefox."),u.browserShim=O,rt(t,a),it(t),S(t,a),C(t,a),T(t),R(t),N(t),E(t),$(t),_(t),A(t),D(t),F(t),Q(t),et(t),Z(t,a),tt(t);break;case"safari":if(!j||!e.shimSafari)return r("Safari shim is not included in this adapter release."),u;r("adapter.js shimming safari."),u.browserShim=j,rt(t,a),it(t),U(t),W(t),M(t),L(t),P(t),V(t),z(t),G(t),Q(t),J(t),Z(t,a),tt(t),nt(t,a);break;default:r("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var ot=function(t,e){return(ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function at(t,e){function n(){this.constructor=t}ot(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var ut=function(){return(ut=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function lt(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{u(r.next(t))}catch(pg){s(pg)}}function a(t){try{u(r.throw(t))}catch(pg){s(pg)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))}function ct(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(pg){s=[6,pg],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function ht(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function dt(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ht(arguments[e]));return t}function pt(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ft(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=ft(t[n],e[n]));return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var gt=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mt(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function yt(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(pg){return!1}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var bt=function(t){function e(n,r,i){var s=t.call(this,r)||this;return s.code=n,s.customData=i,s.name="FirebaseError",Object.setPrototypeOf(s,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(s,vt.prototype.create),s}return at(e,t),e}(Error),vt=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e[0]||{},i=this.service+"/"+t,s=this.errors[t],o=s?xt(s,r):"Error",a=this.serviceName+": "+o+" ("+i+").",u=new bt(i,a,r);return u},t}();function xt(t,e){return t.replace(wt,(function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"}))}var wt=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function It(t,e){var n=new St(t,e);return n.subscribe.bind(n)}var St=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=Tt),void 0===r.error&&(r.error=Tt),void 0===r.complete&&(r.complete=Tt);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(pg){}})),this.observers.push(r),s},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(pg){"undefined"!=typeof console&&console.error&&console.error(pg)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function Tt(){}var Ct=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),Nt=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]");var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new gt;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(pg){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=ut({identifier:"[DEFAULT]",optional:!1},t),n=e.identifier,r=e.optional,i=this.normalizeInstanceIdentifier(n);try{var s=this.getOrInitializeService(i);if(!s){if(r)return null;throw Error("Service "+this.name+" is not available")}return s}catch(pg){if(r)return null;throw pg}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService("[DEFAULT]")}catch(pg){}try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var s=ht(i.value,2),o=s[0],a=s[1],u=this.normalizeInstanceIdentifier(o);try{var l=this.getOrInitializeService(u);a.resolve(l)}catch(pg){}}}catch(c){e={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return lt(this,void 0,void 0,(function(){var t;return ct(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(dt(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})),t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()}))))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.isInitialized=function(t){return void 0===t&&(t="[DEFAULT]"),this.instances.has(t)},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return"[DEFAULT]"===t?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Et,Rt=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new Nt(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function $t(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t,At,Dt=[];(At=_t||(_t={}))[At.DEBUG=0]="DEBUG",At[At.VERBOSE=1]="VERBOSE",At[At.INFO=2]="INFO",At[At.WARN=3]="WARN",At[At.ERROR=4]="ERROR",At[At.SILENT=5]="SILENT";var Ft,Ot={debug:_t.DEBUG,verbose:_t.VERBOSE,info:_t.INFO,warn:_t.WARN,error:_t.ERROR,silent:_t.SILENT},Lt=_t.INFO,Pt=((Et={})[_t.DEBUG]="log",Et[_t.VERBOSE]="log",Et[_t.INFO]="info",Et[_t.WARN]="warn",Et[_t.ERROR]="error",Et),Mt=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),s=Pt[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[s].apply(console,$t(["["+i+"]  "+t.name+":"],n))}},zt=function(){function t(t){this.name=t,this._logLevel=Lt,this._logHandler=Mt,this._userLogHandler=null,Dt.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in _t))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?Ot[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,$t([this,_t.DEBUG],t)),this._logHandler.apply(this,$t([this,_t.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,$t([this,_t.VERBOSE],t)),this._logHandler.apply(this,$t([this,_t.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,$t([this,_t.INFO],t)),this._logHandler.apply(this,$t([this,_t.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,$t([this,_t.WARN],t)),this._logHandler.apply(this,$t([this,_t.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,$t([this,_t.ERROR],t)),this._logHandler.apply(this,$t([this,_t.ERROR],t))},t}();function Bt(t){Dt.forEach((function(e){e.setLogLevel(t)}))}var Ut,Vt=((Ft={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Ft["bad-app-name"]="Illegal App name: '{$appName}",Ft["duplicate-app"]="Firebase App named '{$appName}' already exists",Ft["app-deleted"]="Firebase App named '{$appName}' already deleted",Ft["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Ft["invalid-log-argument"]="First argument to `onLog` must be null or a function.",Ft),Wt=new vt("app","Firebase",Vt),Gt=((Ut={})["@firebase/app"]="fire-core",Ut["@firebase/analytics"]="fire-analytics",Ut["@firebase/auth"]="fire-auth",Ut["@firebase/database"]="fire-rtdb",Ut["@firebase/functions"]="fire-fn",Ut["@firebase/installations"]="fire-iid",Ut["@firebase/messaging"]="fire-fcm",Ut["@firebase/performance"]="fire-perf",Ut["@firebase/remote-config"]="fire-rc",Ut["@firebase/storage"]="fire-gcs",Ut["@firebase/firestore"]="fire-fst",Ut["fire-js"]="fire-js",Ut["firebase-wrapper"]="fire-js-all",Ut),jt=new zt("@firebase/app"),Ht=function(){function t(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=ft(void 0,t),this.container=new Rt(e.name),this._addComponent(new Ct("app",(function(){return r}),"PUBLIC")),this.firebase_.INTERNAL.components.forEach((function(t){return r._addComponent(t)}))}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e="[DEFAULT]"),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(pg){jt.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,pg)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw Wt.create("app-deleted",{appName:this.name_})},t}();Ht.prototype.name&&Ht.prototype.options||Ht.prototype.delete||console.log("dc");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function qt(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var s=i;void 0===s.name&&(s.name="[DEFAULT]");var o=s.name;if("string"!=typeof o||!o)throw Wt.create("bad-app-name",{appName:String(o)});if(kt(e,o))throw Wt.create("duplicate-app",{appName:o});var a=new t(n,s,r);return e[o]=a,a},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=Gt[t])&&void 0!==r?r:t;n&&(i+="-"+n);var o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){var u=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&a&&u.push("and"),a&&u.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void jt.warn(u.join(" "))}s(new Ct(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:Bt,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw Wt.create("invalid-log-argument");!function(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=Ot[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var o=i.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(e){return null}})).filter((function(t){return t})).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:_t[n].toLowerCase(),message:o,args:i,type:e.name})}},r=0,i=Dt;r<i.length;r++)n(i[r])}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,e)},apps:null,SDK_VERSION:"8.2.9",INTERNAL:{registerComponent:s,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){if("serverAuth"===e)return null;return e}}};function i(t){if(!kt(e,t=t||"[DEFAULT]"))throw Wt.create("no-app",{appName:t});return e[t]}function s(s){var o=s.name;if(n.has(o))return jt.debug("There were multiple attempts to register component "+o+"."),"PUBLIC"===s.type?r[o]:null;if(n.set(o,s),"PUBLIC"===s.type){var a=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[o])throw Wt.create("invalid-app-argument",{appName:o});return t[o]()};void 0!==s.serviceProps&&ft(a,s.serviceProps),r[o]=a,t.prototype[o]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,o);return n.apply(this,s.multipleInstances?t:[])}}for(var u=0,l=Object.keys(e);u<l.length;u++){var c=l[u];e[c]._addComponent(s)}return"PUBLIC"===s.type?r[o]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kt=function t(){var e=qt(Ht);return e.INTERNAL=ut(ut({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){ft(e,t)},createSubscribe:It,ErrorFactory:vt,deepExtend:ft}),e}(),Xt=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if("object"==typeof self&&self.self===self&&void 0!==self.firebase){jt.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var Yt=self.firebase.SDK_VERSION;Yt&&Yt.indexOf("LITE")>=0&&jt.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var Qt=Kt.initializeApp;Kt.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return yt()&&jt.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),Qt.apply(void 0,t)};var Jt,Zt,te=Kt;(Jt=te).INTERNAL.registerComponent(new Ct("platform-logger",(function(t){return new Xt(t)}),"PRIVATE")),Jt.registerVersion("@firebase/app","0.6.15",Zt),Jt.registerVersion("fire-js","");
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
te.registerVersion("firebase","8.2.10","app");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var ee=function(t,e){return(ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function ne(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var re,ie="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},se=se||{},oe=ie||self;function ae(){}function ue(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function le(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ce="closure_uid_"+(1e9*Math.random()>>>0),he=0;function de(t,e,n){return t.call.apply(t.bind,arguments)}function pe(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function fe(t,e,n){return(fe=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?de:pe).apply(null,arguments)}function ge(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function me(){return Date.now()}function ye(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function be(){this.j=this.j,this.i=this.i}be.prototype.j=!1,be.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,ce)&&t[ce]||(t[ce]=++he))},be.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var ve=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},xe=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,s=0;s<r;s++)s in i&&e.call(n,i[s],s,t)};function we(t){return Array.prototype.concat.apply([],arguments)}function ke(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Ie(t){return/^[\s\xa0]*$/.test(t)}var Se,Te=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Ce(t,e){return-1!=t.indexOf(e)}function Ne(t,e){return t<e?-1:t>e?1:0}t:{var Ee=oe.navigator;if(Ee){var Re=Ee.userAgent;if(Re){Se=Re;break t}}Se=""}function $e(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function _e(t){var e={};for(var n in t)e[n]=t[n];return e}var Ae="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function De(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var s=0;s<Ae.length;s++)n=Ae[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Fe(t){return Fe[" "](t),t}Fe[" "]=ae;var Oe,Le,Pe=Ce(Se,"Opera"),Me=Ce(Se,"Trident")||Ce(Se,"MSIE"),ze=Ce(Se,"Edge"),Be=ze||Me,Ue=Ce(Se,"Gecko")&&!(Ce(Se.toLowerCase(),"webkit")&&!Ce(Se,"Edge"))&&!(Ce(Se,"Trident")||Ce(Se,"MSIE"))&&!Ce(Se,"Edge"),Ve=Ce(Se.toLowerCase(),"webkit")&&!Ce(Se,"Edge");function We(){var t=oe.document;return t?t.documentMode:void 0}t:{var Ge="",je=(Le=Se,Ue?/rv:([^\);]+)(\)|;)/.exec(Le):ze?/Edge\/([\d\.]+)/.exec(Le):Me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Le):Ve?/WebKit\/(\S+)/.exec(Le):Pe?/(?:Version)[ \/]?(\S+)/.exec(Le):void 0);if(je&&(Ge=je?je[1]:""),Me){var He=We();if(null!=He&&He>parseFloat(Ge)){Oe=String(He);break t}}Oe=Ge}var qe,Ke={};function Xe(t){return function(t,e){var n=Ke;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=Te(String(Oe)).split("."),r=Te(String(t)).split("."),i=Math.max(n.length,r.length),s=0;0==e&&s<i;s++){var o=n[s]||"",a=r[s]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=Ne(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Ne(0==o[2].length,0==a[2].length)||Ne(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e}))}if(oe.document&&Me){var Ye=We();qe=Ye||(parseInt(Oe,10)||void 0)}else qe=void 0;var Qe=qe,Je=!Me||9<=Number(Qe),Ze=Me&&!Xe("9"),tn=function(){if(!oe.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{oe.addEventListener("test",ae,e),oe.removeEventListener("test",ae,e)}catch(n){}return t}();function en(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function nn(t,e){if(en.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Ue){t:{try{Fe(e.nodeName);var i=!0;break t}catch(s){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:rn[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}en.prototype.b=function(){this.defaultPrevented=!0},ye(nn,en);var rn={2:"touch",3:"pen",4:"mouse"};nn.prototype.b=function(){nn.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Ze)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var sn="closure_listenable_"+(1e6*Math.random()|0),on=0;function an(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++on,this.Y=this.Z=!1}function un(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function ln(t){this.src=t,this.a={},this.b=0}function cn(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],s=ve(i,e);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(un(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function hn(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.Y&&s.listener==e&&s.capture==!!n&&s.ca==r)return i}return-1}ln.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.a[s])||(t=this.a[s]=[],this.b++);var o=hn(t,e,r,i);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new an(e,this.src,s,!!r,i)).Z=n,t.push(e)),e};var dn="closure_lm_"+(1e6*Math.random()|0),pn={};function fn(t,e,n,r,i){if(r&&r.once)return mn(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)fn(t,e[s],n,r,i);return null}return n=Sn(n),t&&t[sn]?t.va(e,n,le(r)?!!r.capture:!!r,i):gn(t,e,n,!1,r,i)}function gn(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=le(i)?!!i.capture:!!i;if(o&&!Je)return null;var a=kn(t);if(a||(t[dn]=a=new ln(t)),(n=a.add(e,n,r,o,s)).proxy)return n;if(r=function(){var t=wn,e=Je?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)tn||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(vn(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function mn(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)mn(t,e[s],n,r,i);return null}return n=Sn(n),t&&t[sn]?t.wa(e,n,le(r)?!!r.capture:!!r,i):gn(t,e,n,!0,r,i)}function yn(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)yn(t,e[s],n,r,i);else r=le(r)?!!r.capture:!!r,n=Sn(n),t&&t[sn]?(t=t.c,(e=String(e).toString())in t.a&&(-1<(n=hn(s=t.a[e],n,r,i))&&(un(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.a[e],t.b--)))):t&&(t=kn(t))&&(e=t.a[e.toString()],t=-1,e&&(t=hn(e,n,r,i)),(n=-1<t?e[t]:null)&&bn(n))}function bn(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[sn])cn(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(vn(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=kn(e))?(cn(n,t),0==n.b&&(n.src=null,e[dn]=null)):un(t)}}}function vn(t){return t in pn?pn[t]:pn[t]="on"+t}function xn(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&bn(t),n.call(r,e)}function wn(t,e){if(t.Y)return!0;if(!Je){if(!e)t:{e=["window","event"];for(var n=oe,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return xn(t,e=new nn(e,this))}return xn(t,new nn(e,this))}function kn(t){return(t=t[dn])instanceof ln?t:null}var In="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sn(t){return"function"==typeof t?t:(t[In]||(t[In]=function(e){return t.handleEvent(e)}),t[In])}function Tn(){be.call(this),this.c=new ln(this),this.J=this,this.C=null}function Cn(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new en(e,t);else if(e instanceof en)e.target=e.target||t;else{var i=e;De(e=new en(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.a=n[s];i=Nn(o,r,!0,e)&&i}if(i=Nn(o=e.a=t,r,!0,e)&&i,i=Nn(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=Nn(o=e.a=n[s],r,!1,e)&&i}function Nn(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.Y&&o.capture==n){var a=o.listener,u=o.ca||o.src;o.Z&&cn(t.c,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ye(Tn,be),Tn.prototype[sn]=!0,(re=Tn.prototype).addEventListener=function(t,e,n,r){fn(this,t,e,n,r)},re.removeEventListener=function(t,e,n,r){yn(this,t,e,n,r)},re.G=function(){if(Tn.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)un(n[r]);delete e.a[t],e.b--}}this.C=null},re.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},re.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var En=oe.JSON.stringify;function Rn(){this.b=this.a=null}var $n,_n=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new Dn}),(function(t){t.reset()}));function An(){var t=Pn,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Dn(){this.next=this.b=this.a=null}function Fn(t){oe.setTimeout((function(){throw t}),0)}function On(t,e){$n||function(){var t=oe.Promise.resolve(void 0);$n=function(){t.then(Mn)}}(),Ln||($n(),Ln=!0),Pn.add(t,e)}Rn.prototype.add=function(t,e){var n=_n.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Dn.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Dn.prototype.reset=function(){this.next=this.b=this.a=null};var Ln=!1,Pn=new Rn;function Mn(){for(var t;t=An();){try{t.a.call(t.b)}catch(n){Fn(n)}var e=_n;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Ln=!1}function zn(t,e){Tn.call(this),this.b=t||1,this.a=e||oe,this.f=fe(this.Za,this),this.g=me()}function Bn(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Un(t,e,n){if("function"==typeof t)n&&(t=fe(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=fe(t.handleEvent,t)}return 2147483647<Number(e)?-1:oe.setTimeout(t,e||0)}function Vn(t){t.a=Un((function(){t.a=null,t.c&&(t.c=!1,Vn(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}ye(zn,Tn),(re=zn.prototype).aa=!1,re.M=null,re.Za=function(){if(this.aa){var t=me()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Cn(this,"tick"),this.aa&&(Bn(this),this.start()))}},re.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=me())},re.G=function(){zn.X.G.call(this),Bn(this),delete this.a};var Wn=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}ee(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:Vn(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(oe.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(be);function Gn(t){be.call(this),this.b=t,this.a={}}ye(Gn,be);var jn=[];function Hn(t,e,n,r){Array.isArray(n)||(n&&(jn[0]=n.toString()),n=jn);for(var i=0;i<n.length;i++){var s=fn(e,n[i],r||t.handleEvent,!1,t.b||t);if(!s)break;t.a[s.key]=s}}function qn(t){$e(t.a,(function(t,e){this.a.hasOwnProperty(e)&&bn(t)}),t),t.a={}}function Kn(){this.a=!0}function Xn(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return En(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Gn.prototype.G=function(){Gn.X.G.call(this),qn(this)},Gn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Kn.prototype.info=function(){};var Yn={},Qn=null;function Jn(){return Qn=Qn||new Tn}function Zn(t){en.call(this,Yn.Fa,t)}function tr(t){var e=Jn();Cn(e,new Zn(e,t))}function er(t,e){en.call(this,Yn.STAT_EVENT,t),this.stat=e}function nr(t){var e=Jn();Cn(e,new er(e,t))}function rr(t){en.call(this,Yn.Ga,t)}function ir(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return oe.setTimeout((function(){t()}),e)}Yn.Fa="serverreachability",ye(Zn,en),Yn.STAT_EVENT="statevent",ye(er,en),Yn.Ga="timingevent",ye(rr,en);var sr={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},or={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function ar(){}function ur(t){var e;return(e=t.a)||(e=t.a={}),e}function lr(){}ar.prototype.a=null;var cr,hr={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function dr(){en.call(this,"d")}function pr(){en.call(this,"c")}function fr(){}function gr(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new Gn(this),this.P=mr,t=Be?125:void 0,this.R=new zn(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}ye(dr,en),ye(pr,en),ye(fr,ar),cr=new fr;var mr=45e3,yr={},br={};function vr(t,e,n){t.H=1,t.i=Ur(Or(e)),t.j=n,t.I=!0,xr(t,null)}function xr(t,e){t.u=me(),Ir(t),t.l=Or(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),ti(n.b,"t",r),t.D=0,t.a=Ki(t.g,t.g.C?e:null),0<t.O&&(t.F=new Wn(fe(t.Ca,t,t.a),t.O)),Hn(t.J,t.a,"readystatechange",t.Xa),e=t.B?_e(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),tr(1),function(t,e,n,r,i,s){t.info((function(){if(t.a)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var l=a[u].split("=");if(1<l.length){var c=l[0];l=l[1];var h=c.split("_");o=2<=h.length&&"type"==h[1]?o+(c+"=")+l+"&":o+(c+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function wr(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=kr(t,n);if(i==br){4==e&&(t.h=4,nr(14),r=!1),Xn(t.c,t.f,null,"[Incomplete Response]");break}if(i==yr){t.h=4,nr(15),Xn(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}Xn(t.c,t.f,i,null),Er(t,i)}4==e&&0==n.length&&(t.h=1,nr(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Bi(e),e.F=!0,nr(11))):(Xn(t.c,t.f,n,"[Invalid Chunked Response]"),Nr(t),Cr(t))}function kr(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?br:(n=Number(e.substring(n,r)),isNaN(n)?yr:(r+=1)+n>e.length?br:(e=e.substr(r,n),t.D=r+n,e))}function Ir(t){t.T=me()+t.P,Sr(t,t.P)}function Sr(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ir(fe(t.Va,t),e)}function Tr(t){t.o&&(oe.clearTimeout(t.o),t.o=null)}function Cr(t){0==t.g.v||t.A||Wi(t.g,t)}function Nr(t){Tr(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Bn(t.R),qn(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Er(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||ai(n.b,t)))if(n.I=t.N,!t.C&&ai(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(m){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Vi(n),_i(n)}zi(n),nr(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=ir(fe(n.Sa,n),6e3));if(1>=oi(n.b)&&n.ea){try{n.ea()}catch(m){}n.ea=void 0}}else ji(n,11)}else if((t.C||n.a==t)&&Vi(n),!Ie(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var s=i[3];null!=s&&(n.ha=s,n.c.info("VER="+n.ha));var o=i[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var l=t.a;if(l){var c=l.a?l.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var h=u.b;!h.a&&(Ce(c,"spdy")||Ce(c,"quic")||Ce(c,"h2"))&&(h.f=h.g,h.a=new Set,h.b&&(ui(h,h.b),h.b=null))}if(u.A){var d=l.a?l.a.getResponseHeader("X-HTTP-Session-Id"):null;d&&(u.na=d,Br(u.B,u.A,d))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=me()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var p=t;if((u=n).la=qi(u,u.C?u.ga:null,u.fa),p.C){li(u.b,p);var f=p,g=u.D;g&&f.setTimeout(g),f.o&&(Tr(f),Ir(f)),u.a=p}else Mi(u);0<n.g.length&&Fi(n)}else"stop"!=i[0]&&"close"!=i[0]||ji(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ji(n,7):$i(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);tr(4)}catch(m){}}function Rr(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(ue(t)||"string"==typeof t)xe(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(ue(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(ue(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}}function $r(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof $r)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function _r(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ar(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ar(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Ar(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(re=gr.prototype).setTimeout=function(t){this.P=t},re.Xa=function(t){t=t.target;var e=this.F;e&&3==Ci(t)?e.f():this.Ca(t)},re.Ca=function(t){try{if(t==this.a)t:{var e=Ci(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!Be&&!this.a.$())){this.A||4!=e||7==n||tr(8==n||0>=r?3:2),Tr(this);var i=this.a.W();this.N=i;var s=this.a.$();if(this.b=200==i,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ie(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.h=3,nr(12),Nr(this),Cr(this);break t}Xn(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Er(this,u)}this.I?(wr(this,e,s),Be&&this.b&&3==e&&(Hn(this.J,this.R,"tick",this.Wa),this.R.start())):(Xn(this.c,this.f,s,null),Er(this,s)),4==e&&Nr(this),this.b&&!this.A&&(4==e?Wi(this.g,this):(this.b=!1,Ir(this)))}else 400==i&&0<s.indexOf("Unknown SID")?(this.h=3,nr(12)):(this.h=0,nr(13)),Nr(this),Cr(this)}}}catch(l){}},re.Wa=function(){if(this.a){var t=Ci(this.a),e=this.a.$();this.D<e.length&&(Tr(this),wr(this,t,e),this.b&&4!=t&&Ir(this))}},re.cancel=function(){this.A=!0,Nr(this)},re.Va=function(){this.o=null;var t=me();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(tr(3),nr(17)),Nr(this),this.h=2,Cr(this)):Sr(this,this.T-t)},(re=$r.prototype).K=function(){_r(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},re.L=function(){return _r(this),this.a.concat()},re.get=function(t,e){return Ar(this.b,t)?this.b[t]:e},re.set=function(t,e){Ar(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},re.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);t.call(e,s,i,this)}};var Dr=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Fr(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Fr){this.a=void 0!==e?e:t.a,Lr(this,t.f),this.j=t.j,Pr(this,t.c),Mr(this,t.h),this.g=t.g,e=t.b;var n=new Yr;n.c=e.c,e.a&&(n.a=new $r(e.a),n.b=e.b),zr(this,n),this.i=t.i}else t&&(n=String(t).match(Dr))?(this.a=!!e,Lr(this,n[1]||"",!0),this.j=Vr(n[2]||""),Pr(this,n[3]||"",!0),Mr(this,n[4]),this.g=Vr(n[5]||"",!0),zr(this,n[6]||"",!0),this.i=Vr(n[7]||"")):(this.a=!!e,this.b=new Yr(null,this.a))}function Or(t){return new Fr(t)}function Lr(t,e,n){t.f=n?Vr(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Pr(t,e,n){t.c=n?Vr(e,!0):e}function Mr(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function zr(t,e,n){e instanceof Yr?(t.b=e,function(t,e){e&&!t.f&&(Qr(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Jr(this,e),ti(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=Wr(e,Kr)),t.b=new Yr(e,t.a))}function Br(t,e,n){t.b.set(e,n)}function Ur(t){return Br(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^me()).toString(36)),t}function Vr(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Wr(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Gr),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Gr(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Fr.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Wr(e,jr,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Wr(e,jr,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Wr(n,"/"==n.charAt(0)?qr:Hr,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Wr(n,Xr)),t.join("")};var jr=/[#\/\?@]/g,Hr=/[#\?:]/g,qr=/[#\?]/g,Kr=/[#\?@]/g,Xr=/#/g;function Yr(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Qr(t){t.a||(t.a=new $r,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Jr(t,e){Qr(t),e=ei(t,e),Ar(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ar((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&_r(t)))}function Zr(t,e){return Qr(t),e=ei(t,e),Ar(t.a.b,e)}function ti(t,e,n){Jr(t,e),0<n.length&&(t.c=null,t.a.set(ei(t,e),ke(n)),t.b+=n.length)}function ei(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(re=Yr.prototype).add=function(t,e){Qr(this),this.c=null,t=ei(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},re.forEach=function(t,e){Qr(this),this.a.forEach((function(n,r){xe(n,(function(n){t.call(e,n,r,this)}),this)}),this)},re.L=function(){Qr(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],s=0;s<i.length;s++)n.push(e[r]);return n},re.K=function(t){Qr(this);var e=[];if("string"==typeof t)Zr(this,t)&&(e=we(e,this.a.get(ei(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=we(e,t[n])}return e},re.set=function(t,e){return Qr(this),this.c=null,Zr(this,t=ei(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},re.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},re.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),t.push(o)}}return this.c=t.join("&")};var ni=function(t,e){this.b=t,this.a=e};function ri(t){this.g=t||ii,oe.PerformanceNavigationTiming?t=0<(t=oe.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(oe.ia&&oe.ia.ya&&oe.ia.ya()&&oe.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var ii=10;function si(t){return!!t.b||!!t.a&&t.a.size>=t.f}function oi(t){return t.b?1:t.a?t.a.size:0}function ai(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function ui(t,e){t.a?t.a.add(e):t.b=e}function li(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function ci(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=ne(t.a.values()),s=i.next();!s.done;s=i.next()){var o=s.value;r=r.concat(o.s)}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return ke(t.c)}function hi(){}function di(){this.a=new hi}function pi(t,e,n){var r=n||"";try{Rr(t,(function(t,n){var i=t;le(t)&&(i=En(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(pg){throw e.push(r+"type="+encodeURIComponent("_badmap")),pg}}function fi(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(s){}}ri.prototype.cancel=function(){var t,e;if(this.c=ci(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=ne(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},hi.prototype.stringify=function(t){return oe.JSON.stringify(t,void 0)},hi.prototype.parse=function(t){return oe.JSON.parse(t,void 0)};var gi=oe.JSON.parse;function mi(t){Tn.call(this),this.headers=new $r,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=yi,this.D=this.F=!1}ye(mi,Tn);var yi="",bi=/^https?$/i,vi=["POST","PUT"];function xi(t){return"content-type"==t.toLowerCase()}function wi(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,ki(t),Si(t)}function ki(t){t.u||(t.u=!0,Cn(t,"complete"),Cn(t,"error"))}function Ii(t){if(t.b&&void 0!==se&&(!t.s[1]||4!=Ci(t)||2!=t.W()))if(t.l&&4==Ci(t))Un(t.za,0,t);else if(Cn(t,"readystatechange"),4==Ci(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.B).match(Dr)[1]||null;if(!s&&oe.self&&oe.self.location){var o=oe.self.location.protocol;s=o.substr(0,o.length-1)}i=!bi.test(s?s.toLowerCase():"")}e=i}if(e)Cn(t,"complete"),Cn(t,"success");else{t.h=6;try{var a=2<Ci(t)?t.a.statusText:""}catch(u){a=""}t.f=a+" ["+t.W()+"]",ki(t)}}finally{Si(t)}}}function Si(t,e){if(t.a){Ti(t);var n=t.a,r=t.s[0]?ae:null;t.a=null,t.s=null,e||Cn(t,"ready");try{n.onreadystatechange=r}catch(pg){}}}function Ti(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(oe.clearTimeout(t.m),t.m=null)}function Ci(t){return t.a?t.a.readyState:0}function Ni(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return $e(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Br(t,e,n))}function Ei(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ri(t){this.pa=0,this.g=[],this.c=new Kn,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Ei("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Ei("baseRetryDelayMs",5e3,t),this.Ra=Ei("retryDelaySeedMs",1e4,t),this.Ma=Ei("forwardChannelMaxRetries",2,t),this.ma=Ei("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new ri(t&&t.concurrentRequestLimit),this.ka=new di,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function $i(t){if(Ai(t),3==t.v){var e=t.R++,n=Or(t.B);Br(n,"SID",t.J),Br(n,"RID",e),Br(n,"TYPE","terminate"),Li(t,n),(e=new gr(t,t.c,e,void 0)).H=2,e.i=Ur(Or(n)),n=!1,oe.navigator&&oe.navigator.sendBeacon&&(n=oe.navigator.sendBeacon(e.i.toString(),"")),!n&&oe.Image&&((new Image).src=e.i,n=!0),n||(e.a=Ki(e.g,null),e.a.ba(e.i)),e.u=me(),Ir(e)}Hi(t)}function _i(t){t.a&&(Bi(t),t.a.cancel(),t.a=null)}function Ai(t){_i(t),t.j&&(oe.clearTimeout(t.j),t.j=null),Vi(t),t.b.cancel(),t.h&&("number"==typeof t.h&&oe.clearTimeout(t.h),t.h=null)}function Di(t,e){t.g.push(new ni(t.Oa++,e)),3==t.v&&Fi(t)}function Fi(t){si(t.b)||t.h||(t.h=!0,On(t.Ba,t),t.u=0)}function Oi(t,e){var n;n=e?e.f:t.R++;var r=Or(t.B);Br(r,"SID",t.J),Br(r,"RID",n),Br(r,"AID",t.P),Li(t,r),t.i&&t.l&&Ni(r,t.i,t.l),n=new gr(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Pi(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),ui(t.b,n),vr(n,r,e)}function Li(t,e){t.f&&Rr({},(function(t,n){Br(e,n,t)}))}function Pi(t,e,n){n=Math.min(t.g.length,n);var r=t.f?fe(t.f.Ja,t.f,t):null;t:for(var i=t.g,s=-1;;){var o=["count="+n];-1==s?0<n?(s=i[0].b,o.push("ofs="+s)):s=0:o.push("ofs="+s);for(var a=!0,u=0;u<n;u++){var l=i[u].b,c=i[u].a;if(0>(l-=s))s=Math.max(0,i[u].b-100),a=!1;else try{pi(c,o,"req"+l+"_")}catch(h){r&&r(c)}}if(a){r=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Mi(t){t.a||t.j||(t.T=1,On(t.Aa,t),t.o=0)}function zi(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ir(fe(t.Aa,t),Gi(t,t.o)),t.o++,!0)}function Bi(t){null!=t.s&&(oe.clearTimeout(t.s),t.s=null)}function Ui(t){t.a=new gr(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Or(t.la);Br(e,"RID","rpc"),Br(e,"SID",t.J),Br(e,"CI",t.H?"0":"1"),Br(e,"AID",t.P),Li(t,e),Br(e,"TYPE","xmlhttp"),t.i&&t.l&&Ni(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Ur(Or(e)),n.j=null,n.I=!0,xr(n,t)}function Vi(t){null!=t.m&&(oe.clearTimeout(t.m),t.m=null)}function Wi(t,e){var n=null;if(t.a==e){Vi(t),Bi(t),t.a=null;var r=2}else{if(!ai(t.b,e))return;n=e.s,li(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=me()-e.u;var i=t.u;Cn(r=Jn(),new rr(r,n,e,i)),Fi(t)}else Mi(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(oi(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=ir(fe(t.Ba,t,e),Gi(t,t.u)),t.u++,0)))}(t,e)||2==r&&zi(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ji(t,5);break;case 4:ji(t,10);break;case 3:ji(t,6);break;default:ji(t,2)}}function Gi(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function ji(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=fe(t.Ya,t);n||(n=new Fr("//www.google.com/images/cleardot.gif"),oe.location&&"http"==oe.location.protocol||Lr(n,"https"),Ur(n)),function(t,e){var n=new Kn;if(oe.Image){var r=new Image;r.onload=ge(fi,n,r,"TestLoadImage: loaded",!0,e),r.onerror=ge(fi,n,r,"TestLoadImage: error",!1,e),r.onabort=ge(fi,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=ge(fi,n,r,"TestLoadImage: timeout",!1,e),oe.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else nr(2);t.v=0,t.f&&t.f.ra(e),Hi(t),Ai(t)}function Hi(t){t.v=0,t.I=-1,t.f&&(0==ci(t.b).length&&0==t.g.length||(t.b.c.length=0,ke(t.g),t.g.length=0),t.f.qa())}function qi(t,e,n){var r=function(t){return t instanceof Fr?Or(t):new Fr(t,void 0)}(n);if(""!=r.c)e&&Pr(r,e+"."+r.c),Mr(r,r.h);else{var i=oe.location;r=function(t,e,n,r){var i=new Fr(null,void 0);return t&&Lr(i,t),e&&Pr(i,e),n&&Mr(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&$e(t.V,(function(t,e){Br(r,e,t)})),e=t.A,n=t.na,e&&n&&Br(r,e,n),Br(r,"VER",t.ha),Li(t,r),r}function Ki(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new mi(t.Na)).F=t.C,e}function Xi(){}function Yi(){if(Me&&!(10<=Number(Qe)))throw Error("Environmental error: no available transport.")}function Qi(t,e){Tn.call(this),this.a=new Ri(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!Ie(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ie(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new ts(this)}function Ji(t){dr.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Zi(){pr.call(this),this.status=1}function ts(t){this.a=t}(re=mi.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ur(this.H):ur(cr),this.a.onreadystatechange=fe(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(s){return void wi(this,s)}t=n||"";var i=new $r(this.headers);r&&Rr(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=xi,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=oe.FormData&&t instanceof oe.FormData,!(0<=ve(vi,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Ti(this),0<this.o&&((this.D=function(t){return Me&&Xe(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=fe(this.xa,this)):this.m=Un(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(s){wi(this,s)}},re.xa=function(){void 0!==se&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Cn(this,"timeout"),this.abort(8))},re.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Cn(this,"complete"),Cn(this,"abort"),Si(this))},re.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Si(this,!0)),mi.X.G.call(this)},re.za=function(){this.j||(this.A||this.l||this.g?Ii(this):this.Ua())},re.Ua=function(){Ii(this)},re.W=function(){try{return 2<Ci(this)?this.a.status:-1}catch(Le){return-1}},re.$=function(){try{return this.a?this.a.responseText:""}catch(Le){return""}},re.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),gi(e)}},re.ua=function(){return this.h},re.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(re=Ri.prototype).ha=8,re.v=1,re.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new gr(this,this.c,t,void 0),r=this.l;if(this.O&&(r?De(r=_e(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var s=this.g[i];if(void 0===(s="__data__"in s.a&&"string"==typeof(s=s.a.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Pi(this,n,e),Br(i=Or(this.B),"RID",t),Br(i,"CVER",22),this.A&&Br(i,"X-HTTP-Session-Id",this.A),Li(this,i),this.i&&r&&Ni(i,this.i,r),ui(this.b,n),this.Ia&&Br(i,"TYPE","init"),this.da?(Br(i,"$req",e),Br(i,"SID","null"),n.U=!0,vr(n,i,null)):vr(n,i,e),this.v=2}}else 3==this.v&&(t?Oi(this,t):0==this.g.length||si(this.b)||Oi(this))},re.Aa=function(){if(this.j=null,Ui(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=ir(fe(this.Ta,this),t)}},re.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,nr(10),_i(this),Ui(this))},re.Sa=function(){null!=this.m&&(this.m=null,_i(this),zi(this),nr(19))},re.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),nr(2)):(this.c.info("Failed to ping google.com"),nr(1))},(re=Xi.prototype).ta=function(){},re.sa=function(){},re.ra=function(){},re.qa=function(){},re.Ja=function(){},Yi.prototype.a=function(t,e){return new Qi(t,e)},ye(Qi,Tn),Qi.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;nr(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=qi(t,null,t.fa),Fi(t)},Qi.prototype.close=function(){$i(this.a)},Qi.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Di(this.a,e)}else this.l?((e={}).__data__=En(t),Di(this.a,e)):Di(this.a,t)},Qi.prototype.G=function(){this.a.f=null,delete this.f,$i(this.a),delete this.a,Qi.X.G.call(this)},ye(Ji,dr),ye(Zi,pr),ye(ts,Xi),ts.prototype.ta=function(){Cn(this.a,"a")},ts.prototype.sa=function(t){Cn(this.a,new Ji(t))},ts.prototype.ra=function(t){Cn(this.a,new Zi(t))},ts.prototype.qa=function(){Cn(this.a,"b")},Yi.prototype.createWebChannel=Yi.prototype.a,Qi.prototype.send=Qi.prototype.h,Qi.prototype.open=Qi.prototype.g,Qi.prototype.close=Qi.prototype.close,sr.NO_ERROR=0,sr.TIMEOUT=8,sr.HTTP_ERROR=6,or.COMPLETE="complete",lr.EventType=hr,hr.OPEN="a",hr.CLOSE="b",hr.ERROR="c",hr.MESSAGE="d",Tn.prototype.listen=Tn.prototype.va,mi.prototype.listenOnce=mi.prototype.wa,mi.prototype.getLastError=mi.prototype.Qa,mi.prototype.getLastErrorCode=mi.prototype.ua,mi.prototype.getStatus=mi.prototype.W,mi.prototype.getResponseJson=mi.prototype.Pa,mi.prototype.getResponseText=mi.prototype.$,mi.prototype.send=mi.prototype.ba;var es=sr,ns=or,rs=Yn,is=10,ss=11,os=lr,as=mi,us=function(t,e,n,r,i,s){this.t=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.i=s},ls=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"o",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),cs=new zt("@firebase/firestore");function hs(){return cs.logLevel}function ds(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(cs.logLevel<=_t.DEBUG){var r=e.map(gs);cs.debug.apply(cs,pt(["Firestore (8.2.9): "+t],r))}}function ps(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(cs.logLevel<=_t.ERROR){var r=e.map(gs);cs.error.apply(cs,pt(["Firestore (8.2.9): "+t],r))}}function fs(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(cs.logLevel<=_t.WARN){var r=e.map(gs);cs.warn.apply(cs,pt(["Firestore (8.2.9): "+t],r))}}function gs(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(n){return t}
/**
  * @license
  * Copyright 2020 Google LLC
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *   http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ms(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.2.9) INTERNAL ASSERTION FAILED: "+t;throw ps(e),new Error(e)}function ys(t,e){t||ms()}function bs(t,e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vs(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xs=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=vs(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function ws(t,e){return t<e?-1:t>e?1:0}function ks(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Is(t){return t+"\0"}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ss=function(){function t(t){this.h=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.h,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.h)},t.prototype.l=function(){return 2*this.h.length},t.prototype._=function(t){return ws(this.h,t.h)},t.prototype.isEqual=function(t){return this.h===t.h},t}();Ss.T=new Ss("");var Ts={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Cs=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return at(e,t),e}(Error),Ns=function(){function t(t){this.I=t}return t.fromBase64String=function(e){try{return new t(Ss.fromBase64String(e))}catch(n){throw new Cs(Ts.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},t.fromUint8Array=function(e){return new t(Ss.fromUint8Array(e))},t.prototype.toBase64=function(){return this.I.toBase64()},t.prototype.toUint8Array=function(){return this.I.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.I.isEqual(t.I)},t}(),Es=function(){function t(t){this.uid=t}return t.prototype.m=function(){return null!=this.uid},t.prototype.A=function(){return this.m()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();Es.UNAUTHENTICATED=new Es(null),Es.R=new Es("google-credentials-uid"),Es.P=new Es("first-party-uid");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Rs=function(t,e){this.user=e,this.type="OAuth",this.g={},this.g.Authorization="Bearer "+t},$s=function(){function t(){this.V=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.p=function(){},t.prototype.v=function(t){this.V=t,t(Es.UNAUTHENTICATED)},t.prototype.S=function(){this.V=null},t}(),_s=function(){function t(t){var e=this;this.D=null,this.currentUser=Es.UNAUTHENTICATED,this.C=!1,this.N=0,this.V=null,this.forceRefresh=!1,this.D=function(){e.N++,e.currentUser=e.$(),e.C=!0,e.V&&e.V(e.currentUser)},this.N=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.D):(this.D(null),t.get().then((function(t){e.auth=t,e.D&&e.auth.addAuthTokenListener(e.D)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.N,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.N!==e?(ds("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(ys("string"==typeof n.accessToken),new Rs(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.p=function(){this.forceRefresh=!0},t.prototype.v=function(t){this.V=t,this.C&&t(this.currentUser)},t.prototype.S=function(){this.auth&&this.auth.removeAuthTokenListener(this.D),this.D=null,this.V=null},t.prototype.$=function(){var t=this.auth&&this.auth.getUid();return ys(null===t||"string"==typeof t),new Es(t)},t}(),As=function(){function t(t,e){this.F=t,this.O=e,this.type="FirstParty",this.user=Es.P}return Object.defineProperty(t.prototype,"g",{get:function(){var t={"X-Goog-AuthUser":this.O},e=this.F.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Ds=function(){function t(t,e){this.F=t,this.O=e}return t.prototype.getToken=function(){return Promise.resolve(new As(this.F,this.O))},t.prototype.v=function(t){t(Es.P)},t.prototype.S=function(){},t.prototype.p=function(){},t}(),Fs=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.k=function(t){return n.M(t)},this.L=function(t){return e.B(t)})}return t.prototype.M=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.L&&this.L(t),t},t}();Fs.q=-1;var Os=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Cs(Ts.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Cs(Ts.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Cs(Ts.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Cs(Ts.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.U=function(t){return this.seconds===t.seconds?ws(this.nanoseconds,t.nanoseconds):ws(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Ls=function(){function t(t){this.timestamp=t}return t.K=function(e){return new t(e)},t.min=function(){return new t(new Os(0,0))},t.prototype._=function(t){return this.timestamp.U(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.W=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.j=function(){return this.timestamp},t}(),Ps=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&ms(),void 0===n?n=t.length-e:n>t.length-e&&ms(),this.segments=t,this.offset=e,this.G=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.G},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.H(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.J(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.Y=function(t){return t=void 0===t?1:t,this.J(this.segments,this.offset+t,this.length-t)},t.prototype.X=function(){return this.J(this.segments,this.offset,this.length-1)},t.prototype.Z=function(){return this.segments[this.offset]},t.prototype.tt=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.et=function(){return 0===this.length},t.prototype.nt=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.st=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.it=function(){return this.segments.slice(this.offset,this.limit())},t.H=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),s=e.get(r);if(i<s)return-1;if(i>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Ms=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.J=function(t,n,r){return new e(t,n,r)},e.prototype.rt=function(){return this.it().join("/")},e.prototype.toString=function(){return this.rt()},e.ot=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,s=t;i<s.length;i++){var o=s[i];if(o.indexOf("//")>=0)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");r.push.apply(r,o.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.ct=function(){return new e([])},e}(Ps),zs=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Bs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.J=function(t,n,r){return new e(t,n,r)},e.at=function(t){return zs.test(t)},e.prototype.rt=function(){return this.it().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.at(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.rt()},e.prototype.ut=function(){return 1===this.length&&"__name__"===this.get(0)},e.ht=function(){return new e(["__name__"])},e.lt=function(t){for(var n=[],r="",i=0,s=function(){if(0===r.length)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},o=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Cs(Ts.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Cs(Ts.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new Cs(Ts.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.ct=function(){return new e([])},e}(Ps),Us=function(){function t(t){this.path=t}return t._t=function(e){return new t(Ms.ot(e))},t.ft=function(e){return new t(Ms.ot(e).Y(5))},t.prototype.dt=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Ms.H(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.H=function(t,e){return Ms.H(t.path,e.path)},t.wt=function(t){return t.length%2==0},t.Et=function(e){return new t(new Ms(e.slice()))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vs(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ws(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Gs(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var js=function(){function t(t){this.fields=t,t.sort(Bs.H)}return t.prototype.Tt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].nt(t))return!0;return!1},t.prototype.isEqual=function(t){return ks(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Hs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qs(t){if(ys(!!t),"string"==typeof t){var e=0,n=Hs.exec(t);if(ys(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ks(t.seconds),nanos:Ks(t.nanos)}}function Ks(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Xs(t){return"string"==typeof t?Ss.fromBase64String(t):Ss.fromUint8Array(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ys(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Qs(t){var e=t.mapValue.fields.__previous_value__;return Ys(e)?Qs(e):e}function Js(t){var e=qs(t.mapValue.fields.__local_write_time__.timestampValue);return new Os(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zs(t){return null==t}function to(t){return 0===t&&1/t==-1/0}function eo(t){return"number"==typeof t&&Number.isInteger(t)&&!to(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function no(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ys(t)?4:10:ms()}function ro(t,e){var n,r=no(t);if(r!==no(e))return!1;switch(r){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Js(t).isEqual(Js(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=qs(t.timestampValue),r=qs(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return n=e,Xs(t.bytesValue).isEqual(Xs(n.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ks(t.geoPointValue.latitude)===Ks(e.geoPointValue.latitude)&&Ks(t.geoPointValue.longitude)===Ks(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ks(t.integerValue)===Ks(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Ks(t.doubleValue),r=Ks(e.doubleValue);return n===r?to(n)===to(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ks(t.arrayValue.values||[],e.arrayValue.values||[],ro);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Vs(n)!==Vs(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ro(n[i],r[i])))return!1;return!0}(t,e);default:return ms()}}function io(t,e){return void 0!==(t.values||[]).find((function(t){return ro(t,e)}))}function so(t,e){var n,r,i,s,o=no(t),a=no(e);if(o!==a)return ws(o,a);switch(o){case 0:return 0;case 1:return ws(t.booleanValue,e.booleanValue);case 2:return r=e,i=Ks((n=t).integerValue||n.doubleValue),s=Ks(r.integerValue||r.doubleValue),i<s?-1:i>s?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return oo(t.timestampValue,e.timestampValue);case 4:return oo(Js(t),Js(e));case 5:return ws(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Xs(t),r=Xs(e);return n._(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var s=ws(n[i],r[i]);if(0!==s)return s}return ws(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=ws(Ks(t.latitude),Ks(e.latitude));return 0!==n?n:ws(Ks(t.longitude),Ks(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var s=so(n[i],r[i]);if(s)return s}return ws(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(var o=0;o<r.length&&o<s.length;++o){var a=ws(r[o],s[o]);if(0!==a)return a;var u=so(n[r[o]],i[s[o]]);if(0!==u)return u}return ws(r.length,s.length)}(t.mapValue,e.mapValue);default:throw ms()}}function oo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ws(t,e);var n=qs(t),r=qs(e),i=ws(n.seconds,r.seconds);return 0!==i?i:ws(n.nanos,r.nanos)}function ao(t){return uo(t)}function uo(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(e=t.timestampValue,"time("+(n=qs(e)).seconds+","+n.nanos+")"):"stringValue"in t?t.stringValue:"bytesValue"in t?Xs(t.bytesValue).toBase64():"referenceValue"in t?(i=t.referenceValue,Us.ft(i).toString()):"geoPointValue"in t?"geo("+(r=t.geoPointValue).latitude+","+r.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=uo(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var s=i[r];n?n=!1:e+=",",e+=s+":"+uo(t.fields[s])}return e+"}"}(t.mapValue):ms();var e,n,r,i}function lo(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.rt()}}function co(t){return!!t&&"integerValue"in t}function ho(t){return!!t&&"arrayValue"in t}function po(t){return!!t&&"nullValue"in t}function fo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function go(t){return!!t&&"mapValue"in t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mo=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.et())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!go(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.tt()])||null},t.prototype.isEqual=function(t){return ro(this.proto,t.proto)},t}(),yo=function(){function t(t){void 0===t&&(t=mo.empty()),this.It=t,this.At=new Map}return t.prototype.set=function(t,e){return this.Rt(t,e),this},t.prototype.delete=function(t){return this.Rt(t,null),this},t.prototype.Rt=function(t,e){for(var n=this.At,r=0;r<t.length-1;++r){var i=t.get(r),s=n.get(i);s instanceof Map?n=s:s&&10===no(s)?(s=new Map(Object.entries(s.mapValue.fields||{})),n.set(i,s),n=s):(s=new Map,n.set(i,s),n=s)}n.set(t.tt(),e)},t.prototype.Pt=function(){var t=this.yt(Bs.ct(),this.At);return null!=t?new mo(t):this.It},t.prototype.yt=function(t,e){var n=this,r=!1,i=this.It.field(t),s=go(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var o=n.yt(t.child(i),e);null!=o&&(s[i]=o,r=!0)}else null!==e?(s[i]=e,r=!0):s.hasOwnProperty(i)&&(delete s[i],r=!0)})),r?{mapValue:{fields:s}}:null},t}();function bo(t){var e=[];return Ws(t.fields||{},(function(t,n){var r=new Bs([t]);if(go(n)){var i=bo(n.mapValue).fields;if(0===i.length)e.push(r);else for(var s=0,o=i;s<o.length;s++){var a=o[s];e.push(r.child(a))}}else e.push(r)})),new js(e)}var vo=function(t,e){this.key=t,this.version=e},xo=function(t){function e(e,n,r,i){var s=this;return(s=t.call(this,e,n)||this).gt=r,s.Vt=!!i.Vt,s.hasCommittedMutations=!!i.hasCommittedMutations,s}return at(e,t),e.prototype.field=function(t){return this.gt.field(t)},e.prototype.data=function(){return this.gt},e.prototype.bt=function(){return this.gt.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Vt===t.Vt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.gt.isEqual(t.gt)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.gt.toString()+", {hasLocalMutations: "+this.Vt+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.Vt||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(vo),wo=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return at(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(vo),ko=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(vo),Io=function(t,e,n,r,i,s,o){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.vt=null};function So(t,e,n,r,i,s,o){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null),new Io(t,e,n,r,i,s,o)}function To(t){var e=bs(t);if(null===e.vt){var n=e.path.rt();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return(e=t).field.rt()+e.op.toString()+ao(e.value);var e})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.rt()+e.dir;var e})).join(","),Zs(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Mo(e.startAt)),e.endAt&&(n+="|ub:",n+=Mo(e.endAt)),e.vt=n}return e.vt}function Co(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Bo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],s=e.filters[r],i.op!==s.op||!i.field.isEqual(s.field)||!ro(i.value,s.value))return!1;var i,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Vo(t.startAt,e.startAt)&&Vo(t.endAt,e.endAt)}function No(t){return Us.wt(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Eo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return at(e,t),e.create=function(t,n,r){return t.ut()?"in"===n||"not-in"===n?this.St(t,n,r):new Ro(t,n,r):"array-contains"===n?new Do(t,r):"in"===n?new Fo(t,r):"not-in"===n?new Oo(t,r):"array-contains-any"===n?new Lo(t,r):new e(t,n,r)},e.St=function(t,e,n){return"in"===e?new $o(t,n):new _o(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.Dt(so(e,this.value)):null!==e&&no(this.value)===no(e)&&this.Dt(so(e,this.value))},e.prototype.Dt=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ms()}},e.prototype.Ct=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Ro=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Us.ft(r.referenceValue),i}return at(e,t),e.prototype.matches=function(t){var e=Us.H(t.key,this.key);return this.Dt(e)},e}(Eo),$o=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Ao("in",n),r}return at(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Eo),_o=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Ao("not-in",n),r}return at(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Eo);function Ao(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Us.ft(t.referenceValue)}))}var Do=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return at(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return ho(e)&&io(e.arrayValue,this.value)},e}(Eo),Fo=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return at(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&io(this.value.arrayValue,e)},e}(Eo),Oo=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return at(e,t),e.prototype.matches=function(t){if(io(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!io(this.value.arrayValue,e)},e}(Eo),Lo=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return at(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!ho(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return io(e.value.arrayValue,t)}))},e}(Eo),Po=function(t,e){this.position=t,this.before=e};function Mo(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return ao(t)})).join(",")}var zo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Bo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Uo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var s=e[i],o=t.position[i];if(r=s.field.ut()?Us.H(Us.ft(o.referenceValue),n.key):so(o,n.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Vo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ro(t.position[n],e.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wo=function(t,e,n,r,i,s,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===s&&(s="F"),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.xt=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Nt=null,this.$t=null,this.startAt,this.endAt};function Go(t,e,n,r,i,s,o,a){return new Wo(t,e,n,r,i,s,o,a)}function jo(t){return new Wo(t)}function Ho(t){return!Zs(t.limit)&&"F"===t.limitType}function qo(t){return!Zs(t.limit)&&"L"===t.limitType}function Ko(t){return t.xt.length>0?t.xt[0].field:null}function Xo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.Ct())return r.field}return null}function Yo(t){return null!==t.collectionGroup}function Qo(t){var e=bs(t);if(null===e.Nt){e.Nt=[];var n=Xo(e),r=Ko(e);if(null!==n&&null===r)n.ut()||e.Nt.push(new zo(n)),e.Nt.push(new zo(Bs.ht(),"asc"));else{for(var i=!1,s=0,o=e.xt;s<o.length;s++){var a=o[s];e.Nt.push(a),a.field.ut()&&(i=!0)}if(!i){var u=e.xt.length>0?e.xt[e.xt.length-1].dir:"asc";e.Nt.push(new zo(Bs.ht(),u))}}}return e.Nt}function Jo(t){var e=bs(t);if(!e.$t)if("F"===e.limitType)e.$t=So(e.path,e.collectionGroup,Qo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Qo(e);r<i.length;r++){var s=i[r],o="desc"===s.dir?"asc":"desc";n.push(new zo(s.field,o))}var a=e.endAt?new Po(e.endAt.position,!e.endAt.before):null,u=e.startAt?new Po(e.startAt.position,!e.startAt.before):null;e.$t=So(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.$t}function Zo(t,e,n){return new Wo(t.path,t.collectionGroup,t.xt.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ta(t,e){return Co(Jo(t),Jo(e))&&t.limitType===e.limitType}function ea(t){return To(Jo(t))+"|lt:"+t.limitType}function na(t){return"Query(target="+(e=Jo(t),n=e.path.rt(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=", filters: ["+e.filters.map((function(t){return(e=t).field.rt()+" "+e.op+" "+ao(e.value);var e})).join(", ")+"]"),Zs(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=", orderBy: ["+e.orderBy.map((function(t){return(e=t).field.rt()+" ("+e.dir+")";var e})).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Mo(e.startAt)),e.endAt&&(n+=", endAt: "+Mo(e.endAt)),"Target("+n+"); limitType=")+t.limitType+")";var e,n}function ra(t,e){return n=t,i=(r=e).key.path,(null!==n.collectionGroup?r.key.dt(n.collectionGroup)&&n.path.nt(i):Us.wt(n.path)?n.path.isEqual(i):n.path.st(i))&&function(t,e){for(var n=0,r=t.xt;n<r.length;n++){var i=r[n];if(!i.field.ut()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Uo(t.startAt,Qo(t),e)||t.endAt&&Uo(t.endAt,Qo(t),e))}(t,e);var n,r,i}function ia(t){return function(e,n){for(var r=!1,i=0,s=Qo(t);i<s.length;i++){var o=s[i],a=sa(o,e,n);if(0!==a)return a;r=r||o.field.ut()}return 0}}function sa(t,e,n){var r,i,s,o,a=t.field.ut()?Us.H(e.key,n.key):(r=t.field,i=n,s=e.field(r),o=i.field(r),null!==s&&null!==o?so(s,o):ms());switch(t.dir){case"asc":return a;case"desc":return-1*a;default:return ms()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oa=function(){function t(t,e,n,r,i,s,o){void 0===i&&(i=Ls.min()),void 0===s&&(s=Ls.min()),void 0===o&&(o=Ss.T),this.target=t,this.targetId=e,this.Ft=n,this.sequenceNumber=r,this.Ot=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}return t.prototype.kt=function(e){return new t(this.target,this.targetId,this.Ft,e,this.Ot,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.Mt=function(e,n){return new t(this.target,this.targetId,this.Ft,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.Lt=function(e){return new t(this.target,this.targetId,this.Ft,this.sequenceNumber,this.Ot,e,this.resumeToken)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aa(t,e){if(t.Bt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:to(e)?"-0":e}}function ua(t){return{integerValue:""+t}}function la(t,e){return eo(e)?ua(e):aa(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ca=function(){this.qt=void 0};function ha(t,e,n){return t instanceof fa?(i=e,s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(r=n).seconds,nanos:r.nanoseconds}}}},i&&(s.fields.__previous_value__=i),{mapValue:s}):t instanceof ga?ma(t,e):t instanceof ya?ba(t,e):function(t,e){var n=pa(t,e),r=xa(n)+xa(t.Ut);return co(n)&&co(t.Ut)?ua(r):aa(t.Qt,r)}(t,e);var r,i,s}function da(t,e,n){return t instanceof ga?ma(t,e):t instanceof ya?ba(t,e):n}function pa(t,e){return t instanceof va?co(r=e)||(n=r)&&"doubleValue"in n?e:{integerValue:0}:null;var n,r}var fa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e}(ca),ga=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return at(e,t),e}(ca);function ma(t,e){for(var n=wa(e),r=function(t){n.some((function(e){return ro(e,t)}))||n.push(t)},i=0,s=t.elements;i<s.length;i++)r(s[i]);return{arrayValue:{values:n}}}var ya=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return at(e,t),e}(ca);function ba(t,e){for(var n=wa(e),r=function(t){n=n.filter((function(e){return!ro(e,t)}))},i=0,s=t.elements;i<s.length;i++)r(s[i]);return{arrayValue:{values:n}}}var va=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qt=e,r.Ut=n,r}return at(e,t),e}(ca);function xa(t){return Ks(t.integerValue||t.doubleValue)}function wa(t){return ho(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ka=function(t,e){this.field=t,this.transform=e},Ia=function(t,e){this.version=t,this.transformResults=e},Sa=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.Kt=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"Wt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Ta(t,e){return void 0!==t.updateTime?e instanceof xo&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof xo}var Ca=function(){};function Na(t,e,n){return t instanceof Aa?function(t,e,n){var r=t.value;if(n.transformResults){var i=Oa(t.fieldTransforms,e,n.transformResults);r=Pa(t.fieldTransforms,r,i)}return new xo(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Da?function(t,e,n){if(!Ta(t.jt,e))return new ko(t.key,n.version);var r=Fa(t,e,n.transformResults?Oa(t.fieldTransforms,e,n.transformResults):[]);return new xo(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):(r=n,new wo(t.key,r.version,{hasCommittedMutations:!0}));var r}function Ea(t,e,n){return t instanceof Aa?function(t,e,n){if(!Ta(t.jt,e))return e;var r=t.value,i=La(t.fieldTransforms,n,e);r=Pa(t.fieldTransforms,r,i);var s=_a(e);return new xo(t.key,s,r,{Vt:!0})}(t,e,n):t instanceof Da?function(t,e,n){if(!Ta(t.jt,e))return e;var r=_a(e),i=Fa(t,e,La(t.fieldTransforms,n,e));return new xo(t.key,r,i,{Vt:!0})}(t,e,n):(i=e,Ta((r=t).jt,i)?new wo(r.key,Ls.min()):i);var r,i}function Ra(t,e){return function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var s=i[r],o=e instanceof xo?e.field(s.field):void 0,a=pa(s.transform,o||null);null!=a&&(n=null==n?(new yo).set(s.field,a):n.set(s.field,a))}return n?n.Pt():null}(t.fieldTransforms,e)}function $a(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.jt.isEqual(e.jt)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&ks(n,r,(function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,s=r.transform,i instanceof ga&&s instanceof ga||i instanceof ya&&s instanceof ya?ks(i.elements,s.elements,ro):i instanceof va&&s instanceof va?ro(i.Ut,s.Ut):i instanceof fa&&s instanceof fa);var n,r,i,s}))))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.Gt.isEqual(e.Gt));var n,r}function _a(t){return t instanceof xo?t.version:Ls.min()}var Aa=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var s=this;return(s=t.call(this)||this).key=e,s.value=n,s.jt=r,s.fieldTransforms=i,s.type=0,s}return at(e,t),e}(Ca),Da=function(t){function e(e,n,r,i,s){void 0===s&&(s=[]);var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Gt=r,o.jt=i,o.fieldTransforms=s,o.type=1,o}return at(e,t),e}(Ca);function Fa(t,e,n){var r,i,s,o;return i=t,s=r=e instanceof xo?e.data():mo.empty(),o=new yo(s),i.Gt.fields.forEach((function(t){if(!t.et()){var e=i.data.field(t);null!==e?o.set(t,e):o.delete(t)}})),r=o.Pt(),Pa(t.fieldTransforms,r,n)}function Oa(t,e,n){var r=[];ys(t.length===n.length);for(var i=0;i<n.length;i++){var s=t[i],o=s.transform,a=null;e instanceof xo&&(a=e.field(s.field)),r.push(da(o,a,n[i]))}return r}function La(t,e,n){for(var r=[],i=0,s=t;i<s.length;i++){var o=s[i],a=o.transform,u=null;n instanceof xo&&(u=n.field(o.field)),r.push(ha(a,u,e))}return r}function Pa(t,e,n){for(var r=new yo(e),i=0;i<t.length;i++){var s=t[i];r.set(s.field,n[i])}return r.Pt()}var Ma,za,Ba=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.jt=n,r.type=2,r.fieldTransforms=[],r}return at(e,t),e}(Ca),Ua=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.jt=n,r.type=3,r.fieldTransforms=[],r}return at(e,t),e}(Ca),Va=function(t){this.count=t};function Wa(t){switch(t){case Ts.OK:return ms();case Ts.CANCELLED:case Ts.UNKNOWN:case Ts.DEADLINE_EXCEEDED:case Ts.RESOURCE_EXHAUSTED:case Ts.INTERNAL:case Ts.UNAVAILABLE:case Ts.UNAUTHENTICATED:return!1;case Ts.INVALID_ARGUMENT:case Ts.NOT_FOUND:case Ts.ALREADY_EXISTS:case Ts.PERMISSION_DENIED:case Ts.FAILED_PRECONDITION:case Ts.ABORTED:case Ts.OUT_OF_RANGE:case Ts.UNIMPLEMENTED:case Ts.DATA_LOSS:return!0;default:return ms()}}function Ga(t){if(void 0===t)return ps("GRPC error has no .code"),Ts.UNKNOWN;switch(t){case Ma.OK:return Ts.OK;case Ma.CANCELLED:return Ts.CANCELLED;case Ma.UNKNOWN:return Ts.UNKNOWN;case Ma.DEADLINE_EXCEEDED:return Ts.DEADLINE_EXCEEDED;case Ma.RESOURCE_EXHAUSTED:return Ts.RESOURCE_EXHAUSTED;case Ma.INTERNAL:return Ts.INTERNAL;case Ma.UNAVAILABLE:return Ts.UNAVAILABLE;case Ma.UNAUTHENTICATED:return Ts.UNAUTHENTICATED;case Ma.INVALID_ARGUMENT:return Ts.INVALID_ARGUMENT;case Ma.NOT_FOUND:return Ts.NOT_FOUND;case Ma.ALREADY_EXISTS:return Ts.ALREADY_EXISTS;case Ma.PERMISSION_DENIED:return Ts.PERMISSION_DENIED;case Ma.FAILED_PRECONDITION:return Ts.FAILED_PRECONDITION;case Ma.ABORTED:return Ts.ABORTED;case Ma.OUT_OF_RANGE:return Ts.OUT_OF_RANGE;case Ma.UNIMPLEMENTED:return Ts.UNIMPLEMENTED;case Ma.DATA_LOSS:return Ts.DATA_LOSS;default:return ms()}}(za=Ma||(Ma={}))[za.OK=0]="OK",za[za.CANCELLED=1]="CANCELLED",za[za.UNKNOWN=2]="UNKNOWN",za[za.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",za[za.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",za[za.NOT_FOUND=5]="NOT_FOUND",za[za.ALREADY_EXISTS=6]="ALREADY_EXISTS",za[za.PERMISSION_DENIED=7]="PERMISSION_DENIED",za[za.UNAUTHENTICATED=16]="UNAUTHENTICATED",za[za.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",za[za.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",za[za.ABORTED=10]="ABORTED",za[za.OUT_OF_RANGE=11]="OUT_OF_RANGE",za[za.UNIMPLEMENTED=12]="UNIMPLEMENTED",za[za.INTERNAL=13]="INTERNAL",za[za.UNAVAILABLE=14]="UNAVAILABLE",za[za.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ja=function(){function t(t,e){this.H=t,this.root=e||qa.EMPTY}return t.prototype.zt=function(e,n){return new t(this.H,this.root.zt(e,n,this.H).copy(null,null,qa.Ht,null,null))},t.prototype.remove=function(e){return new t(this.H,this.root.remove(e,this.H).copy(null,null,qa.Ht,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.et();){var n=this.H(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.et();){var r=this.H(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.et=function(){return this.root.et()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.Jt=function(){return this.root.Jt()},t.prototype.Yt=function(){return this.root.Yt()},t.prototype.Xt=function(t){return this.root.Xt(t)},t.prototype.forEach=function(t){this.Xt((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.Xt((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.Zt=function(t){return this.root.Zt(t)},t.prototype.te=function(){return new Ha(this.root,null,this.H,!1)},t.prototype.ee=function(t){return new Ha(this.root,t,this.H,!1)},t.prototype.ne=function(){return new Ha(this.root,null,this.H,!0)},t.prototype.se=function(t){return new Ha(this.root,t,this.H,!0)},t}(),Ha=function(){function t(t,e,n,r){this.ie=r,this.re=[];for(var i=1;!t.et();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.ie?t.left:t.right;else{if(0===i){this.re.push(t);break}this.re.push(t),t=this.ie?t.right:t.left}}return t.prototype.oe=function(){var t=this.re.pop(),e={key:t.key,value:t.value};if(this.ie)for(t=t.left;!t.et();)this.re.push(t),t=t.right;else for(t=t.right;!t.et();)this.re.push(t),t=t.left;return e},t.prototype.ce=function(){return this.re.length>0},t.prototype.ae=function(){if(0===this.re.length)return null;var t=this.re[this.re.length-1];return{key:t.key,value:t.value}},t}(),qa=function(){function t(e,n,r,i,s){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=s?s:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,s){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)},t.prototype.et=function(){return!1},t.prototype.Xt=function(t){return this.left.Xt(t)||t(this.key,this.value)||this.right.Xt(t)},t.prototype.Zt=function(t){return this.right.Zt(t)||t(this.key,this.value)||this.left.Zt(t)},t.prototype.min=function(){return this.left.et()?this:this.left.min()},t.prototype.Jt=function(){return this.min().key},t.prototype.Yt=function(){return this.right.et()?this.key:this.right.Yt()},t.prototype.zt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.zt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.zt(t,e,n))).ue()},t.prototype.he=function(){if(this.left.et())return t.EMPTY;var e=this;return e.left.le()||e.left.left.le()||(e=e._e()),(e=e.copy(null,null,null,e.left.he(),null)).ue()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.et()||i.left.le()||i.left.left.le()||(i=i._e()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.le()&&(i=i.fe()),i.right.et()||i.right.le()||i.right.left.le()||(i=i.de()),0===n(e,i.key)){if(i.right.et())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.he())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.ue()},t.prototype.le=function(){return this.color},t.prototype.ue=function(){var t=this;return t.right.le()&&!t.left.le()&&(t=t.we()),t.left.le()&&t.left.left.le()&&(t=t.fe()),t.left.le()&&t.right.le()&&(t=t.Ee()),t},t.prototype._e=function(){var t=this.Ee();return t.right.left.le()&&(t=(t=(t=t.copy(null,null,null,null,t.right.fe())).we()).Ee()),t},t.prototype.de=function(){var t=this.Ee();return t.left.left.le()&&(t=(t=t.fe()).Ee()),t},t.prototype.we=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.fe=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.Ee=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Te=function(){var t=this.Ie();return Math.pow(2,t)<=this.size+1},t.prototype.Ie=function(){if(this.le()&&this.left.le())throw ms();if(this.right.le())throw ms();var t=this.left.Ie();if(t!==this.right.Ie())throw ms();return t+(this.le()?0:1)},t}();qa.EMPTY=null,qa.RED=!0,qa.Ht=!1,qa.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw ms()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw ms()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw ms()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw ms()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw ms()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.zt=function(t,e,n){return new qa(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.et=function(){return!0},t.prototype.Xt=function(t){return!1},t.prototype.Zt=function(t){return!1},t.prototype.Jt=function(){return null},t.prototype.Yt=function(){return null},t.prototype.le=function(){return!1},t.prototype.Te=function(){return!0},t.prototype.Ie=function(){return 0},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ka=function(){function t(t){this.H=t,this.data=new ja(this.H)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.Jt()},t.prototype.last=function(){return this.data.Yt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.Xt((function(e,n){return t(e),!1}))},t.prototype.me=function(t,e){for(var n=this.data.ee(t[0]);n.ce();){var r=n.oe();if(this.H(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Ae=function(t,e){var n;for(n=void 0!==e?this.data.ee(e):this.data.te();n.ce();)if(!t(n.oe().key))return},t.prototype.Re=function(t){var e=this.data.ee(t);return e.ce()?e.oe().key:null},t.prototype.te=function(){return new Xa(this.data.te())},t.prototype.ee=function(t){return new Xa(this.data.ee(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).zt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.et=function(){return this.data.et()},t.prototype.Pe=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.te(),r=e.data.te();n.ce();){var i=n.oe().key,s=r.oe().key;if(0!==this.H(i,s))return!1}return!0},t.prototype.it=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.H);return n.data=e,n},t}(),Xa=function(){function t(t){this.ye=t}return t.prototype.oe=function(){return this.ye.oe().key},t.prototype.ce=function(){return this.ye.ce()},t}(),Ya=new ja(Us.H);function Qa(){return Ya}function Ja(){return Qa()}var Za=new ja(Us.H);function tu(){return Za}var eu=new ja(Us.H);var nu=new Ka(Us.H);function ru(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=nu,r=0,i=t;r<i.length;r++){var s=i[r];n=n.add(s)}return n}var iu=new Ka(ws);function su(){return iu}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ou=function(){function t(t){this.H=t?function(e,n){return t(e,n)||Us.H(e.key,n.key)}:function(t,e){return Us.H(t.key,e.key)},this.ge=tu(),this.Ve=new ja(this.H)}return t.pe=function(e){return new t(e.H)},t.prototype.has=function(t){return null!=this.ge.get(t)},t.prototype.get=function(t){return this.ge.get(t)},t.prototype.first=function(){return this.Ve.Jt()},t.prototype.last=function(){return this.Ve.Yt()},t.prototype.et=function(){return this.Ve.et()},t.prototype.indexOf=function(t){var e=this.ge.get(t);return e?this.Ve.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.Ve.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Ve.Xt((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.ge.zt(t.key,t),e.Ve.zt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.ge.remove(t),this.Ve.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Ve.te(),r=e.Ve.te();n.ce();){var i=n.oe().key,s=r.oe().key;if(!i.isEqual(s))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.H=this.H,r.ge=e,r.Ve=n,r},t}(),au=function(){function t(){this.be=new ja(Us.H)}return t.prototype.track=function(t){var e=t.doc.key,n=this.be.get(e);n?0!==t.type&&3===n.type?this.be=this.be.zt(e,t):3===t.type&&1!==n.type?this.be=this.be.zt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.be=this.be.zt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.be=this.be.zt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.be=this.be.remove(e):1===t.type&&2===n.type?this.be=this.be.zt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.be=this.be.zt(e,{type:2,doc:t.doc}):ms():this.be=this.be.zt(e,t)},t.prototype.ve=function(){var t=[];return this.be.Xt((function(e,n){t.push(n)})),t},t}(),uu=function(){function t(t,e,n,r,i,s,o,a){this.query=t,this.docs=e,this.Se=n,this.docChanges=r,this.De=i,this.fromCache=s,this.Ce=o,this.xe=a}return t.Ne=function(e,n,r,i){var s=[];return n.forEach((function(t){s.push({type:0,doc:t})})),new t(e,n,ou.pe(n),s,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.De.et()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Ce===t.Ce&&this.De.isEqual(t.De)&&ta(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Se.isEqual(t.Se)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),lu=function(){function t(t,e,n,r,i){this.Ot=t,this.$e=e,this.Fe=n,this.Oe=r,this.ke=i}return t.Me=function(e,n){var r=new Map;return r.set(e,cu.Le(e,n)),new t(Ls.min(),r,su(),Qa(),ru())},t}(),cu=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Be=e,this.qe=n,this.Ue=r,this.Qe=i}return t.Le=function(e,n){return new t(Ss.T,n,ru(),ru(),ru())},t}(),hu=function(t,e,n,r){this.Ke=t,this.removedTargetIds=e,this.key=n,this.We=r},du=function(t,e){this.targetId=t,this.je=e},pu=function(t,e,n,r){void 0===n&&(n=Ss.T),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},fu=function(){function t(){this.Ge=0,this.ze=yu(),this.He=Ss.T,this.Je=!1,this.Ye=!0}return Object.defineProperty(t.prototype,"Be",{get:function(){return this.Je},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.He},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Xe",{get:function(){return 0!==this.Ge},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Ze",{get:function(){return this.Ye},enumerable:!1,configurable:!0}),t.prototype.tn=function(t){t.l()>0&&(this.Ye=!0,this.He=t)},t.prototype.en=function(){var t=ru(),e=ru(),n=ru();return this.ze.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:ms()}})),new cu(this.He,this.Je,t,e,n)},t.prototype.nn=function(){this.Ye=!1,this.ze=yu()},t.prototype.sn=function(t,e){this.Ye=!0,this.ze=this.ze.zt(t,e)},t.prototype.rn=function(t){this.Ye=!0,this.ze=this.ze.remove(t)},t.prototype.on=function(){this.Ge+=1},t.prototype.cn=function(){this.Ge-=1},t.prototype.an=function(){this.Ye=!0,this.Je=!0},t}(),gu=function(){function t(t){this.un=t,this.hn=new Map,this.ln=Qa(),this._n=mu(),this.fn=new Ka(ws)}return t.prototype.dn=function(t){for(var e=0,n=t.Ke;e<n.length;e++){var r=n[e];t.We instanceof xo?this.wn(r,t.We):t.We instanceof wo&&this.En(r,t.key,t.We)}for(var i=0,s=t.removedTargetIds;i<s.length;i++)r=s[i],this.En(r,t.key,t.We)},t.prototype.Tn=function(t){var e=this;this.In(t,(function(n){var r=e.mn(n);switch(t.state){case 0:e.An(n)&&r.tn(t.resumeToken);break;case 1:r.cn(),r.Xe||r.nn(),r.tn(t.resumeToken);break;case 2:r.cn(),r.Xe||e.removeTarget(n);break;case 3:e.An(n)&&(r.an(),r.tn(t.resumeToken));break;case 4:e.An(n)&&(e.Rn(n),r.tn(t.resumeToken));break;default:ms()}}))},t.prototype.In=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.hn.forEach((function(t,r){n.An(r)&&e(r)}))},t.prototype.Pn=function(t){var e=t.targetId,n=t.je.count,r=this.yn(e);if(r){var i=r.target;if(No(i))if(0===n){var s=new Us(i.path);this.En(e,s,new wo(s,Ls.min()))}else ys(1===n);else this.gn(e)!==n&&(this.Rn(e),this.fn=this.fn.add(e))}},t.prototype.Vn=function(t){var e=this,n=new Map;this.hn.forEach((function(r,i){var s=e.yn(i);if(s){if(r.Be&&No(s.target)){var o=new Us(s.target.path);null!==e.ln.get(o)||e.pn(i,o)||e.En(i,o,new wo(o,t))}r.Ze&&(n.set(i,r.en()),r.nn())}}));var r=ru();this._n.forEach((function(t,n){var i=!0;n.Ae((function(t){var n=e.yn(t);return!n||2===n.Ft||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new lu(t,n,this.fn,this.ln,r);return this.ln=Qa(),this._n=mu(),this.fn=new Ka(ws),i},t.prototype.wn=function(t,e){if(this.An(t)){var n=this.pn(t,e.key)?2:0;this.mn(t).sn(e.key,n),this.ln=this.ln.zt(e.key,e),this._n=this._n.zt(e.key,this.bn(e.key).add(t))}},t.prototype.En=function(t,e,n){if(this.An(t)){var r=this.mn(t);this.pn(t,e)?r.sn(e,1):r.rn(e),this._n=this._n.zt(e,this.bn(e).delete(t)),n&&(this.ln=this.ln.zt(e,n))}},t.prototype.removeTarget=function(t){this.hn.delete(t)},t.prototype.gn=function(t){var e=this.mn(t).en();return this.un.vn(t).size+e.qe.size-e.Qe.size},t.prototype.on=function(t){this.mn(t).on()},t.prototype.mn=function(t){var e=this.hn.get(t);return e||(e=new fu,this.hn.set(t,e)),e},t.prototype.bn=function(t){var e=this._n.get(t);return e||(e=new Ka(ws),this._n=this._n.zt(t,e)),e},t.prototype.An=function(t){var e=null!==this.yn(t);return e||ds("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.yn=function(t){var e=this.hn.get(t);return e&&e.Xe?null:this.un.Sn(t)},t.prototype.Rn=function(t){var e=this;this.hn.set(t,new fu),this.un.vn(t).forEach((function(n){e.En(t,n,null)}))},t.prototype.pn=function(t,e){return this.un.vn(t).has(e)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mu(){return new ja(Us.H)}function yu(){return new ja(Us.H)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bu={asc:"ASCENDING",desc:"DESCENDING"},vu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xu=function(t,e){this.t=t,this.Bt=e};function wu(t,e){return t.Bt?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ku(t,e){return t.Bt?e.toBase64():e.toUint8Array()}function Iu(t,e){return wu(t,e.j())}function Su(t){return ys(!!t),Ls.K((e=qs(t),new Os(e.seconds,e.nanos)));var e}function Tu(t,e){return(n=t,new Ms(["projects",n.projectId,"databases",n.database])).child("documents").child(e).rt();var n}function Cu(t){var e=Ms.ot(t);return ys(Xu(e)),e}function Nu(t,e){return Tu(t.t,e.path)}function Eu(t,e){var n=Cu(e);if(n.get(1)!==t.t.projectId)throw new Cs(Ts.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.t.projectId);if(n.get(3)!==t.t.database)throw new Cs(Ts.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.t.database);return new Us(Au(n))}function Ru(t,e){return Tu(t.t,e)}function $u(t){var e=Cu(t);return 4===e.length?Ms.ct():Au(e)}function _u(t){return new Ms(["projects",t.t.projectId,"databases",t.t.database]).rt()}function Au(t){return ys(t.length>4&&"documents"===t.get(4)),t.Y(5)}function Du(t,e,n){return{name:Nu(t,e),fields:n.proto.mapValue.fields}}function Fu(t,e){var n,r,i;if(e instanceof Aa)n={update:Du(t,e.key,e.value)};else if(e instanceof Ba)n={delete:Nu(t,e.key)};else if(e instanceof Da)n={update:Du(t,e.key,e.data),updateMask:Ku(e.Gt)};else{if(!(e instanceof Ua))return ms();n={verify:Nu(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof fa)return{fieldPath:e.field.rt(),setToServerValue:"REQUEST_TIME"};if(n instanceof ga)return{fieldPath:e.field.rt(),appendMissingElements:{values:n.elements}};if(n instanceof ya)return{fieldPath:e.field.rt(),removeAllFromArray:{values:n.elements}};if(n instanceof va)return{fieldPath:e.field.rt(),increment:n.Ut};throw ms()}(0,t)}))),e.jt.Wt||(n.currentDocument=(r=t,void 0!==(i=e.jt).updateTime?{updateTime:Iu(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:ms())),n}function Ou(t,e){var n,r=e.currentDocument?void 0!==(n=e.currentDocument).updateTime?Sa.updateTime(Su(n.updateTime)):void 0!==n.exists?Sa.exists(n.exists):Sa.Kt():Sa.Kt(),i=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)ys("REQUEST_TIME"===e.setToServerValue),n=new fa;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new ga(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new ya(i)}else"increment"in e?n=new va(t,e.increment):ms();var s=Bs.lt(e.fieldPath);return new ka(s,n)}(t,e)})):[];if(e.update){e.update.name;var s=Eu(t,e.update.name),o=new mo({mapValue:{fields:e.update.fields}});if(e.updateMask){var a=function(t){var e=t.fieldPaths||[];return new js(e.map((function(t){return Bs.lt(t)})))}(e.updateMask);return new Da(s,o,a,r,i)}return new Aa(s,o,r,i)}if(e.delete){var u=Eu(t,e.delete);return new Ba(u,r)}if(e.verify){var l=Eu(t,e.verify);return new Ua(l,r)}return ms()}function Lu(t,e){return{documents:[Ru(t,e.path)]}}function Pu(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ru(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ru(t,r.X()),n.structuredQuery.from=[{collectionId:r.tt()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(fo(t.value))return{unaryFilter:{field:Gu(t.field),op:"IS_NAN"}};if(po(t.value))return{unaryFilter:{field:Gu(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(fo(t.value))return{unaryFilter:{field:Gu(t.field),op:"IS_NOT_NAN"}};if(po(t.value))return{unaryFilter:{field:Gu(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gu(t.field),op:Wu(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var s=function(t){if(0!==t.length)return t.map((function(t){return{field:Gu((e=t).field),direction:Vu(e.dir)};var e}))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);var o,a,u=(o=t,a=e.limit,o.Bt||Zs(a)?a:{value:a});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Bu(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Bu(e.endAt)),n}function Mu(t){var e=$u(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){ys(1===r);var s=n.from[0];s.allDescendants?i=s.collectionId:e=e.child(s.collectionId)}var o=[];n.where&&(o=zu(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return new zo(ju((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));var u,l,c=null;n.limit&&(u=n.limit,c=Zs(l="object"==typeof u?u.value:u)?null:l);var h=null;n.startAt&&(h=Uu(n.startAt));var d=null;return n.endAt&&(d=Uu(n.endAt)),Go(e,i,a,o,c,"F",h,d)}function zu(t){return t?void 0!==t.unaryFilter?[qu(t)]:void 0!==t.fieldFilter?[Hu(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return zu(t)})).reduce((function(t,e){return t.concat(e)})):ms():[]}function Bu(t){return{before:t.before,values:t.position}}function Uu(t){var e=!!t.before,n=t.values||[];return new Po(n,e)}function Vu(t){return bu[t]}function Wu(t){return vu[t]}function Gu(t){return{fieldPath:t.rt()}}function ju(t){return Bs.lt(t.fieldPath)}function Hu(t){return Eo.create(ju(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return ms()}}(t.fieldFilter.op),t.fieldFilter.value)}function qu(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ju(t.unaryFilter.field);return Eo.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ju(t.unaryFilter.field);return Eo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ju(t.unaryFilter.field);return Eo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ju(t.unaryFilter.field);return Eo.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return ms()}}function Ku(t){var e=[];return t.fields.forEach((function(t){return e.push(t.rt())})),{fieldPaths:e}}function Xu(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yu=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Qu=function(){function t(t){var e=this;this.Dn=null,this.Cn=null,this.result=void 0,this.error=void 0,this.xn=!1,this.Nn=!1,t((function(t){e.xn=!0,e.result=t,e.Dn&&e.Dn(t)}),(function(t){e.xn=!0,e.error=t,e.Cn&&e.Cn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Nn&&ms(),this.Nn=!0,this.xn?this.error?this.$n(n,this.error):this.Fn(e,this.result):new t((function(t,i){r.Dn=function(n){r.Fn(e,n).next(t,i)},r.Cn=function(e){r.$n(n,e).next(t,i)}}))},t.prototype.On=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.kn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(r){return t.reject(r)}},t.prototype.Fn=function(e,n){return e?this.kn((function(){return e(n)})):t.resolve(n)},t.prototype.$n=function(e,n){return e?this.kn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.Mn=function(e){return new t((function(t,n){var r=0,i=0,s=!1;e.forEach((function(e){++r,e.next((function(){++i,s&&i===r&&t()}),(function(t){return n(t)}))})),s=!0,i===r&&t()}))},t.Ln=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,s=e;i<s.length;i++)r(s[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.Mn(r)},t}(),Ju=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.Bn=new Yu,this.transaction.oncomplete=function(){n.Bn.resolve()},this.transaction.onabort=function(){e.error?n.Bn.reject(new el(t,e.error)):n.Bn.resolve()},this.transaction.onerror=function(e){var r=ol(e.target.error);n.Bn.reject(new el(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(s){throw new el(n,s)}},Object.defineProperty(t.prototype,"qn",{get:function(){return this.Bn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.Bn.reject(t),this.aborted||(ds("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new rl(e)},t}(),Zu=function(){function t(e,n,r){this.name=e,this.version=n,this.Un=r,12.2===t.Qn(mt())&&ps("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return ds("SimpleDb","Removing database:",t),il(window.indexedDB.deleteDatabase(t)).On()},t.Kn=function(){if("undefined"==typeof indexedDB)return!1;if(t.Wn())return!0;var e=mt(),n=t.Qn(e),r=0<n&&n<10,i=t.jn(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)},t.Wn=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Gn)},t.zn=function(t,e){return t.store(e)},t.Qn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.jn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.Hn=function(t){return lt(this,void 0,void 0,(function(){var e,n=this;return ct(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(ds("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new el(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Cs(Ts.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new el(t,n))},i.onupgradeneeded=function(t){ds("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.Un.Jn(e,i.transaction,t.oldVersion,n.version).next((function(){ds("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.Yn&&(this.db.onversionchange=function(t){return n.Yn(t)}),this.db)]}}))}))},t.prototype.Xn=function(t){this.Yn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return lt(this,void 0,void 0,(function(){var i,s,o,a,u;return ct(this,(function(l){switch(l.label){case 0:i="readonly"===e,s=0,o=function(){var e,o,u,l,c;return ct(this,(function(h){switch(h.label){case 0:++s,h.label=1;case 1:return h.trys.push([1,4,,5]),[4,a.Hn(t)];case 2:return a.db=h.sent(),e=Ju.open(a.db,t,i?"readonly":"readwrite",n),o=r(e).catch((function(t){return e.abort(t),Qu.reject(t)})).On(),u={},o.catch((function(){})),[4,e.qn];case 3:return[2,(u.value=(h.sent(),o),u)];case 4:return l=h.sent(),c="FirebaseError"!==l.name&&s<3,ds("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),a.close(),c?[3,5]:[2,{value:Promise.reject(l)}];case 5:return[2]}}))},a=this,l.label=1;case 1:return[5,o()];case 2:if("object"==typeof(u=l.sent()))return[2,u.value];l.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),tl=function(){function t(t){this.Zn=t,this.ts=!1,this.es=null}return Object.defineProperty(t.prototype,"xn",{get:function(){return this.ts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ns",{get:function(){return this.es},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Zn=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.ts=!0},t.prototype.ss=function(t){this.es=t},t.prototype.delete=function(){return il(this.Zn.delete())},t}(),el=function(t){function e(e,n){var r=this;return(r=t.call(this,Ts.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return at(e,t),e}(Cs);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nl(t){return"IndexedDbTransactionError"===t.name}var rl=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(ds("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(ds("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),il(n)},t.prototype.add=function(t){return ds("SimpleDb","ADD",this.store.name,t,t),il(this.store.add(t))},t.prototype.get=function(t){var e=this;return il(this.store.get(t)).next((function(n){return void 0===n&&(n=null),ds("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return ds("SimpleDb","DELETE",this.store.name,t),il(this.store.delete(t))},t.prototype.count=function(){return ds("SimpleDb","COUNT",this.store.name),il(this.store.count())},t.prototype.rs=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.os(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.cs=function(t,e){ds("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.us=!1;var r=this.cursor(n);return this.os(r,(function(t,e,n){return n.delete()}))},t.prototype.hs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.os(r,e)},t.prototype.ls=function(t){var e=this.cursor({});return new Qu((function(n,r){e.onerror=function(t){var e=ol(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.os=function(t,e){var n=[];return new Qu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var s=new tl(i),o=e(i.primaryKey,i.value,s);if(o instanceof Qu){var a=o.catch((function(t){return s.done(),Qu.reject(t)}));n.push(a)}s.xn?r():null===s.ns?i.continue():i.continue(s.ns)}else r()}})).next((function(){return Qu.Mn(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.us?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function il(t){return new Qu((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ol(t.target.error);n(e)}}))}var sl=!1;function ol(t){var e=Zu.Qn(mt());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Cs("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return sl||(sl=!0,setTimeout((function(){throw r}),0)),r}}return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var al=function(){function t(t,e,n,r,i){this._s=t,this.fs=e,this.ds=n,this.op=r,this.ws=i,this.Es=new Yu,this.then=this.Es.promise.then.bind(this.Es.promise),this.Es.promise.catch((function(t){}))}return t.Ts=function(e,n,r,i,s){var o=new t(e,n,Date.now()+r,i,s);return o.start(r),o},t.prototype.start=function(t){var e=this;this.Is=setTimeout((function(){return e.As()}),t)},t.prototype.Rs=function(){return this.As()},t.prototype.cancel=function(t){null!==this.Is&&(this.clearTimeout(),this.Es.reject(new Cs(Ts.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.As=function(){var t=this;this._s.Ps((function(){return null!==t.Is?(t.clearTimeout(),t.op().then((function(e){return t.Es.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.Is&&(this.ws(this),clearTimeout(this.Is),this.Is=null)},t}();function ul(t,e){if(ps("AsyncQueue",e+": "+t),nl(t))return new Cs(Ts.UNAVAILABLE,e+": "+t);throw t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ll="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",cl=function(){function t(){this.ys=[]}return t.prototype.gs=function(t){this.ys.push(t)},t.prototype.Vs=function(){this.ys.forEach((function(t){return t()}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hl(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=pl(e)),e=dl(t.get(n),e);return pl(e)}function dl(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var s=t.charAt(i);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function pl(t){return t+""}function fl(t){var e=t.length;if(ys(e>=2),2===e)return ys(""===t.charAt(0)&&""===t.charAt(1)),Ms.ct();for(var n=e-2,r=[],i="",s=0;s<e;){var o=t.indexOf("",s);switch((o<0||o>n)&&ms(),t.charAt(o+1)){case"":var a=t.substring(s,o),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(s,o),i+="\0";break;case"":i+=t.substring(s,o+1);break;default:ms()}s=o+2}return new Ms(r)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gl=function(t,e){this.seconds=t,this.nanoseconds=e},ml=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};ml.store="owner",ml.key="owner";var yl=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};yl.store="mutationQueues",yl.keyPath="userId";var bl=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};bl.store="mutations",bl.keyPath="batchId",bl.userMutationsIndex="userMutationsIndex",bl.userMutationsKeyPath=["userId","batchId"];var vl=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,hl(e)]},t.key=function(t,e,n){return[t,hl(e),n]},t}();vl.store="documentMutations",vl.PLACEHOLDER=new vl;var xl=function(t,e){this.path=t,this.readTime=e},wl=function(t,e){this.path=t,this.version=e},kl=function(t,e,n,r,i,s){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s};kl.store="remoteDocuments",kl.readTimeIndex="readTimeIndex",kl.readTimeIndexPath="readTime",kl.collectionReadTimeIndex="collectionReadTimeIndex",kl.collectionReadTimeIndexPath=["parentPath","readTime"];var Il=function(t){this.byteSize=t};Il.store="remoteDocumentGlobal",Il.key="remoteDocumentGlobalKey";var Sl=function(t,e,n,r,i,s,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o};Sl.store="targets",Sl.keyPath="targetId",Sl.queryTargetsIndexName="queryTargetsIndex",Sl.queryTargetsKeyPath=["canonicalId","targetId"];var Tl=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Tl.store="targetDocuments",Tl.keyPath=["targetId","path"],Tl.documentTargetsIndex="documentTargetsIndex",Tl.documentTargetsKeyPath=["path","targetId"];var Cl=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Cl.key="targetGlobalKey",Cl.store="targetGlobal";var Nl=function(t,e){this.collectionId=t,this.parent=e};Nl.store="collectionParents",Nl.keyPath=["collectionId","parent"];var El=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};El.store="clientMetadata",El.keyPath="clientId";var Rl=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Rl.store="bundles",Rl.keyPath="bundleId";var $l=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};$l.store="namedQueries",$l.keyPath="name";var _l=pt(pt(pt(pt([yl.store,bl.store,vl.store,kl.store,Sl.store,ml.store,Cl.store,Tl.store],[El.store]),[Il.store]),[Nl.store]),[Rl.store,$l.store]),Al=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).ps=e,r.bs=n,r}return at(e,t),e}(cl);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dl(t,e){var n=bs(t);return Zu.zn(n.ps,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fl=function(){function t(t,e,n,r){this.batchId=t,this.vs=e,this.baseMutations=n,this.mutations=r}return t.prototype.Ss=function(t,e,n){for(var r=n.Ds,i=0;i<this.mutations.length;i++){var s=this.mutations[i];s.key.isEqual(t)&&(e=Na(s,e,r[i]))}return e},t.prototype.Cs=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(o=r[n]).key.isEqual(t)&&(e=Ea(o,e,this.vs));for(var i=0,s=this.mutations;i<s.length;i++){var o;(o=s[i]).key.isEqual(t)&&(e=Ea(o,e,this.vs))}return e},t.prototype.xs=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.Cs(r.key,t.get(r.key));i&&(n=n.zt(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),ru())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&ks(this.mutations,t.mutations,(function(t,e){return $a(t,e)}))&&ks(this.baseMutations,t.baseMutations,(function(t,e){return $a(t,e)}))},t}(),Ol=function(){function t(t,e,n,r){this.batch=t,this.Ns=e,this.Ds=n,this.$s=r}return t.from=function(e,n,r){ys(e.mutations.length===r.length);for(var i=eu,s=e.mutations,o=0;o<s.length;o++)i=i.zt(s[o].key,r[o].version);return new t(e,n,r,i)},t}(),Ll=function(t){this.Fs=t};function Pl(t,e){if(e.document)return function(t,e,n){var r=Eu(t,e.name),i=Su(e.updateTime),s=new mo({mapValue:{fields:e.fields}});return new xo(r,i,s,{hasCommittedMutations:!!n})}(t.Fs,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Us.Et(e.noDocument.path),r=Vl(e.noDocument.readTime);return new wo(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=Us.Et(e.unknownDocument.path);return r=Vl(e.unknownDocument.version),new ko(i,r)}return ms()}function Ml(t,e,n){var r,i,s=zl(n),o=e.key.path.X().it();if(e instanceof xo){var a={name:Nu(r=t.Fs,(i=e).key),fields:i.bt().mapValue.fields,updateTime:wu(r,i.version.j())},u=e.hasCommittedMutations;return new kl(null,null,a,u,s,o)}if(e instanceof wo){var l=e.key.path.it(),c=Ul(e.version);return u=e.hasCommittedMutations,new kl(null,new xl(l,c),null,u,s,o)}if(e instanceof ko){var h=e.key.path.it(),d=Ul(e.version);return new kl(new wl(h,d),null,null,!0,s,o)}return ms()}function zl(t){var e=t.j();return[e.seconds,e.nanoseconds]}function Bl(t){var e=new Os(t[0],t[1]);return Ls.K(e)}function Ul(t){var e=t.j();return new gl(e.seconds,e.nanoseconds)}function Vl(t){var e=new Os(t.seconds,t.nanoseconds);return Ls.K(e)}function Wl(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Ou(t.Fs,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var s=e.mutations[r+1];i.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var o=e.mutations.map((function(e){return Ou(t.Fs,e)})),a=Os.fromMillis(e.localWriteTimeMs);return new Fl(e.batchId,a,n,o)}function Gl(t){var e,n,r=Vl(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Vl(t.lastLimboFreeSnapshotVersion):Ls.min();return void 0!==t.query.documents?(ys(1===(n=t.query).documents.length),e=Jo(jo($u(n.documents[0])))):e=Jo(Mu(t.query)),new oa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Ss.fromBase64String(t.resumeToken))}function jl(t,e){var n,r=Ul(e.Ot),i=Ul(e.lastLimboFreeSnapshotVersion);n=No(e.target)?Lu(t.Fs,e.target):Pu(t.Fs,e.target);var s=e.resumeToken.toBase64();return new Sl(e.targetId,To(e.target),r,s,e.sequenceNumber,i,n)}function Hl(t){var e=Mu({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Zo(e,e.limit,"L"):e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ql=function(){function t(){}return t.prototype.Os=function(t,e){return Kl(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Vl(e.createTime),version:e.version};var e}))},t.prototype.ks=function(t,e){return Kl(t).put({bundleId:(n=e).id,createTime:Ul(Su(n.createTime)),version:n.version});var n},t.prototype.Ms=function(t,e){return Xl(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Hl(e.bundledQuery),readTime:Vl(e.readTime)};var e}))},t.prototype.Ls=function(t,e){return Xl(t).put({name:(n=e).name,readTime:Ul(Su(n.readTime)),bundledQuery:n.bundledQuery});var n},t}();function Kl(t){return Dl(t,Rl.store)}function Xl(t){return Dl(t,$l.store)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yl=function(){function t(){this.Bs=new Ql}return t.prototype.qs=function(t,e){return this.Bs.add(e),Qu.resolve()},t.prototype.Us=function(t,e){return Qu.resolve(this.Bs.getEntries(e))},t}(),Ql=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.tt(),n=t.X(),r=this.index[e]||new Ka(Ms.H),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.tt(),n=t.X(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Ka(Ms.H)).it()},t}(),Jl=function(){function t(){this.Qs=new Ql}return t.prototype.qs=function(t,e){var n=this;if(!this.Qs.has(e)){var r=e.tt(),i=e.X();t.gs((function(){n.Qs.add(e)}));var s={collectionId:r,parent:hl(i)};return Zl(t).put(s)}return Qu.resolve()},t.prototype.Us=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Is(e),""],!1,!0);return Zl(t).rs(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var s=i[r];if(s.collectionId!==e)break;n.push(fl(s.parent))}return n}))},t}();function Zl(t){return Dl(t,Nl.store)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tc={Ks:!1,Ws:0,js:0,Gs:0},ec=function(){function t(t,e,n){this.zs=t,this.Hs=e,this.Js=n}return t.Ys=function(e){return new t(e,t.Xs,t.Zs)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nc(t){return lt(this,void 0,void 0,(function(){return ct(this,(function(e){if(t.code!==Ts.FAILED_PRECONDITION||t.message!==ll)throw t;return ds("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ec.Xs=10,ec.Zs=1e3,ec.ti=new ec(41943040,ec.Xs,ec.Zs),ec.ei=new ec(-1,0,0);var rc=function(){function t(t,e){this.ni=t,this.si=e,this.ii={}}return t.prototype.get=function(t){var e=this.ni(t),n=this.ii[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var s=i[r],o=s[0],a=s[1];if(this.si(o,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.ni(t),r=this.ii[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.si(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.ii[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.ni(t),n=this.ii[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.si(n[r][0],t))return 1===n.length?delete this.ii[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Ws(this.ii,(function(e,n){for(var r=0,i=n;r<i.length;r++){var s=i[r],o=s[0],a=s[1];t(o,a)}}))},t.prototype.et=function(){return Gs(this.ii)},t}(),ic=function(){function t(){this.ri=new rc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.oi=!1}return t.prototype.ci=function(t){var e=this.ri.get(t);return e?e.readTime:Ls.min()},t.prototype.ai=function(t,e){this.ui(),this.ri.set(t.key,{hi:t,readTime:e})},t.prototype.li=function(t,e){void 0===e&&(e=null),this.ui(),this.ri.set(t,{hi:null,readTime:e})},t.prototype._i=function(t,e){this.ui();var n=this.ri.get(e);return void 0!==n?Qu.resolve(n.hi):this.fi(t,e)},t.prototype.getEntries=function(t,e){return this.di(t,e)},t.prototype.apply=function(t){return this.ui(),this.oi=!0,this.wi(t)},t.prototype.ui=function(){},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sc(t,e,n){var r=t.store(bl.store),i=t.store(vl.store),s=[],o=IDBKeyRange.only(n.batchId),a=0,u=r.hs({range:o},(function(t,e,n){return a++,n.delete()}));s.push(u.next((function(){ys(1===a)})));for(var l=[],c=0,h=n.mutations;c<h.length;c++){var d=h[c],p=vl.key(e,d.key.path,n.batchId);s.push(i.delete(p)),l.push(d.key)}return Qu.Mn(s).next((function(){return l}))}function oc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ms();e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ac=function(){function t(t,e,n,r){this.userId=t,this.Qt=e,this.Ei=n,this.Ti=r,this.Ii={}}return t.mi=function(e,n,r,i){return ys(""!==e.uid),new t(e.m()?e.uid:"",n,r,i)},t.prototype.Ai=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return lc(t).hs({index:bl.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Ri=function(t,e,n,r){var i=this,s=cc(t),o=lc(t);return o.add({}).next((function(a){ys("number"==typeof a);for(var u=new Fl(a,e,n,r),l=function(t,e,n){var r=n.baseMutations.map((function(e){return Fu(t.Fs,e)})),i=n.mutations.map((function(e){return Fu(t.Fs,e)}));return new bl(e,n.batchId,n.vs.toMillis(),r,i)}(i.Qt,i.userId,u),c=[],h=new Ka((function(t,e){return ws(t.rt(),e.rt())})),d=0,p=r;d<p.length;d++){var f=p[d],g=vl.key(i.userId,f.key.path,a);h=h.add(f.key.path.X()),c.push(o.put(l)),c.push(s.put(g,vl.PLACEHOLDER))}return h.forEach((function(e){c.push(i.Ei.qs(t,e))})),t.gs((function(){i.Ii[a]=u.keys()})),Qu.Mn(c).next((function(){return u}))}))},t.prototype.Pi=function(t,e){var n=this;return lc(t).get(e).next((function(t){return t?(ys(t.userId===n.userId),Wl(n.Qt,t)):null}))},t.prototype.yi=function(t,e){var n=this;return this.Ii[e]?Qu.resolve(this.Ii[e]):this.Pi(t,e).next((function(t){if(t){var r=t.keys();return n.Ii[e]=r,r}return null}))},t.prototype.gi=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return lc(t).hs({index:bl.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(ys(e.batchId>=r),s=Wl(n.Qt,e)),i.done()})).next((function(){return s}))},t.prototype.Vi=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return lc(t).hs({index:bl.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.pi=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return lc(t).rs(bl.userMutationsIndex,n).next((function(t){return t.map((function(t){return Wl(e.Qt,t)}))}))},t.prototype.bi=function(t,e){var n=this,r=vl.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),s=[];return cc(t).hs({range:i},(function(r,i,o){var a=r[0],u=r[1],l=r[2],c=fl(u);if(a===n.userId&&e.path.isEqual(c))return lc(t).get(l).next((function(t){if(!t)throw ms();ys(t.userId===n.userId),s.push(Wl(n.Qt,t))}));o.done()})).next((function(){return s}))},t.prototype.vi=function(t,e){var n=this,r=new Ka(ws),i=[];return e.forEach((function(e){var s=vl.prefixForPath(n.userId,e.path),o=IDBKeyRange.lowerBound(s),a=cc(t).hs({range:o},(function(t,i,s){var o=t[0],a=t[1],u=t[2],l=fl(a);o===n.userId&&e.path.isEqual(l)?r=r.add(u):s.done()}));i.push(a)})),Qu.Mn(i).next((function(){return n.Si(t,r)}))},t.prototype.Di=function(t,e){var n=this,r=e.path,i=r.length+1,s=vl.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Ka(ws);return cc(t).hs({range:o},(function(t,e,s){var o=t[0],u=t[1],l=t[2],c=fl(u);o===n.userId&&r.nt(c)?c.length===i&&(a=a.add(l)):s.done()})).next((function(){return n.Si(t,a)}))},t.prototype.Si=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(lc(t).get(e).next((function(t){if(null===t)throw ms();ys(t.userId===n.userId),r.push(Wl(n.Qt,t))})))})),Qu.Mn(i).next((function(){return r}))},t.prototype.Ci=function(t,e){var n=this;return sc(t.ps,this.userId,e).next((function(r){return t.gs((function(){n.xi(e.batchId)})),Qu.forEach(r,(function(e){return n.Ti.Ni(t,e)}))}))},t.prototype.xi=function(t){delete this.Ii[t]},t.prototype.$i=function(t){var e=this;return this.Ai(t).next((function(n){if(!n)return Qu.resolve();var r=IDBKeyRange.lowerBound(vl.prefixForUser(e.userId)),i=[];return cc(t).hs({range:r},(function(t,n,r){if(t[0]===e.userId){var s=fl(t[1]);i.push(s)}else r.done()})).next((function(){ys(0===i.length)}))}))},t.prototype.Fi=function(t,e){return uc(t,this.userId,e)},t.prototype.Oi=function(t){var e=this;return hc(t).get(this.userId).next((function(t){return t||new yl(e.userId,-1,"")}))},t}();function uc(t,e,n){var r=vl.prefixForPath(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return cc(t).hs({range:s,us:!0},(function(t,n,r){var s=t[0],a=t[1];t[2],s===e&&a===i&&(o=!0),r.done()})).next((function(){return o}))}function lc(t){return Dl(t,bl.store)}function cc(t){return Dl(t,vl.store)}function hc(t){return Dl(t,yl.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dc=function(){function t(t){this.ki=t}return t.prototype.next=function(){return this.ki+=2,this.ki},t.Mi=function(){return new t(0)},t.Li=function(){return new t(-1)},t}(),pc=function(){function t(t,e){this.Ti=t,this.Qt=e}return t.prototype.Bi=function(t){var e=this;return this.qi(t).next((function(n){var r=new dc(n.highestTargetId);return n.highestTargetId=r.next(),e.Ui(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.Qi=function(t){return this.qi(t).next((function(t){return Ls.K(new Os(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.Ki=function(t){return this.qi(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.Wi=function(t,e,n){var r=this;return this.qi(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.j()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ui(t,i)}))},t.prototype.ji=function(t,e){var n=this;return this.Gi(t,e).next((function(){return n.qi(t).next((function(r){return r.targetCount+=1,n.zi(e,r),n.Ui(t,r)}))}))},t.prototype.Hi=function(t,e){return this.Gi(t,e)},t.prototype.Ji=function(t,e){var n=this;return this.Yi(t,e.targetId).next((function(){return fc(t).delete(e.targetId)})).next((function(){return n.qi(t)})).next((function(e){return ys(e.targetCount>0),e.targetCount-=1,n.Ui(t,e)}))},t.prototype.Xi=function(t,e,n){var r=this,i=0,s=[];return fc(t).hs((function(o,a){var u=Gl(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,s.push(r.Ji(t,u)))})).next((function(){return Qu.Mn(s)})).next((function(){return i}))},t.prototype.In=function(t,e){return fc(t).hs((function(t,n){var r=Gl(n);e(r)}))},t.prototype.qi=function(t){return gc(t).get(Cl.key).next((function(t){return ys(null!==t),t}))},t.prototype.Ui=function(t,e){return gc(t).put(Cl.key,e)},t.prototype.Gi=function(t,e){return fc(t).put(jl(this.Qt,e))},t.prototype.zi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.Zi=function(t){return this.qi(t).next((function(t){return t.targetCount}))},t.prototype.tr=function(t,e){var n=To(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return fc(t).hs({range:r,index:Sl.queryTargetsIndexName},(function(t,n,r){var s=Gl(n);Co(e,s.target)&&(i=s,r.done())})).next((function(){return i}))},t.prototype.er=function(t,e,n){var r=this,i=[],s=mc(t);return e.forEach((function(e){var o=hl(e.path);i.push(s.put(new Tl(n,o))),i.push(r.Ti.nr(t,n,e))})),Qu.Mn(i)},t.prototype.sr=function(t,e,n){var r=this,i=mc(t);return Qu.forEach(e,(function(e){var s=hl(e.path);return Qu.Mn([i.delete([n,s]),r.Ti.ir(t,n,e)])}))},t.prototype.Yi=function(t,e){var n=mc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.rr=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=mc(t),i=ru();return r.hs({range:n,us:!0},(function(t,e,n){var r=fl(t[1]),s=new Us(r);i=i.add(s)})).next((function(){return i}))},t.prototype.Fi=function(t,e){var n=hl(e.path),r=IDBKeyRange.bound([n],[Is(n)],!1,!0),i=0;return mc(t).hs({index:Tl.documentTargetsIndex,us:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Sn=function(t,e){return fc(t).get(e).next((function(t){return t?Gl(t):null}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fc(t){return Dl(t,Sl.store)}function gc(t){return Dl(t,Cl.store)}function mc(t){return Dl(t,Tl.store)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yc(t,e){var n=t[0],r=t[1],i=e[0],s=e[1],o=ws(n,i);return 0===o?ws(r,s):o}var bc=function(){function t(t){this.cr=t,this.buffer=new Ka(yc),this.ar=0}return t.prototype.ur=function(){return++this.ar},t.prototype.hr=function(t){var e=[t,this.ur()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();yc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),vc=function(){function t(t,e){this.lr=t,this._s=e,this._r=!1,this.dr=null}return t.prototype.start=function(t){-1!==this.lr.params.zs&&this.wr(t)},t.prototype.stop=function(){this.dr&&(this.dr.cancel(),this.dr=null)},Object.defineProperty(t.prototype,"Er",{get:function(){return null!==this.dr},enumerable:!1,configurable:!0}),t.prototype.wr=function(t){var e=this,n=this._r?3e5:6e4;ds("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.dr=this._s.Tr("lru_garbage_collection",n,(function(){return lt(e,void 0,void 0,(function(){var e;return ct(this,(function(n){switch(n.label){case 0:this.dr=null,this._r=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Ir(this.lr)];case 2:return n.sent(),[3,7];case 3:return nl(e=n.sent())?(ds("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,nc(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.wr(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),xc=function(){function t(t,e){this.mr=t,this.params=e}return t.prototype.Ar=function(t,e){return this.mr.Rr(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.Pr=function(t,e){var n=this;if(0===e)return Qu.resolve(Fs.q);var r=new bc(e);return this.mr.In(t,(function(t){return r.hr(t.sequenceNumber)})).next((function(){return n.mr.yr(t,(function(t){return r.hr(t)}))})).next((function(){return r.maxValue}))},t.prototype.Xi=function(t,e,n){return this.mr.Xi(t,e,n)},t.prototype.gr=function(t,e){return this.mr.gr(t,e)},t.prototype.Vr=function(t,e){var n=this;return-1===this.params.zs?(ds("LruGarbageCollector","Garbage collection skipped; disabled"),Qu.resolve(tc)):this.pr(t).next((function(r){return r<n.params.zs?(ds("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.zs),tc):n.br(t,e)}))},t.prototype.pr=function(t){return this.mr.pr(t)},t.prototype.br=function(t,e){var n,r,i,s,o,a,u,l=this,c=Date.now();return this.Ar(t,this.params.Hs).next((function(e){return e>l.params.Js?(ds("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.Js+" from "+e),r=l.params.Js):r=e,s=Date.now(),l.Pr(t,r)})).next((function(r){return n=r,o=Date.now(),l.Xi(t,n,e)})).next((function(e){return i=e,a=Date.now(),l.gr(t,n)})).next((function(t){return u=Date.now(),hs()<=_t.DEBUG&&ds("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-c)+"ms\n\tDetermined least recently used "+r+" in "+(o-s)+"ms\n\tRemoved "+i+" targets in "+(a-o)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-c)+"ms"),Qu.resolve({Ks:!0,Ws:r,js:i,Gs:t})}))},t}(),wc=function(){function t(t,e){this.db=t,this.lr=new xc(this,e)}return t.prototype.Rr=function(t){var e=this.vr(t);return this.db.Sr().Zi(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.vr=function(t){var e=0;return this.yr(t,(function(t){e++})).next((function(){return e}))},t.prototype.In=function(t,e){return this.db.Sr().In(t,e)},t.prototype.yr=function(t,e){return this.Dr(t,(function(t,n){return e(n)}))},t.prototype.nr=function(t,e,n){return kc(t,n)},t.prototype.ir=function(t,e,n){return kc(t,n)},t.prototype.Xi=function(t,e,n){return this.db.Sr().Xi(t,e,n)},t.prototype.Ni=function(t,e){return kc(t,e)},t.prototype.Cr=function(t,e){return r=e,i=!1,hc(n=t).ls((function(t){return uc(n,t,r).next((function(t){return t&&(i=!0),Qu.resolve(!t)}))})).next((function(){return i}));var n,r,i},t.prototype.gr=function(t,e){var n=this,r=this.db.$r().Nr(),i=[],s=0;return this.Dr(t,(function(o,a){if(a<=e){var u=n.Cr(t,o).next((function(e){if(!e)return s++,r._i(t,o).next((function(){return r.li(o),mc(t).delete([0,hl(o.path)])}))}));i.push(u)}})).next((function(){return Qu.Mn(i)})).next((function(){return r.apply(t)})).next((function(){return s}))},t.prototype.removeTarget=function(t,e){var n=e.kt(t.bs);return this.db.Sr().Hi(t,n)},t.prototype.Fr=function(t,e){return kc(t,e)},t.prototype.Dr=function(t,e){var n,r=mc(t),i=Fs.q;return r.hs({index:Tl.documentTargetsIndex},(function(t,r){var s=t[0],o=(t[1],r.path),a=r.sequenceNumber;0===s?(i!==Fs.q&&e(new Us(fl(n)),i),i=a,n=o):i=Fs.q})).next((function(){i!==Fs.q&&e(new Us(fl(n)),i)}))},t.prototype.pr=function(t){return this.db.$r().Or(t)},t}();function kc(t,e){return mc(t).put((n=e,r=t.bs,new Tl(0,hl(n.path),r)));var n,r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ic=function(){function t(t,e){this.Qt=t,this.Ei=e}return t.prototype.ai=function(t,e,n){return Cc(t).put(Nc(e),n)},t.prototype.li=function(t,e){var n=Cc(t),r=Nc(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.kr(t,r)}))},t.prototype._i=function(t,e){var n=this;return Cc(t).get(Nc(e)).next((function(t){return n.Mr(t)}))},t.prototype.Lr=function(t,e){var n=this;return Cc(t).get(Nc(e)).next((function(t){var e=n.Mr(t);return e?{hi:e,size:oc(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=Ja();return this.Br(t,e,(function(t,e){var i=n.Mr(e);r=r.zt(t,i)})).next((function(){return r}))},t.prototype.qr=function(t,e){var n=this,r=Ja(),i=new ja(Us.H);return this.Br(t,e,(function(t,e){var s=n.Mr(e);s?(r=r.zt(t,s),i=i.zt(t,oc(e))):(r=r.zt(t,null),i=i.zt(t,0))})).next((function(){return{Ur:r,Qr:i}}))},t.prototype.Br=function(t,e,n){if(e.et())return Qu.resolve();var r=IDBKeyRange.bound(e.first().path.it(),e.last().path.it()),i=e.te(),s=i.oe();return Cc(t).hs({range:r},(function(t,e,r){for(var o=Us.Et(t);s&&Us.H(s,o)<0;)n(s,null),s=i.oe();s&&s.isEqual(o)&&(n(s,e),s=i.ce()?i.oe():null),s?r.ss(s.path.it()):r.done()})).next((function(){for(;s;)n(s,null),s=i.ce()?i.oe():null}))},t.prototype.Kr=function(t,e,n){var r=this,i=tu(),s=e.path.length+1,o={};if(n.isEqual(Ls.min())){var a=e.path.it();o.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.it(),l=zl(n);o.range=IDBKeyRange.lowerBound([u,l],!0),o.index=kl.collectionReadTimeIndex}return Cc(t).hs(o,(function(t,n,o){if(t.length===s){var a=Pl(r.Qt,n);e.path.nt(a.key.path)?a instanceof xo&&ra(e,a)&&(i=i.zt(a.key,a)):o.done()}})).next((function(){return i}))},t.prototype.Nr=function(t){return new Sc(this,!!t&&t.Wr)},t.prototype.Or=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Tc(t).get(Il.key).next((function(t){return ys(!!t),t}))},t.prototype.kr=function(t,e){return Tc(t).put(Il.key,e)},t.prototype.Mr=function(t){if(t){var e=Pl(this.Qt,t);return e instanceof wo&&e.version.isEqual(Ls.min())?null:e}return null},t}(),Sc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jr=e,r.Wr=n,r.Gr=new rc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return at(e,t),e.prototype.wi=function(t){var e=this,n=[],r=0,i=new Ka((function(t,e){return ws(t.rt(),e.rt())}));return this.ri.forEach((function(s,o){var a=e.Gr.get(s);if(o.hi){var u=Ml(e.jr.Qt,o.hi,e.ci(s));i=i.add(s.path.X());var l=oc(u);r+=l-a,n.push(e.jr.ai(t,s,u))}else if(r-=a,e.Wr){var c=Ml(e.jr.Qt,new wo(s,Ls.min()),e.ci(s));n.push(e.jr.ai(t,s,c))}else n.push(e.jr.li(t,s))})),i.forEach((function(r){n.push(e.jr.Ei.qs(t,r))})),n.push(this.jr.updateMetadata(t,r)),Qu.Mn(n)},e.prototype.fi=function(t,e){var n=this;return this.jr.Lr(t,e).next((function(t){return null===t?(n.Gr.set(e,0),null):(n.Gr.set(e,t.size),t.hi)}))},e.prototype.di=function(t,e){var n=this;return this.jr.qr(t,e).next((function(t){var e=t.Ur;return t.Qr.forEach((function(t,e){n.Gr.set(t,e)})),e}))},e}(ic);function Tc(t){return Dl(t,Il.store)}function Cc(t){return Dl(t,kl.store)}function Nc(t){return t.path.it()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ec=function(){function t(t){this.Qt=t}return t.prototype.Jn=function(t,e,n,r){var i=this;ys(n<r&&n>=0&&r<=11);var s=new Ju("createOrUpgrade",e);n<1&&r>=1&&(t.createObjectStore(ml.store),function(t){t.createObjectStore(yl.store,{keyPath:yl.keyPath}),t.createObjectStore(bl.store,{keyPath:bl.keyPath,autoIncrement:!0}).createIndex(bl.userMutationsIndex,bl.userMutationsKeyPath,{unique:!0}),t.createObjectStore(vl.store)}(t),Rc(t),function(t){t.createObjectStore(kl.store)}(t));var o=Qu.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Tl.store),t.deleteObjectStore(Sl.store),t.deleteObjectStore(Cl.store)}(t),Rc(t)),o=o.next((function(){return function(t){var e=t.store(Cl.store),n=new Cl(0,0,Ls.min().j(),0);return e.put(Cl.key,n)}(s)}))),n<4&&r>=4&&(0!==n&&(o=o.next((function(){return function(t,e){return e.store(bl.store).rs().next((function(n){t.deleteObjectStore(bl.store),t.createObjectStore(bl.store,{keyPath:bl.keyPath,autoIncrement:!0}).createIndex(bl.userMutationsIndex,bl.userMutationsKeyPath,{unique:!0});var r=e.store(bl.store),i=n.map((function(t){return r.put(t)}));return Qu.Mn(i)}))}(t,s)}))),o=o.next((function(){!function(t){t.createObjectStore(El.store,{keyPath:El.keyPath})}(t)}))),n<5&&r>=5&&(o=o.next((function(){return i.zr(s)}))),n<6&&r>=6&&(o=o.next((function(){return function(t){t.createObjectStore(Il.store)}(t),i.Hr(s)}))),n<7&&r>=7&&(o=o.next((function(){return i.Jr(s)}))),n<8&&r>=8&&(o=o.next((function(){return i.Yr(t,s)}))),n<9&&r>=9&&(o=o.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(kl.store);e.createIndex(kl.readTimeIndex,kl.readTimeIndexPath,{unique:!1}),e.createIndex(kl.collectionReadTimeIndex,kl.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(o=o.next((function(){return i.Xr(s)}))),n<11&&r>=11&&(o=o.next((function(){!function(t){t.createObjectStore(Rl.store,{keyPath:Rl.keyPath})}(t),function(t){t.createObjectStore($l.store,{keyPath:$l.keyPath})}(t)}))),o},t.prototype.Hr=function(t){var e=0;return t.store(kl.store).hs((function(t,n){e+=oc(n)})).next((function(){var n=new Il(e);return t.store(Il.store).put(Il.key,n)}))},t.prototype.zr=function(t){var e=this,n=t.store(yl.store),r=t.store(bl.store);return n.rs().next((function(n){return Qu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.rs(bl.userMutationsIndex,i).next((function(r){return Qu.forEach(r,(function(r){ys(r.userId===n.userId);var i=Wl(e.Qt,r);return sc(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.Jr=function(t){var e=t.store(Tl.store),n=t.store(kl.store);return t.store(Cl.store).get(Cl.key).next((function(t){var r=[];return n.hs((function(n,i){var s=new Ms(n),o=[0,hl(s)];r.push(e.get(o).next((function(n){return n?Qu.resolve():(r=s,e.put(new Tl(0,hl(r),t.highestListenSequenceNumber)));var r})))})).next((function(){return Qu.Mn(r)}))}))},t.prototype.Yr=function(t,e){t.createObjectStore(Nl.store,{keyPath:Nl.keyPath});var n=e.store(Nl.store),r=new Ql,i=function(t){if(r.add(t)){var e=t.tt(),i=t.X();return n.put({collectionId:e,parent:hl(i)})}};return e.store(kl.store).hs({us:!0},(function(t,e){var n=new Ms(t);return i(n.X())})).next((function(){return e.store(vl.store).hs({us:!0},(function(t,e){t[0];var n=t[1],r=(t[2],fl(n));return i(r.X())}))}))},t.prototype.Xr=function(t){var e=this,n=t.store(Sl.store);return n.hs((function(t,r){var i=Gl(r),s=jl(e.Qt,i);return n.put(s)}))},t}();function Rc(t){t.createObjectStore(Tl.store,{keyPath:Tl.keyPath}).createIndex(Tl.documentTargetsIndex,Tl.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Sl.store,{keyPath:Sl.keyPath}).createIndex(Sl.queryTargetsIndexName,Sl.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Cl.store)}var $c="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",_c=function(){function t(e,n,r,i,s,o,a,u,l,c){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Zr=s,this.window=o,this.document=a,this.eo=l,this.no=c,this.so=null,this.io=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ro=null,this.inForeground=!1,this.oo=null,this.co=null,this.ao=Number.NEGATIVE_INFINITY,this.uo=function(t){return Promise.resolve()},!t.Kn())throw new Cs(Ts.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");var h,d;this.Ti=new wc(this,i),this.ho=n+"main",this.Qt=new Ll(u),this.lo=new Zu(this.ho,11,new Ec(this.Qt)),this._o=new pc(this.Ti,this.Qt),this.Ei=new Jl,this.fo=(h=this.Qt,d=this.Ei,new Ic(h,d)),this.wo=new ql,this.window&&this.window.localStorage?this.Eo=this.window.localStorage:(this.Eo=null,!1===c&&ps("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.To().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Cs(Ts.FAILED_PRECONDITION,$c);return t.Io(),t.mo(),t.Ao(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t._o.Ki(e)}))})).then((function(e){t.so=new Fs(e,t.eo)})).then((function(){t.io=!0})).catch((function(e){return t.lo&&t.lo.close(),Promise.reject(e)}))},t.prototype.Ro=function(t){var e=this;return this.uo=function(n){return lt(e,void 0,void 0,(function(){return ct(this,(function(e){return this.Er?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.Po=function(t){var e=this;this.lo.Xn((function(n){return lt(e,void 0,void 0,(function(){return ct(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.yo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Zr.Ps((function(){return lt(e,void 0,void 0,(function(){return ct(this,(function(t){switch(t.label){case 0:return this.Er?[4,this.To()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.To=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Dc(e).put(new El(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Vo(e).next((function(e){e||(t.isPrimary=!1,t.Zr.po((function(){return t.uo(!1)})))}))})).next((function(){return t.bo(e)})).next((function(n){return t.isPrimary&&!n?t.vo(e).next((function(){return!1})):!!n&&t.So(e).next((function(){return!0}))}))})).catch((function(e){if(nl(e))return ds("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return ds("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Zr.po((function(){return t.uo(e)})),t.isPrimary=e}))},t.prototype.Vo=function(t){var e=this;return Ac(t).get(ml.key).next((function(t){return Qu.resolve(e.Do(t))}))},t.prototype.Co=function(t){return Dc(t).delete(this.clientId)},t.prototype.xo=function(){return lt(this,void 0,void 0,(function(){var t,e,n,r,i=this;return ct(this,(function(s){switch(s.label){case 0:return!this.isPrimary||this.No(this.ao,18e5)?[3,2]:(this.ao=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Dl(t,El.store);return e.rs().next((function(t){var n=i.$o(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return Qu.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=s.sent(),this.Eo)for(e=0,n=t;e<n.length;e++)r=n[e],this.Eo.removeItem(this.Fo(r.clientId));s.label=2;case 2:return[2]}}))}))},t.prototype.Ao=function(){var t=this;this.co=this.Zr.Tr("client_metadata_refresh",4e3,(function(){return t.To().then((function(){return t.xo()})).then((function(){return t.Ao()}))}))},t.prototype.Do=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.bo=function(t){var e=this;return this.no?Qu.resolve(!0):Ac(t).get(ml.key).next((function(n){if(null!==n&&e.No(n.leaseTimestampMs,5e3)&&!e.Oo(n.ownerId)){if(e.Do(n)&&e.networkEnabled)return!0;if(!e.Do(n)){if(!n.allowTabSynchronization)throw new Cs(Ts.FAILED_PRECONDITION,$c);return!1}}return!(!e.networkEnabled||!e.inForeground)||Dc(t).rs().next((function(t){return void 0===e.$o(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&ds("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.ko=function(){return lt(this,void 0,void 0,(function(){var t=this;return ct(this,(function(e){switch(e.label){case 0:return this.io=!1,this.Mo(),this.co&&(this.co.cancel(),this.co=null),this.Lo(),this.Bo(),[4,this.lo.runTransaction("shutdown","readwrite",[ml.store,El.store],(function(e){var n=new Al(e,Fs.q);return t.vo(n).next((function(){return t.Co(n)}))}))];case 1:return e.sent(),this.lo.close(),this.qo(),[2]}}))}))},t.prototype.$o=function(t,e){var n=this;return t.filter((function(t){return n.No(t.updateTimeMs,e)&&!n.Oo(t.clientId)}))},t.prototype.Uo=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Dc(e).rs().next((function(e){return t.$o(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"Er",{get:function(){return this.io},enumerable:!1,configurable:!0}),t.prototype.Qo=function(t){return ac.mi(t,this.Qt,this.Ei,this.Ti)},t.prototype.Sr=function(){return this._o},t.prototype.$r=function(){return this.fo},t.prototype.Ko=function(){return this.Ei},t.prototype.Wo=function(){return this.wo},t.prototype.runTransaction=function(t,e,n){var r=this;ds("IndexedDbPersistence","Starting transaction:",t);var i,s="readonly"===e?"readonly":"readwrite";return this.lo.runTransaction(t,s,_l,(function(s){return i=new Al(s,r.so?r.so.next():Fs.q),"readwrite-primary"===e?r.Vo(i).next((function(t){return!!t||r.bo(i)})).next((function(e){if(!e)throw ps("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Zr.po((function(){return r.uo(!1)})),new Cs(Ts.FAILED_PRECONDITION,ll);return n(i)})).next((function(t){return r.So(i).next((function(){return t}))})):r.jo(i).next((function(){return n(i)}))})).then((function(t){return i.Vs(),t}))},t.prototype.jo=function(t){var e=this;return Ac(t).get(ml.key).next((function(t){if(null!==t&&e.No(t.leaseTimestampMs,5e3)&&!e.Oo(t.ownerId)&&!e.Do(t)&&!(e.no||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Cs(Ts.FAILED_PRECONDITION,$c)}))},t.prototype.So=function(t){var e=new ml(this.clientId,this.allowTabSynchronization,Date.now());return Ac(t).put(ml.key,e)},t.Kn=function(){return Zu.Kn()},t.prototype.vo=function(t){var e=this,n=Ac(t);return n.get(ml.key).next((function(t){return e.Do(t)?(ds("IndexedDbPersistence","Releasing primary lease."),n.delete(ml.key)):Qu.resolve()}))},t.prototype.No=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(ps("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.Io=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.oo=function(){t.Zr.Ps((function(){return t.inForeground="visible"===t.document.visibilityState,t.To()}))},this.document.addEventListener("visibilitychange",this.oo),this.inForeground="visible"===this.document.visibilityState)},t.prototype.Lo=function(){this.oo&&(this.document.removeEventListener("visibilitychange",this.oo),this.oo=null)},t.prototype.mo=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ro=function(){e.Mo(),e.Zr.Ps((function(){return e.ko()}))},this.window.addEventListener("unload",this.ro))},t.prototype.Bo=function(){this.ro&&(this.window.removeEventListener("unload",this.ro),this.ro=null)},t.prototype.Oo=function(t){var e;try{var n=null!==(null===(e=this.Eo)||void 0===e?void 0:e.getItem(this.Fo(t)));return ds("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(r){return ps("IndexedDbPersistence","Failed to get zombied client id.",r),!1}},t.prototype.Mo=function(){if(this.Eo)try{this.Eo.setItem(this.Fo(this.clientId),String(Date.now()))}catch(t){ps("Failed to set zombie client id.",t)}},t.prototype.qo=function(){if(this.Eo)try{this.Eo.removeItem(this.Fo(this.clientId))}catch(t){}},t.prototype.Fo=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Ac(t){return Dl(t,ml.store)}function Dc(t){return Dl(t,El.store)}function Fc(t,e){var n=t.projectId;return t.o||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Oc=function(){function t(t,e,n){this.fo=t,this.zo=e,this.Ei=n}return t.prototype.Ho=function(t,e){var n=this;return this.zo.bi(t,e).next((function(r){return n.Jo(t,e,r)}))},t.prototype.Jo=function(t,e,n){return this.fo._i(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].Cs(e,t);return t}))},t.prototype.Yo=function(t,e,n){var r=Ja();return e.forEach((function(t,e){for(var i=0,s=n;i<s.length;i++)e=s[i].Cs(t,e);r=r.zt(t,e)})),r},t.prototype.Xo=function(t,e){var n=this;return this.fo.getEntries(t,e).next((function(e){return n.Zo(t,e)}))},t.prototype.Zo=function(t,e){var n=this;return this.zo.vi(t,e).next((function(r){var i=n.Yo(t,e,r),s=Qa();return i.forEach((function(t,e){e||(e=new wo(t,Ls.min())),s=s.zt(t,e)})),s}))},t.prototype.Kr=function(t,e,n){return r=e,Us.wt(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.tc(t,e.path):Yo(e)?this.ec(t,e,n):this.nc(t,e,n);var r},t.prototype.tc=function(t,e){return this.Ho(t,new Us(e)).next((function(t){var e=tu();return t instanceof xo&&(e=e.zt(t.key,t)),e}))},t.prototype.ec=function(t,e,n){var r=this,i=e.collectionGroup,s=tu();return this.Ei.Us(t,i).next((function(o){return Qu.forEach(o,(function(o){var a,u,l=(a=e,u=o.child(i),new Wo(u,null,a.xt.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));return r.nc(t,l,n).next((function(t){t.forEach((function(t,e){s=s.zt(t,e)}))}))})).next((function(){return s}))}))},t.prototype.nc=function(t,e,n){var r,i,s=this;return this.fo.Kr(t,e,n).next((function(n){return r=n,s.zo.Di(t,e)})).next((function(e){return i=e,s.sc(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var s=n[e],o=0,a=s.mutations;o<a.length;o++){var u=a[o],l=u.key,c=Ea(u,r.get(l),s.vs);r=c instanceof xo?r.zt(l,c):r.remove(l)}}))})).next((function(){return r.forEach((function(t,n){ra(e,n)||(r=r.remove(t))})),r}))},t.prototype.sc=function(t,e,n){for(var r=ru(),i=0,s=e;i<s.length;i++)for(var o=0,a=s[i].mutations;o<a.length;o++){var u=a[o];u instanceof Da&&null===n.get(u.key)&&(r=r.add(u.key))}var l=n;return this.fo.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof xo&&(l=l.zt(t,e))})),l}))},t}(),Lc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.ic=n,this.rc=r}return t.oc=function(e,n){for(var r=ru(),i=ru(),s=0,o=n.docChanges;s<o.length;s++){var a=o[s];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Pc=function(){function t(){}return t.prototype.cc=function(t){this.ac=t},t.prototype.Kr=function(t,e,n,r){var i,s=this;return 0===(i=e).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.xt.length||1===i.xt.length&&i.xt[0].field.ut())||n.isEqual(Ls.min())?this.uc(t,e):this.ac.Xo(t,r).next((function(i){var o=s.hc(e,i);return(Ho(e)||qo(e))&&s.lc(e.limitType,o,r,n)?s.uc(t,e):(hs()<=_t.DEBUG&&ds("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),na(e)),s.ac.Kr(t,e,n).next((function(t){return o.forEach((function(e){t=t.zt(e.key,e)})),t})))}))},t.prototype.hc=function(t,e){var n=new Ka(ia(t));return e.forEach((function(e,r){r instanceof xo&&ra(t,r)&&(n=n.add(r))})),n},t.prototype.lc=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version._(r)>0)},t.prototype.uc=function(t,e){return hs()<=_t.DEBUG&&ds("QueryEngine","Using full collection scan to execute query:",na(e)),this.ac.Kr(t,e,Ls.min())},t}(),Mc=function(){function t(t,e,n,r){this.persistence=t,this._c=e,this.Qt=r,this.fc=new ja(ws),this.dc=new rc((function(t){return To(t)}),Co),this.wc=Ls.min(),this.zo=t.Qo(n),this.Ec=t.$r(),this._o=t.Sr(),this.Tc=new Oc(this.Ec,this.zo,this.persistence.Ko()),this.wo=t.Wo(),this._c.cc(this.Tc)}return t.prototype.Ir=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.Vr(n,e.fc)}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(t,e,n,r){return new Mc(t,e,n,r)}function Bc(t,e){return lt(this,void 0,void 0,(function(){var n,r,i,s;return ct(this,(function(o){switch(o.label){case 0:return n=bs(t),r=n.zo,i=n.Tc,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var s;return n.zo.pi(t).next((function(o){return s=o,r=n.persistence.Qo(e),i=new Oc(n.Ec,r,n.persistence.Ko()),r.pi(t)})).next((function(e){for(var n=[],r=[],o=ru(),a=0,u=s;a<u.length;a++){var l=u[a];n.push(l.batchId);for(var c=0,h=l.mutations;c<h.length;c++){var d=h[c];o=o.add(d.key)}}for(var p=0,f=e;p<f.length;p++){var g=f[p];r.push(g.batchId);for(var m=0,y=g.mutations;m<y.length;m++){var b=y[m];o=o.add(b.key)}}return i.Xo(t,o).next((function(t){return{Ic:t,mc:n,Ac:r}}))}))}))];case 1:return s=o.sent(),[2,(n.zo=r,n.Tc=i,n._c.cc(n.Tc),s)]}}))}))}function Uc(t,e){var n=bs(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r,i,s,o,a,u,l,c=e.batch.keys(),h=n.Ec.Nr({Wr:!0});return(r=n,i=t,s=e,o=h,a=s.batch,u=a.keys(),l=Qu.resolve(),u.forEach((function(t){l=l.next((function(){return o._i(i,t)})).next((function(e){var n=e,r=s.$s.get(t);ys(null!==r),(!n||n.version._(r)<0)&&(n=a.Ss(t,n,s))&&o.ai(n,s.Ns)}))})),l.next((function(){return r.zo.Ci(i,a)}))).next((function(){return h.apply(t)})).next((function(){return n.zo.$i(t)})).next((function(){return n.Tc.Xo(t,c)}))}))}function Vc(t){var e=bs(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e._o.Qi(t)}))}function Wc(t,e){var n=bs(t),r=e.Ot,i=n.fc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var s=n.Ec.Nr({Wr:!0});i=n.fc;var o=[];e.$e.forEach((function(e,s){var a,u,l,c=i.get(s);if(c){o.push(n._o.sr(t,e.Qe,s).next((function(){return n._o.er(t,e.qe,s)})));var h=e.resumeToken;if(h.l()>0){var d=c.Mt(h,r).kt(t.bs);i=i.zt(s,d),a=c,l=e,ys((u=d).resumeToken.l()>0),(0===a.resumeToken.l()||u.Ot.W()-a.Ot.W()>=3e8||l.qe.size+l.Ue.size+l.Qe.size>0)&&o.push(n._o.Hi(t,d))}}}));var a=Qa();if(e.Oe.forEach((function(r,i){e.ke.has(r)&&o.push(n.persistence.Ti.Fr(t,r))})),o.push(function(t,e,n,r,i){var s=ru();return n.forEach((function(t){return s=s.add(t)})),e.getEntries(t,s).next((function(t){var s=Qa();return n.forEach((function(n,o){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;o instanceof wo&&o.version.isEqual(Ls.min())?(e.li(n,u),s=s.zt(n,o)):null==a||o.version._(a.version)>0||0===o.version._(a.version)&&a.hasPendingWrites?(e.ai(o,u),s=s.zt(n,o)):ds("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)})),s}))}(t,s,e.Oe,r,void 0).next((function(t){a=t}))),!r.isEqual(Ls.min())){var u=n._o.Qi(t).next((function(e){return n._o.Wi(t,t.bs,r)}));o.push(u)}return Qu.Mn(o).next((function(){return s.apply(t)})).next((function(){return n.Tc.Zo(t,a)}))})).then((function(t){return n.fc=i,t}))}function Gc(t,e){var n=bs(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.zo.gi(t,e)}))}function jc(t,e){var n=bs(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n._o.tr(t,e).next((function(i){return i?(r=i,Qu.resolve(r)):n._o.Bi(t).next((function(i){return r=new oa(e,i,0,t.bs),n._o.ji(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.fc.get(t.targetId);return(null===r||t.Ot._(r.Ot)>0)&&(n.fc=n.fc.zt(t.targetId,t),n.dc.set(e,t.targetId)),t}))}function Hc(t,e,n){return lt(this,void 0,void 0,(function(){var r,i,s,o;return ct(this,(function(a){switch(a.label){case 0:r=bs(t),i=r.fc.get(e),s=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",s,(function(t){return r.persistence.Ti.removeTarget(t,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!nl(o=a.sent()))throw o;return ds("LocalStore","Failed to update sequence numbers for target "+e+": "+o),[3,5];case 5:return r.fc=r.fc.remove(e),r.dc.delete(i.target),[2]}}))}))}function qc(t,e,n){var r=bs(t),i=Ls.min(),s=ru();return r.persistence.runTransaction("Execute query","readonly",(function(t){return(o=r,a=t,u=Jo(e),l=bs(o),c=l.dc.get(u),void 0!==c?Qu.resolve(l.fc.get(c)):l._o.tr(a,u)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r._o.rr(t,e.targetId).next((function(t){s=t}))})).next((function(){return r._c.Kr(t,e,n?i:Ls.min(),n?s:ru())})).next((function(t){return{documents:t,Rc:s}}));var o,a,u,l,c}))}function Kc(t,e){var n=bs(t),r=bs(n._o),i=n.fc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Sn(t,e).next((function(t){return t?t.target:null}))}))}function Xc(t){var e=bs(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n=e.Ec,r=t,i=e.wc,s=bs(n),o=Qa(),a=zl(i),u=Cc(r),l=IDBKeyRange.lowerBound(a,!0),u.hs({index:kl.readTimeIndex,range:l},(function(t,e){var n=Pl(s.Qt,e);o=o.zt(n.key,n),a=e.readTime})).next((function(){return{Go:o,readTime:Bl(a)}}));var n,r,i,s,o,a,u,l})).then((function(t){var n=t.Go,r=t.readTime;return e.wc=r,n}))}function Yc(t){return lt(this,void 0,void 0,(function(){var e;return ct(this,(function(n){return[2,(e=bs(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return e=Cc(t),n=Ls.min(),e.hs({index:kl.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Bl(e.readTime)),r.done()})).next((function(){return n}));var e,n})).then((function(t){e.wc=t}))]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qc=function(){function t(t){this.Qt=t,this.Vc=new Map,this.bc=new Map}return t.prototype.Os=function(t,e){return Qu.resolve(this.Vc.get(e))},t.prototype.ks=function(t,e){var n;return this.Vc.set(e.id,{id:(n=e).id,version:n.version,createTime:Su(n.createTime)}),Qu.resolve()},t.prototype.Ms=function(t,e){return Qu.resolve(this.bc.get(e))},t.prototype.Ls=function(t,e){return this.bc.set(e.name,{name:(n=e).name,query:Hl(n.bundledQuery),readTime:Su(n.readTime)}),Qu.resolve();var n},t}(),Jc=function(){function t(){this.vc=new Ka(Zc.Sc),this.Dc=new Ka(Zc.Cc)}return t.prototype.et=function(){return this.vc.et()},t.prototype.nr=function(t,e){var n=new Zc(t,e);this.vc=this.vc.add(n),this.Dc=this.Dc.add(n)},t.prototype.xc=function(t,e){var n=this;t.forEach((function(t){return n.nr(t,e)}))},t.prototype.ir=function(t,e){this.Nc(new Zc(t,e))},t.prototype.$c=function(t,e){var n=this;t.forEach((function(t){return n.ir(t,e)}))},t.prototype.Fc=function(t){var e=this,n=new Us(new Ms([])),r=new Zc(n,t),i=new Zc(n,t+1),s=[];return this.Dc.me([r,i],(function(t){e.Nc(t),s.push(t.key)})),s},t.prototype.Oc=function(){var t=this;this.vc.forEach((function(e){return t.Nc(e)}))},t.prototype.Nc=function(t){this.vc=this.vc.delete(t),this.Dc=this.Dc.delete(t)},t.prototype.kc=function(t){var e=new Us(new Ms([])),n=new Zc(e,t),r=new Zc(e,t+1),i=ru();return this.Dc.me([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.Fi=function(t){var e=new Zc(t,0),n=this.vc.Re(e);return null!==n&&t.isEqual(n.key)},t}(),Zc=function(){function t(t,e){this.key=t,this.Mc=e}return t.Sc=function(t,e){return Us.H(t.key,e.key)||ws(t.Mc,e.Mc)},t.Cc=function(t,e){return ws(t.Mc,e.Mc)||Us.H(t.key,e.key)},t}(),th=function(){function t(t,e){this.Ei=t,this.Ti=e,this.zo=[],this.Lc=1,this.Bc=new Ka(Zc.Sc)}return t.prototype.Ai=function(t){return Qu.resolve(0===this.zo.length)},t.prototype.Ri=function(t,e,n,r){var i=this.Lc;this.Lc++,this.zo.length>0&&this.zo[this.zo.length-1];var s=new Fl(i,e,n,r);this.zo.push(s);for(var o=0,a=r;o<a.length;o++){var u=a[o];this.Bc=this.Bc.add(new Zc(u.key,i)),this.Ei.qs(t,u.key.path.X())}return Qu.resolve(s)},t.prototype.Pi=function(t,e){return Qu.resolve(this.qc(e))},t.prototype.gi=function(t,e){var n=e+1,r=this.Uc(n),i=r<0?0:r;return Qu.resolve(this.zo.length>i?this.zo[i]:null)},t.prototype.Vi=function(){return Qu.resolve(0===this.zo.length?-1:this.Lc-1)},t.prototype.pi=function(t){return Qu.resolve(this.zo.slice())},t.prototype.bi=function(t,e){var n=this,r=new Zc(e,0),i=new Zc(e,Number.POSITIVE_INFINITY),s=[];return this.Bc.me([r,i],(function(t){var e=n.qc(t.Mc);s.push(e)})),Qu.resolve(s)},t.prototype.vi=function(t,e){var n=this,r=new Ka(ws);return e.forEach((function(t){var e=new Zc(t,0),i=new Zc(t,Number.POSITIVE_INFINITY);n.Bc.me([e,i],(function(t){r=r.add(t.Mc)}))})),Qu.resolve(this.Qc(r))},t.prototype.Di=function(t,e){var n=e.path,r=n.length+1,i=n;Us.wt(i)||(i=i.child(""));var s=new Zc(new Us(i),0),o=new Ka(ws);return this.Bc.Ae((function(t){var e=t.key.path;return!!n.nt(e)&&(e.length===r&&(o=o.add(t.Mc)),!0)}),s),Qu.resolve(this.Qc(o))},t.prototype.Qc=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.qc(t);null!==r&&n.push(r)})),n},t.prototype.Ci=function(t,e){var n=this;ys(0===this.Kc(e.batchId,"removed")),this.zo.shift();var r=this.Bc;return Qu.forEach(e.mutations,(function(i){var s=new Zc(i.key,e.batchId);return r=r.delete(s),n.Ti.Ni(t,i.key)})).next((function(){n.Bc=r}))},t.prototype.xi=function(t){},t.prototype.Fi=function(t,e){var n=new Zc(e,0),r=this.Bc.Re(n);return Qu.resolve(e.isEqual(r&&r.key))},t.prototype.$i=function(t){return this.zo.length,Qu.resolve()},t.prototype.Kc=function(t,e){return this.Uc(t)},t.prototype.Uc=function(t){return 0===this.zo.length?0:t-this.zo[0].batchId},t.prototype.qc=function(t){var e=this.Uc(t);return e<0||e>=this.zo.length?null:this.zo[e]},t}(),eh=function(){function t(t,e){this.Ei=t,this.Wc=e,this.docs=new ja(Us.H),this.size=0}return t.prototype.ai=function(t,e,n){var r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.Wc(e);return this.docs=this.docs.zt(r,{hi:e,size:o,readTime:n}),this.size+=o-s,this.Ei.qs(t,r.path.X())},t.prototype.li=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype._i=function(t,e){var n=this.docs.get(e);return Qu.resolve(n?n.hi:null)},t.prototype.getEntries=function(t,e){var n=this,r=Ja();return e.forEach((function(t){var e=n.docs.get(t);r=r.zt(t,e?e.hi:null)})),Qu.resolve(r)},t.prototype.Kr=function(t,e,n){for(var r=tu(),i=new Us(e.path.child("")),s=this.docs.ee(i);s.ce();){var o=s.oe(),a=o.key,u=o.value,l=u.hi,c=u.readTime;if(!e.path.nt(a.path))break;c._(n)<=0||l instanceof xo&&ra(e,l)&&(r=r.zt(l.key,l))}return Qu.resolve(r)},t.prototype.jc=function(t,e){return Qu.forEach(this.docs,(function(t){return e(t)}))},t.prototype.Nr=function(t){return new nh(this)},t.prototype.Or=function(t){return Qu.resolve(this.size)},t}(),nh=function(t){function e(e){var n=this;return(n=t.call(this)||this).jr=e,n}return at(e,t),e.prototype.wi=function(t){var e=this,n=[];return this.ri.forEach((function(r,i){i&&i.hi?n.push(e.jr.ai(t,i.hi,e.ci(r))):e.jr.li(r)})),Qu.Mn(n)},e.prototype.fi=function(t,e){return this.jr._i(t,e)},e.prototype.di=function(t,e){return this.jr.getEntries(t,e)},e}(ic),rh=function(){function t(t){this.persistence=t,this.Gc=new rc((function(t){return To(t)}),Co),this.lastRemoteSnapshotVersion=Ls.min(),this.highestTargetId=0,this.zc=0,this.Hc=new Jc,this.targetCount=0,this.Jc=dc.Mi()}return t.prototype.In=function(t,e){return this.Gc.forEach((function(t,n){return e(n)})),Qu.resolve()},t.prototype.Qi=function(t){return Qu.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Ki=function(t){return Qu.resolve(this.zc)},t.prototype.Bi=function(t){return this.highestTargetId=this.Jc.next(),Qu.resolve(this.highestTargetId)},t.prototype.Wi=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.zc&&(this.zc=e),Qu.resolve()},t.prototype.Gi=function(t){this.Gc.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Jc=new dc(e),this.highestTargetId=e),t.sequenceNumber>this.zc&&(this.zc=t.sequenceNumber)},t.prototype.ji=function(t,e){return this.Gi(e),this.targetCount+=1,Qu.resolve()},t.prototype.Hi=function(t,e){return this.Gi(e),Qu.resolve()},t.prototype.Ji=function(t,e){return this.Gc.delete(e.target),this.Hc.Fc(e.targetId),this.targetCount-=1,Qu.resolve()},t.prototype.Xi=function(t,e,n){var r=this,i=0,s=[];return this.Gc.forEach((function(o,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.Gc.delete(o),s.push(r.Yi(t,a.targetId)),i++)})),Qu.Mn(s).next((function(){return i}))},t.prototype.Zi=function(t){return Qu.resolve(this.targetCount)},t.prototype.tr=function(t,e){var n=this.Gc.get(e)||null;return Qu.resolve(n)},t.prototype.er=function(t,e,n){return this.Hc.xc(e,n),Qu.resolve()},t.prototype.sr=function(t,e,n){this.Hc.$c(e,n);var r=this.persistence.Ti,i=[];return r&&e.forEach((function(e){i.push(r.Ni(t,e))})),Qu.Mn(i)},t.prototype.Yi=function(t,e){return this.Hc.Fc(e),Qu.resolve()},t.prototype.rr=function(t,e){var n=this.Hc.kc(e);return Qu.resolve(n)},t.prototype.Fi=function(t,e){return Qu.resolve(this.Hc.Fi(e))},t}(),ih=function(){function t(t,e){var n,r=this;this.Yc={},this.so=new Fs(0),this.io=!1,this.io=!0,this.Ti=t(this),this._o=new rh(this),this.Ei=new Yl,this.fo=(n=this.Ei,new eh(n,(function(t){return r.Ti.Xc(t)}))),this.Qt=new Ll(e),this.wo=new Qc(this.Qt)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.ko=function(){return this.io=!1,Promise.resolve()},Object.defineProperty(t.prototype,"Er",{get:function(){return this.io},enumerable:!1,configurable:!0}),t.prototype.Po=function(){},t.prototype.yo=function(){},t.prototype.Ko=function(){return this.Ei},t.prototype.Qo=function(t){var e=this.Yc[t.A()];return e||(e=new th(this.Ei,this.Ti),this.Yc[t.A()]=e),e},t.prototype.Sr=function(){return this._o},t.prototype.$r=function(){return this.fo},t.prototype.Wo=function(){return this.wo},t.prototype.runTransaction=function(t,e,n){var r=this;ds("MemoryPersistence","Starting transaction:",t);var i=new sh(this.so.next());return this.Ti.Zc(),n(i).next((function(t){return r.Ti.ta(i).next((function(){return t}))})).On().then((function(t){return i.Vs(),t}))},t.prototype.ea=function(t,e){return Qu.Ln(Object.values(this.Yc).map((function(n){return function(){return n.Fi(t,e)}})))},t}(),sh=function(t){function e(e){var n=this;return(n=t.call(this)||this).bs=e,n}return at(e,t),e}(cl),oh=function(){function t(t){this.persistence=t,this.na=new Jc,this.sa=null}return t.ia=function(e){return new t(e)},Object.defineProperty(t.prototype,"ra",{get:function(){if(this.sa)return this.sa;throw ms()},enumerable:!1,configurable:!0}),t.prototype.nr=function(t,e,n){return this.na.nr(n,e),this.ra.delete(n.toString()),Qu.resolve()},t.prototype.ir=function(t,e,n){return this.na.ir(n,e),this.ra.add(n.toString()),Qu.resolve()},t.prototype.Ni=function(t,e){return this.ra.add(e.toString()),Qu.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.na.Fc(e.targetId).forEach((function(t){return n.ra.add(t.toString())}));var r=this.persistence.Sr();return r.rr(t,e.targetId).next((function(t){t.forEach((function(t){return n.ra.add(t.toString())}))})).next((function(){return r.Ji(t,e)}))},t.prototype.Zc=function(){this.sa=new Set},t.prototype.ta=function(t){var e=this,n=this.persistence.$r().Nr();return Qu.forEach(this.ra,(function(r){var i=Us._t(r);return e.oa(t,i).next((function(t){t||n.li(i)}))})).next((function(){return e.sa=null,n.apply(t)}))},t.prototype.Fr=function(t,e){var n=this;return this.oa(t,e).next((function(t){t?n.ra.delete(e.toString()):n.ra.add(e.toString())}))},t.prototype.Xc=function(t){return 0},t.prototype.oa=function(t,e){var n=this;return Qu.Ln([function(){return Qu.resolve(n.na.Fi(e))},function(){return n.persistence.Sr().Fi(t,e)},function(){return n.persistence.ea(t,e)}])},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ah(t,e){return"firestore_clients_"+t+"_"+e}function uh(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.m()&&(r+="_"+e.uid),r}function lh(t,e){return"firestore_targets_"+t+"_"+e}var ch=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.ca=function(e,n,r){var i,s=JSON.parse(r),o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(i=new Cs(s.error.code,s.error.message)),o?new t(e,n,s.state,i):(ps("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.aa=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),hh=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.ca=function(e,n){var r,i=JSON.parse(n),s="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Cs(i.error.code,i.error.message)),s?new t(e,i.state,r):(ps("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.aa=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),dh=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.ca=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,s=su(),o=0;i&&o<r.activeTargetIds.length;++o)i=eo(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new t(e,s):(ps("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),ph=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.ca=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(ps("SharedClientState","Failed to parse online state: "+e),null)},t}(),fh=function(){function t(){this.activeTargetIds=su()}return t.prototype.ua=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.ha=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.aa=function(){var t={activeTargetIds:this.activeTargetIds.it(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),gh=function(){function t(t,e,n,r,i){this.window=t,this.Zr=e,this.persistenceKey=n,this.la=r,this._a=null,this.fa=null,this.k=null,this.da=this.wa.bind(this),this.Ea=new ja(ws),this.Er=!1,this.Ta=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ia=ah(this.persistenceKey,this.la),this.ma="firestore_sequence_number_"+this.persistenceKey,this.Ea=this.Ea.zt(this.la,new fh),this.Aa=new RegExp("^firestore_clients_"+s+"_([^_]*)$"),this.Ra=new RegExp("^firestore_mutations_"+s+"_(\\d+)(?:_(.*))?$"),this.Pa=new RegExp("^firestore_targets_"+s+"_(\\d+)$"),this.ya=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.ga=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.da)}return t.Kn=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return lt(this,void 0,void 0,(function(){var t,e,n,r,i,s,o,a,u,l,c,h=this;return ct(this,(function(d){switch(d.label){case 0:return[4,this._a.Uo()];case 1:for(t=d.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.la&&(i=this.getItem(ah(this.persistenceKey,r)))&&(s=dh.ca(r,i))&&(this.Ea=this.Ea.zt(s.clientId,s));for(this.Va(),(o=this.storage.getItem(this.ya))&&(a=this.pa(o))&&this.ba(a),u=0,l=this.Ta;u<l.length;u++)c=l[u],this.wa(c);return this.Ta=[],this.window.addEventListener("unload",(function(){return h.ko()})),this.Er=!0,[2]}}))}))},t.prototype.B=function(t){this.setItem(this.ma,JSON.stringify(t))},t.prototype.va=function(){return this.Sa(this.Ea)},t.prototype.Da=function(t){var e=!1;return this.Ea.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.Ca=function(t){this.xa(t,"pending")},t.prototype.Na=function(t,e,n){this.xa(t,e,n),this.$a(t)},t.prototype.Fa=function(t){var e="not-current";if(this.Da(t)){var n=this.storage.getItem(lh(this.persistenceKey,t));if(n){var r=hh.ca(t,n);r&&(e=r.state)}}return this.Oa.ua(t),this.Va(),e},t.prototype.ka=function(t){this.Oa.ha(t),this.Va()},t.prototype.Ma=function(t){return this.Oa.activeTargetIds.has(t)},t.prototype.La=function(t){this.removeItem(lh(this.persistenceKey,t))},t.prototype.Ba=function(t,e,n){this.qa(t,e,n)},t.prototype.Ua=function(t,e,n){var r=this;e.forEach((function(t){r.$a(t)})),this.currentUser=t,n.forEach((function(t){r.Ca(t)}))},t.prototype.Qa=function(t){this.Ka(t)},t.prototype.Wa=function(){this.ja()},t.prototype.ko=function(){this.Er&&(this.window.removeEventListener("storage",this.da),this.removeItem(this.Ia),this.Er=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return ds("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){ds("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){ds("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.wa=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(ds("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ia)return void ps("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Zr.po((function(){return lt(e,void 0,void 0,(function(){var t,e,r,i,s,o;return ct(this,(function(a){if(this.Er){if(null!==n.key)if(this.Aa.test(n.key)){if(null==n.newValue)return t=this.Ga(n.key),[2,this.za(t,null)];if(e=this.Ha(n.key,n.newValue))return[2,this.za(e.clientId,e)]}else if(this.Ra.test(n.key)){if(null!==n.newValue&&(r=this.Ja(n.key,n.newValue)))return[2,this.Ya(r)]}else if(this.Pa.test(n.key)){if(null!==n.newValue&&(i=this.Xa(n.key,n.newValue)))return[2,this.Za(i)]}else if(n.key===this.ya){if(null!==n.newValue&&(s=this.pa(n.newValue)))return[2,this.ba(s)]}else if(n.key===this.ma)(o=function(t){var e=Fs.q;if(null!=t)try{var n=JSON.parse(t);ys("number"==typeof n),e=n}catch(r){ps("SharedClientState","Failed to read sequence number from WebStorage",r)}return e}(n.newValue))!==Fs.q&&this.k(o);else if(n.key===this.ga)return[2,this._a.tu()]}else this.Ta.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Oa",{get:function(){return this.Ea.get(this.la)},enumerable:!1,configurable:!0}),t.prototype.Va=function(){this.setItem(this.Ia,this.Oa.aa())},t.prototype.xa=function(t,e,n){var r=new ch(this.currentUser,t,e,n),i=uh(this.persistenceKey,this.currentUser,t);this.setItem(i,r.aa())},t.prototype.$a=function(t){var e=uh(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Ka=function(t){var e={clientId:this.la,onlineState:t};this.storage.setItem(this.ya,JSON.stringify(e))},t.prototype.qa=function(t,e,n){var r=lh(this.persistenceKey,t),i=new hh(t,e,n);this.setItem(r,i.aa())},t.prototype.ja=function(){this.setItem(this.ga,"value-not-used")},t.prototype.Ga=function(t){var e=this.Aa.exec(t);return e?e[1]:null},t.prototype.Ha=function(t,e){var n=this.Ga(t);return dh.ca(n,e)},t.prototype.Ja=function(t,e){var n=this.Ra.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ch.ca(new Es(i),r,e)},t.prototype.Xa=function(t,e){var n=this.Pa.exec(t),r=Number(n[1]);return hh.ca(r,e)},t.prototype.pa=function(t){return ph.ca(t)},t.prototype.Ya=function(t){return lt(this,void 0,void 0,(function(){return ct(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this._a.eu(t.batchId,t.state,t.error)]:(ds("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.Za=function(t){return this._a.nu(t.targetId,t.state,t.error)},t.prototype.za=function(t,e){var n=this,r=e?this.Ea.zt(t,e):this.Ea.remove(t),i=this.Sa(this.Ea),s=this.Sa(r),o=[],a=[];return s.forEach((function(t){i.has(t)||o.push(t)})),i.forEach((function(t){s.has(t)||a.push(t)})),this._a.su(o,a).then((function(){n.Ea=r}))},t.prototype.ba=function(t){this.Ea.get(t.clientId)&&this.fa(t.onlineState)},t.prototype.Sa=function(t){var e=su();return t.forEach((function(t,n){e=e.Pe(n.activeTargetIds)})),e},t}(),mh=function(){function t(){this.iu=new fh,this.ru={},this.fa=null,this.k=null}return t.prototype.Ca=function(t){},t.prototype.Na=function(t,e,n){},t.prototype.Fa=function(t){return this.iu.ua(t),this.ru[t]||"not-current"},t.prototype.Ba=function(t,e,n){this.ru[t]=e},t.prototype.ka=function(t){this.iu.ha(t)},t.prototype.Ma=function(t){return this.iu.activeTargetIds.has(t)},t.prototype.La=function(t){delete this.ru[t]},t.prototype.va=function(){return this.iu.activeTargetIds},t.prototype.Da=function(t){return this.iu.activeTargetIds.has(t)},t.prototype.start=function(){return this.iu=new fh,Promise.resolve()},t.prototype.Ua=function(t,e,n){},t.prototype.Qa=function(t){},t.prototype.ko=function(){},t.prototype.B=function(t){},t.prototype.Wa=function(){},t}(),yh=function(){function t(){}return t.prototype.ou=function(t){},t.prototype.ko=function(){},t}(),bh=function(){function t(){var t=this;this.cu=function(){return t.au()},this.uu=function(){return t.hu()},this.lu=[],this._u()}return t.prototype.ou=function(t){this.lu.push(t)},t.prototype.ko=function(){window.removeEventListener("online",this.cu),window.removeEventListener("offline",this.uu)},t.prototype._u=function(){window.addEventListener("online",this.cu),window.addEventListener("offline",this.uu)},t.prototype.au=function(){ds("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.lu;t<e.length;t++)(0,e[t])(0)},t.prototype.hu=function(){ds("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.lu;t<e.length;t++)(0,e[t])(1)},t.Kn=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),vh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},xh=function(){function t(t){this.fu=t.fu,this.du=t.du}return t.prototype.wu=function(t){this.Eu=t},t.prototype.Tu=function(t){this.Iu=t},t.prototype.onMessage=function(t){this.mu=t},t.prototype.close=function(){this.du()},t.prototype.send=function(t){this.fu(t)},t.prototype.Au=function(){this.Eu()},t.prototype.Ru=function(t){this.Iu(t)},t.prototype.Pu=function(t){this.mu(t)},t}(),wh=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.i=e.i,n}return at(e,t),e.prototype.Su=function(t,e,n,r){return new Promise((function(i,s){var o=new as;o.listenOnce(ns.COMPLETE,(function(){try{switch(o.getLastErrorCode()){case es.NO_ERROR:var e=o.getResponseJson();ds("Connection","XHR received:",JSON.stringify(e)),i(e);break;case es.TIMEOUT:ds("Connection",'RPC "'+t+'" timed out'),s(new Cs(Ts.DEADLINE_EXCEEDED,"Request time out"));break;case es.HTTP_ERROR:var n=o.getStatus();if(ds("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){var r=o.getResponseJson().error;if(r&&r.status&&r.message){var a=(u=r.status,l=u.toLowerCase().replace(/_/g,"-"),Object.values(Ts).indexOf(l)>=0?l:Ts.UNKNOWN);s(new Cs(a,r.message))}else s(new Cs(Ts.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Cs(Ts.UNAVAILABLE,"Connection failed."));break;default:ms()}}finally{ds("Connection",'RPC "'+t+'" completed.')}var u,l}));var a=JSON.stringify(r);o.send(e,"POST",a,n,15)}))},e.prototype.Cu=function(t,e){var n,r,i=[this.gu,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=new Yi,o=Jn(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.t.projectId+"/databases/"+this.t.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.i};this.vu(a.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(mt())||"object"==typeof navigator&&"ReactNative"===navigator.product||mt().indexOf("Electron/")>=0||((r=mt()).indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0)||mt().indexOf("MSAppHost/")>=0||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(a.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");ds("Connection","Creating WebChannel: "+u,a);var l=s.createWebChannel(u,a),c=!1,h=!1,d=new xh({fu:function(t){h?ds("Connection","Not sending because WebChannel is closed:",t):(c||(ds("Connection","Opening WebChannel transport."),l.open(),c=!0),ds("Connection","WebChannel sending:",t),l.send(t))},du:function(){return l.close()}}),p=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(e){setTimeout((function(){throw e}),0)}}))};return p(l,os.EventType.OPEN,(function(){h||ds("Connection","WebChannel transport opened.")})),p(l,os.EventType.CLOSE,(function(){h||(h=!0,ds("Connection","WebChannel transport closed"),d.Ru())})),p(l,os.EventType.ERROR,(function(t){h||(h=!0,fs("Connection","WebChannel transport errored:",t),d.Ru(new Cs(Ts.UNAVAILABLE,"The operation could not be completed")))})),p(l,os.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];ys(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){ds("Connection","WebChannel received error:",i);var s=i.status,o=function(t){var e=Ma[t];if(void 0!==e)return Ga(e)}(s),a=i.message;void 0===o&&(o=Ts.INTERNAL,a="Unknown error status: "+s+" with message "+i.message),h=!0,d.Ru(new Cs(o,a)),l.close()}else ds("Connection","WebChannel received:",n),d.Pu(n)}})),p(o,rs.STAT_EVENT,(function(t){t.stat===is?ds("Connection","Detected buffering proxy"):t.stat===ss&&ds("Connection","Detected no buffering proxy")})),setTimeout((function(){d.Au()}),0),d},e}(function(){function t(t){this.yu=t,this.t=t.t;var e=t.ssl?"https":"http";this.gu=e+"://"+t.host,this.Vu="projects/"+this.t.projectId+"/databases/"+this.t.database+"/documents"}return t.prototype.pu=function(t,e,n,r){var i=this.bu(t,e);ds("RestConnection","Sending: ",i,n);var s={};return this.vu(s,r),this.Su(t,i,s,n).then((function(t){return ds("RestConnection","Received: ",t),t}),(function(e){throw fs("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Du=function(t,e,n,r){return this.pu(t,e,n,r)},t.prototype.vu=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.9",t["Content-Type"]="text/plain",e)for(var n in e.g)e.g.hasOwnProperty(n)&&(t[n]=e.g[n])},t.prototype.bu=function(t,e){var n=vh[t];return this.gu+"/v1/"+e+":"+n},t}());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kh(){return"undefined"!=typeof window?window:null}function Ih(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sh(t){return new xu(t,!0)}var Th=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Zr=t,this.fs=e,this.xu=n,this.Nu=r,this.$u=i,this.Fu=0,this.Ou=null,this.ku=Date.now(),this.reset()}return t.prototype.reset=function(){this.Fu=0},t.prototype.Mu=function(){this.Fu=this.$u},t.prototype.Lu=function(t){var e=this;this.cancel();var n=Math.floor(this.Fu+this.Bu()),r=Math.max(0,Date.now()-this.ku),i=Math.max(0,n-r);i>0&&ds("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Fu+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ou=this.Zr.Tr(this.fs,i,(function(){return e.ku=Date.now(),t()})),this.Fu*=this.Nu,this.Fu<this.xu&&(this.Fu=this.xu),this.Fu>this.$u&&(this.Fu=this.$u)},t.prototype.qu=function(){null!==this.Ou&&(this.Ou.Rs(),this.Ou=null)},t.prototype.cancel=function(){null!==this.Ou&&(this.Ou.cancel(),this.Ou=null)},t.prototype.Bu=function(){return(Math.random()-.5)*this.Fu},t}(),Ch=function(){function t(t,e,n,r,i,s){this.Zr=t,this.Uu=n,this.Qu=r,this.Ku=i,this.listener=s,this.state=0,this.Wu=0,this.ju=null,this.stream=null,this.Gu=new Th(t,e)}return t.prototype.zu=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.Hu=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.Ju()},t.prototype.stop=function(){return lt(this,void 0,void 0,(function(){return ct(this,(function(t){switch(t.label){case 0:return this.zu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.Yu=function(){this.state=0,this.Gu.reset()},t.prototype.Xu=function(){var t=this;this.Hu()&&null===this.ju&&(this.ju=this.Zr.Tr(this.Uu,6e4,(function(){return t.Zu()})))},t.prototype.th=function(t){this.eh(),this.stream.send(t)},t.prototype.Zu=function(){return lt(this,void 0,void 0,(function(){return ct(this,(function(t){return this.Hu()?[2,this.close(0)]:[2]}))}))},t.prototype.eh=function(){this.ju&&(this.ju.cancel(),this.ju=null)},t.prototype.close=function(t,e){return lt(this,void 0,void 0,(function(){return ct(this,(function(n){switch(n.label){case 0:return this.eh(),this.Gu.cancel(),this.Wu++,3!==t?this.Gu.reset():e&&e.code===Ts.RESOURCE_EXHAUSTED?(ps(e.toString()),ps("Using maximum backoff delay to prevent overloading the backend."),this.Gu.Mu()):e&&e.code===Ts.UNAUTHENTICATED&&this.Ku.p(),null!==this.stream&&(this.nh(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Tu(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.nh=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.sh(this.Wu),n=this.Wu;this.Ku.getToken().then((function(e){t.Wu===n&&t.ih(e)}),(function(n){e((function(){var e=new Cs(Ts.UNKNOWN,"Fetching auth token failed: "+n.message);return t.rh(e)}))}))},t.prototype.ih=function(t){var e=this,n=this.sh(this.Wu);this.stream=this.oh(t),this.stream.wu((function(){n((function(){return e.state=2,e.listener.wu()}))})),this.stream.Tu((function(t){n((function(){return e.rh(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.Ju=function(){var t=this;this.state=4,this.Gu.Lu((function(){return lt(t,void 0,void 0,(function(){return ct(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.rh=function(t){return ds("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.sh=function(t){var e=this;return function(n){e.Zr.Ps((function(){return e.Wu===t?n():(ds("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Nh=function(t){function e(e,n,r,i,s){var o=this;return(o=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,s)||this).Qt=i,o}return at(e,t),e.prototype.oh=function(t){return this.Qu.Cu("Listen",t)},e.prototype.onMessage=function(t){this.Gu.reset();var e=function(t,e){var n,r;if("targetChange"in e){e.targetChange;var i="NO_CHANGE"===(r=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:ms(),s=e.targetChange.targetIds||[],o=function(t,e){return t.Bt?(ys(void 0===e||"string"==typeof e),Ss.fromBase64String(e||"")):(ys(void 0===e||e instanceof Uint8Array),Ss.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=(u=e.targetChange.cause)&&function(t){var e=void 0===t.code?Ts.UNKNOWN:Ga(t.code);return new Cs(e,t.message||"")}(u);n=new pu(i,s,o,a||null)}else if("documentChange"in e){e.documentChange,(i=e.documentChange).document,i.document.name,i.document.updateTime,s=Eu(t,i.document.name),o=Su(i.document.updateTime);var u=new mo({mapValue:{fields:i.document.fields}}),l=(a=new xo(s,o,u,{}),i.targetIds||[]),c=i.removedTargetIds||[];n=new hu(l,c,a.key,a)}else if("documentDelete"in e)e.documentDelete,(i=e.documentDelete).document,s=Eu(t,i.document),o=i.readTime?Su(i.readTime):Ls.min(),u=new wo(s,o),a=i.removedTargetIds||[],n=new hu([],a,u.key,u);else if("documentRemove"in e)e.documentRemove,(i=e.documentRemove).document,s=Eu(t,i.document),o=i.removedTargetIds||[],n=new hu([],o,s,null);else{if(!("filter"in e))return ms();e.filter;var h=e.filter;h.targetId,i=h.count||0,s=new Va(i),o=h.targetId,n=new du(o,s)}return n}(this.Qt,t),n=function(t){if(!("targetChange"in t))return Ls.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ls.min():e.readTime?Su(e.readTime):Ls.min()}(t);return this.listener.ah(e,n)},e.prototype.uh=function(t){var e,n,r,i,s={};s.database=_u(this.Qt),s.addTarget=(e=this.Qt,i=(n=t).target,(r=No(i)?{documents:Lu(e,i)}:{query:Pu(e,i)}).targetId=n.targetId,n.resumeToken.l()>0?r.resumeToken=ku(e,n.resumeToken):n.Ot._(Ls.min())>0&&(r.readTime=wu(e,n.Ot.j())),r);var o=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ms()}}(0,e.Ft);return null==n?null:{"goog-listen-tags":n}}(this.Qt,t);o&&(s.labels=o),this.th(s)},e.prototype.hh=function(t){var e={};e.database=_u(this.Qt),e.removeTarget=t,this.th(e)},e}(Ch),Eh=function(t){function e(e,n,r,i,s){var o=this;return(o=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,s)||this).Qt=i,o.lh=!1,o}return at(e,t),Object.defineProperty(e.prototype,"_h",{get:function(){return this.lh},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.lh=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.nh=function(){this.lh&&this.fh([])},e.prototype.oh=function(t){return this.Qu.Cu("Write",t)},e.prototype.onMessage=function(t){if(ys(!!t.streamToken),this.lastStreamToken=t.streamToken,this.lh){this.Gu.reset();var e=(r=t.writeResults,i=t.commitTime,r&&r.length>0?(ys(void 0!==i),r.map((function(t){return function(t,e){var n=t.updateTime?Su(t.updateTime):Su(e);n.isEqual(Ls.min())&&(n=Su(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Ia(n,r)}(t,i)}))):[]),n=Su(t.commitTime);return this.listener.dh(n,e)}var r,i;return ys(!t.writeResults||0===t.writeResults.length),this.lh=!0,this.listener.wh()},e.prototype.Eh=function(){var t={};t.database=_u(this.Qt),this.th(t)},e.prototype.fh=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Fu(e.Qt,t)}))};this.th(n)},e}(Ch),Rh=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Qu=n,i.Qt=r,i.Th=!1,i}return at(e,t),e.prototype.Ih=function(){if(this.Th)throw new Cs(Ts.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.pu=function(t,e,n){var r=this;return this.Ih(),this.credentials.getToken().then((function(i){return r.Qu.pu(t,e,n,i)})).catch((function(t){throw t.code===Ts.UNAUTHENTICATED&&r.credentials.p(),t}))},e.prototype.Du=function(t,e,n){var r=this;return this.Ih(),this.credentials.getToken().then((function(i){return r.Qu.Du(t,e,n,i)})).catch((function(t){throw t.code===Ts.UNAUTHENTICATED&&r.credentials.p(),t}))},e.prototype.terminate=function(){this.Th=!1},e}((function(){})),$h=function(){function t(t,e){this._s=t,this.fa=e,this.state="Unknown",this.mh=0,this.Ah=null,this.Rh=!0}return t.prototype.Ph=function(){var t=this;0===this.mh&&(this.yh("Unknown"),this.Ah=this._s.Tr("online_state_timeout",1e4,(function(){return t.Ah=null,t.gh("Backend didn't respond within 10 seconds."),t.yh("Offline"),Promise.resolve()})))},t.prototype.Vh=function(t){"Online"===this.state?this.yh("Unknown"):(this.mh++,this.mh>=1&&(this.ph(),this.gh("Connection failed 1 times. Most recent error: "+t.toString()),this.yh("Offline")))},t.prototype.set=function(t){this.ph(),this.mh=0,"Online"===t&&(this.Rh=!1),this.yh(t)},t.prototype.yh=function(t){t!==this.state&&(this.state=t,this.fa(t))},t.prototype.gh=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Rh?(ps(e),this.Rh=!1):ds("OnlineStateTracker",e)},t.prototype.ph=function(){null!==this.Ah&&(this.Ah.cancel(),this.Ah=null)},t}(),_h=function(t,e,n,r,i){var s=this;this.bh=t,this.Sh=e,this._s=n,this.Dh={},this.Ch=[],this.xh=new Map,this.Nh=new Set,this.$h=[],this.Fh=i,this.Fh.ou((function(t){n.Ps((function(){return lt(s,void 0,void 0,(function(){return ct(this,(function(t){switch(t.label){case 0:return Bh(this)?(ds("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return lt(this,void 0,void 0,(function(){var e;return ct(this,(function(n){switch(n.label){case 0:return(e=bs(t)).Nh.add(4),[4,Dh(e)];case 1:return n.sent(),e.Oh.set("Unknown"),e.Nh.delete(4),[4,Ah(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Oh=new $h(n,r)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ah(t){return lt(this,void 0,void 0,(function(){var e,n;return ct(this,(function(r){switch(r.label){case 0:if(!Bh(t))return[3,4];e=0,n=t.$h,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Dh(t){return lt(this,void 0,void 0,(function(){var e,n;return ct(this,(function(r){switch(r.label){case 0:e=0,n=t.$h,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Fh(t,e){var n=bs(t);n.xh.has(e.targetId)||(n.xh.set(e.targetId,e),zh(n)?Mh(n):ed(n).Hu()&&Lh(n,e))}function Oh(t,e){var n=bs(t),r=ed(n);n.xh.delete(e),r.Hu()&&Ph(n,e),0===n.xh.size&&(r.Hu()?r.Xu():Bh(n)&&n.Oh.set("Unknown"))}function Lh(t,e){t.kh.on(e.targetId),ed(t).uh(e)}function Ph(t,e){t.kh.on(e),ed(t).hh(e)}function Mh(t){t.kh=new gu({vn:function(e){return t.Dh.vn(e)},Sn:function(e){return t.xh.get(e)||null}}),ed(t).start(),t.Oh.Ph()}function zh(t){return Bh(t)&&!ed(t).zu()&&t.xh.size>0}function Bh(t){return 0===bs(t).Nh.size}function Uh(t){t.kh=void 0}function Vh(t){return lt(this,void 0,void 0,(function(){return ct(this,(function(e){return t.xh.forEach((function(e,n){Lh(t,e)})),[2]}))}))}function Wh(t,e){return lt(this,void 0,void 0,(function(){return ct(this,(function(n){return Uh(t),zh(t)?(t.Oh.Vh(e),Mh(t)):t.Oh.set("Unknown"),[2]}))}))}function Gh(t,e,n){return lt(this,void 0,void 0,(function(){var r,i,s;return ct(this,(function(o){switch(o.label){case 0:if(t.Oh.set("Online"),!(e instanceof pu&&2===e.state&&e.cause))return[3,6];o.label=1;case 1:return o.trys.push([1,3,,5]),[4,function(t,e){return lt(this,void 0,void 0,(function(){var n,r,i,s;return ct(this,(function(o){switch(o.label){case 0:n=e.cause,r=0,i=e.targetIds,o.label=1;case 1:return r<i.length?(s=i[r],t.xh.has(s)?[4,t.Dh.Mh(s,n)]:[3,3]):[3,5];case 2:o.sent(),t.xh.delete(s),t.kh.removeTarget(s),o.label=3;case 3:o.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return o.sent(),[3,5];case 3:return r=o.sent(),ds("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,jh(t,r)];case 4:return o.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof hu?t.kh.dn(e):e instanceof du?t.kh.Pn(e):t.kh.Tn(e),n.isEqual(Ls.min()))return[3,13];o.label=7;case 7:return o.trys.push([7,11,,13]),[4,Vc(t.bh)];case 8:return i=o.sent(),n._(i)>=0?[4,(a=t,u=n,l=a.kh.Vn(u),l.$e.forEach((function(t,e){if(t.resumeToken.l()>0){var n=a.xh.get(e);n&&a.xh.set(e,n.Mt(t.resumeToken,u))}})),l.Fe.forEach((function(t){var e=a.xh.get(t);if(e){a.xh.set(t,e.Mt(Ss.T,e.Ot)),Ph(a,t);var n=new oa(e.target,t,1,e.sequenceNumber);Lh(a,n)}})),a.Dh.Lh(l))]:[3,10];case 9:o.sent(),o.label=10;case 10:return[3,13];case 11:return ds("RemoteStore","Failed to raise snapshot:",s=o.sent()),[4,jh(t,s)];case 12:return o.sent(),[3,13];case 13:return[2]}var a,u,l}))}))}function jh(t,e,n){return lt(this,void 0,void 0,(function(){var r=this;return ct(this,(function(i){switch(i.label){case 0:if(!nl(e))throw e;return t.Nh.add(1),[4,Dh(t)];case 1:return i.sent(),t.Oh.set("Offline"),n||(n=function(){return Vc(t.bh)}),t._s.po((function(){return lt(r,void 0,void 0,(function(){return ct(this,(function(e){switch(e.label){case 0:return ds("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Nh.delete(1),[4,Ah(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Hh(t,e){return e().catch((function(n){return jh(t,n,e)}))}function qh(t){return lt(this,void 0,void 0,(function(){var e,n,r,i,s;return ct(this,(function(o){switch(o.label){case 0:e=bs(t),n=nd(e),r=e.Ch.length>0?e.Ch[e.Ch.length-1].batchId:-1,o.label=1;case 1:if(!(Bh(a=e)&&a.Ch.length<10))return[3,7];o.label=2;case 2:return o.trys.push([2,4,,6]),[4,Gc(e.bh,r)];case 3:return null===(i=o.sent())?(0===e.Ch.length&&n.Xu(),[3,7]):(r=i.batchId,function(t,e){t.Ch.push(e);var n=nd(t);n.Hu()&&n._h&&n.fh(e.mutations)}(e,i),[3,6]);case 4:return s=o.sent(),[4,jh(e,s)];case 5:return o.sent(),[3,6];case 6:return[3,1];case 7:return Kh(e)&&Xh(e),[2]}var a}))}))}function Kh(t){return Bh(t)&&!nd(t).zu()&&t.Ch.length>0}function Xh(t){nd(t).start()}function Yh(t){return lt(this,void 0,void 0,(function(){return ct(this,(function(e){return nd(t).Eh(),[2]}))}))}function Qh(t){return lt(this,void 0,void 0,(function(){var e,n,r,i;return ct(this,(function(s){for(e=nd(t),n=0,r=t.Ch;n<r.length;n++)i=r[n],e.fh(i.mutations);return[2]}))}))}function Jh(t,e,n){return lt(this,void 0,void 0,(function(){var r,i;return ct(this,(function(s){switch(s.label){case 0:return r=t.Ch.shift(),i=Ol.from(r,e,n),[4,Hh(t,(function(){return t.Dh.Bh(i)}))];case 1:return s.sent(),[4,qh(t)];case 2:return s.sent(),[2]}}))}))}function Zh(t,e){return lt(this,void 0,void 0,(function(){return ct(this,(function(n){switch(n.label){case 0:return e&&nd(t)._h?[4,function(t,e){return lt(this,void 0,void 0,(function(){var n,r;return ct(this,(function(i){switch(i.label){case 0:return Wa(r=e.code)&&r!==Ts.ABORTED?(n=t.Ch.shift(),nd(t).Yu(),[4,Hh(t,(function(){return t.Dh.qh(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,qh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Kh(t)&&Xh(t),[2]}}))}))}function td(t,e){return lt(this,void 0,void 0,(function(){var n;return ct(this,(function(r){switch(r.label){case 0:return n=bs(t),e?(n.Nh.delete(2),[4,Ah(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Nh.add(2),[4,Dh(n)]);case 3:r.sent(),n.Oh.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function ed(t){var e,n,r,i,s=this;return t.Uh||(t.Uh=(e=t.Sh,n=t._s,r={wu:Vh.bind(null,t),Tu:Wh.bind(null,t),ah:Gh.bind(null,t)},(i=bs(e)).Ih(),new Nh(n,i.Qu,i.credentials,i.Qt,r)),t.$h.push((function(e){return lt(s,void 0,void 0,(function(){return ct(this,(function(n){switch(n.label){case 0:return e?(t.Uh.Yu(),zh(t)?Mh(t):t.Oh.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Uh.stop()];case 2:n.sent(),Uh(t),n.label=3;case 3:return[2]}}))}))}))),t.Uh}function nd(t){var e,n,r,i,s=this;return t.Qh||(t.Qh=(e=t.Sh,n=t._s,r={wu:Yh.bind(null,t),Tu:Zh.bind(null,t),wh:Qh.bind(null,t),dh:Jh.bind(null,t)},(i=bs(e)).Ih(),new Eh(n,i.Qu,i.credentials,i.Qt,r)),t.$h.push((function(e){return lt(s,void 0,void 0,(function(){return ct(this,(function(n){switch(n.label){case 0:return e?(t.Qh.Yu(),[4,qh(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Qh.stop()];case 3:n.sent(),t.Ch.length>0&&(ds("RemoteStore","Stopping write stream with "+t.Ch.length+" pending writes"),t.Ch=[]),n.label=4;case 4:return[2]}}))}))}))),t.Qh}var rd=function(){this.Kh=void 0,this.listeners=[]},id=function(){this.queries=new rc((function(t){return ea(t)}),ta),this.onlineState="Unknown",this.Wh=new Set};function sd(t,e){return lt(this,void 0,void 0,(function(){var n,r,i,s,o,a,u;return ct(this,(function(l){switch(l.label){case 0:if(n=bs(t),r=e.query,i=!1,(s=n.queries.get(r))||(i=!0,s=new rd),!i)return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),o=s,[4,n.jh(r)];case 2:return o.Kh=l.sent(),[3,4];case 3:return a=l.sent(),u=ul(a,"Initialization of query '"+na(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,s),s.listeners.push(e),e.Gh(n.onlineState),s.Kh&&e.zh(s.Kh)&&ld(n),[2]}}))}))}function od(t,e){return lt(this,void 0,void 0,(function(){var n,r,i,s,o;return ct(this,(function(a){return n=bs(t),r=e.query,i=!1,(s=n.queries.get(r))&&(o=s.listeners.indexOf(e))>=0&&(s.listeners.splice(o,1),i=0===s.listeners.length),i?[2,(n.queries.delete(r),n.Hh(r))]:[2]}))}))}function ad(t,e){for(var n=bs(t),r=!1,i=0,s=e;i<s.length;i++){var o=s[i],a=o.query,u=n.queries.get(a);if(u){for(var l=0,c=u.listeners;l<c.length;l++)c[l].zh(o)&&(r=!0);u.Kh=o}}r&&ld(n)}function ud(t,e,n){var r=bs(t),i=r.queries.get(e);if(i)for(var s=0,o=i.listeners;s<o.length;s++)o[s].onError(n);r.queries.delete(e)}function ld(t){t.Wh.forEach((function(t){t.next()}))}var cd=function(){function t(t,e,n){this.query=t,this.Jh=e,this.Yh=!1,this.Xh=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.zh=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new uu(t.query,t.docs,t.Se,e,t.De,t.fromCache,t.Ce,!0)}var s=!1;return this.Yh?this.Zh(t)&&(this.Jh.next(t),s=!0):this.tl(t,this.onlineState)&&(this.el(t),s=!0),this.Xh=t,s},t.prototype.onError=function(t){this.Jh.error(t)},t.prototype.Gh=function(t){this.onlineState=t;var e=!1;return this.Xh&&!this.Yh&&this.tl(this.Xh,t)&&(this.el(this.Xh),e=!0),e},t.prototype.tl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.nl&&n||t.docs.et()&&"Offline"!==e)},t.prototype.Zh=function(t){if(t.docChanges.length>0)return!0;var e=this.Xh&&this.Xh.hasPendingWrites!==t.hasPendingWrites;return!(!t.Ce&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.el=function(t){t=uu.Ne(t.query,t.docs,t.De,t.fromCache),this.Yh=!0,this.Jh.next(t)},t}(),hd=function(t){this.key=t},dd=function(t){this.key=t},pd=function(){function t(t,e){this.query=t,this.cl=e,this.al=null,this.Be=!1,this.ul=ru(),this.De=ru(),this.hl=ia(t),this.ll=new ou(this.hl)}return Object.defineProperty(t.prototype,"_l",{get:function(){return this.cl},enumerable:!1,configurable:!0}),t.prototype.fl=function(t,e){var n=this,r=e?e.dl:new au,i=e?e.ll:this.ll,s=e?e.De:this.De,o=i,a=!1,u=Ho(this.query)&&i.size===this.query.limit?i.last():null,l=qo(this.query)&&i.size===this.query.limit?i.first():null;if(t.Xt((function(t,e){var c=i.get(t),h=e instanceof xo?e:null;h&&(h=ra(n.query,h)?h:null);var d=!!c&&n.De.has(c.key),p=!!h&&(h.Vt||n.De.has(h.key)&&h.hasCommittedMutations),f=!1;c&&h?c.data().isEqual(h.data())?d!==p&&(r.track({type:3,doc:h}),f=!0):n.wl(c,h)||(r.track({type:2,doc:h}),f=!0,(u&&n.hl(h,u)>0||l&&n.hl(h,l)<0)&&(a=!0)):!c&&h?(r.track({type:0,doc:h}),f=!0):c&&!h&&(r.track({type:1,doc:c}),f=!0,(u||l)&&(a=!0)),f&&(h?(o=o.add(h),s=p?s.add(t):s.delete(t)):(o=o.delete(t),s=s.delete(t)))})),Ho(this.query)||qo(this.query))for(;o.size>this.query.limit;){var c=Ho(this.query)?o.last():o.first();o=o.delete(c.key),s=s.delete(c.key),r.track({type:1,doc:c})}return{ll:o,dl:r,lc:a,De:s}},t.prototype.wl=function(t,e){return t.Vt&&e.hasCommittedMutations&&!e.Vt},t.prototype.wi=function(t,e,n){var r=this,i=this.ll;this.ll=t.ll,this.De=t.De;var s=t.dl.ve();s.sort((function(t,e){return n=t.type,i=e.type,(s=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ms()}})(n)-s(i)||r.hl(t.doc,e.doc);var n,i,s})),this.El(n);var o=e?this.Tl():[],a=0===this.ul.size&&this.Be?1:0,u=a!==this.al;return this.al=a,0!==s.length||u?{snapshot:new uu(this.query,t.ll,i,s,t.De,0===a,u,!1),Il:o}:{Il:o}},t.prototype.Gh=function(t){return this.Be&&"Offline"===t?(this.Be=!1,this.wi({ll:this.ll,dl:new au,De:this.De,lc:!1},!1)):{Il:[]}},t.prototype.ml=function(t){return!this.cl.has(t)&&!!this.ll.has(t)&&!this.ll.get(t).Vt},t.prototype.El=function(t){var e=this;t&&(t.qe.forEach((function(t){return e.cl=e.cl.add(t)})),t.Ue.forEach((function(t){})),t.Qe.forEach((function(t){return e.cl=e.cl.delete(t)})),this.Be=t.Be)},t.prototype.Tl=function(){var t=this;if(!this.Be)return[];var e=this.ul;this.ul=ru(),this.ll.forEach((function(e){t.ml(e.key)&&(t.ul=t.ul.add(e.key))}));var n=[];return e.forEach((function(e){t.ul.has(e)||n.push(new dd(e))})),this.ul.forEach((function(t){e.has(t)||n.push(new hd(t))})),n},t.prototype.Al=function(t){this.cl=t.Rc,this.ul=ru();var e=this.fl(t.documents);return this.wi(e,!0)},t.prototype.Rl=function(){return uu.Ne(this.query,this.ll,this.De,0===this.al)},t}(),fd=function(t,e,n){this.query=t,this.targetId=e,this.view=n},gd=function(t){this.key=t,this.Pl=!1},md=function(){function t(t,e,n,r,i,s){this.bh=t,this.yl=e,this.gl=n,this.Vl=r,this.currentUser=i,this.pl=s,this.bl={},this.vl=new rc((function(t){return ea(t)}),ta),this.Sl=new Map,this.Dl=new Set,this.Cl=new ja(Us.H),this.xl=new Map,this.Nl=new Jc,this.$l={},this.Fl=new Map,this.Ol=dc.Li(),this.onlineState="Unknown",this.kl=void 0}return Object.defineProperty(t.prototype,"Ml",{get:function(){return!0===this.kl},enumerable:!1,configurable:!0}),t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yd(t,e){return lt(this,void 0,void 0,(function(){var n,r,i,s,o,a;return ct(this,(function(u){switch(u.label){case 0:return n=Hd(t),(s=n.vl.get(e))?(r=s.targetId,n.Vl.Fa(r),i=s.view.Rl(),[3,4]):[3,1];case 1:return[4,jc(n.bh,Jo(e))];case 2:return o=u.sent(),a=n.Vl.Fa(o.targetId),r=o.targetId,[4,bd(n,e,r,"current"===a)];case 3:i=u.sent(),n.Ml&&Fh(n.yl,o),u.label=4;case 4:return[2,i]}}))}))}function bd(t,e,n,r){return lt(this,void 0,void 0,(function(){var i,s,o,a,u,l;return ct(this,(function(c){switch(c.label){case 0:return t.Ll=function(e,n,r){return function(t,e,n,r){return lt(this,void 0,void 0,(function(){var i,s,o;return ct(this,(function(a){switch(a.label){case 0:return(i=e.view.fl(n)).lc?[4,qc(t.bh,e.query,!1).then((function(t){var n=t.documents;return e.view.fl(n,i)}))]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return s=r&&r.$e.get(e.targetId),o=e.view.wi(i,t.Ml,s),[2,(_d(t,e.targetId,o.Il),o.snapshot)]}}))}))}(t,e,n,r)},[4,qc(t.bh,e,!0)];case 1:return i=c.sent(),s=new pd(e,i.Rc),o=s.fl(i.documents),a=cu.Le(n,r&&"Offline"!==t.onlineState),u=s.wi(o,t.Ml,a),_d(t,n,u.Il),l=new fd(e,n,s),[2,(t.vl.set(e,l),t.Sl.has(n)?t.Sl.get(n).push(e):t.Sl.set(n,[e]),u.snapshot)]}}))}))}function vd(t,e){return lt(this,void 0,void 0,(function(){var n,r,i;return ct(this,(function(s){switch(s.label){case 0:return n=bs(t),r=n.vl.get(e),(i=n.Sl.get(r.targetId)).length>1?[2,(n.Sl.set(r.targetId,i.filter((function(t){return!ta(t,e)}))),void n.vl.delete(e))]:n.Ml?(n.Vl.ka(r.targetId),n.Vl.Da(r.targetId)?[3,2]:[4,Hc(n.bh,r.targetId,!1).then((function(){n.Vl.La(r.targetId),Oh(n.yl,r.targetId),Rd(n,r.targetId)})).catch(nc)]):[3,3];case 1:s.sent(),s.label=2;case 2:return[3,5];case 3:return Rd(n,r.targetId),[4,Hc(n.bh,r.targetId,!0)];case 4:s.sent(),s.label=5;case 5:return[2]}}))}))}function xd(t,e,n){return lt(this,void 0,void 0,(function(){var r,i,s,o;return ct(this,(function(a){switch(a.label){case 0:r=qd(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,(u=r.bh,l=e,h=bs(u),d=Os.now(),p=l.reduce((function(t,e){return t.add(e.key)}),ru()),h.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return h.Tc.Xo(t,p).next((function(e){c=e;for(var n=[],r=0,i=l;r<i.length;r++){var s=i[r],o=Ra(s,c.get(s.key));null!=o&&n.push(new Da(s.key,o,bo(o.proto.mapValue),Sa.exists(!0)))}return h.zo.Ri(t,d,n,l)}))})).then((function(t){var e=t.xs(c);return{batchId:t.batchId,ri:e}})))];case 2:return i=a.sent(),r.Vl.Ca(i.batchId),function(t,e,n){var r=t.$l[t.currentUser.A()];r||(r=new ja(ws)),r=r.zt(e,n),t.$l[t.currentUser.A()]=r}(r,i.batchId,n),[4,Fd(r,i.ri)];case 3:return a.sent(),[4,qh(r.yl)];case 4:return a.sent(),[3,6];case 5:return s=a.sent(),o=ul(s,"Failed to persist write"),n.reject(o),[3,6];case 6:return[2]}var u,l,c,h,d,p}))}))}function wd(t,e){return lt(this,void 0,void 0,(function(){var n,r;return ct(this,(function(i){switch(i.label){case 0:n=bs(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Wc(n.bh,e)];case 2:return r=i.sent(),e.$e.forEach((function(t,e){var r=n.xl.get(e);r&&(ys(t.qe.size+t.Ue.size+t.Qe.size<=1),t.qe.size>0?r.Pl=!0:t.Ue.size>0?ys(r.Pl):t.Qe.size>0&&(ys(r.Pl),r.Pl=!1))})),[4,Fd(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,nc(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function kd(t,e,n){var r=bs(t);if(r.Ml&&0===n||!r.Ml&&1===n){var i=[];r.vl.forEach((function(t,n){var r=n.view.Gh(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=bs(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,s=n.listeners;i<s.length;i++)s[i].Gh(e)&&(r=!0)})),r&&ld(n)}(r.gl,e),i.length&&r.bl.ah(i),r.onlineState=e,r.Ml&&r.Vl.Qa(e)}}function Id(t,e,n){return lt(this,void 0,void 0,(function(){var r,i,s,o,a,u;return ct(this,(function(l){switch(l.label){case 0:return(r=bs(t)).Vl.Ba(e,"rejected",n),i=r.xl.get(e),(s=i&&i.key)?(o=(o=new ja(Us.H)).zt(s,new wo(s,Ls.min())),a=ru().add(s),u=new lu(Ls.min(),new Map,new Ka(ws),o,a),[4,wd(r,u)]):[3,2];case 1:return l.sent(),r.Cl=r.Cl.remove(s),r.xl.delete(e),Dd(r),[3,4];case 2:return[4,Hc(r.bh,e,!1).then((function(){return Rd(r,e,n)})).catch(nc)];case 3:l.sent(),l.label=4;case 4:return[2]}}))}))}function Sd(t,e){return lt(this,void 0,void 0,(function(){var n,r,i;return ct(this,(function(s){switch(s.label){case 0:n=bs(t),r=e.batch.batchId,s.label=1;case 1:return s.trys.push([1,4,,6]),[4,Uc(n.bh,e)];case 2:return i=s.sent(),Ed(n,r,null),Nd(n,r),n.Vl.Na(r,"acknowledged"),[4,Fd(n,i)];case 3:return s.sent(),[3,6];case 4:return[4,nc(s.sent())];case 5:return s.sent(),[3,6];case 6:return[2]}}))}))}function Td(t,e,n){return lt(this,void 0,void 0,(function(){var r,i;return ct(this,(function(s){switch(s.label){case 0:r=bs(t),s.label=1;case 1:return s.trys.push([1,4,,6]),[4,(o=r.bh,a=e,u=bs(o),u.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var e;return u.zo.Pi(t,a).next((function(n){return ys(null!==n),e=n.keys(),u.zo.Ci(t,n)})).next((function(){return u.zo.$i(t)})).next((function(){return u.Tc.Xo(t,e)}))})))];case 2:return i=s.sent(),Ed(r,e,n),Nd(r,e),r.Vl.Na(e,"rejected",n),[4,Fd(r,i)];case 3:return s.sent(),[3,6];case 4:return[4,nc(s.sent())];case 5:return s.sent(),[3,6];case 6:return[2]}var o,a,u}))}))}function Cd(t,e){return lt(this,void 0,void 0,(function(){var n,r,i,s,o;return ct(this,(function(a){switch(a.label){case 0:Bh((n=bs(t)).yl)||ds("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(u=n.bh,l=bs(u),l.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return l.zo.Vi(t)})))];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fl.get(r)||[]).push(e),n.Fl.set(r,i),[3,4]);case 3:return s=a.sent(),o=ul(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(o),[3,4];case 4:return[2]}var u,l}))}))}function Nd(t,e){(t.Fl.get(e)||[]).forEach((function(t){t.resolve()})),t.Fl.delete(e)}function Ed(t,e,n){var r=bs(t),i=r.$l[r.currentUser.A()];if(i){var s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.$l[r.currentUser.A()]=i}}function Rd(t,e,n){void 0===n&&(n=null),t.Vl.ka(e);for(var r=0,i=t.Sl.get(e);r<i.length;r++){var s=i[r];t.vl.delete(s),n&&t.bl.Bl(s,n)}t.Sl.delete(e),t.Ml&&t.Nl.Fc(e).forEach((function(e){t.Nl.Fi(e)||$d(t,e)}))}function $d(t,e){t.Dl.delete(e.path.rt());var n=t.Cl.get(e);null!==n&&(Oh(t.yl,n),t.Cl=t.Cl.remove(e),t.xl.delete(n),Dd(t))}function _d(t,e,n){for(var r=0,i=n;r<i.length;r++){var s=i[r];s instanceof hd?(t.Nl.nr(s.key,e),Ad(t,s)):s instanceof dd?(ds("SyncEngine","Document no longer in limbo: "+s.key),t.Nl.ir(s.key,e),t.Nl.Fi(s.key)||$d(t,s.key)):ms()}}function Ad(t,e){var n=e.key,r=n.path.rt();t.Cl.get(n)||t.Dl.has(r)||(ds("SyncEngine","New document in limbo: "+n),t.Dl.add(r),Dd(t))}function Dd(t){for(;t.Dl.size>0&&t.Cl.size<t.pl;){var e=t.Dl.values().next().value;t.Dl.delete(e);var n=new Us(Ms.ot(e)),r=t.Ol.next();t.xl.set(r,new gd(n)),t.Cl=t.Cl.zt(n,r),Fh(t.yl,new oa(Jo(jo(n.path)),r,2,Fs.q))}}function Fd(t,e,n){return lt(this,void 0,void 0,(function(){var r,i,s,o;return ct(this,(function(a){switch(a.label){case 0:return r=bs(t),i=[],s=[],o=[],r.vl.et()?[3,3]:(r.vl.forEach((function(t,a){o.push(r.Ll(a,e,n).then((function(t){if(t){r.Ml&&r.Vl.Ba(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Lc.oc(a.targetId,t);s.push(e)}})))})),[4,Promise.all(o)]);case 1:return a.sent(),r.bl.ah(i),[4,function(t,e){return lt(this,void 0,void 0,(function(){var n,r,i,s,o,a,u,l,c;return ct(this,(function(h){switch(h.label){case 0:n=bs(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Qu.forEach(e,(function(e){return Qu.forEach(e.ic,(function(r){return n.persistence.Ti.nr(t,e.targetId,r)})).next((function(){return Qu.forEach(e.rc,(function(r){return n.persistence.Ti.ir(t,e.targetId,r)}))}))}))}))];case 2:return h.sent(),[3,4];case 3:if(!nl(r=h.sent()))throw r;return ds("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,s=e;i<s.length;i++)o=s[i],a=o.targetId,o.fromCache||(u=n.fc.get(a),l=u.Ot,c=u.Lt(l),n.fc=n.fc.zt(a,c));return[2]}}))}))}(r.bh,s)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function Od(t,e){return lt(this,void 0,void 0,(function(){var n,r;return ct(this,(function(i){switch(i.label){case 0:return(n=bs(t)).currentUser.isEqual(e)?[3,3]:(ds("SyncEngine","User change. New user:",e.A()),[4,Bc(n.bh,e)]);case 1:return r=i.sent(),n.currentUser=e,(s=n).Fl.forEach((function(t){t.forEach((function(t){t.reject(new Cs(Ts.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),s.Fl.clear(),n.Vl.Ua(e,r.mc,r.Ac),[4,Fd(n,r.Ic)];case 2:i.sent(),i.label=3;case 3:return[2]}var s}))}))}function Ld(t,e){var n=bs(t),r=n.xl.get(e);if(r&&r.Pl)return ru().add(r.key);var i=ru(),s=n.Sl.get(e);if(!s)return i;for(var o=0,a=s;o<a.length;o++){var u=a[o],l=n.vl.get(u);i=i.Pe(l.view._l)}return i}function Pd(t,e){return lt(this,void 0,void 0,(function(){var n,r,i;return ct(this,(function(s){switch(s.label){case 0:return[4,qc((n=bs(t)).bh,e.query,!0)];case 1:return r=s.sent(),i=e.view.Al(r),[2,(n.Ml&&_d(n,e.targetId,i.Il),i)]}}))}))}function Md(t){return lt(this,void 0,void 0,(function(){var e;return ct(this,(function(n){return[2,Xc((e=bs(t)).bh).then((function(t){return Fd(e,t)}))]}))}))}function zd(t,e,n,r){return lt(this,void 0,void 0,(function(){var i,s;return ct(this,(function(o){switch(o.label){case 0:return[4,(a=(i=bs(t)).bh,u=e,l=bs(a),c=bs(l.zo),l.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return c.yi(t,u).next((function(e){return e?l.Tc.Xo(t,e):Qu.resolve(null)}))})))];case 1:return null===(s=o.sent())?[3,6]:"pending"!==n?[3,3]:[4,qh(i.yl)];case 2:return o.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Ed(i,e,r||null),Nd(i,e),function(t,e){bs(bs(t).zo).xi(e)}(i.bh,e)):ms(),o.label=4;case 4:return[4,Fd(i,s)];case 5:return o.sent(),[3,7];case 6:ds("SyncEngine","Cannot apply mutation batch with id: "+e),o.label=7;case 7:return[2]}var a,u,l,c}))}))}function Bd(t,e){return lt(this,void 0,void 0,(function(){var n,r,i,s,o,a,u,l;return ct(this,(function(c){switch(c.label){case 0:return Hd(n=bs(t)),qd(n),!0!==e||!0===n.kl?[3,3]:(r=n.Vl.va(),[4,Ud(n,r.it())]);case 1:return i=c.sent(),n.kl=!0,[4,td(n.yl,!0)];case 2:for(c.sent(),s=0,o=i;s<o.length;s++)a=o[s],Fh(n.yl,a);return[3,7];case 3:return!1!==e||!1===n.kl?[3,7]:(u=[],l=Promise.resolve(),n.Sl.forEach((function(t,e){n.Vl.Ma(e)?u.push(e):l=l.then((function(){return Rd(n,e),Hc(n.bh,e,!0)})),Oh(n.yl,e)})),[4,l]);case 4:return c.sent(),[4,Ud(n,u)];case 5:return c.sent(),(h=bs(n)).xl.forEach((function(t,e){Oh(h.yl,e)})),h.Nl.Oc(),h.xl=new Map,h.Cl=new ja(Us.H),n.kl=!1,[4,td(n.yl,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}var h}))}))}function Ud(t,e,n){return lt(this,void 0,void 0,(function(){var n,r,i,s,o,a,u,l,c,h,d,p,f,g;return ct(this,(function(m){switch(m.label){case 0:n=bs(t),r=[],i=[],s=0,o=e,m.label=1;case 1:return s<o.length?(a=o[s],u=void 0,(l=n.Sl.get(a))&&0!==l.length?[4,jc(n.bh,Jo(l[0]))]:[3,7]):[3,13];case 2:u=m.sent(),c=0,h=l,m.label=3;case 3:return c<h.length?(d=h[c],p=n.vl.get(d),[4,Pd(n,p)]):[3,6];case 4:(f=m.sent()).snapshot&&i.push(f.snapshot),m.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Kc(n.bh,a)];case 8:return g=m.sent(),[4,jc(n.bh,g)];case 9:return u=m.sent(),[4,bd(n,Vd(g),a,!1)];case 10:m.sent(),m.label=11;case 11:r.push(u),m.label=12;case 12:return s++,[3,1];case 13:return[2,(n.bl.ah(i),r)]}}))}))}function Vd(t){return Go(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Wd(t){var e=bs(t);return bs(bs(e.bh).persistence).Uo()}function Gd(t,e,n,r){return lt(this,void 0,void 0,(function(){var i,s,o;return ct(this,(function(a){switch(a.label){case 0:return(i=bs(t)).kl?(ds("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Sl.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Xc(i.bh)];case 3:return s=a.sent(),o=lu.Me(e,"current"===n),[4,Fd(i,s,o)];case 4:return a.sent(),[3,8];case 5:return[4,Hc(i.bh,e,!0)];case 6:return a.sent(),Rd(i,e,r),[3,8];case 7:ms(),a.label=8;case 8:return[2]}}))}))}function jd(t,e,n){return lt(this,void 0,void 0,(function(){var r,i,s,o,a,u,l,c,h,d;return ct(this,(function(p){switch(p.label){case 0:if(!(r=Hd(t)).kl)return[3,10];i=0,s=e,p.label=1;case 1:return i<s.length?(o=s[i],r.Sl.has(o)?(ds("SyncEngine","Adding an already active target "+o),[3,5]):[4,Kc(r.bh,o)]):[3,6];case 2:return a=p.sent(),[4,jc(r.bh,a)];case 3:return u=p.sent(),[4,bd(r,Vd(a),u.targetId,!1)];case 4:p.sent(),Fh(r.yl,u),p.label=5;case 5:return i++,[3,1];case 6:l=function(t){return ct(this,(function(e){switch(e.label){case 0:return r.Sl.has(t)?[4,Hc(r.bh,t,!1).then((function(){Oh(r.yl,t),Rd(r,t)})).catch(nc)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},c=0,h=n,p.label=7;case 7:return c<h.length?(d=h[c],[5,l(d)]):[3,10];case 8:p.sent(),p.label=9;case 9:return c++,[3,7];case 10:return[2]}}))}))}function Hd(t){var e=bs(t);return e.yl.Dh.Lh=wd.bind(null,e),e.yl.Dh.vn=Ld.bind(null,e),e.yl.Dh.Mh=Id.bind(null,e),e.bl.ah=ad.bind(null,e.gl),e.bl.Bl=ud.bind(null,e.gl),e}function qd(t){var e=bs(t);return e.yl.Dh.Bh=Sd.bind(null,e),e.yl.Dh.qh=Td.bind(null,e),e}var Kd=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return lt(this,void 0,void 0,(function(){return ct(this,(function(e){switch(e.label){case 0:return this.Qt=Sh(t.yu.t),this.Vl=this.Wl(t),this.persistence=this.jl(t),[4,this.persistence.start()];case 1:return e.sent(),this.Gl=this.zl(t),this.bh=this.Hl(t),[2]}}))}))},t.prototype.zl=function(t){return null},t.prototype.Hl=function(t){return zc(this.persistence,new Pc,t.Jl,this.Qt)},t.prototype.jl=function(t){return new ih(oh.ia,this.Qt)},t.prototype.Wl=function(t){return new mh},t.prototype.terminate=function(){return lt(this,void 0,void 0,(function(){return ct(this,(function(t){switch(t.label){case 0:return this.Gl&&this.Gl.stop(),[4,this.Vl.ko()];case 1:return t.sent(),[4,this.persistence.ko()];case 2:return t.sent(),[2]}}))}))},t}(),Xd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Yl=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return at(e,t),e.prototype.initialize=function(e){return lt(this,void 0,void 0,(function(){return ct(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Yc(this.bh)];case 2:return n.sent(),[4,this.Yl.initialize(this,e)];case 3:return n.sent(),[4,qd(this.Yl._a)];case 4:return n.sent(),[4,qh(this.Yl.yl)];case 5:return n.sent(),[2]}}))}))},e.prototype.Hl=function(t){return zc(this.persistence,new Pc,t.Jl,this.Qt)},e.prototype.zl=function(t){var e=this.persistence.Ti.lr;return new vc(e,t._s)},e.prototype.jl=function(t){var e=Fc(t.yu.t,t.yu.persistenceKey),n=void 0!==this.cacheSizeBytes?ec.Ys(this.cacheSizeBytes):ec.ti;return new _c(this.synchronizeTabs,e,t.clientId,n,t._s,kh(),Ih(),this.Qt,this.Vl,!!this.forceOwnership)},e.prototype.Wl=function(t){return new mh},e}(Kd),Yd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Yl=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return at(e,t),e.prototype.initialize=function(e){return lt(this,void 0,void 0,(function(){var n,r=this;return ct(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Yl._a,this.Vl instanceof gh?(this.Vl._a={eu:zd.bind(null,n),nu:Gd.bind(null,n),su:jd.bind(null,n),Uo:Wd.bind(null,n),tu:Md.bind(null,n)},[4,this.Vl.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.Ro((function(t){return lt(r,void 0,void 0,(function(){return ct(this,(function(e){switch(e.label){case 0:return[4,Bd(this.Yl._a,t)];case 1:return e.sent(),this.Gl&&(t&&!this.Gl.Er?this.Gl.start(this.bh):t||this.Gl.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Wl=function(t){var e=kh();if(!gh.Kn(e))throw new Cs(Ts.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Fc(t.yu.t,t.yu.persistenceKey);return new gh(e,t._s,n,t.clientId,t.Jl)},e}(Xd),Qd=function(){function t(){}return t.prototype.initialize=function(t,e){return lt(this,void 0,void 0,(function(){var n=this;return ct(this,(function(r){switch(r.label){case 0:return this.bh?[3,2]:(this.bh=t.bh,this.Vl=t.Vl,this.Sh=this.Xl(e),this.yl=this.Zl(e),this.gl=this.t_(e),this._a=this.e_(e,!t.synchronizeTabs),this.Vl.fa=function(t){return kd(n._a,t,1)},this.yl.Dh.n_=Od.bind(null,this._a),[4,td(this.yl,this._a.Ml)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.t_=function(t){return new id},t.prototype.Xl=function(t){var e,n,r=Sh(t.yu.t),i=(e=t.yu,new wh(e));return n=t.credentials,new Rh(n,i,r)},t.prototype.Zl=function(t){var e,n,r,i,s,o=this;return e=this.bh,n=this.Sh,r=t._s,i=function(t){return kd(o._a,t,0)},s=bh.Kn()?new bh:new yh,new _h(e,n,r,i,s)},t.prototype.e_=function(t,e){return n=this.bh,r=this.yl,i=this.gl,s=this.Vl,o=t.Jl,a=t.pl,u=e,l=new md(n,r,i,s,o,a),u&&(l.kl=!0),l;var n,r,i,s,o,a,u,l},t.prototype.terminate=function(){return function(t){return lt(this,void 0,void 0,(function(){var e;return ct(this,(function(n){switch(n.label){case 0:return e=bs(t),ds("RemoteStore","RemoteStore shutting down."),e.Nh.add(5),[4,Dh(e)];case 1:return n.sent(),e.Fh.ko(),e.Oh.set("Unknown"),[2]}}))}))}(this.yl)},t}(),Jd=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.s_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.s_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.i_=function(){this.muted=!0},t.prototype.s_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),Zd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.f_=new Bs(t)}return t.prototype.isEqual=function(t){return this.f_.isEqual(t.f_)},t}(),tp=function(t){this._methodName=t},ep=function(t){this.d_=t};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function np(t,e,n){if(!n)throw new Cs(Ts.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function rp(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ip(t,e,n,r){if(!0===e&&!0===r)throw new Cs(Ts.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function sp(t){if(!Us.wt(t))throw new Cs(Ts.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function op(t){if(Us.wt(t))throw new Cs(Ts.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function ap(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":ms()}function up(t,e){if("_delegate"in t&&(t=t.d_),!(t instanceof e)){if(e.name===t.constructor.name)throw new Cs(Ts.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ap(t);throw new Cs(Ts.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function lp(t,e){if(e<=0)throw new Cs(Ts.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cp=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Cs(Ts.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Cs(Ts.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,ip("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),hp=new Map,dp=function(){function t(t,e){this.w_="(lite)",this.E_=new cp({}),this.T_=!1,t instanceof ls?(this.I_=t,this.m_=new $s):(this.A_=t,this.I_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Cs(Ts.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ls(t.options.projectId)}(t),this.m_=new _s(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this.A_)throw new Cs(Ts.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.A_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"R_",{get:function(){return this.T_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"P_",{get:function(){return void 0!==this.y_},enumerable:!1,configurable:!0}),t.prototype.g_=function(t){if(this.T_)throw new Cs(Ts.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.E_=new cp(t),void 0!==t.credentials&&(this.m_=function(t){if(!t)return new $s;switch(t.type){case"gapi":var e=t.client;return ys(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ds(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Cs(Ts.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype.V_=function(){return this.E_},t.prototype.p_=function(){return this.T_=!0,this.E_},t.prototype._delete=function(){return this.y_||(this.y_=this.b_()),this.y_},t.prototype.toJSON=function(){return{app:this.A_,t:this.I_,settings:this.E_}},t.prototype.b_=function(){return this,(t=hp.get(this))&&(ds("ComponentProvider","Removing Datastore"),hp.delete(this),t.terminate()),Promise.resolve();var t},t}(),pp=function(){function t(t,e,n){this.v_=e,this.S_=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"D_",{get:function(){return this.S_.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.S_.path.tt()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.S_.path.rt()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new gp(this.firestore,this.v_,this.S_.path.X())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this.S_)},t}(),fp=function(){function t(t,e,n){this.v_=e,this.C_=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this.C_)},t}(),gp=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,jo(r))||this).firestore=e,i.D_=r,i.type="collection",i}return at(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.C_.path.tt()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.C_.path.rt()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.D_.X();return t.et()?null:new pp(this.firestore,null,new Us(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this.D_)},e}(fp);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof ep&&(t=t.d_),np("collection","path",e),t instanceof dp)return op(n=Ms.ot.apply(Ms,pt([e],r))),new gp(t,null,n);if(!(t instanceof pp||t instanceof gp))throw new Cs(Ts.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return op(n=Ms.ot.apply(Ms,pt([t.path],r)).child(Ms.ot(e))),new gp(t.firestore,null,n)}function yp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof ep&&(t=t.d_),1===arguments.length&&(e=xs.u()),np("doc","path",e),t instanceof dp)return sp(n=Ms.ot.apply(Ms,pt([e],r))),new pp(t,null,new Us(n));if(!(t instanceof pp||t instanceof gp))throw new Cs(Ts.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return sp(n=t.D_.child(Ms.ot.apply(Ms,pt([e],r)))),new pp(t.firestore,t instanceof gp?t.v_:null,new Us(n))}function bp(t,e){return t instanceof ep&&(t=t.d_),e instanceof ep&&(e=e.d_),(t instanceof pp||t instanceof gp)&&(e instanceof pp||e instanceof gp)&&t.firestore===e.firestore&&t.path===e.path&&t.v_===e.v_}function vp(t,e){return t instanceof ep&&(t=t.d_),e instanceof ep&&(e=e.d_),t instanceof fp&&e instanceof fp&&t.firestore===e.firestore&&ta(t.C_,e.C_)&&t.v_===e.v_}var xp=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Cs(Ts.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Cs(Ts.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.x_=t,this.N_=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.x_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.N_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.x_===t.x_&&this.N_===t.N_},t.prototype.toJSON=function(){return{latitude:this.x_,longitude:this.N_}},t.prototype.U=function(t){return ws(this.x_,t.x_)||ws(this.N_,t.N_)},t}(),wp=/^__.*__$/,kp=function(){function t(t,e,n){this.data=t,this.Gt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return null!==this.Gt?new Da(t,this.data,this.Gt,e,this.fieldTransforms):new Aa(t,this.data,e,this.fieldTransforms)},t}(),Ip=function(){function t(t,e,n){this.data=t,this.Gt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return new Da(t,this.data,this.Gt,e,this.fieldTransforms)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sp(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ms()}}var Tp=function(){function t(t,e,n,r,i,s){this.settings=t,this.t=e,this.Qt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.O_(),this.fieldTransforms=i||[],this.Gt=s||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k_",{get:function(){return this.settings.k_},enumerable:!1,configurable:!0}),t.prototype.M_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.t,this.Qt,this.ignoreUndefinedProperties,this.fieldTransforms,this.Gt)},t.prototype.L_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.q_(t),r},t.prototype.U_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.O_(),r},t.prototype.Q_=function(t){return this.M_({path:void 0,B_:!0})},t.prototype.K_=function(t){return jp(t,this.settings.methodName,this.settings.W_||!1,this.path,this.settings.j_)},t.prototype.contains=function(t){return void 0!==this.Gt.find((function(e){return t.nt(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.nt(e.field)}))},t.prototype.O_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.q_(this.path.get(t))},t.prototype.q_=function(t){if(0===t.length)throw this.K_("Document fields must not be empty");if(Sp(this.k_)&&wp.test(t))throw this.K_('Document fields cannot begin and end with "__"')},t}(),Cp=function(){function t(t,e,n){this.t=t,this.ignoreUndefinedProperties=e,this.Qt=n||Sh(t)}return t.prototype.G_=function(t,e,n,r){return void 0===r&&(r=!1),new Tp({k_:t,methodName:e,j_:n,path:Bs.ct(),B_:!1,W_:r},this.t,this.Qt,this.ignoreUndefinedProperties)},t}();function Np(t){var e=t.p_(),n=Sh(t.I_);return new Cp(t.I_,!!e.ignoreUndefinedProperties,n)}function Ep(t,e,n,r,i,s){void 0===s&&(s={});var o=t.G_(s.merge||s.mergeFields?2:0,e,n,i);Up("Data must be an object, but it was:",o,r);var a,u,l=zp(r,o);if(s.merge)a=new js(o.Gt),u=o.fieldTransforms;else if(s.mergeFields){for(var c=[],h=0,d=s.mergeFields;h<d.length;h++){var p=Vp(e,d[h],n);if(!o.contains(p))throw new Cs(Ts.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");Hp(c,p)||c.push(p)}a=new js(c),u=o.fieldTransforms.filter((function(t){return a.Tt(t.field)}))}else a=null,u=o.fieldTransforms;return new kp(new mo(l),a,u)}var Rp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.z_=function(t){if(2!==t.k_)throw 1===t.k_?t.K_(this._methodName+"() can only appear at the top level of your update data"):t.K_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.Gt.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(tp);function $p(t,e,n){return new Tp({k_:3,j_:e.settings.j_,methodName:t._methodName,B_:n},e.t,e.Qt,e.ignoreUndefinedProperties)}var _p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.z_=function(t){return new ka(t.path,new fa)},e.prototype.isEqual=function(t){return t instanceof e},e}(tp),Ap=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).H_=n,r}return at(e,t),e.prototype.z_=function(t){var e=$p(this,t,!0),n=this.H_.map((function(t){return Mp(t,e)})),r=new ga(n);return new ka(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(tp),Dp=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).H_=n,r}return at(e,t),e.prototype.z_=function(t){var e=$p(this,t,!0),n=this.H_.map((function(t){return Mp(t,e)})),r=new ya(n);return new ka(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(tp),Fp=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).J_=n,r}return at(e,t),e.prototype.z_=function(t){var e=new va(t.Qt,la(t.Qt,this.J_));return new ka(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(tp);function Op(t,e,n,r){var i=t.G_(1,e,n);Up("Data must be an object, but it was:",i,r);var s=[],o=new yo;Ws(r,(function(t,r){var a=Gp(e,t,n);r instanceof ep&&(r=r.d_);var u=i.U_(a);if(r instanceof Rp)s.push(a);else{var l=Mp(r,u);null!=l&&(s.push(a),o.set(a,l))}}));var a=new js(s);return new Ip(o.Pt(),a,i.fieldTransforms)}function Lp(t,e,n,r,i,s){var o=t.G_(1,e,n),a=[Vp(e,r,n)],u=[i];if(s.length%2!=0)throw new Cs(Ts.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var l=0;l<s.length;l+=2)a.push(Vp(e,s[l])),u.push(s[l+1]);for(var c=[],h=new yo,d=a.length-1;d>=0;--d)if(!Hp(c,a[d])){var p=a[d],f=u[d];f instanceof ep&&(f=f.d_);var g=o.U_(p);if(f instanceof Rp)c.push(p);else{var m=Mp(f,g);null!=m&&(c.push(p),h.set(p,m))}}var y=new js(c);return new Ip(h.Pt(),y,o.fieldTransforms)}function Pp(t,e,n,r){return void 0===r&&(r=!1),Mp(n,t.G_(r?4:3,e))}function Mp(t,e){if(t instanceof ep&&(t=t.d_),Bp(t))return Up("Unsupported field value:",e,t),zp(t,e);if(t instanceof tp)return function(t,e){if(!Sp(e.k_))throw e.K_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.K_(t._methodName+"() is not currently supported inside arrays");var n=t.z_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.Gt.push(e.path),t instanceof Array){if(e.settings.B_&&4!==e.k_)throw e.K_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,s=t;i<s.length;i++){var o=Mp(s[i],e.Q_(r));null==o&&(o={nullValue:"NULL_VALUE"}),n.push(o),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof ep&&(t=t.d_),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return la(e.Qt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Os.fromDate(t);return{timestampValue:wu(e.Qt,n)}}if(t instanceof Os)return n=new Os(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:wu(e.Qt,n)};if(t instanceof xp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ns)return{bytesValue:ku(e.Qt,t.I)};if(t instanceof pp){n=e.t;var r=t.firestore.I_;if(!r.isEqual(n))throw e.K_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Tu(t.firestore.I_||e.t,t.S_.path)}}throw e.K_("Unsupported field value: "+ap(t))}(t,e)}function zp(t,e){var n={};return Gs(t)?e.path&&e.path.length>0&&e.Gt.push(e.path):Ws(t,(function(t,r){var i=Mp(r,e.L_(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Bp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Os||t instanceof xp||t instanceof Ns||t instanceof pp||t instanceof tp)}function Up(t,e,n){if(!Bp(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=ap(n);throw"an object"===r?e.K_(t+" a custom object"):e.K_(t+" "+r)}var i}function Vp(t,e,n){if(e instanceof ep&&(e=e.d_),e instanceof Zd)return e.f_;if("string"==typeof e)return Gp(t,e);throw jp("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Wp=new RegExp("[~\\*/\\[\\]]");function Gp(t,e,n){if(e.search(Wp)>=0)throw jp("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Zd.bind.apply(Zd,pt([void 0],e.split("."))))).f_}catch(r){throw jp("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function jp(t,e,n,r,i){var s=r&&!r.et(),o=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(s||o)&&(u+=" (found",s&&(u+=" in field "+r),o&&(u+=" in document "+i),u+=")"),new Cs(Ts.INVALID_ARGUMENT,(a+=". ")+t+u)}function Hp(t,e){return t.some((function(t){return t.isEqual(e)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qp=function(){function t(t){this.Sh=t,this.Y_=new Map,this.mutations=[],this.X_=!1,this.Z_=null,this.tf=new Set}return t.prototype.ef=function(t){return lt(this,void 0,void 0,(function(){var e,n=this;return ct(this,(function(r){switch(r.label){case 0:if(this.nf(),this.mutations.length>0)throw new Cs(Ts.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return lt(this,void 0,void 0,(function(){var n,r,i,s,o,a;return ct(this,(function(u){switch(u.label){case 0:return n=bs(t),r=_u(n.Qt)+"/documents",i={documents:e.map((function(t){return Nu(n.Qt,t)}))},[4,n.Du("BatchGetDocuments",r,i)];case 1:return s=u.sent(),o=new Map,s.forEach((function(t){var e,r,i=(e=n.Qt,"found"in(r=t)?function(t,e){ys(!!e.found),e.found.name,e.found.updateTime;var n=Eu(t,e.found.name),r=Su(e.found.updateTime),i=new mo({mapValue:{fields:e.found.fields}});return new xo(n,r,i,{})}(e,r):"missing"in r?function(t,e){ys(!!e.missing),ys(!!e.readTime);var n=Eu(t,e.missing),r=Su(e.readTime);return new wo(n,r)}(e,r):ms());o.set(i.key.toString(),i)})),a=[],[2,(e.forEach((function(t){var e=o.get(t.toString());ys(!!e),a.push(e)})),a)]}}))}))}(this.Sh,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof wo||t instanceof xo?n.sf(t):ms()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.F_(t,this.jt(t))),this.tf.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.F_(t,this.rf(t)))}catch(n){this.Z_=n}this.tf.add(t.toString())},t.prototype.delete=function(t){this.write(new Ba(t,this.jt(t))),this.tf.add(t.toString())},t.prototype.commit=function(){return lt(this,void 0,void 0,(function(){var t,e=this;return ct(this,(function(n){switch(n.label){case 0:if(this.nf(),this.Z_)throw this.Z_;return t=this.Y_,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Us._t(n);e.mutations.push(new Ua(r,e.jt(r)))})),[4,function(t,e){return lt(this,void 0,void 0,(function(){var n,r,i;return ct(this,(function(s){switch(s.label){case 0:return n=bs(t),r=_u(n.Qt)+"/documents",i={writes:e.map((function(t){return Fu(n.Qt,t)}))},[4,n.pu("Commit",r,i)];case 1:return s.sent(),[2]}}))}))}(this.Sh,this.mutations)];case 1:return n.sent(),this.X_=!0,[2]}}))}))},t.prototype.sf=function(t){var e;if(t instanceof xo)e=t.version;else{if(!(t instanceof wo))throw ms();e=Ls.min()}var n=this.Y_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Cs(Ts.ABORTED,"Document version changed between two reads.")}else this.Y_.set(t.key.toString(),e)},t.prototype.jt=function(t){var e=this.Y_.get(t.toString());return!this.tf.has(t.toString())&&e?Sa.updateTime(e):Sa.Kt()},t.prototype.rf=function(t){var e=this.Y_.get(t.toString());if(!this.tf.has(t.toString())&&e){if(e.isEqual(Ls.min()))throw new Cs(Ts.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Sa.updateTime(e)}return Sa.exists(!0)},t.prototype.write=function(t){this.nf(),this.mutations.push(t)},t.prototype.nf=function(){},t}(),Kp=function(){function t(t,e,n,r){this._s=t,this.Sh=e,this.updateFunction=n,this.Es=r,this.cf=5,this.Gu=new Th(this._s,"transaction_retry")}return t.prototype.run=function(){this.af()},t.prototype.af=function(){var t=this;this.Gu.Lu((function(){return lt(t,void 0,void 0,(function(){var t,e,n=this;return ct(this,(function(r){return t=new qp(this.Sh),(e=this.uf(t))&&e.then((function(e){n._s.Ps((function(){return t.commit().then((function(){n.Es.resolve(e)})).catch((function(t){n.hf(t)}))}))})).catch((function(t){n.hf(t)})),[2]}))}))}))},t.prototype.uf=function(t){try{var e=this.updateFunction(t);return!Zs(e)&&e.catch&&e.then?e:(this.Es.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.Es.reject(n),null}},t.prototype.hf=function(t){var e=this;this.cf>0&&this.lf(t)?(this.cf-=1,this._s.Ps((function(){return e.af(),Promise.resolve()}))):this.Es.reject(t)},t.prototype.lf=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Wa(e)}return!1},t}(),Xp=function(){function t(t,e,n){var r=this;this.credentials=t,this._s=e,this.yu=n,this.user=Es.UNAUTHENTICATED,this.clientId=xs.u(),this._f=function(){},this.C=new Yu,this.credentials.v((function(t){ds("FirestoreClient","Received user=",t.uid),r.user=t,r._f(t),r.C.resolve()}))}return t.prototype.getConfiguration=function(){return lt(this,void 0,void 0,(function(){return ct(this,(function(t){switch(t.label){case 0:return[4,this.C.promise];case 1:return[2,(t.sent(),{_s:this._s,yu:this.yu,clientId:this.clientId,credentials:this.credentials,Jl:this.user,pl:100})]}}))}))},t.prototype.ff=function(t){var e=this;this._f=t,this.C.promise.then((function(){return e._f(e.user)}))},t.prototype.df=function(){if(this._s.wf)throw new Cs(Ts.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this._s.Ef();var e=new Yu;return this._s.Tf((function(){return lt(t,void 0,void 0,(function(){var t,n;return ct(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.If?[4,this.If.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.mf?[4,this.mf.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.S(),e.resolve(),[3,6];case 5:return t=r.sent(),n=ul(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yp(t,e){return lt(this,void 0,void 0,(function(){var n,r,i=this;return ct(this,(function(s){switch(s.label){case 0:return t._s.Af(),ds("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=s.sent(),[4,e.initialize(n)];case 2:return s.sent(),r=n.Jl,t.ff((function(n){r.isEqual(n)||(r=n,t._s.po((function(){return lt(i,void 0,void 0,(function(){return ct(this,(function(t){switch(t.label){case 0:return[4,Bc(e.bh,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.Po((function(){return t.terminate()})),t.mf=e,[2]}}))}))}function Qp(t,e){return lt(this,void 0,void 0,(function(){var n,r;return ct(this,(function(i){switch(i.label){case 0:return t._s.Af(),[4,Jp(t)];case 1:return n=i.sent(),ds("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.ff((function(n){return t._s.po((function(){return function(t,e){return lt(this,void 0,void 0,(function(){var n,r;return ct(this,(function(i){switch(i.label){case 0:return(n=bs(t))._s.Af(),ds("RemoteStore","RemoteStore received new credentials"),r=Bh(n),n.Nh.add(3),[4,Dh(n)];case 1:return i.sent(),r&&n.Oh.set("Unknown"),[4,n.Dh.n_(e)];case 2:return i.sent(),n.Nh.delete(3),[4,Ah(n)];case 3:return i.sent(),[2]}}))}))}(e.yl,n)}))})),t.If=e,[2]}}))}))}function Jp(t){return lt(this,void 0,void 0,(function(){return ct(this,(function(e){switch(e.label){case 0:return t.mf?[3,2]:(ds("FirestoreClient","Using default OfflineComponentProvider"),[4,Yp(t,new Kd)]);case 1:e.sent(),e.label=2;case 2:return[2,t.mf]}}))}))}function Zp(t){return lt(this,void 0,void 0,(function(){return ct(this,(function(e){switch(e.label){case 0:return t.If?[3,2]:(ds("FirestoreClient","Using default OnlineComponentProvider"),[4,Qp(t,new Qd)]);case 1:e.sent(),e.label=2;case 2:return[2,t.If]}}))}))}function tf(t){return Jp(t).then((function(t){return t.persistence}))}function ef(t){return Jp(t).then((function(t){return t.bh}))}function nf(t){return Zp(t).then((function(t){return t.yl}))}function rf(t){return Zp(t).then((function(t){return t._a}))}function sf(t){return lt(this,void 0,void 0,(function(){var e,n;return ct(this,(function(r){switch(r.label){case 0:return[4,Zp(t)];case 1:return e=r.sent(),[2,((n=e.gl).jh=yd.bind(null,e._a),n.Hh=vd.bind(null,e._a),n)]}}))}))}function of(t,e,n){var r=this;void 0===n&&(n={});var i=new Yu;return t._s.Ps((function(){return lt(r,void 0,void 0,(function(){var r;return ct(this,(function(s){switch(s.label){case 0:return r=function(t,e,n,r,i){var s=new Jd({next:function(s){e.Ps((function(){return od(t,o)}));var a=s.docs.has(n);!a&&s.fromCache?i.reject(new Cs(Ts.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Cs(Ts.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:function(t){return i.reject(t)}}),o=new cd(jo(n.path),s,{includeMetadataChanges:!0,nl:!0});return sd(t,o)},[4,sf(t)];case 1:return[2,r.apply(void 0,[s.sent(),t._s,e,n,i])]}}))}))})),i.promise}function af(t,e,n){var r=this;void 0===n&&(n={});var i=new Yu;return t._s.Ps((function(){return lt(r,void 0,void 0,(function(){var r;return ct(this,(function(s){switch(s.label){case 0:return r=function(t,e,n,r,i){var s=new Jd({next:function(n){e.Ps((function(){return od(t,o)})),n.fromCache&&"server"===r.source?i.reject(new Cs(Ts.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),o=new cd(n,s,{includeMetadataChanges:!0,nl:!0});return sd(t,o)},[4,sf(t)];case 1:return[2,r.apply(void 0,[s.sent(),t._s,e,n,i])]}}))}))})),i.promise}var uf=function(){function t(){var t=this;this.Rf=Promise.resolve(),this.Pf=[],this.yf=!1,this.gf=[],this.Vf=null,this.pf=!1,this.bf=[],this.Gu=new Th(this,"async_queue_retry"),this.vf=function(){var e=Ih();e&&ds("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Gu.qu()};var e=Ih();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.vf)}return Object.defineProperty(t.prototype,"wf",{get:function(){return this.yf},enumerable:!1,configurable:!0}),t.prototype.Ps=function(t){this.enqueue(t)},t.prototype.Tf=function(t){this.Sf(),this.Df(t)},t.prototype.Ef=function(){if(!this.yf){this.yf=!0;var t=Ih();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.vf)}},t.prototype.enqueue=function(t){return this.Sf(),this.yf?new Promise((function(t){})):this.Df(t)},t.prototype.po=function(t){var e=this;this.Ps((function(){return e.Pf.push(t),e.Cf()}))},t.prototype.Cf=function(){return lt(this,void 0,void 0,(function(){var t,e=this;return ct(this,(function(n){switch(n.label){case 0:if(0===this.Pf.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.Pf[0]()];case 2:return n.sent(),this.Pf.shift(),this.Gu.reset(),[3,4];case 3:if(!nl(t=n.sent()))throw t;return ds("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.Pf.length>0&&this.Gu.Lu((function(){return e.Cf()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Df=function(t){var e=this,n=this.Rf.then((function(){return e.pf=!0,t().catch((function(t){throw e.Vf=t,e.pf=!1,ps("INTERNAL UNHANDLED ERROR: ",(r=(n=t).message||"",n.stack&&(r=n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack),r)),t;var n,r})).then((function(t){return e.pf=!1,t}))}));return this.Rf=n,n},t.prototype.Tr=function(t,e,n){var r=this;this.Sf(),this.bf.indexOf(t)>-1&&(e=0);var i=al.Ts(this,t,e,n,(function(t){return r.xf(t)}));return this.gf.push(i),i},t.prototype.Sf=function(){this.Vf&&ms()},t.prototype.Af=function(){},t.prototype.Nf=function(){return lt(this,void 0,void 0,(function(){var t;return ct(this,(function(e){switch(e.label){case 0:return[4,t=this.Rf];case 1:e.sent(),e.label=2;case 2:if(t!==this.Rf)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.$f=function(t){for(var e=0,n=this.gf;e<n.length;e++)if(n[e].fs===t)return!0;return!1},t.prototype.Ff=function(t){var e=this;return this.Nf().then((function(){e.gf.sort((function(t,e){return t.ds-e.ds}));for(var n=0,r=e.gf;n<r.length;n++){var i=r[n];if(i.Rs(),"all"!==t&&i.fs===t)break}return e.Nf()}))},t.prototype.Of=function(t){this.bf.push(t)},t.prototype.xf=function(t){var e=this.gf.indexOf(t);this.gf.splice(e,1)},t}();function lf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var s=i[r];if(s in n&&"function"==typeof n[s])return!0}return!1}(t)}var cf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).Bf=new uf,r.w_="name"in e?e.name:"[DEFAULT]",r}return at(e,t),e.prototype.b_=function(){return this.qf||df(this),this.qf.terminate()},e}(dp);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hf(t){return t.qf||df(t),t.qf.df(),t.qf}function df(t){var e,n,r,i=t.p_(),s=(e=t.I_,n=t.w_,new us(e,n,(r=i).host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t.qf=new Xp(t.m_,t.Bf,s)}function pf(t,e,n){var r=this,i=new Yu;return t._s.enqueue((function(){return lt(r,void 0,void 0,(function(){var r;return ct(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,Yp(t,n)];case 1:return s.sent(),[4,Qp(t,e)];case 2:return s.sent(),i.resolve(),[3,4];case 3:if(!("FirebaseError"===(o=r=s.sent()).name?o.code===Ts.FAILED_PRECONDITION||o.code===Ts.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}var o}))}))})).then((function(){return i.promise}))}function ff(t){if(t.R_||t.P_)throw new Cs(Ts.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gf=function(){function t(){}return t.prototype.Uf=function(t,e){switch(void 0===e&&(e="none"),no(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ks(t.integerValue||t.doubleValue);case 3:return this.Qf(t.timestampValue);case 4:return this.Kf(t,e);case 5:return t.stringValue;case 6:return this.Wf(Xs(t.bytesValue));case 7:return this.jf(t.referenceValue);case 8:return this.Gf(t.geoPointValue);case 9:return this.zf(t.arrayValue,e);case 10:return this.Hf(t.mapValue,e);default:throw ms()}},t.prototype.Hf=function(t,e){var n=this,r={};return Ws(t.fields||{},(function(t,i){r[t]=n.Uf(i,e)})),r},t.prototype.Gf=function(t){return new xp(Ks(t.latitude),Ks(t.longitude))},t.prototype.zf=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.Uf(t,e)}))},t.prototype.Kf=function(t,e){switch(e){case"previous":var n=Qs(t);return null==n?null:this.Uf(n,e);case"estimate":return this.Qf(Js(t));default:return null}},t.prototype.Qf=function(t){var e=qs(t);return new Os(e.seconds,e.nanos)},t.prototype.Jf=function(t,e){var n=Ms.ot(t);ys(Xu(n));var r=new ls(n.get(1),n.get(3)),i=new Us(n.Y(5));return r.isEqual(e)||ps("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}(),mf=function(){function t(t,e,n,r,i){this.Yf=t,this.Xf=e,this.S_=n,this.Zf=r,this.v_=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this.S_.path.tt()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new pp(this.Yf,this.v_,this.S_)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this.Zf},t.prototype.data=function(){if(this.Zf){if(this.v_){var t=new yf(this.Yf,this.Xf,this.S_,this.Zf,null);return this.v_.fromFirestore(t)}return this.Xf.Uf(this.Zf.bt())}},t.prototype.get=function(t){if(this.Zf){var e=this.Zf.data().field(bf("DocumentSnapshot.get",t));if(null!==e)return this.Xf.Uf(e)}},t}(),yf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(mf);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bf(t,e){return"string"==typeof e?Gp(t,e):e instanceof ep?e.d_.f_:e.f_}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vf(t){if(qo(t)&&0===t.xt.length)throw new Cs(Ts.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var xf=function(){};function wf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var s=i[r];t=s.td(t)}return t}var kf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).ed=e,i.nd=n,i.sd=r,i.type="where",i}return at(e,t),e.prototype.td=function(t){var e,n,r,i=Np(t.firestore),s=function(t,e,n,r,i,s,o){var a;if(i.ut()){if("array-contains"===s||"array-contains-any"===s)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+s+"' queries on FieldPath.documentId().");if("in"===s||"not-in"===s){Rf(o,s);for(var u=[],l=0,c=o;l<c.length;l++){var h=c[l];u.push(Ef(r,t,h))}a={arrayValue:{values:u}}}else a=Ef(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Rf(o,s),a=Pp(n,"where",o,"in"===s||"not-in"===s);var d=Eo.create(i,s,a);return function(t,e){if(e.Ct()){var n=Xo(t);if(null!==n&&!n.isEqual(e.field))throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Ko(t);null!==r&&$f(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new Cs(Ts.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Cs(Ts.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,d),d}(t.C_,0,i,t.firestore.I_,this.ed,this.nd,this.sd);return new fp(t.firestore,t.v_,(e=t.C_,n=s,r=e.filters.concat([n]),new Wo(e.path,e.collectionGroup,e.xt.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)))},e}(xf),If=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).ed=e,r.rd=n,r.type="orderBy",r}return at(e,t),e.prototype.td=function(t){var e,n,r,i=function(t,e,n){if(null!==t.startAt)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new zo(e,n);return function(t,e){if(null===Ko(t)){var n=Xo(t);null!==n&&$f(t,n,e.field)}}(t,r),r}(t.C_,this.ed,this.rd);return new fp(t.firestore,t.v_,(e=t.C_,n=i,r=e.xt.concat([n]),new Wo(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},e}(xf),Sf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.od=n,i.ad=r,i}return at(e,t),e.prototype.td=function(t){return new fp(t.firestore,t.v_,Zo(t.C_,this.od,this.ad))},e}(xf),Tf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ud=n,i.hd=r,i}return at(e,t),e.prototype.td=function(t){var e,n,r=Nf(t,this.type,this.ud,this.hd);return new fp(t.firestore,t.v_,(e=t.C_,n=r,new Wo(e.path,e.collectionGroup,e.xt.slice(),e.filters.slice(),e.limit,e.limitType,n,e.endAt)))},e}(xf),Cf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ud=n,i.hd=r,i}return at(e,t),e.prototype.td=function(t){var e,n,r=Nf(t,this.type,this.ud,this.hd);return new fp(t.firestore,t.v_,(e=t.C_,n=r,new Wo(e.path,e.collectionGroup,e.xt.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,n)))},e}(xf);function Nf(t,e,n,r){if(n[0]instanceof ep&&(n[0]=n[0].d_),n[0]instanceof mf)return function(t,e,n,r,i){if(!r)throw new Cs(Ts.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var s=[],o=0,a=Qo(t);o<a.length;o++){var u=a[o];if(u.field.ut())s.push(lo(e,r.key));else{var l=r.field(u.field);if(Ys(l))throw new Cs(Ts.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===l){var c=u.field.rt();throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+c+"' (used as the orderBy) does not exist.")}s.push(l)}}return new Po(s,i)}(t.C_,t.firestore.I_,e,n[0].Zf,r);var i=Np(t.firestore);return function(t,e,n,r,i,s){var o=t.xt;if(i.length>o.length)throw new Cs(Ts.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var l=i[u];if(o[u].field.ut()){if("string"!=typeof l)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof l);if(!Yo(t)&&-1!==l.indexOf("/"))throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+l+"' contains a slash.");var c=t.path.child(Ms.ot(l));if(!Us.wt(c))throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+c+"' is not because it contains an odd number of segments.");var h=new Us(c);a.push(lo(e,h))}else{var d=Pp(n,r,l);a.push(d)}}return new Po(a,s)}(t.C_,t.firestore.I_,i,e,n,r)}function Ef(t,e,n){if(n instanceof ep&&(n=n.d_),"string"==typeof n){if(""===n)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yo(e)&&-1!==n.indexOf("/"))throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Ms.ot(n));if(!Us.wt(r))throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return lo(t,new Us(r))}if(n instanceof pp)return lo(t,n.S_);throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ap(n)+".")}function Rf(t,e){if(!Array.isArray(t)||0===t.length)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function $f(t,e,n){if(!n.isEqual(e))throw new Cs(Ts.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _f(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Af=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return at(e,t),e.prototype.Wf=function(t){return new Ns(t)},e.prototype.jf=function(t){var e=this.Jf(t,this.firestore.I_);return new pp(this.firestore,null,e)},e}(gf),Df=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Ff=function(t){function e(e,n,r,i,s,o){var a=this;return(a=t.call(this,e,n,r,i,o)||this).Yf=e,a.ld=e,a.metadata=s,a}return at(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this.Zf){if(this.v_){var e=new Of(this.Yf,this.Xf,this.S_,this.Zf,this.metadata,null);return this.v_.fromFirestore(e,t)}return this.Xf.Uf(this.Zf.bt(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this.Zf){var n=this.Zf.data().field(bf("DocumentSnapshot.get",t));if(null!==n)return this.Xf.Uf(n,e.serverTimestamps)}},e}(mf),Of=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Ff),Lf=function(){function t(t,e,n,r){this.Yf=t,this.Xf=e,this._d=r,this.metadata=new Df(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._d.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._d.docs.forEach((function(r){t.call(e,new Of(n.Yf,n.Xf,r.key,r,new Df(n._d.De.has(r.key),n._d.fromCache),n.query.v_))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._d.xe)throw new Cs(Ts.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.fd&&this.dd===e||(this.fd=function(t,e){if(t._d.Se.et()){var n=0;return t._d.docChanges.map((function(e){var r=new Of(t.Yf,t.Xf,e.doc.key,e.doc,new Df(t._d.De.has(e.doc.key),t._d.fromCache),t.query.v_);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._d.Se;return t._d.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Of(t.Yf,t.Xf,e.doc.key,e.doc,new Df(t._d.De.has(e.doc.key),t._d.fromCache),t.query.v_),i=-1,s=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(s=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Pf(e.type),doc:n,oldIndex:i,newIndex:s}}))}(this,e),this.dd=e),this.fd},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ms()}}function Mf(t,e){return t instanceof Ff&&e instanceof Ff?t.Yf===e.Yf&&t.S_.isEqual(e.S_)&&(null===t.Zf?null===e.Zf:t.Zf.isEqual(e.Zf))&&t.v_===e.v_:t instanceof Lf&&e instanceof Lf&&t.Yf===e.Yf&&vp(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._d.isEqual(e._d)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return at(e,t),e.prototype.Wf=function(t){return new Ns(t)},e.prototype.jf=function(t){var e=this.Jf(t,this.firestore.I_);return new pp(this.firestore,null,e)},e}(gf);function Bf(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=up(t,pp);var s=up(t.firestore,cf),o=Np(s);return e instanceof ep&&(e=e.d_),Vf(s,[("string"==typeof e||e instanceof Zd?Lp(o,"updateDoc",t.S_,e,n,r):Op(o,"updateDoc",t.S_,e)).F_(t.S_,Sa.exists(!0))])}function Uf(t){for(var e,n,r,i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];t instanceof ep&&(t=t.d_);var o={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||lf(i[a])||(o=i[a],a++);var u,l,c,h={includeMetadataChanges:o.includeMetadataChanges};if(lf(i[a])){var d=i[a];i[a]=null===(e=d.next)||void 0===e?void 0:e.bind(d),i[a+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),i[a+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof pp)l=up(t.firestore,cf),c=jo(t.S_.path),u={next:function(e){i[a]&&i[a](Wf(l,t,e))},error:i[a+1],complete:i[a+2]};else{var p=up(t,fp);l=up(p.firestore,cf),c=p.C_;var f=new zf(l);u={next:function(t){i[a]&&i[a](new Lf(l,f,p,t))},error:i[a+1],complete:i[a+2]},vf(t.C_)}return function(t,e,n,r){var i=this,s=new Jd(r),o=new cd(e,s,n);return t._s.Ps((function(){return lt(i,void 0,void 0,(function(){var e;return ct(this,(function(n){switch(n.label){case 0:return e=sd,[4,sf(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))})),function(){s.i_(),t._s.Ps((function(){return lt(i,void 0,void 0,(function(){var e;return ct(this,(function(n){switch(n.label){case 0:return e=od,[4,sf(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))}))}}(hf(l),c,h,u)}function Vf(t,e){return function(t,e){var n=this,r=new Yu;return t._s.Ps((function(){return lt(n,void 0,void 0,(function(){var n;return ct(this,(function(i){switch(i.label){case 0:return n=xd,[4,rf(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(hf(t),e)}function Wf(t,e,n){var r=n.docs.get(e.S_),i=new zf(t);return new Ff(t,i,e.S_,r,new Df(n.hasPendingWrites,n.fromCache),e.v_)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gf=function(){function t(t,e){this.Yf=t,this.wd=e,this.Ed=[],this.Td=!1,this.Id=Np(t)}return t.prototype.set=function(t,e,n){this.md();var r=jf(t,this.Yf),i=_f(r.v_,e,n),s=Ep(this.Id,"WriteBatch.set",r.S_,i,null!==r.v_,n);return this.Ed.push(s.F_(r.S_,Sa.Kt())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this.md();var s,o=jf(t,this.Yf);return e instanceof ep&&(e=e.d_),s="string"==typeof e||e instanceof Zd?Lp(this.Id,"WriteBatch.update",o.S_,e,n,r):Op(this.Id,"WriteBatch.update",o.S_,e),this.Ed.push(s.F_(o.S_,Sa.exists(!0))),this},t.prototype.delete=function(t){this.md();var e=jf(t,this.Yf);return this.Ed=this.Ed.concat(new Ba(e.S_,Sa.Kt())),this},t.prototype.commit=function(){return this.md(),this.Td=!0,this.Ed.length>0?this.wd(this.Ed):Promise.resolve()},t.prototype.md=function(){if(this.Td)throw new Cs(Ts.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function jf(t,e){if(t instanceof ep&&(t=t.d_),t.firestore!==e)throw new Cs(Ts.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).Yf=e,r}return at(e,t),e.prototype.get=function(e){var n=this,r=jf(e,this.Yf),i=new zf(this.Yf);return t.prototype.get.call(this,e).then((function(t){return new Ff(n.Yf,i,r.S_,t.Zf,new Df(!1,!1),r.v_)}))},e}(function(){function t(t,e){this.Yf=t,this.Ad=e,this.Id=Np(t)}return t.prototype.get=function(t){var e=this,n=jf(t,this.Yf),r=new Af(this.Yf);return this.Ad.ef([n.S_]).then((function(t){if(!t||1!==t.length)return ms();var i=t[0];if(i instanceof wo)return new mf(e.Yf,r,n.S_,null,n.v_);if(i instanceof xo)return new mf(e.Yf,r,i.key,i,n.v_);throw ms()}))},t.prototype.set=function(t,e,n){var r=jf(t,this.Yf),i=_f(r.v_,e,n),s=Ep(this.Id,"Transaction.set",r.S_,i,null!==r.v_,n);return this.Ad.set(r.S_,s),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var s,o=jf(t,this.Yf);return e instanceof ep&&(e=e.d_),s="string"==typeof e||e instanceof Zd?Lp(this.Id,"Transaction.update",o.S_,e,n,r):Op(this.Id,"Transaction.update",o.S_,e),this.Ad.update(o.S_,s),this},t.prototype.delete=function(t){var e=jf(t,this.Yf);return this.Ad.delete(e.S_),this},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qf(){if("undefined"==typeof Uint8Array)throw new Cs(Ts.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Kf(){if("undefined"==typeof atob)throw new Cs(Ts.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Xf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.fromBase64String=function(t){return Kf(),new e(Ns.fromBase64String(t))},e.fromUint8Array=function(t){return qf(),new e(Ns.fromUint8Array(t))},e.prototype.toBase64=function(){return Kf(),this.d_.toBase64()},e.prototype.toUint8Array=function(){return qf(),this.d_.toUint8Array()},e.prototype.isEqual=function(t){return this.d_.isEqual(t.d_)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(ep),Yf=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){ff(t=up(t,cf));var n=hf(t),r=t.p_(),i=new Qd;return pf(n,i,new Xd(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t.d_,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){ff(t=up(t,cf));var e=hf(t),n=t.p_(),r=new Qd;return pf(e,r,new Yd(r,n.cacheSizeBytes))}(t.d_)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t.R_&&!t.P_)throw new Cs(Ts.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Yu;return t.Bf.Tf((function(){return lt(e,void 0,void 0,(function(){var e;return ct(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return lt(this,void 0,void 0,(function(){var e;return ct(this,(function(n){switch(n.label){case 0:return Zu.Kn()?(e=t+"main",[4,Zu.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Fc(t.I_,t.w_))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t.d_)},t}(),Qf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n)||this).Rd=r,i.INTERNAL={delete:function(){return i.terminate()}},e instanceof ls||(i.Pd=e),i}return at(e,t),Object.defineProperty(e.prototype,"I_",{get:function(){return this.d_.I_},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.d_.V_()),t)).merge,this.d_.g_(t)},e.prototype.useEmulator=function(t,e){var n,r,i,s;n=this.d_,r=t,i=e,"firestore.googleapis.com"!==(s=(n=up(n,dp)).V_()).host&&s.host!==r&&fs("Host has been set in both settings() and useEmulator(), emulator host will be used"),n.g_(Object.assign(Object.assign({},s),{host:r+":"+i,ssl:!1}))},e.prototype.enableNetwork=function(){return function(t){var e=this;return t._s.enqueue((function(){return lt(e,void 0,void 0,(function(){var e,n;return ct(this,(function(r){switch(r.label){case 0:return[4,tf(t)];case 1:return e=r.sent(),[4,nf(t)];case 2:return n=r.sent(),[2,(e.yo(!0),i=n,s=bs(i),s.Nh.delete(0),Ah(s))]}var i,s}))}))}))}(hf(up(this.d_,cf)))},e.prototype.disableNetwork=function(){return function(t){var e=this;return t._s.enqueue((function(){return lt(e,void 0,void 0,(function(){var e,n;return ct(this,(function(r){switch(r.label){case 0:return[4,tf(t)];case 1:return e=r.sent(),[4,nf(t)];case 2:return n=r.sent(),[2,(e.yo(!1),function(t){return lt(this,void 0,void 0,(function(){var e;return ct(this,(function(n){switch(n.label){case 0:return(e=bs(t)).Nh.add(0),[4,Dh(e)];case 1:return n.sent(),e.Oh.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(hf(up(this.d_,cf)))},e.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&ip("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Rd.enableMultiTabIndexedDbPersistence(this):this.Rd.enableIndexedDbPersistence(this,n)},e.prototype.clearPersistence=function(){return this.Rd.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.Pd&&(this.Pd._removeServiceInstance("firestore"),this.Pd._removeServiceInstance("firestore-exp")),this.d_._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Yu;return t._s.Ps((function(){return lt(e,void 0,void 0,(function(){var e;return ct(this,(function(r){switch(r.label){case 0:return e=Cd,[4,rf(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(hf(up(this.d_,cf)))},e.prototype.onSnapshotsInSync=function(t){return e=this.d_,n=t,function(t,e){var n=this,r=new Jd(e);return t._s.Ps((function(){return lt(n,void 0,void 0,(function(){var e;return ct(this,(function(n){switch(n.label){case 0:return e=function(t,e){bs(t).Wh.add(e),e.next()},[4,sf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.i_(),t._s.Ps((function(){return lt(n,void 0,void 0,(function(){var e;return ct(this,(function(n){switch(n.label){case 0:return e=function(t,e){bs(t).Wh.delete(e)},[4,sf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(hf(e=up(e,cf)),lf(n)?n:{next:n});var e,n},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.Pd)throw new Cs(Ts.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Pd},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new hg(this,mp(this.d_,t))}catch(e){throw rg(e,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new ng(this,yp(this.d_,t))}catch(e){throw rg(e,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new ug(this,function(t,e){if(t=up(t,dp),np("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new fp(t,null,(n=e,new Wo(Ms.ct(),n)));var n}(this.d_,t))}catch(e){throw rg(e,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var e,n=this;return function(t,e){var n=this,r=new Yu;return t._s.Ps((function(){return lt(n,void 0,void 0,(function(){var n;return ct(this,(function(i){switch(i.label){case 0:return[4,(s=t,Zp(s).then((function(t){return t.Sh})))];case 1:return n=i.sent(),new Kp(t._s,n,e,r).run(),[2]}var s}))}))})),r.promise}(hf(e=this.d_),(function(r){return function(e){return t(new Zf(n,e))}(new Hf(e,r))}))},e.prototype.batch=function(){var t=this;return hf(this.d_),new tg(new Gf(this.d_,(function(e){return Vf(t.d_,e)})))},e.prototype.loadBundle=function(t){throw new Cs(Ts.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new Cs(Ts.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(ep),Jf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return at(e,t),e.prototype.Wf=function(t){return new Xf(new Ns(t))},e.prototype.jf=function(t){var e=this.Jf(t,this.firestore.I_);return ng.yd(e,this.firestore,null)},e}(gf);var Zf=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r.Xf=new Jf(e),r}return at(e,t),e.prototype.get=function(t){var e=this,n=dg(t);return this.d_.get(n).then((function(t){return new og(e.Yf,new Ff(e.Yf.d_,e.Xf,t.S_,t.Zf,t.metadata,n.v_))}))},e.prototype.set=function(t,e,n){var r=dg(t);return n?(rp("Transaction.set",n),this.d_.set(r,e,n)):this.d_.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];var o=dg(t);return 2===arguments.length?this.d_.update(o,e):(r=this.d_).update.apply(r,pt([o,e,n],i)),this},e.prototype.delete=function(t){var e=dg(t);return this.d_.delete(e),this},e}(ep),tg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.set=function(t,e,n){var r=dg(t);return n?(rp("WriteBatch.set",n),this.d_.set(r,e,n)):this.d_.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];var o=dg(t);return 2===arguments.length?this.d_.update(o,e):(r=this.d_).update.apply(r,pt([o,e,n],i)),this},e.prototype.delete=function(t){var e=dg(t);return this.d_.delete(e),this},e.prototype.commit=function(){return this.d_.commit()},e}(ep),eg=function(t){function e(e,n,r){var i=this;return(i=t.call(this,r)||this).Yf=e,i.Xf=n,i}return at(e,t),e.prototype.fromFirestore=function(t,e){var n=new Of(this.Yf.d_,this.Xf,t.S_,t.Zf,t.metadata,null);return this.d_.fromFirestore(new ag(this.Yf,n),null!=e?e:{})},e.prototype.toFirestore=function(t,e){return e?this.d_.toFirestore(t,e):this.d_.toFirestore(t)},e.gd=function(t,n){var r=e.Vd,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var s=i.get(n);return s||(s=new e(t,new Jf(t),n),i.set(n,s)),s},e}(ep);eg.Vd=new WeakMap;var ng=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.Xf=new Jf(e),r}return at(e,t),e.pd=function(t,n,r){if(t.length%2!=0)throw new Cs(Ts.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.rt()+" has "+t.length);return new e(n,new pp(n.d_,r,new Us(t)))},e.yd=function(t,n,r){return new e(n,new pp(n.d_,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this.d_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new hg(this.firestore,this.d_.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.d_.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new hg(this.firestore,mp(this.d_,t))}catch(e){throw rg(e,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return t instanceof ep&&(t=t.d_),t instanceof pp&&bp(this.d_,t)},e.prototype.set=function(t,e){e=rp("DocumentReference.set",e);try{return function(t,e,n){t=up(t,pp);var r=up(t.firestore,cf),i=_f(t.v_,e,n);return Vf(r,[Ep(Np(r),"setDoc",t.S_,i,null!==t.v_,n).F_(t.S_,Sa.Kt())])}(this.d_,t,e)}catch(n){throw rg(n,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Bf(this.d_,t):Bf.apply(void 0,pt([this.d_,t,e],n))}catch(i){throw rg(i,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return Vf(up((t=this.d_).firestore,cf),[new Ba(t.S_,Sa.Kt())]);var t},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ig(e),i=sg(e,(function(e){return new og(t.firestore,new Ff(t.firestore.d_,t.Xf,e.S_,e.Zf,e.metadata,t.d_.v_))}));return Uf(this.d_,r,i)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=up(t,pp);var e=up(t.firestore,cf),n=hf(e),r=new zf(e);return function(t,e){var n=this,r=new Yu;return t._s.Ps((function(){return lt(n,void 0,void 0,(function(){var n;return ct(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return lt(this,void 0,void 0,(function(){var r,i;return ct(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,(o=t,a=e,u=bs(o),u.persistence.runTransaction("read document","readonly",(function(t){return u.Tc.Ho(t,a)})))];case 1:return(i=s.sent())instanceof xo?n.resolve(i):i instanceof wo?n.resolve(null):n.reject(new Cs(Ts.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=s.sent(),i=ul(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}var o,a,u}))}))},[4,ef(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t.S_).then((function(n){return new Ff(e,r,t.S_,n,new Df(n instanceof xo&&n.Vt,!0),t.v_)}))}(this.d_):"server"===(null==t?void 0:t.source)?function(t){t=up(t,pp);var e=up(t.firestore,cf);return of(hf(e),t.S_,{source:"server"}).then((function(n){return Wf(e,t,n)}))}(this.d_):function(t){t=up(t,pp);var e=up(t.firestore,cf);return of(hf(e),t.S_).then((function(n){return Wf(e,t,n)}))}(this.d_)).then((function(t){return new og(e.firestore,new Ff(e.firestore.d_,e.Xf,t.S_,t.Zf,t.metadata,e.d_.v_))}))},e.prototype.withConverter=function(t){return new e(this.firestore,this.d_.withConverter(eg.gd(this.firestore,t)))},e}(ep);function rg(t,e,n){return t.message=t.message.replace(e,n),t}function ig(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!lf(r))return r}return{}}function sg(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=lf(t[0])?t[0]:lf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var og=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r}return at(e,t),Object.defineProperty(e.prototype,"ref",{get:function(){return new ng(this.Yf,this.d_.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.d_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.d_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this.d_.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this.d_.data(t)},e.prototype.get=function(t,e){return this.d_.get(t,e)},e.prototype.isEqual=function(t){return Mf(this.d_,t.d_)},e}(ep),ag=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.data=function(t){return this.d_.data(t)},e}(og),ug=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.Xf=new Jf(e),r}return at(e,t),e.prototype.where=function(t,n,r){try{return new e(this.firestore,wf(this.d_,(s=r,o=n,a=bf("where",i=t),new kf(a,o,s))))}catch(i){throw rg(i,/(orderBy|where)\(\)/,"Query.$1()")}var i,s,o,a},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,wf(this.d_,function(t,e){void 0===e&&(e="asc");var n=e,r=bf("orderBy",t);return new If(r,n)}(t,n)))}catch(r){throw rg(r,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,wf(this.d_,(lp("limit",n=t),new Sf("limit",n,"F"))))}catch(n){throw rg(n,"limit()","Query.limit()")}var n},e.prototype.limitToLast=function(t){try{return new e(this.firestore,wf(this.d_,(lp("limitToLast",n=t),new Sf("limitToLast",n,"L"))))}catch(n){throw rg(n,"limitToLast()","Query.limitToLast()")}var n},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,wf(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Tf("startAt",t,!0)}.apply(void 0,t)))}catch(r){throw rg(r,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,wf(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Tf("startAfter",t,!1)}.apply(void 0,t)))}catch(r){throw rg(r,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,wf(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Cf("endBefore",t,!0)}.apply(void 0,t)))}catch(r){throw rg(r,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,wf(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Cf("endAt",t,!1)}.apply(void 0,t)))}catch(r){throw rg(r,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return vp(this.d_,t.d_)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=up(t,fp);var e=up(t.firestore,cf),n=hf(e),r=new zf(e);return function(t,e){var n=this,r=new Yu;return t._s.Ps((function(){return lt(n,void 0,void 0,(function(){var n;return ct(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return lt(this,void 0,void 0,(function(){var r,i,s,o,a;return ct(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,qc(t,e,!0)];case 1:return a=u.sent(),r=new pd(e,a.Rc),i=r.fl(a.documents),s=r.wi(i,!1),n.resolve(s.snapshot),[3,3];case 2:return o=u.sent(),a=ul(o,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,ef(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t.C_).then((function(n){return new Lf(e,r,t,n)}))}(this.d_):"server"===(null==t?void 0:t.source)?function(t){t=up(t,fp);var e=up(t.firestore,cf),n=hf(e),r=new zf(e);return af(n,t.C_,{source:"server"}).then((function(n){return new Lf(e,r,t,n)}))}(this.d_):function(t){t=up(t,fp);var e=up(t.firestore,cf),n=hf(e),r=new zf(e);return vf(t.C_),af(n,t.C_).then((function(n){return new Lf(e,r,t,n)}))}(this.d_)).then((function(t){return new cg(e.firestore,new Lf(e.firestore.d_,e.Xf,e.d_,t._d))}))},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ig(e),i=sg(e,(function(e){return new cg(t.firestore,new Lf(t.firestore.d_,t.Xf,t.d_,e._d))}));return Uf(this.d_,r,i)},e.prototype.withConverter=function(t){return new e(this.firestore,this.d_.withConverter(eg.gd(this.firestore,t)))},e}(ep),lg=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r}return at(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this.d_.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new ag(this.Yf,this.d_.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this.d_.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this.d_.newIndex},enumerable:!1,configurable:!0}),e}(ep),cg=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r}return at(e,t),Object.defineProperty(e.prototype,"query",{get:function(){return new ug(this.Yf,this.d_.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.d_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.d_.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this.d_.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this.d_.docs.map((function(e){return new ag(t.Yf,e)}))},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var e=this;return this.d_.docChanges(t).map((function(t){return new lg(e.Yf,t)}))},e.prototype.forEach=function(t,e){var n=this;this.d_.forEach((function(r){t.call(e,new ag(n.Yf,r))}))},e.prototype.isEqual=function(t){return Mf(this.d_,t.d_)},e}(ep),hg=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r.d_=n,r}return at(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.d_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.d_.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.d_.parent;return t?new ng(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new ng(this.firestore,void 0===t?yp(this.d_):yp(this.d_,t))}catch(e){throw rg(e,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e,n,r,i,s,o=this;return(e=this.d_,n=t,r=up(e.firestore,cf),i=yp(e),s=_f(e.v_,n),Vf(r,[Ep(Np(e.firestore),"addDoc",i.S_,s,null!==e.v_,{}).F_(i.S_,Sa.exists(!1))]).then((function(){return i}))).then((function(t){return new ng(o.firestore,t)}))},e.prototype.isEqual=function(t){return bp(this.d_,t.d_)},e.prototype.withConverter=function(t){return new e(this.firestore,this.d_.withConverter(eg.gd(this.firestore,t)))},e}(ug);function dg(t){return t instanceof ep&&(t=t.d_),up(t,pp)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var pg,fg=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,new(Zd.bind.apply(Zd,pt([void 0],e))))||this}return at(e,t),e.documentId=function(){return new e(Bs.ht().rt())},e.prototype.isEqual=function(t){return t instanceof ep&&(t=t.d_),t instanceof Zd&&this.d_.f_.isEqual(t.f_)},e}(ep),gg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.serverTimestamp=function(){var t=new _p("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Rp("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ap("arrayUnion",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Dp("arrayRemove",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=new Fp("increment",t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this.d_.isEqual(t.d_)},e}(ep),mg={Firestore:Qf,GeoPoint:xp,Timestamp:Os,Blob:Xf,Transaction:Zf,WriteBatch:tg,DocumentReference:ng,DocumentSnapshot:og,Query:ug,QueryDocumentSnapshot:ag,QuerySnapshot:cg,CollectionReference:hg,FieldPath:fg,FieldValue:gg,setLogLevel:function(t){var e;e=t,cs.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(pg=te).INTERNAL.registerComponent(new Ct("firestore",(function(t){return function(t,e){return new Qf(t,new cf(t,e),new Yf)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},mg))),pg.registerVersion("@firebase/firestore","2.1.7");class yg{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class bg{refCount(t){return vg("refCount")}incRef(t){return vg("incRef")}timerAvailable(){return!0}time(t){return vg("time")}read(t){return vg("read")}readSync(t){return vg("readSync")}readToGPU(t,e){return vg("readToGPU")}numDataIds(){return vg("numDataIds")}disposeData(t,e){return vg("disposeData")}write(t,e,n){return vg("write")}move(t,e,n,r,i){return vg("move")}createTensorFromGPUData(t,e,n){return vg("createTensorFromGPUData")}memory(){return vg("memory")}floatPrecision(){return vg("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return vg("dispose")}}function vg(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xg(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,Ig(t,e,n)}function wg(t,e,n){return Math.max(t,Math.min(e,n))}function kg(t){return t%2==0?t:t+1}function Ig(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function Sg(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function Tg(t,e,n=""){Sg(Eg(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function Cg(t){Sg(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function Ng(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function Eg(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Rg(t){return t%1==0}function $g(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function _g(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function Ag(t,e=(t=>0),n,r){return new Promise(((i,s)=>{let o=0;const a=()=>{if(t())return void i();o++;const u=e(o);null!=n&&o>=n?s():null!=r?r(a,u):setTimeout(a,u)};a()}))}function Dg(t,e){let n=1,r=-1;for(let s=0;s<t.length;++s)if(t[s]>=0)n*=t[s];else if(-1===t[s]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(t[s]<0)throw Error(`Shapes can not be < 0. Found ${t[s]} at dim ${s}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[r]=e/n,i}function Fg(t,e){const n=e.length;return Sg((t=null==t?e.map(((t,e)=>e)):[].concat(t)).every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),Sg(t.every((t=>Rg(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function Og(t,e){const n=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,s=null==e||i?null:Fg(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(null!=s){if(s[o]===a&&1!==t[a])throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(null==s[o]||s[o]>a)&&1===t[a]&&(n.push(t[a]),r.push(a)),s[o]<=a&&o++}1!==t[a]&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function Lg(t,e){return Pg(t,e)}function Pg(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function Mg(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))}function zg(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function Bg(t){return"string"==typeof t||t instanceof String}function Ug(t){return"number"==typeof t}function Vg(t){return Array.isArray(t)?Vg(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":Ug(t)?"float32":Bg(t)?"string":"boolean"==typeof t?"bool":"float32"}function Wg(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Gg(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function jg(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function Hg(t,e,n,r=!1){const i=new Array;if(1===e.length){const s=e[0]*(r?2:1);for(let e=0;e<s;e++)i[e]=n[t+e]}else{const s=e[0],o=e.slice(1),a=o.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<s;e++)i[e]=Hg(t+e*a,o,n,r)}return i}function qg(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return Hg(0,t,e,n)}function Kg(t,e){const n=Xg(t,e);for(let r=0;r<n.length;r++)n[r]=1;return n}function Xg(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function Yg(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return qg(t,new Float32Array(n));if("int32"===e)return qg(t,new Int32Array(n));if("bool"===e)return qg(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function Qg(t){t.forEach((e=>{Sg(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function Jg(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let i=0;i<t.length-1;++i)r+=n[i]*t[i];return r}function Zg(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(t/n[i]),t-=r[i]*n[i];return r[r.length-1]=t,r}function tm(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class em{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=nm,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(rm().getBool("IS_TEST")||rm().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];rm().getBool("IS_TEST")||rm().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(tm(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){const n=e.toLowerCase();return"true"===n||"false"===n?"true"===n:""+ +n===n?+n:e}(0,n)}))}}}function nm(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function rm(){return sm}let im,sm=null;function om(){if(null==im){let t;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}im=t}return im}function am(t,e){const n=function(){const t=om();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function um(...t){rm().getBool("IS_TEST")||rm().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const lm=am("kernelRegistry",(()=>new Map)),cm=am("gradRegistry",(()=>new Map));function hm(t,e){const n=mm(t,e);return lm.get(n)}function dm(t){return cm.get(t)}function pm(t){const e=lm.entries(),n=[];for(;;){const{done:r,value:i}=e.next();if(r)break;const[s,o]=i,[a]=s.split("_");a===t&&n.push(o)}return n}function fm(t){const{kernelName:e,backendName:n}=t,r=mm(e,n);lm.has(r)&&um(`The kernel '${e}' for backend '${n}' is already registered`),lm.set(r,t)}function gm(t){const{kernelName:e}=t;cm.has(e)&&rm().getBool("DEBUG")&&um(`Overriding the gradient for '${e}'`),cm.set(e,t)}function mm(t,e){return`${e}_${t}`}
/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ym(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var bm=xm,vm=null;try{vm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(pg){}function xm(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function wm(t){return!0===(t&&t.__isLong__)}xm.prototype.__isLong__,Object.defineProperty(xm.prototype,"__isLong__",{value:!0}),xm.isLong=wm;var km={},Im={};function Sm(t,e){var n,r,i;return e?(i=0<=(t>>>=0)&&t<256)&&(r=Im[t])?r:(n=Cm(t,(0|t)<0?-1:0,!0),i&&(Im[t]=n),n):(i=-128<=(t|=0)&&t<128)&&(r=km[t])?r:(n=Cm(t,t<0?-1:0,!1),i&&(km[t]=n),n)}function Tm(t,e){if(isNaN(t))return e?Om:Fm;if(e){if(t<0)return Om;if(t>=_m)return Bm}else{if(t<=-Am)return Um;if(t+1>=Am)return zm}return t<0?Tm(-t,e).neg():Cm(t%$m|0,t/$m|0,e)}function Cm(t,e,n){return new xm(t,e,n)}xm.fromInt=Sm,xm.fromNumber=Tm,xm.fromBits=Cm;var Nm=Math.pow;function Em(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return Fm;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Em(t.substring(1),e,n).neg();for(var i=Tm(Nm(n,8)),s=Fm,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),u=parseInt(t.substring(o,o+a),n);if(a<8){var l=Tm(Nm(n,a));s=s.mul(l).add(Tm(u))}else s=(s=s.mul(i)).add(Tm(u))}return s.unsigned=e,s}function Rm(t,e){return"number"==typeof t?Tm(t,e):"string"==typeof t?Em(t,e):Cm(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}xm.fromString=Em,xm.fromValue=Rm;var $m=4294967296,_m=$m*$m,Am=_m/2,Dm=Sm(1<<24),Fm=Sm(0);xm.ZERO=Fm;var Om=Sm(0,!0);xm.UZERO=Om;var Lm=Sm(1);xm.ONE=Lm;var Pm=Sm(1,!0);xm.UONE=Pm;var Mm=Sm(-1);xm.NEG_ONE=Mm;var zm=Cm(-1,2147483647,!1);xm.MAX_VALUE=zm;var Bm=Cm(-1,-1,!0);xm.MAX_UNSIGNED_VALUE=Bm;var Um=Cm(0,-2147483648,!1);xm.MIN_VALUE=Um;var Vm=xm.prototype;Vm.toInt=function(){return this.unsigned?this.low>>>0:this.low},Vm.toNumber=function(){return this.unsigned?(this.high>>>0)*$m+(this.low>>>0):this.high*$m+(this.low>>>0)},Vm.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Um)){var e=Tm(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=Tm(Nm(t,6),this.unsigned),s=this,o="";;){var a=s.div(i),u=(s.sub(a.mul(i)).toInt()>>>0).toString(t);if((s=a).isZero())return u+o;for(;u.length<6;)u="0"+u;o=""+u+o}},Vm.getHighBits=function(){return this.high},Vm.getHighBitsUnsigned=function(){return this.high>>>0},Vm.getLowBits=function(){return this.low},Vm.getLowBitsUnsigned=function(){return this.low>>>0},Vm.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Um)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},Vm.isZero=function(){return 0===this.high&&0===this.low},Vm.eqz=Vm.isZero,Vm.isNegative=function(){return!this.unsigned&&this.high<0},Vm.isPositive=function(){return this.unsigned||this.high>=0},Vm.isOdd=function(){return 1==(1&this.low)},Vm.isEven=function(){return 0==(1&this.low)},Vm.equals=function(t){return wm(t)||(t=Rm(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},Vm.eq=Vm.equals,Vm.notEquals=function(t){return!this.eq(t)},Vm.neq=Vm.notEquals,Vm.ne=Vm.notEquals,Vm.lessThan=function(t){return this.comp(t)<0},Vm.lt=Vm.lessThan,Vm.lessThanOrEqual=function(t){return this.comp(t)<=0},Vm.lte=Vm.lessThanOrEqual,Vm.le=Vm.lessThanOrEqual,Vm.greaterThan=function(t){return this.comp(t)>0},Vm.gt=Vm.greaterThan,Vm.greaterThanOrEqual=function(t){return this.comp(t)>=0},Vm.gte=Vm.greaterThanOrEqual,Vm.ge=Vm.greaterThanOrEqual,Vm.compare=function(t){if(wm(t)||(t=Rm(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Vm.comp=Vm.compare,Vm.negate=function(){return!this.unsigned&&this.eq(Um)?Um:this.not().add(Lm)},Vm.neg=Vm.negate,Vm.add=function(t){wm(t)||(t=Rm(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,u=0,l=0,c=0,h=0;return c+=(h+=i+(65535&t.low))>>>16,l+=(c+=r+a)>>>16,u+=(l+=n+o)>>>16,u+=e+s,Cm((c&=65535)<<16|(h&=65535),(u&=65535)<<16|(l&=65535),this.unsigned)},Vm.subtract=function(t){return wm(t)||(t=Rm(t)),this.add(t.neg())},Vm.sub=Vm.subtract,Vm.multiply=function(t){if(this.isZero())return Fm;if(wm(t)||(t=Rm(t)),vm)return Cm(vm.mul(this.low,this.high,t.low,t.high),vm.get_high(),this.unsigned);if(t.isZero())return Fm;if(this.eq(Um))return t.isOdd()?Um:Fm;if(t.eq(Um))return this.isOdd()?Um:Fm;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Dm)&&t.lt(Dm))return Tm(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,u=65535&t.low,l=0,c=0,h=0,d=0;return h+=(d+=i*u)>>>16,c+=(h+=r*u)>>>16,h&=65535,c+=(h+=i*a)>>>16,l+=(c+=n*u)>>>16,c&=65535,l+=(c+=r*a)>>>16,c&=65535,l+=(c+=i*o)>>>16,l+=e*u+n*a+r*o+i*s,Cm((h&=65535)<<16|(d&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},Vm.mul=Vm.multiply,Vm.divide=function(t){if(wm(t)||(t=Rm(t)),t.isZero())throw Error("division by zero");var e,n,r;if(vm)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?Cm((this.unsigned?vm.div_u:vm.div_s)(this.low,this.high,t.low,t.high),vm.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Om:Fm;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Om;if(t.gt(this.shru(1)))return Pm;r=Om}else{if(this.eq(Um))return t.eq(Lm)||t.eq(Mm)?Um:t.eq(Um)?Lm:(e=this.shr(1).div(t).shl(1)).eq(Fm)?t.isNegative()?Lm:Mm:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(Um))return this.unsigned?Om:Fm;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=Fm}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),s=i<=48?1:Nm(2,i-48),o=Tm(e),a=o.mul(t);a.isNegative()||a.gt(n);)a=(o=Tm(e-=s,this.unsigned)).mul(t);o.isZero()&&(o=Lm),r=r.add(o),n=n.sub(a)}return r},Vm.div=Vm.divide,Vm.modulo=function(t){return wm(t)||(t=Rm(t)),vm?Cm((this.unsigned?vm.rem_u:vm.rem_s)(this.low,this.high,t.low,t.high),vm.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},Vm.mod=Vm.modulo,Vm.rem=Vm.modulo,Vm.not=function(){return Cm(~this.low,~this.high,this.unsigned)},Vm.and=function(t){return wm(t)||(t=Rm(t)),Cm(this.low&t.low,this.high&t.high,this.unsigned)},Vm.or=function(t){return wm(t)||(t=Rm(t)),Cm(this.low|t.low,this.high|t.high,this.unsigned)},Vm.xor=function(t){return wm(t)||(t=Rm(t)),Cm(this.low^t.low,this.high^t.high,this.unsigned)},Vm.shiftLeft=function(t){return wm(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Cm(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Cm(0,this.low<<t-32,this.unsigned)},Vm.shl=Vm.shiftLeft,Vm.shiftRight=function(t){return wm(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Cm(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Cm(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Vm.shr=Vm.shiftRight,Vm.shiftRightUnsigned=function(t){if(wm(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?Cm(this.low>>>t|e<<32-t,e>>>t,this.unsigned):Cm(32===t?e:e>>>t-32,0,this.unsigned)},Vm.shru=Vm.shiftRightUnsigned,Vm.shr_u=Vm.shiftRightUnsigned,Vm.toSigned=function(){return this.unsigned?Cm(this.low,this.high,!1):this},Vm.toUnsigned=function(){return this.unsigned?this:Cm(this.low,this.high,!0)},Vm.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Vm.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},Vm.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},xm.fromBytes=function(t,e,n){return n?xm.fromBytesLE(t,e):xm.fromBytesBE(t,e)},xm.fromBytesLE=function(t,e){return new xm(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},xm.fromBytesBE=function(t,e){return new xm(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var Wm=Object.freeze(Object.assign(Object.create(null),bm,{[Symbol.toStringTag]:"Module",default:bm}));
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gm=bm||Wm;function jm(t){return Gm.fromString(t,!0,16)}const Hm=jm("c3a5c85c97cb3127"),qm=jm("b492b66fbe98f273"),Km=jm("9ae16a3b2f90404f");function Xm(t){return t.xor(t.shru(47))}function Ym(t,e,n){const r=t.slice(e,e+n);return Gm.fromBytes(Array.from(r),!0,!0)}function Qm(t,e){return Ym(t,e,8)}function Jm(t,e){return Ym(t,e,4)}function Zm(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function ty(t,e,n=jm("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let i=e.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function ey(t,e,n,r){return function(t,e,n,r,i,s){i=i.add(t),s=Zm(s.add(i).add(r),21);const o=i;return i=(i=i.add(e)).add(n),s=s.add(Zm(i,44)),[i.add(r),s.add(o)]}(Qm(t,e),Qm(t,e+8),Qm(t,e+16),Qm(t,e+24),n,r)}function ny(t,e=t.length){const n=Gm.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=Km.add(2*e),r=Qm(t,0).add(Km),i=Qm(t,e-8);return ty(Zm(i,37).mul(n).add(r),Zm(r,25).add(i).mul(n),n)}if(e>=4){const n=Km.add(2*e);return ty(Jm(t,0).shl(3).add(e),Jm(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return Xm(Km.mul(n).xor(Hm.mul(r))).mul(Km)}return Km}(t,e):function(t,e=t.length){const n=Km.add(2*e),r=Qm(t,0).mul(qm),i=Qm(t,8),s=Qm(t,e-8).mul(n),o=Qm(t,e-16).mul(Km);return ty(Zm(r.add(i),43).add(Zm(s,30)).add(o),r.add(Zm(i.add(Km),18)).add(s),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=Km.add(2*e),r=Qm(t,0).mul(Km),i=Qm(t,8),s=Qm(t,e-8).mul(n),o=Qm(t,e-16).mul(Km),a=Zm(r.add(i),43).add(Zm(s,30)).add(o),u=ty(a,r.add(Zm(i.add(Km),18)).add(s),n),l=Qm(t,16).mul(n),c=Qm(t,24),h=a.add(Qm(t,e-32)).mul(n),d=u.add(Qm(t,e-24)).mul(n);return ty(Zm(l.add(c),43).add(Zm(h,30)).add(d),l.add(Zm(c.add(r),18)).add(h),n)}(t,e);let r=n,i=n.mul(qm).add(113),s=Xm(i.mul(Km).add(113)).mul(Km),o=[Gm.UZERO,Gm.UZERO],a=[Gm.UZERO,Gm.UZERO];r=r.mul(Km).add(Qm(t,0));let u=0;const l=64*(e-1>>6),c=l+(e-1&63)-63;do{r=Zm(r.add(i).add(o[0]).add(Qm(t,u+8)),37).mul(qm),i=Zm(i.add(o[1]).add(Qm(t,u+48)),42).mul(qm),r=r.xor(a[1]),i=i.add(o[0]).add(Qm(t,u+40)),s=Zm(s.add(a[0]),33).mul(qm),o=ey(t,u,o[1].mul(qm),r.add(a[0])),a=ey(t,u+32,s.add(a[1]),i.add(Qm(t,u+16))),[s,r]=[r,s],u+=64}while(u!==l);const h=qm.add(s.and(255).shl(1));return u=c,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=Zm(r.add(i).add(o[0]).add(Qm(t,u+8)),37).mul(h),i=Zm(i.add(o[1]).add(Qm(t,u+48)),42).mul(h),r=r.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(Qm(t,u+40))),s=Zm(s.add(a[0]),33).mul(h),o=ey(t,u,o[1].mul(h),r.add(a[0])),a=ey(t,u+32,s.add(a[1]),i.add(Qm(t,u+16))),[s,r]=[r,s],ty(ty(o[0],a[0],h).add(Xm(i).mul(Hm)).add(s),ty(o[1],a[1],h).add(r),h)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ry(t,e){return"string"===e?oy(t):iy([t],e)}function iy(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=ly(t)),rm().getBool("DEBUG")&&function(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function sy(){return rm().platform.now()}function oy(t,e="utf-8"){return e=e||"utf-8",rm().platform.encode(t,e)}function ay(t,e="utf-8"){return e=e||"utf-8",rm().platform.decode(t,e)}function uy(t){return null!=rm().platform.isTypedArray?rm().platform.isTypedArray(t):ym(t)}function ly(t,e=[],n=!1){if(null==e&&(e=[]),"boolean"==typeof t||"number"==typeof t||"string"==typeof t||tm(t)||null==t||uy(t)&&n)e.push(t);else if(Array.isArray(t)||uy(t))for(let r=0;r<t.length;++r)ly(t[r],e,n);else{let r=-1;for(const e of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(e)&&(r=Math.max(r,Number(e)));for(let i=0;i<=r;i++)ly(t[i],e,n)}return e}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cy{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new dy)}profileKernel(t,e,n){let r;const i=()=>{r=n()};let s;const o=sy();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(const t of r)t.dataSync();s=Promise.resolve({kernelMs:sy()-o})}if(rm().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let a=0;a<r.length;a++){const e=r[a];e.data().then((n=>{hy(n,e.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:s.then((t=>t.kernelMs)),extraInfo:s.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:i,extraInfo:s}=t;n.forEach((t=>{Promise.all([t.data(),r,s]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],i,n[2])}))}))}}function hy(t,e,n){if("float32"!==e)return!1;for(let r=0;r<t.length;r++){const e=t[r];if(isNaN(e)||!isFinite(e))return console.warn(`Found ${e} in the result of '${n}'`),!0}return!1}class dy{logKernelProfile(t,e,n,r,i,s){const o="number"==typeof r?_g(`${r}ms`,9):r.error,a=_g(t,25),u=e.rank,l=e.size,c=_g(e.shape.toString(),14);let h="";for(const d in i){const t=i[d];if(null!=t){const n=t.shape||e.shape,r=n.length;h+=`${d}: ${r}D ${r>0?n:""} `}}console.log(`%c${a}\t%c${o}\t%c${u}D ${c}\t%c${l}\t%c${h}\t%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function py(t,e,n,r){const i=jg(e),s=function(t,e,n,r){const i=Ng(e),s=r[r.length-1],o=new Array(s).fill(0),a=e.length,u="complex64"===n?yy(t):t;if(a>1)for(let l=0;l<i/s;l++){const t=l*s;for(let e=0;e<s;e++)o[e]=Math.max(o[e],fy(u[t+e],0,n).length)}return o}(t,e,n,i),o=e.length,a=my(t,e,n,i,s),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function fy(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:Bg(t)?`'${t}'`:"bool"===n?gy(t):parseFloat(t.toFixed(7)).toString(),_g(r,e)}function gy(t){return 0===t?"false":"true"}function my(t,e,n,r,i,s=!0){const o="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[fy(yy(t)[0],0,n)]}return"bool"===n?[gy(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*o;let r=Array.from(t.slice(0,e)),s=Array.from(t.slice((a-3)*o,a*o));return"complex64"===n&&(r=yy(r),s=yy(s)),["["+r.map(((t,e)=>fy(t,i[e],n))).join(", ")+", ..., "+s.map(((t,e)=>fy(t,i[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?yy(t):Array.from(t)).map(((t,e)=>fy(t,i[e],n))).join(", ")+"]"]}const l=e.slice(1),c=r.slice(1),h=r[0]*o,d=[];if(a>20){for(let e=0;e<3;e++){const r=e*h,s=r+h;d.push(...my(t.slice(r,s),l,n,c,i,!1))}d.push("...");for(let e=a-3;e<a;e++){const r=e*h,s=r+h;d.push(...my(t.slice(r,s),l,n,c,i,e===a-1))}}else for(let g=0;g<a;g++){const e=g*h,r=e+h;d.push(...my(t.slice(e,r),l,n,c,i,g===a-1))}const p=2===u?",":"";d[0]="["+(a>0?d[0]+p:"");for(let g=1;g<d.length-1;g++)d[g]=" "+d[g]+p;let f=",\n";for(let g=2;g<u;g++)f+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(s?"":f),d}function yy(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class by{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=Ng(t),null!=n){const t=n.length;Sg(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Pg(e,this.size),this.strides=jg(t)}set(t,...e){0===e.length&&(e=[0]),Sg(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const r of t){if(r<0||r>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return vy().makeTensor(this.values,this.shape,this.dtype)}}let vy=null,xy=null;class wy{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Ng(t),this.strides=jg(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return xy.buffer(this.shape,this.dtype,t)}bufferSync(){return xy.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return qg(this.shape,t,"complex64"===this.dtype)}arraySync(){return qg(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=vy().read(this.dataId);if("string"===this.dtype){const n=await t;try{return n.map((t=>ay(t)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),vy().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=vy().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>ay(t)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await vy().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(vy().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return xy.print(this,t)}clone(){return this.throwIfDisposed(),xy.clone(this)}toString(t=!1){return py(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),xy.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),vy().makeVariable(this,t,e,n)}}function ky(){return am("Tensor",(()=>wy))}Object.defineProperty(wy,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),ky();class Iy extends wy{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!Eg(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);vy().disposeTensor(this),this.dataId=t.dataId,vy().incRef(this,null)}dispose(){vy().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Sy,Ty,Cy,Ny,Ey,Ry,$y,_y,Ay,Dy;Object.defineProperty(Iy,Symbol.hasInstance,{value:t=>t instanceof wy&&null!=t.assign&&t.assign instanceof Function}),(Ty=Sy||(Sy={})).R0="R0",Ty.R1="R1",Ty.R2="R2",Ty.R3="R3",Ty.R4="R4",Ty.R5="R5",Ty.R6="R6",(Ny=Cy||(Cy={})).float32="float32",Ny.int32="int32",Ny.bool="int32",Ny.complex64="complex64",(Ry=Ey||(Ey={})).float32="float32",Ry.int32="int32",Ry.bool="bool",Ry.complex64="complex64",(_y=$y||($y={})).float32="float32",_y.int32="float32",_y.bool="float32",_y.complex64="complex64",(Dy=Ay||(Ay={})).float32="complex64",Dy.int32="complex64",Dy.bool="complex64",Dy.complex64="complex64";const Fy={float32:$y,int32:Cy,bool:Ey,complex64:Ay};function Oy(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Fy[t][e]}function Ly(t){return Oy(t,"int32")}function Py(t){return null!=t&&"object"==typeof t&&"texture"in t&&t.texture instanceof WebGLTexture}function My(t){return"undefined"!=typeof GPUBuffer&&null!=t&&"object"==typeof t&&"buffer"in t&&t.buffer instanceof GPUBuffer}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zy(t,e){if(t.dtype===e.dtype)return[t,e];const n=Oy(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function By(t){const e=[];return Uy(t,e,new Set),e}function Uy(t,e,n){if(null==t)return;if(t instanceof wy)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i=t;for(const s in i){const t=i[s];n.has(t)||(n.add(t),Uy(t,e,n))}}function Vy(t){return null!=t.kernelName}class Wy{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Gy{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Wy}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void(await this.setBackend(n))}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(um(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new cy(this.backendInstance),!0}setupRegisteredKernels(){pm(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){pm(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof bg||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,um(`Initialization of backend ${t} failed`),um(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(n){return um(`Initialization of backend ${t} failed`),um(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e),s=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,i,n.shape,n.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(r){throw e(),r}}nextTensorId(){return Gy.nextTensorId++}nextVariableId(){return Gy.nextVariableId++}clone(t){const e=Hy.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return Hy.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=hm(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let i=0;n.forEach((t=>{i+="complex64"===t.dtype?3:1}));const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-e-i-s;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),i=this.state.numBytes,s=this.state.numTensors;let o,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=Vy(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Vy(t)){const{kernelName:e,inputs:i,attrs:s}=t;null==this.backendName&&this.backend;const u=hm(e,this.backendName);Sg(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),o=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:i,attrs:s,backend:this.backend});const o=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,o);const l=o.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,i,l);n=this.saveTensorsForBackwardMode(t)}return l}}else{const{forwardFunc:e}=t,i=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};o=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,i)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:l,attrs:c}=t,h=Vy(t)?null:t.backwardsFunc;let d;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(d=this.profiler.profileKernel(u,l,(()=>o())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),e=d.outputs):e=o()})),r&&this.addTapeNode(u,l,e,h,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map((t=>null!=l[t]?l[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){return t.map((t=>this.keep(this.clone(t))))}getTensorsForGradient(t,e,n){const r=dm(t);if(null!=r){const t=r.inputsToSave||[],i=r.outputsToSave||[];let s;r.saveAllInputs?(Sg(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),s=Object.keys(e).map((t=>e[t]))):s=t.map((t=>e[t]));const o=n.filter(((t,e)=>i[e]));return s.concat(o)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let i=t;"string"===n&&Bg(t[0])&&(i=t.map((t=>oy(t))));const s=r.write(i,e,n),o=new wy(e,n,s,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){const t=this.state.tensorInfo.get(s),e=function(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}(i);this.state.numBytes+=e-t.bytes,t.bytes=e}return o}makeTensorFromDataId(t,e,n,r){const i={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:i}=t,s=new wy(r,i,n,this.nextTensorId());return this.trackTensor(s,e),s}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const i=new Iy(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*zg(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof Iy||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*zg(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,i,s){const o={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},a=dm(t);null!=a&&(r=a.gradFunc),null!=r&&(o.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=Xg(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],i,s))),this.state.activeTape.push(o)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=By(t),n=new Set(e.map((t=>t.id)));for(let i=0;i<this.state.activeScope.track.length;i++){const t=this.state.activeScope.track[i];t.kept||n.has(t.id)||t.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(Sg(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));Sg(i instanceof wy,(()=>"The result y returned by f() must be a tensor."));const s=function(t,e,n){const r={},i={};for(let u=0;u<e.length;u++)r[e[u].id]=!0;for(let u=0;u<t.length;u++){const n=t[u],s=n.inputs;for(const t in s){const o=s[t];let a=!1;for(let t=0;t<e.length;t++)if(r[o.id]){n.outputs.forEach((t=>r[t.id]=!0)),a=!0,i[n.id]=!0;break}if(a)break}}const s={};s[n.id]=!0;const o={};for(let u=t.length-1;u>=0;u--){const e=t[u],n=e.inputs;for(let t=0;t<e.outputs.length;t++)if(s[e.outputs[t].id]){for(const t in n)s[n[t].id]=!0,o[e.id]=!0;break}}const a=[];for(let u=0;u<t.length;u++){const e=t[u];if(i[e.id]&&o[e.id]){const t={};for(const i in e.inputs){const n=e.inputs[i];r[n.id]&&(t[i]=n)}const n=Object.assign({},e);n.inputs=t,n.outputs=e.outputs,a.push(n)}}return a}(this.state.activeTape,e,i);if(!r&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[i.id]=null==n?function(t){const e=Kg(Ng(t),"float32");return Hy.makeTensor(e,t,"float32")}(i.shape):n,function(t,e,n,r){for(let i=e.length-1;i>=0;i--){const s=e[i],o=[];if(s.outputs.forEach((e=>{const n=t[e.id];null!=n?o.push(n):o.push(null)})),null==s.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const e in s.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const i=n((()=>a[e]()));if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${i.dtype}'`);const o=s.inputs[e];if(!Eg(i.shape,o.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${e}' has shape '${i.shape}', which does not match the shape of the input '${o.shape}'`);if(null==t[o.id])t[o.id]=i;else{const e=t[o.id];t[o.id]=r(e,i),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,s,(t=>this.tidy(t)),qy);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:i,grads:r}}))}customGrad(t){return Sg(Wg(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;Sg(e.every((t=>t instanceof wy)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,i)=>(n=t(...e,i),Sg(n.value instanceof wy,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),Sg(Wg(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const i=n.gradFunc(t,r),s=Array.isArray(i)?i:[i];Sg(s.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),Sg(s.every((t=>t instanceof wy)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const o={};return s.forEach(((t,e)=>{o[e]=()=>t})),o},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=sy(),n=await this.backend.time(t);return n.wallMs=sy()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Wy;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function jy(){const t=om();if(null==t._tfengine){const e=new em(t);t._tfengine=new Gy(e)}var e;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */return e=t._tfengine.ENV,sm=e,vy=()=>t._tfengine,t._tfengine}Gy.nextTensorId=0,Gy.nextVariableId=0;const Hy=jy();function qy(t,e){const n={a:t,b:e};return Hy.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ky(t){if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Xy(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yy=rm();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Qy(t,e){let n=t;if(uy(t))return"string"===e?[]:[t.length];if(Py(t)){const e=t.channels||"RGBA";return[t.height,t.width*e.length]}if(My(t))return[t.buffer.size/(null==e?4:zg(e))];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||uy(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&rm().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Jy(t,r,[]),r}function Jy(t,e,n){if(n=n||[],!Array.isArray(t)&&!uy(t))return void Sg(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));Sg(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),Sg(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let i=0;i<t.length;++i)Jy(t[i],r,n.concat(i))}function Zy(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function tb(t,e,n,r="numeric"){if(t instanceof wy)return Zy(r,t.dtype,e,n),t;let i=Vg(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Zy(r,i,e,n),null==t||!uy(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const s=Qy(t,i);uy(t)||Array.isArray(t)||(t=[t]);const o="string"!==i?iy(t,i):ly(t,[],!0);return Hy.makeTensor(o,s,i)}function eb(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,i)=>tb(t,`${e}[${i}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Yy.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Yy.registerFlag("IS_BROWSER",(()=>Xy())),Yy.registerFlag("IS_NODE",(()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node)),Yy.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),Yy.registerFlag("IS_SAFARI",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor))),Yy.registerFlag("PROD",(()=>!1)),Yy.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>Yy.getBool("DEBUG"))),Yy.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),Yy.registerFlag("IS_TEST",(()=>!1)),Yy.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>Yy.getBool("DEBUG"))),Yy.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),Yy.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(()=>!1)),Yy.registerFlag("USE_SETTIMEOUTCUSTOM",(()=>!1));function nb(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const i=(...t)=>{Hy.startScope(n);try{const e=r(...t);return tm(e)&&console.error("Cannot return a Promise inside of tidy."),Hy.endScope(e),e}catch(e){throw Hy.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rb=nb({complex_:function(t,e){const n=tb(t,"real","complex"),r=tb(e,"imag","complex");Tg(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const i={real:n,imag:r};return Hy.runKernel("Complex",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ib(t,e,n,r){if(null==r)r=Vg(t);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(My(t)||Py(t)){if("float32"!==r&&"int32"!==r)throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return Hy.backend.createTensorFromGPUData(t,e||n,r)}if(!uy(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Qg(e);const t=Ng(e),r=Ng(n);Sg(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let i=0;i<n.length;++i){const t=n[i],r=i!==n.length-1||t!==Ng(e.slice(i));Sg(n[i]===e[i]||!r,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return uy(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?iy(t,r):ly(t,[],!0),Hy.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sb(t,e,n){return ib(t,e,Qy(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ob={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function ab(t,e){const n=[],r=[],i=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let s=0;s<i.length;++s){const o=i[s],a=Array.isArray(t)?t[s].tensor:t[o];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${o}': ${a.dtype}`);const u={name:o,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let i=0;for(let s=0;s<e.length;s++){const t=e[s],n=new Uint8Array(new Uint32Array([t.length]).buffer);r.set(n,i),i+=4,r.set(t,i),i+=t.length}t(r)}));r.push(t)}else r.push(a.data());null!=e&&(u.group=e),n.push(u)}return{data:ub(await Promise.all(r)),specs:n}}function ub(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let i=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),i),i+=t.byteLength})),r.buffer}const lb="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function cb(t){return lb?Buffer.byteLength(t):new Blob([t]).size}function hb(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function db(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.initializerSignature&&(n.initializerSignature=t.initializerSignature),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}async function pb(t,e){let n,r;return null!=t.weightsManifest&&([n,r]=await e(t.weightsManifest)),function(t,e,n){const r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(r.trainingConfig=t.trainingConfig),null!=t.weightsManifest){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=n}return null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),null!=t.initializerSignature&&(r.initializerSignature=t.initializerSignature),r}(t,n,r)}function fb(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:cb(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:cb(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function gb(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let o=0;o<r.length;o++){const i=r[o],a=t[n[i>>10]+(1023&i)]+e[i>>10];s[o]=a}return new Float32Array(i)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mb{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==mb.instance&&(mb.instance=new mb),mb.instance}static registerSaveRouter(t){mb.getInstance().saveRouters.push(t)}static registerLoadRouter(t){mb.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return mb.getHandlers(t,"save")}static getLoadHandlers(t,e){return mb.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?mb.getInstance().loadRouters:mb.getInstance().saveRouters).forEach((e=>{const i=e(t,n);null!==i&&r.push(i)})),r}}function yb(){if(!rm().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function bb(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class vb{constructor(t){if(this.indexedDB=yb(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>bb(r),r.onsuccess=()=>{const i=r.result;if(null==e){const e=i.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(i.close(),n(r.error)),e.oncomplete=()=>i.close()}else{const r=fb(e),o=i.transaction("model_info_store","readwrite");let a,u,l=o.objectStore("model_info_store");try{a=l.put({modelPath:this.modelPath,modelArtifactsInfo:r})}catch(s){return n(s)}a.onsuccess=()=>{u=i.transaction("models_store","readwrite");const a=u.objectStore("models_store");let c;try{c=a.put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r})}catch(s){return n(s)}c.onsuccess=()=>t({modelArtifactsInfo:r}),c.onerror=t=>{l=o.objectStore("model_info_store");const e=l.delete(this.modelPath);e.onsuccess=()=>(i.close(),n(c.error)),e.onerror=t=>(i.close(),n(c.error))}},a.onerror=t=>(i.close(),n(a.error)),o.oncomplete=()=>{null==u?i.close():u.oncomplete=()=>i.close()}}},r.onerror=t=>n(r.error)}))}}vb.URL_SCHEME="indexeddb://";const xb=t=>{return rm().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(vb.URL_SCHEME)?(e=t.slice(vb.URL_SCHEME.length),new vb(e)):null;var e};mb.registerSaveRouter(xb),mb.registerLoadRouter(xb);class wb{constructor(){this.indexedDB=yb()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>bb(n),n.onsuccess=()=>{const r=n.result,i=r.transaction("model_info_store","readonly"),s=i.objectStore("model_info_store").getAll();s.onsuccess=()=>{const e={};for(const t of s.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},s.onerror=t=>(r.close(),e(s.error)),i.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(vb.URL_SCHEME)?e.slice(vb.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>bb(r),r.onsuccess=()=>{const i=r.result,s=i.transaction("model_info_store","readwrite"),o=s.objectStore("model_info_store"),a=o.get(t);let u;a.onsuccess=()=>{if(null==a.result)return i.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=o.delete(t),s=()=>{u=i.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=s,r.onerror=t=>(s(),i.close(),n(a.error))}},a.onerror=t=>(i.close(),n(a.error)),s.oncomplete=()=>{null==u?i.close():u.oncomplete=()=>i.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kb="tensorflowjs_models",Ib="info",Sb="model_topology",Tb="weight_specs",Cb="weight_data",Nb="model_metadata";function Eb(t){return{info:[kb,t,Ib].join("/"),topology:[kb,t,Sb].join("/"),weightSpecs:[kb,t,Tb].join("/"),weightData:[kb,t,Cb].join("/"),modelMetadata:[kb,t,Nb].join("/")}}function Rb(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function $b(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class _b{constructor(t){if(!rm().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Eb(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),i=fb(t);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(t){if(lb)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let r=0,i=e.length;r<i;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(t.weightData));const e={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,initializerSignature:null!=t.initializerSignature?t.initializerSignature:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(e)),{modelArtifactsInfo:i}}catch(e){throw Rb(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const t=JSON.parse(i);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.initializerSignature&&(e.initializerSignature=t.initializerSignature),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const s=this.LS.getItem(this.keys.weightData);if(null==s)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(lb){const e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;++r)n.set([e.charCodeAt(r)],r);return n.buffer}(s),e}}_b.URL_SCHEME="localstorage://";const Ab=t=>{return rm().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(_b.URL_SCHEME)?(e=t.slice(_b.URL_SCHEME.length),new _b(e)):null;var e};mb.registerSaveRouter(Ab),mb.registerLoadRouter(Ab);class Db{constructor(){Sg(rm().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),Sg("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=kb+"/",n="/"+Ib;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(e)&&i.endsWith(n)){t[$b(i)]=JSON.parse(this.LS.getItem(i))}}return t}async removeModel(t){var e;const n=Eb(t=(e=t).startsWith(_b.URL_SCHEME)?e.slice(_b.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return Rb(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fb{constructor(){this.managers={}}static getInstance(){return null==Fb.instance&&(Fb.instance=new Fb),Fb.instance}static registerManager(t,e){Sg(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),Sg(t.length>0,(()=>"scheme must not be an empty string."));const n=Fb.getInstance();Sg(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=Fb.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(Fb.getInstance().managers)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ob{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){"undefined"!=typeof window&&rm().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(t),setTimeout((()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")}),e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(t=>{if(t.source===window&&t.data.name===this.messageName){t.stopPropagation();(0,this.functionRefs[t.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}}),!0))):setTimeout(t,e)}isTypedArray(t){return ym(t)}}if(rm().get("IS_BROWSER")){rm().setPlatform("browser",new Ob);try{Fb.registerManager(_b.URL_SCHEME,new Db)}catch(zj){}try{Fb.registerManager(vb.URL_SCHEME,new wb)}catch(zj){}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lb=()=>require("node-fetch");let Pb;class Mb{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=rm().global.fetch?rm().global.fetch(t,e):(null==Pb&&(Pb=Lb()),Pb(t,e))}now(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zb(t,e="float32",n){return e=e||"float32",Qg(t),new by(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */rm().get("IS_NODE")&&!rm().get("IS_BROWSER")&&rm().setPlatform("node",new Mb);const Bb=nb({cast_:function(t,e){const n=tb(t,"x","cast");if(!function(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:e};return Hy.runKernel("Cast",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ub=nb({clone_:function(t){const e={x:tb(t,"x","clone","string_or_numeric")};return Hy.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
jy();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Vb(){return Hy}function Wb(){return Hy.memory()}function Gb(t,e){return Hy.tidy(t,e)}function jb(t){By(t).forEach((t=>t.dispose()))}function Hb(t){return Hy.keep(t)}function qb(t,e,n=1){return Hy.registerBackend(t,e,n)}xy={buffer:zb,cast:Bb,clone:Ub,print:function(t,e=!1){console.log(t.toString(e))}};const Kb=nb({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=tb(t,"a","add"),r=tb(e,"b","add");[n,r]=zy(n,r);const i={a:n,b:r};return Hy.runKernel("Add",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xb=nb({floorDiv_:function(t,e){let n=tb(t,"a","floorDiv"),r=tb(e,"b","floorDiv");[n,r]=zy(n,r);const i={a:n,b:r};return Hy.runKernel("FloorDiv",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yb=nb({div_:function(t,e){let n=tb(t,"a","div"),r=tb(e,"b","div");if([n,r]=zy(n,r),"int32"===n.dtype&&"int32"===r.dtype)return Xb(n,r);const i={a:n,b:r};return Hy.runKernel("RealDiv",i,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qb=nb({mul_:function(t,e){let n=tb(t,"a","mul"),r=tb(e,"b","mul");[n,r]=zy(n,r);const i={a:n,b:r};return Hy.runKernel("Multiply",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jb=nb({abs_:function(t){const e=tb(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return Hy.runKernel("ComplexAbs",t)}{const t={x:e};return Hy.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zb=nb({acos_:function(t){const e={x:tb(t,"x","acos")};return Hy.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tv=nb({acosh_:function(t){const e={x:tb(t,"x","acosh")};return Hy.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ev=nb({all_:function(t,e=null,n=!1){const r={x:tb(t,"x","all","bool")},i={axis:e,keepDims:n};return Hy.runKernel("All",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nv=nb({any_:function(t,e=null,n=!1){const r={x:tb(t,"x","any","bool")},i={axis:e,keepDims:n};return Hy.runKernel("Any",r,i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rv=nb({argMax_:function(t,e=0){const n={x:tb(t,"x","argMax")},r={axis:e};return Hy.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iv=nb({argMin_:function(t,e=0){const n={x:tb(t,"x","argMin")},r={axis:e};return Hy.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sv=nb({asin_:function(t){const e={x:tb(t,"x","asin")};return Hy.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ov=nb({asinh_:function(t){const e={x:tb(t,"x","asinh")};return Hy.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const av=nb({atan_:function(t){const e={x:tb(t,"x","atan")};return Hy.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uv=nb({atan2_:function(t,e){let n=tb(t,"a","atan2"),r=tb(e,"b","atan2");[n,r]=zy(n,r);const i={a:n,b:r};return Hy.runKernel("Atan2",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lv=nb({atanh_:function(t){const e={x:tb(t,"x","atanh")};return Hy.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cv(t,e,n,r,i="NHWC",s){return pv(t,[...e,t[3]],n,s,r,null,null,Iv(i))}function hv(t,e,n,r,i,s,o="channelsLast"){const[a,u]=mv(e);let l;if("channelsLast"===o)l=[a,u,t[3],t[3]];else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);l=[a,u,t[1],t[1]]}return pv(t,l,n,r,i,s,!1,o)}function dv(t,e,n,r,i,s,o="NDHWC"){const[a,u,l]=yv(e);let c,h;if("NDHWC"===o)h="channelsLast",c=[a,u,l,t[4],t[4]];else{if("NCDHW"!==o)throw new Error(`Unknown dataFormat ${o}`);h="channelsFirst",c=[a,u,l,t[1],t[1]]}return fv(t,c,n,r,i,!1,h,s)}function pv(t,e,n,r,i,s,o=!1,a="channelsLast"){let[u,l,c,h]=[-1,-1,-1,-1];if("channelsLast"===a)[u,l,c,h]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,h,l,c]=t}const[d,p,,f]=e,[g,m]=mv(n),[y,b]=mv(r),v=bv(d,y),x=bv(p,b),{padInfo:w,outHeight:k,outWidth:I}=function(t,e,n,r,i,s,o,a,u){let l,c,h;if("number"==typeof t){l={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const i=function(t,e,n,r,i){null==r&&(r=gv(t,e,n));const s=t[0],o=t[1],a=vv((s-e+2*r)/n+1,i),u=vv((o-e+2*r)/n+1,i);return[a,u]}([e,n],s,r,t,a);c=i[0],h=i[1]}else if("same"===t){c=Math.ceil(e/r),h=Math.ceil(n/i);const t=Math.max(0,(c-1)*r+s-e),a=Math.max(0,(h-1)*i+o-n),u=Math.floor(t/2),d=t-u,p=Math.floor(a/2);l={top:u,bottom:d,left:p,right:a-p,type:"SAME"}}else if("valid"===t)l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-s+1)/r),h=Math.ceil((n-o+1)/i);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const d="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],f="channelsLast"===u?t[2][0]:t[3][0],g="channelsLast"===u?t[2][1]:t[3][1];l={top:d,bottom:p,left:f,right:g,type:0===d&&0===p&&0===f&&0===g?"VALID":"EXPLICIT"},c=vv((e-s+d+p)/r+1,a),h=vv((n-o+f+g)/i+1,a)}}return{padInfo:l,outHeight:c,outWidth:h}}(i,l,c,g,m,v,x,s,a),S=o?f*h:f;let T;return"channelsFirst"===a?T=[u,S,k,I]:"channelsLast"===a&&(T=[u,k,I,S]),{batchSize:u,dataFormat:a,inHeight:l,inWidth:c,inChannels:h,outHeight:k,outWidth:I,outChannels:S,padInfo:w,strideHeight:g,strideWidth:m,filterHeight:d,filterWidth:p,effectiveFilterHeight:v,effectiveFilterWidth:x,dilationHeight:y,dilationWidth:b,inShape:t,outShape:T,filterShape:e}}function fv(t,e,n,r,i,s=!1,o="channelsLast",a){let[u,l,c,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[u,l,c,h,d]=t;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[u,d,l,c,h]=t}const[p,f,g,,m]=e,[y,b,v]=yv(n),[x,w,k]=yv(r),I=bv(p,x),S=bv(f,w),T=bv(g,k),{padInfo:C,outDepth:N,outHeight:E,outWidth:R}=function(t,e,n,r,i,s,o,a,u,l,c){let h,d,p,f;"valid"===t&&(t=0);if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const g=function(t,e,n,r,i,s){null==i&&(i=gv(t,e[0],r[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*i>=e[a]&&(o[a]=vv((t[a]-e[a]+2*i)/r[a]+1,s));return o}([e,n,r,1],[a,u,l],1,[i,s,o],t,c);d=g[0],p=g[1],f=g[2]}else{if("same"!==t)throw Error(`Unknown padding parameter: ${t}`);{d=Math.ceil(e/i),p=Math.ceil(n/s),f=Math.ceil(r/o);const t=(d-1)*i+a-e,c=(p-1)*s+u-n,g=(f-1)*o+l-r,m=Math.floor(t/2),y=t-m,b=Math.floor(c/2),v=c-b,x=Math.floor(g/2);h={top:b,bottom:v,left:x,right:g-x,front:m,back:y,type:"SAME"}}}return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}(i,l,c,h,y,b,v,I,S,T,a),$=s?m*d:m;let _;return"channelsFirst"===o?_=[u,$,N,E,R]:"channelsLast"===o&&(_=[u,N,E,R,$]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:c,inWidth:h,inChannels:d,outDepth:N,outHeight:E,outWidth:R,outChannels:$,padInfo:C,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:p,filterHeight:f,filterWidth:g,effectiveFilterDepth:I,effectiveFilterHeight:S,effectiveFilterWidth:T,dilationDepth:x,dilationHeight:w,dilationWidth:k,inShape:t,outShape:_,filterShape:e}}function gv(t,e,n,r=1){const i=bv(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function mv(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function yv(t){return"number"==typeof t?[t,t,t]:t}function bv(t,e){return e<=1?t:t+(t-1)*(e-1)}function vv(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function xv(t){const[e,n,r]=mv(t);return 1===e&&1===n&&1===r}function wv(t,e){return xv(t)||xv(e)}function kv(t){return mv(t).every((t=>t>0))}function Iv(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Sv(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)Sg(Rg(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{Sg(Rg(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tv=nb({reshape_:function(t,e){const n={x:tb(t,"x","reshape","string_or_numeric")},r={shape:e};return Hy.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cv=nb({avgPool_:function(t,e,n,r,i){const s=tb(t,"x","avgPool","float32");Sg(wv(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let o=s,a=!1;3===s.rank&&(a=!0,o=Tv(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Sg(4===o.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`)),Sv("avgPool",r,i);const u={x:o},l={filterSize:e,strides:n,pad:r,dimRoundingMode:i};let c=Hy.runKernel("AvgPool",u,l);return c=Bb(c,s.dtype),a?Tv(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nv=nb({avgPool3d_:function(t,e,n,r,i,s="NDHWC"){const o=tb(t,"x","avgPool3d","float32");let a=o,u=!1;4===o.rank&&(u=!0,a=Tv(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Sg(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),Sg("NDHWC"===s,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),Sg("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`)),Sv("avgPool3d",r,i);const l={x:a},c={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s};let h=Hy.runKernel("AvgPool3D",l,c);return h=Bb(h,a.dtype),u?Tv(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ev=nb({concat_:function(t,e=0){Sg(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=eb(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return Ub(n[0]);const r=n,i={axis:e};return Hy.runKernel("Concat",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rv=nb({matMul_:function(t,e,n=!1,r=!1){let i=tb(t,"a","matMul"),s=tb(e,"b","matMul");[i,s]=zy(i,s);const o={a:i,b:s},a={transposeA:n,transposeB:r};return Hy.runKernel("BatchMatMul",o,a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $v=nb({sigmoid_:function(t){const e={x:tb(t,"x","sigmoid","float32")};return Hy.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _v=nb({slice_:function(t,e,n){const r=tb(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const i={x:r},s={begin:e,size:n};return Hy.runKernel("Slice",i,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Av=nb({tanh_:function(t){const e={x:tb(t,"x","tanh","float32")};return Hy.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dv=nb({batchToSpaceND_:function(t,e,n){const r=tb(t,"x","batchToSpaceND"),i=e.reduce(((t,e)=>t*e));Sg(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),Sg(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),Sg(r.shape[0]%i==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`));const s={x:r},o={blockShape:e,crops:n};return Hy.runKernel("BatchToSpaceND",s,o)}});const Fv=nb({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i,s){null==s&&(s=.001);const o=tb(t,"x","batchNorm"),a=tb(e,"mean","batchNorm"),u=tb(n,"variance","batchNorm");let l,c;null!=i&&(l=tb(i,"scale","batchNorm")),null!=r&&(c=tb(r,"offset","batchNorm")),Sg(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Sg(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Sg(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const h={x:function(t){let e;return e=0===t.rank||1===t.rank?Tv(t,[1,1,1,t.size]):2===t.rank?Tv(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?Tv(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(o),scale:l,offset:c,mean:a,variance:u},d={varianceEpsilon:s},p=Hy.runKernel("FusedBatchNorm",h,d);return Tv(p,o.shape)}});const Ov=nb({batchNorm2d_:function(t,e,n,r,i,s){const o=tb(t,"x","batchNorm"),a=tb(e,"mean","batchNorm"),u=tb(n,"variance","batchNorm");let l,c;return null!=i&&(l=tb(i,"scale","batchNorm")),null!=r&&(c=tb(r,"offset","batchNorm")),Sg(2===o.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`)),Sg(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),Sg(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=l&&Sg(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`)),null!=c&&Sg(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`)),Fv(o,a,u,c,l,s)}});const Lv=nb({batchNorm3d_:function(t,e,n,r,i,s){const o=tb(t,"x","batchNorm"),a=tb(e,"mean","batchNorm"),u=tb(n,"variance","batchNorm");let l,c;return null!=i&&(l=tb(i,"scale","batchNorm")),null!=r&&(c=tb(r,"offset","batchNorm")),Sg(3===o.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`)),Sg(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),Sg(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=l&&Sg(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`)),null!=c&&Sg(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`)),Fv(o,a,u,c,l,s)}});const Pv=nb({batchNorm4d_:function(t,e,n,r,i,s){const o=tb(t,"x","batchNorm"),a=tb(e,"mean","batchNorm"),u=tb(n,"variance","batchNorm");let l,c;return null!=i&&(l=tb(i,"scale","batchNorm")),null!=r&&(c=tb(r,"offset","batchNorm")),Sg(4===o.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`)),Sg(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),Sg(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=l&&Sg(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`)),null!=c&&Sg(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`)),Fv(o,a,u,c,l,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mv=nb({bincount_:function(t,e,n){const r=tb(t,"x","bincount"),i=tb(e,"weights","bincount");Sg("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),Sg(n>=0,(()=>`size must be non-negative, but got ${n}.`)),Sg(i.size===r.size||0===i.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`));const s={x:r,weights:i},o={size:n};return Hy.runKernel("Bincount",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zv=nb({broadcastTo_:function(t,e){let n=tb(t,"broadcastTo","x");const r=n.shape;if(Qg(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=Tv(n,t)}const i=n.shape,s=Array.from(e);for(let u=e.length-1;u>=0;u--)if(i[u]===e[u])s[u]=1;else if(1!==n.shape[u])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(0===s.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0)).length)return Ub(n);const o={x:n},a={reps:s};return Hy.runKernel("Tile",o,a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bv=nb({ceil_:function(t){const e={x:tb(t,"x","ceil","float32")};return Hy.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uv(t,e,n){Qg(t);const r={shape:t,value:e,dtype:n=n||Vg(e)};return Hy.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vv=nb({clipByValue_:function(t,e,n){const r=tb(t,"x","clipByValue");if(Sg(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`)),e===n)return Uv(r.shape,e,r.dtype);const i={x:r},s={clipValueMin:e,clipValueMax:n};return Hy.runKernel("ClipByValue",i,s)}});const Wv=nb({concat1d_:function(t){return Ev(t,0)}});const Gv=nb({concat2d_:function(t,e){return Ev(t,e)}});const jv=nb({concat3d_:function(t,e){return Ev(t,e)}});const Hv=nb({concat4d_:function(t,e){return Ev(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qv=nb({conv2d_:function(t,e,n,r,i="NHWC",s=[1,1],o){const a=tb(t,"x","conv2d","float32"),u=tb(e,"filter","conv2d","float32");let l=a,c=!1;3===a.rank&&(c=!0,l=Tv(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Sg(4===l.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`)),Sg(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),Sv("conv2d",r,o);const h="NHWC"===i?l.shape[3]:l.shape[1];Sg(h===u.shape[2],(()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${u.shape[2]}.`)),Sg(wv(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),Sg(kv(s),(()=>"Error in conv2D: Dilated rates should be larger than 0.")),Sg(kv(n),(()=>"Error in conv2D: Strides should be larger than 0."));const d={x:l,filter:u},p={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},f=Hy.runKernel("Conv2D",d,p);return c?Tv(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const Kv=nb({conv1d_:function(t,e,n,r,i="NWC",s=1,o){const a=tb(t,"x","conv1d"),u=tb(e,"filter","conv1d");let l=a,c=!1;2===a.rank&&(c=!0,l=Tv(a,[1,a.shape[0],a.shape[1]])),Sg(3===l.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`)),Sg(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),Sv("conv1d",r,o),Sg(l.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),Sg(wv(n,s),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`)),Sg(kv(s),(()=>"Error in conv1D: Dilated rates should be larger than 0.")),Sg(kv(n),(()=>"Error in conv1D: Stride should be larger than 0.")),Sg("NWC"===i,(()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`));const h=Tv(u,[1,u.shape[0],u.shape[1],u.shape[2]]),d=Tv(l,[l.shape[0],1,l.shape[1],l.shape[2]]),p=qv(d,h,[1,n],r,"NHWC",[1,s],o);return Tv(p,c?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xv=nb({conv2DBackpropInput_:function(t,e,n,r,i,s="NHWC",o){Sg(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,l=!1;3===e.rank&&(l=!0,u=Tv(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),Sg(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),Sg(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),Sg(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const c="NHWC"===s?a[3]:a[1],h="NHWC"===s?u.shape[3]:u.shape[1];Sg(c===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`)),Sg(h===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`)),Sv("conv2dDerInput",i,o);const d={dy:u,filter:n},p={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,inputShape:a},f=Hy.runKernel("Conv2DBackpropInput",d,p);return l?Tv(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const Yv=nb({conv2dTranspose_:function(t,e,n,r,i,s){const o=tb(t,"x","conv2dTranspose"),a=tb(e,"filter","conv2dTranspose");return Xv(n,o,a,r,i,"NHWC",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qv=nb({conv3d_:function(t,e,n,r,i="NDHWC",s=[1,1,1]){const o=tb(t,"x","conv3d"),a=tb(e,"filter","conv3d");let u=o,l=!1;4===o.rank&&(l=!0,u=Tv(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Sg(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),Sg(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),Sg(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),Sg(wv(n,s),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),Sg("NDHWC"===i,(()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`)),Sg(kv(s),(()=>"Error in conv3D: Dilated rates should be larger than 0.")),Sg(kv(n),(()=>"Error in conv3D: Strides should be larger than 0."));const c={x:u,filter:a},h={strides:n,pad:r,dataFormat:i,dilations:s},d=Hy.runKernel("Conv3D",c,h);return l?Tv(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jv=nb({conv3DBackpropInput_:function(t,e,n,r,i){Sg(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let s=t,o=e,a=!1;4===e.rank&&(a=!0,o=Tv(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,t[0],t[1],t[2],t[3]]);const u=s[4],l=o.shape[4];Sg(5===s.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`)),Sg(5===o.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`)),Sg(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),Sg(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),Sg(l===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${n.shape[4]}.`));const c={dy:o,filter:n},h={pad:i,strides:r,inputShape:s},d=Hy.runKernel("Conv3DBackpropInputV2",c,h);return a?Tv(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const Zv=nb({conv3dTranspose_:function(t,e,n,r,i){const s=tb(t,"x","conv3dTranspose"),o=tb(e,"filter","conv3dTranspose");return Jv(n,s,o,r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tx=nb({cos_:function(t){const e={x:tb(t,"x","cos","float32")};return Hy.runKernel("Cos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ex=nb({cosh_:function(t){const e={x:tb(t,"x","cosh","float32")};return Hy.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nx=nb({cumprod_:function(t,e=0,n=!1,r=!1){const i={x:tb(t,"x","cumprod")},s={axis:e,exclusive:n,reverse:r};return Hy.runKernel("Cumprod",i,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rx=nb({cumsum_:function(t,e=0,n=!1,r=!1){const i={x:tb(t,"x","cumsum")},s={axis:e,exclusive:n,reverse:r};return Hy.runKernel("Cumsum",i,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ix=nb({denseBincount_:function(t,e,n,r=!1){const i=tb(t,"x","denseBincount"),s=tb(e,"weights","denseBincount");Sg("int32"===i.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`)),Sg(i.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`)),Sg(n>=0,(()=>`size must be non-negative, but got ${n}.`)),Sg(s.size===i.size||0===s.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${s.shape}.`));const o={x:i,weights:s},a={size:n,binaryOutput:r};return Hy.runKernel("DenseBincount",o,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sx=nb({depthToSpace_:function(t,e,n="NHWC"){const r=tb(t,"x","depthToSpace","float32"),i="NHWC"===n?r.shape[1]:r.shape[2],s="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];Sg(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),Sg(i*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),Sg(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),Sg(o%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return Hy.runKernel("DepthToSpace",a,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ox=nb({depthwiseConv2d_:function(t,e,n,r,i="NHWC",s=[1,1],o){const a=tb(t,"x","depthwiseConv2d","float32"),u=tb(e,"filter","depthwiseConv2d","float32");let l=a,c=!1;3===a.rank&&(c=!0,l=Tv(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Sg(4===l.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`)),Sg(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`));const h="NHWC"===i?l.shape[3]:l.shape[1];Sg(h===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${u.shape[2]}.`)),Sv("depthwiseConv2d",r,o);const d={x:l,filter:u},p={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},f=Hy.runKernel("DepthwiseConv2dNative",d,p);return c?Tv(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ax=nb({dilation2d_:function(t,e,n,r,i=[1,1],s="NHWC"){const o=tb(t,"x","dilation2d"),a=tb(e,"filter","dilation2d");Sg(3===o.rank||4===o.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`)),Sg(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),Sg("NHWC"===s,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`));let u=o,l=!1;3===o.rank&&(u=Tv(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0),Sg(u.shape[3]===a.shape[2],(()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${a.shape[2]}`));const c={x:u,filter:a},h={strides:n,pad:r,dilations:i},d=Hy.runKernel("Dilation2D",c,h);return l?Tv(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ux(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const s=n-1-i,o=t[s]||1;(e[e.length-1-i]||1)>1&&1===o&&r.unshift(s)}return r}function lx(t,e){const n=[];for(let r=0;r<e.length;r++){const i=t[t.length-r-1],s=e.length-r-1,o=e[s];(null==i||1===i&&o>1)&&n.unshift(s)}return n}function cx(t,e){const n=Math.max(t.length,e.length),r=new Array(n);for(let i=0;i<n;i++){let s=t[t.length-i-1];null==s&&(s=1);let o=e[e.length-i-1];if(null==o&&(o=1),1===s)r[n-i-1]=o;else if(1===o)r[n-i-1]=s;else{if(s!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}r[n-i-1]=s}}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hx=nb({equal_:function(t,e){let n=tb(t,"a","equal","string_or_numeric"),r=tb(e,"b","equal","string_or_numeric");[n,r]=zy(n,r),cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("Equal",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dx=nb({where_:function(t,e,n){const r=tb(e,"a","where"),i=tb(n,"b","where"),s=tb(t,"condition","where","bool"),o=cx(cx(s.shape,r.shape),i.shape),a={condition:zv(s,o),t:zv(r,o),e:zv(i,o)};return Hy.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const px=nb({zerosLike_:function(t){const e={x:tb(t,"x","zerosLike")};return Hy.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fx=nb({divNoNan_:function(t,e){let n=tb(t,"a","div"),r=tb(e,"b","div");[n,r]=zy(n,r);const i=Yb(n,r),s=px(i),o=hx(r,s);return dx(o,s,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gx=nb({dot_:function(t,e){const n=tb(t,"t1","dot"),r=tb(e,"t2","dot");Sg(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const i=1===n.rank?n.size:n.shape[1],s=1===r.rank?r.size:r.shape[0];if(Sg(i===s,(()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`)),1===n.rank&&1===r.rank){const t=Tv(n,[1,-1]),e=Tv(r,[-1,1]),i=Rv(t,e);return Tv(i,[])}if(1===n.rank&&2===r.rank){const t=Tv(n,[1,-1]),e=Tv(r,[r.shape[0],r.shape[1]]),i=Rv(t,e);return Tv(i,[i.size])}if(2===n.rank&&1===r.rank){const t=Tv(r,[-1,1]),e=Rv(n,t);return Tv(e,[e.size])}{const t=Tv(r,[r.shape[0],r.shape[1]]);return Rv(n,t)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mx=nb({elu_:function(t){const e={x:tb(t,"x","elu","float32")};return Hy.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yx=nb({erf_:function(t){let e=tb(t,"x","erf");Sg("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=Bb(e,"float32"));const n={x:e};return Hy.runKernel("Erf",n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bx(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function vx(t,e,n){const r=t.length+e.length,i=[];let s=0,o=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?i.push(t[s++]):i.push(e[o++]);return i}function xx(t,e){const n=[],r=t.length;for(let i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map((e=>t[e]))]}function wx(t,e){return vx(t,e.map((t=>1)),e)}function kx(t,e,n){Sg(bx(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))}function Ix(t,e){if(bx(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n}function Sx(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}function Tx(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cx=nb({max_:function(t,e=null,n=!1){const r={x:tb(t,"x","max")},i={reductionIndices:e,keepDims:n};return Hy.runKernel("Max",r,i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nx=nb({min_:function(t,e=null,n=!1){const r={x:tb(t,"x","min")},i={axis:e,keepDims:n};return Hy.runKernel("Min",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ex=nb({pow_:function(t,e){let n=tb(t,"base","pow"),r=tb(e,"exp","pow");[n,r]=zy(n,r);const i={a:n,b:r};return Hy.runKernel("Pow",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rx(t,e){if((uy(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&uy(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ib(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $x=nb({sqrt_:function(t){const e={x:tb(t,"x","sqrt","float32")};return Hy.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _x=nb({square_:function(t){const e=tb(t,"x","square");return Hy.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ax=nb({sum_:function(t,e=null,n=!1){let r=tb(t,"x","sum");"bool"===r.dtype&&(r=Bb(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Hy.runKernel("Sum",i,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dx(t,e,n=null){if(0===t.rank)return Jb(t);if(1!==t.rank&&null===n)return Dx(Tv(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return Ax(Jb(t),n);if(e===1/0)return Cx(Jb(t),n);if(e===-1/0)return Nx(Jb(t),n);if("euclidean"===e||2===e)return $x(Ax(Ex(Jb(t),Rx(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return Cx(Ax(Jb(t),n[0]),n[1]-1);if(e===1/0)return Cx(Ax(Jb(t),n[1]),n[0]);if(e===-1/0)return Nx(Ax(Jb(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return $x(Ax(_x(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Fx=nb({norm_:function(t,e="euclidean",n=null,r=!1){const i=Dx(t=tb(t,"x","norm"),e,n);let s=i.shape;if(r){const e=Fg(n,t.shape);s=wx(i.shape,e)}return Tv(i,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ox=nb({euclideanNorm_:function(t,e=null,n=!1){return Fx(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lx=nb({exp_:function(t){const e={x:tb(t,"x","exp")};return Hy.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Px=nb({expandDims_:function(t,e=0){const n=tb(t,"x","expandDims","string_or_numeric");Sg(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},i={dim:e};return Hy.runKernel("ExpandDims",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mx=nb({expm1_:function(t){const e={x:tb(t,"x","expm1")};return Hy.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zx=nb({tile_:function(t,e){const n=tb(t,"x","tile","string_or_numeric");Sg(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},i={reps:e};return Hy.runKernel("Tile",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bx=nb({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const i=zb([t,e],r),s=t<=e?t:e;for(let a=0;a<s;++a)i.set(1,a,a);const o=Tv(i.toTensor(),[t,e]);if(null==n)return o;if(1===n.length)return zx(Px(o,0),[n[0],1,1]);if(2===n.length)return zx(Px(Px(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return zx(Px(Px(Px(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ux=nb({floor_:function(t){const e={x:tb(t,"x","floor","float32")};return Hy.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vx=nb({gather_:function(t,e,n=0,r=0){const i={x:tb(t,"x","gather"),indices:tb(e,"indices","gather","int32")},s={axis:n,batchDims:r};return Hy.runKernel("GatherV2",i,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wx=nb({greater_:function(t,e){let n=tb(t,"a","greater","string_or_numeric"),r=tb(e,"b","greater","string_or_numeric");[n,r]=zy(n,r),cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("Greater",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gx=nb({greaterEqual_:function(t,e){let n=tb(t,"a","greaterEqual","string_or_numeric"),r=tb(e,"b","greaterEqual","string_or_numeric");[n,r]=zy(n,r),cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("GreaterEqual",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jx=nb({imag_:function(t){const e={input:tb(t,"input","imag")};return Hy.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hx=nb({isFinite_:function(t){const e={x:tb(t,"x","isFinite")};return Hy.runKernel("IsFinite",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qx=nb({isInf_:function(t){const e={x:tb(t,"x","isInf")};return Hy.runKernel("IsInf",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kx=nb({isNaN_:function(t){const e={x:tb(t,"x","isNaN")};return Hy.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xx=nb({leakyRelu_:function(t,e=.2){const n={x:tb(t,"x","leakyRelu")},r={alpha:e};return Hy.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yx=nb({less_:function(t,e){let n=tb(t,"a","less","string_or_numeric"),r=tb(e,"b","less","string_or_numeric");[n,r]=zy(n,r),cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("Less",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qx=nb({lessEqual_:function(t,e){let n=tb(t,"a","lessEqual","string_or_numeric"),r=tb(e,"b","lessEqual","string_or_numeric");[n,r]=zy(n,r),cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("LessEqual",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jx=nb({localResponseNormalization_:function(t,e=5,n=1,r=1,i=.5){const s=tb(t,"x","localResponseNormalization");Sg(4===s.rank||3===s.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${s.rank}.`)),Sg(Rg(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let o=s,a=!1;3===s.rank&&(a=!0,o=Tv(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const u={x:o},l={depthRadius:e,bias:n,alpha:r,beta:i},c=Hy.runKernel("LRN",u,l);return a?Tv(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zx=nb({log_:function(t){const e={x:tb(t,"x","log","float32")};return Hy.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tw=nb({log1p_:function(t){const e={x:tb(t,"x","log1p")};return Hy.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ew(t){return Hy.customGrad(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nw=nb({neg_:function(t){const e={x:tb(t,"x","neg")};return Hy.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rw=nb({softplus_:function(t){const e={x:tb(t,"x","softplus")};return Hy.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iw=nb({logSigmoid_:function(t){const e=tb(t,"x","logSigmoid");return ew((t=>({value:nw(rw(nw(t))),gradFunc:e=>Qb(e,$v(nw(t)))})))(e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sw=nb({sub_:function(t,e){let n=tb(t,"a","sub"),r=tb(e,"b","sub");[n,r]=zy(n,r);const i={a:n,b:r};return Hy.runKernel("Sub",i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ow=nb({logSoftmax_:function(t,e=-1){const n=tb(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return ew(((t,n)=>{const r=Cx(t,e,!0),i=sw(t,r),s=sw(Bb(i,"float32"),Zx(Ax(Lx(i),e,!0)));n([s]);return{value:s,gradFunc:(t,n)=>{const[r]=n,i=Lx(r);return sw(t,Qb(Ax(t,e,!0),i))}}}))(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aw=nb({logSumExp_:function(t,e=null,n=!1){const r=tb(t,"x","logSumExp"),i=Fg(e,r.shape),s=Cx(r,i,!0),o=sw(r,s),a=Lx(o),u=Ax(a,i),l=Zx(u),c=Kb(Tv(s,l.shape),l);if(n){const t=wx(c.shape,i);return Tv(c,t)}return c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uw=nb({logicalAnd_:function(t,e){const n=tb(t,"a","logicalAnd","bool"),r=tb(e,"b","logicalAnd","bool");cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("LogicalAnd",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lw=nb({logicalNot_:function(t){const e={x:tb(t,"x","logicalNot","bool")};return Hy.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cw=nb({logicalOr_:function(t,e){const n=tb(t,"a","logicalOr","bool"),r=tb(e,"b","logicalOr","bool");cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("LogicalOr",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hw=nb({logicalXor_:function(t,e){const n=tb(t,"a","logicalXor","bool"),r=tb(e,"b","logicalXor","bool");return cx(n.shape,r.shape),uw(cw(t,e),lw(uw(t,e)))}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dw=nb({maxPool_:function(t,e,n,r,i){const s=tb(t,"x","maxPool");let o=s,a=!1;3===s.rank&&(a=!0,o=Tv(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Sg(4===o.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`)),Sg(wv(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),Sv("maxPool",r,i);const u={x:o},l={filterSize:e,strides:n,pad:r,dimRoundingMode:i},c=Hy.runKernel("MaxPool",u,l);return a?Tv(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pw=nb({maxPool3d_:function(t,e=[1,1,1],n,r,i,s="NDHWC"){const o=tb(t,"x","maxPool3d");let a=o,u=!1;4===o.rank&&(u=!0,a=Tv(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Sg(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),Sg("NDHWC"===s,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),Sv("maxPool3d",r,i);const l={x:a},c={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},h=Hy.runKernel("MaxPool3D",l,c);return u?Tv(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fw=nb({maximum_:function(t,e){let n=tb(t,"a","maximum"),r=tb(e,"b","maximum");[n,r]=zy(n,r),"bool"===n.dtype&&(n=Bb(n,"int32"),r=Bb(r,"int32")),cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("Maximum",i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gw=nb({mean_:function(t,e=null,n=!1){const r={x:tb(t,"x","mean")},i={axis:e,keepDims:n};return Hy.runKernel("Mean",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mw(t,e="float32"){if(Qg(t),"complex64"===e){const e=mw(t,"float32"),n=mw(t,"float32");return rb(e,n)}const n=Xg(Ng(t),e);return Hy.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yw(t,e="float32"){if(Qg(t),"complex64"===e){const e=yw(t,"float32"),n=mw(t,"float32");return rb(e,n)}const n=Kg(Ng(t),e);return Hy.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bw=nb({minimum_:function(t,e){let n=tb(t,"a","minimum"),r=tb(e,"b","minimum");[n,r]=zy(n,r),"bool"===n.dtype&&(n=Bb(n,"int32"),r=Bb(r,"int32")),cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("Minimum",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vw=nb({mirrorPad_:function(t,e,n){Sg("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=tb(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Sg(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const i="reflect"===n?1:0;for(let a=0;a<r.rank;a++)Sg(2===e[a].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Sg(e[a][0]>=0&&e[a][0]<=r.shape[a]-i&&e[a][1]>=0&&e[a][1]<=r.shape[a]-i,(()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-i} or less than 0 for input of shape ${r.shape}`));const s={paddings:e,mode:n},o={x:r};return Hy.runKernel("MirrorPad",o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xw=nb({mod_:function(t,e){let n=tb(t,"a","mod"),r=tb(e,"b","mod");[n,r]=zy(n,r);const i={a:n,b:r};return Hy.runKernel("Mod",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ww=nb({moments_:function(t,e=null,n=!1){const r=Fg(e,(t=tb(t,"x","moments")).shape),i=gw(t,r,n);let s=i.shape;n||(s=wx(i.shape,r));const o=_x(sw(Bb(t,"float32"),Tv(i,s)));return{mean:i,variance:gw(o,r,n)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kw=nb({notEqual_:function(t,e){let n=tb(t,"a","notEqual","string_or_numeric"),r=tb(e,"b","notEqual","string_or_numeric");[n,r]=zy(n,r),cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("NotEqual",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iw=nb({oneHot_:function(t,e,n=1,r=0,i="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:tb(t,"indices","oneHot","int32")},o={dtype:i,depth:e,onValue:n,offValue:r};return Hy.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sw=nb({onesLike_:function(t){const e={x:tb(t,"x","onesLike")};return Hy.runKernel("OnesLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tw=nb({pad_:function(t,e,n=0){const r=tb(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},s={x:r};return Hy.runKernel("PadV2",s,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cw=nb({spaceToBatchND_:function(t,e,n){const r=tb(t,"x","spaceToBatchND");Sg(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),Sg(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),Sg(r.shape.reduce(((t,r,i)=>i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const i={x:r},s={blockShape:e,paddings:n};return Hy.runKernel("SpaceToBatchND",i,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nw=nb({pool_:function(t,e,n,r,i,s,o){null==i&&(i=[1,1]),null==s&&(s=1),0===r&&(r="valid");const a=tb(t,"x","maxPool");let u=a,l=!1;3===a.rank&&(l=!0,u=Tv(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Sg(wv(s,i),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`));const c=hv(u.shape,e,s,i,r),h=[c.dilationHeight,c.dilationWidth];let d;d="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))).map((t=>t-1)),r=n.map((t=>Math.floor(t/2))),i=n.map(((t,e)=>t-r[e]));return n.map(((t,e)=>[r[e],i[e]]))}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];const p=1===h[0]&&1===h[1],[f,g]=function(t,e,n){const r=n.map((t=>t[0])),i=n.map((t=>t[1])),s=t.concat(r,i),o=e.map(((t,e)=>(t-s[e]%t)%t)),a=i.map(((t,e)=>t+o[e])),u=e.map(((t,e)=>[r[e],a[e]])),l=e.map(((t,e)=>[0,o[e]]));return[u,l]}([c.inHeight,c.inWidth],h,d),m=p?r:"valid",y=p?u:Cw(u,h,f),b=("avg"===n?()=>Cv(y,e,s,m,o):()=>dw(y,e,s,m,o))(),v=p?b:Dv(b,h,g);return l?Tv(v,[v.shape[1],v.shape[2],v.shape[3]]):v}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ew=nb({prelu_:function(t,e){const n={x:tb(t,"x","prelu"),alpha:tb(e,"alpha","prelu")};return Hy.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rw=nb({prod_:function(t,e=null,n=!1){let r=tb(t,"x","prod");"bool"===r.dtype&&(r=Bb(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Hy.runKernel("Prod",i,s)}});var $w=K((function(t){!function(t,e,n){function r(t){var e,n=this,r=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function i(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function s(t,e){var n=new r(t),s=e&&e.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:this.alea=s}(0,t)})),_w=K((function(t){!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function s(t,e){var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:this.xor128=s}(0,t)})),Aw=K((function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function s(t,e){var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:this.xorwow=s}(0,t)})),Dw=K((function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function i(t,e){return e.x=t.x.slice(),e.i=t.i,e}function s(t,e){null==t&&(t=+new Date);var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&(s.x&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:this.xorshift7=s}(0,t)})),Fw=K((function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,s=e.i;return e.w=r=r+1640531527|0,n=i[s+34&127],t=i[s=s+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[s]=n^t,e.i=s,n+(r^r>>>16)|0},function(t,e){var n,r,i,s,o,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),i=0,s=-32;s<u;++s)e&&(r^=e.charCodeAt((s+32)%e.length)),0===s&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,s>=0&&(o=o+1640531527|0,i=0==(n=a[127&s]^=r+o)?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,s=512;s>0;--s)r=a[i+34&127],n=a[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[i]=r^n;t.w=o,t.X=a,t.i=i}(e,t)}function i(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function s(t,e){null==t&&(t=+new Date);var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&(s.X&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:this.xor4096=s}(0,t)})),Ow=K((function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function s(t,e){var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:this.tychei=s}(0,t)})),Lw=q(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:{}})),Pw=K((function(t){!function(e,n,r){var i,s=256,o=r.pow(s,6),a=r.pow(2,52),u=2*a,l=255;function c(t,l,c){var m=[],y=f(p((l=1==l?{entropy:!0}:l||{}).entropy?[t,g(n)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(s):(t=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(t)),g(t)}catch(pg){var r=e.navigator,o=r&&r.plugins;return[+new Date,e,o,e.screen,g(n)]}}():t,3),m),b=new h(m),v=function(){for(var t=b.g(6),e=o,n=0;t<a;)t=(t+n)*s,e*=s,n=b.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return v.int32=function(){return 0|b.g(4)},v.quick=function(){return b.g(4)/4294967296},v.double=v,f(g(b.S),n),(l.pass||c||function(t,e,n,i){return i&&(i.S&&d(i,b),t.state=function(){return d(b,{})}),n?(r.random=t,e):t})(v,y,"global"in l?l.global:this==r,l.state)}function h(t){var e,n=t.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);i<s;)a[i]=i++;for(i=0;i<s;i++)a[i]=a[o=l&o+t[i%n]+(e=a[i])],a[o]=e;(r.g=function(t){for(var e,n=0,i=r.i,o=r.j,a=r.S;t--;)e=a[i=l&i+1],n=n*s+a[l&(a[i]=a[o=l&o+e])+(a[o]=e)];return r.i=i,r.j=o,n})(s)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],i=typeof t;if(e&&"object"==i)for(n in t)try{r.push(p(t[n],e-1))}catch(pg){}return r.length?r:"string"==i?t:t+"\0"}function f(t,e){for(var n,r=t+"",i=0;i<r.length;)e[l&i]=l&(n^=19*e[l&i])+r.charCodeAt(i++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(f(r.random(),n),t.exports){t.exports=c;try{i=Lw}catch(m){}}else r.seedrandom=c}("undefined"!=typeof self?self:H,[],Math)}));Pw.alea=$w,Pw.xor128=_w,Pw.xorwow=Aw,Pw.xorshift7=Dw,Pw.xor4096=Fw,Pw.tychei=Ow;var Mw=Pw;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zw{constructor(t,e,n,r,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const s=i||Math.random();this.random=Mw.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,i,s;do{r=2*this.random()-1,i=2*this.random()-1,s=r*r+i*i}while(s>=1||0===s);const o=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*r*o,e=this.mean+this.stdDev*i*o,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class Bw{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=Mw.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uw=nb({randomNormal_:function(t,e=0,n=1,r,i){if(Qg(t),null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const s=new zw(e,n,r,!1,i),o=zb(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vw=nb({randomUniform_:function(t,e=0,n=1,r="float32",i){Qg(t);const s=zb(t,r),o=new Bw(e,n,null,i);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ww(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:r};return Hy.runKernel("Range",{},i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gw=nb({real_:function(t){const e={input:tb(t,"input","real")};return Hy.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jw=nb({reciprocal_:function(t){const e={x:tb(t,"x","reciprocal")};return Hy.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hw=nb({relu_:function(t){const e={x:tb(t,"x","relu")};return Hy.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qw=nb({relu6_:function(t){const e={x:tb(t,"x","relu6")};return Hy.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kw=nb({reverse_:function(t,e){const n={x:tb(t,"x","reverse")},r={dims:e};return Hy.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xw=nb({round_:function(t){const e={x:tb(t,"x","round")};return Hy.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yw=nb({rsqrt_:function(t){const e={x:tb(t,"x","rsqrt","float32")};return Hy.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qw=nb({selu_:function(t){const e={x:tb(t,"x","selu")};return Hy.runKernel("Selu",e)}});const Jw=nb({separableConv2d_:function(t,e,n,r,i,s=[1,1],o="NHWC"){const a=tb(t,"x","separableConv2d"),u=tb(e,"depthwiseFilter","separableConv2d"),l=tb(n,"pointwiseFilter","separableConv2d");let c=a,h=!1;if(3===a.rank&&(h=!0,c=Tv(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Sg(4===c.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`)),Sg(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),Sg(4===l.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),Sg(1===l.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`)),Sg(1===l.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`));const d=u.shape[2],p=u.shape[3];Sg(l.shape[2]===d*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*p}, but got ${l.shape[2]}.`));const f=ox(c,u,r,i,o,s),g=qv(f,l,1,"valid",o);return h?Tv(g,[g.shape[1],g.shape[2],g.shape[3]]):g}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zw=nb({sign_:function(t){const e={x:tb(t,"x","sign")};return Hy.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tk=nb({sin_:function(t){const e={x:tb(t,"x","sin","float32")};return Hy.runKernel("Sin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ek=nb({sinh_:function(t){const e={x:tb(t,"x","sinh")};return Hy.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nk=nb({slice1d_:function(t,e,n){const r=tb(t,"x","slice1d");return Sg(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),_v(r,[e],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rk=nb({slice2d_:function(t,e,n){const r=tb(t,"x","slice2d");return Sg(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),_v(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ik=nb({slice3d_:function(t,e,n){const r=tb(t,"x","slice3d");return Sg(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),_v(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sk=nb({slice4d_:function(t,e,n){const r=tb(t,"x","slice4d");return Sg(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),_v(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ok=nb({softmax_:function(t,e=-1){const n=tb(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},i={dim:e};return Hy.runKernel("Softmax",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ak=nb({fft_:function(t){Sg("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Hy.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uk=nb({ifft_:function(t){Sg("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Hy.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lk=nb({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const i=Tv(t,[n,e]);r=uk(i)}else{const i=[n,2*(e-1)],s=Tv(Gw(t),[n,e]),o=Tv(jx(t),[n,e]),a=Kw(_v(s,[0,1],[n,e-2]),1),u=Qb(Kw(_v(o,[0,1],[n,e-2]),1),Rx(-1)),l=Ev([s,a],1),c=Ev([o,u],1),h=Tv(rb(l,c),[i[0],i[1]]);r=uk(h)}if(r=Gw(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=Tv(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ck=nb({split_:function(t,e,n=0){const r={x:tb(t,"x","split")},i={numOrSizeSplits:e,axis:n};return Hy.runKernel("SplitV",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hk=nb({rfft_:function(t,e){Sg("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let i;if(null!=e&&e<n){const r=t.shape.map((t=>0)),s=t.shape.map((t=>t));s[t.shape.length-1]=e,i=_v(t,r,s),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,i=Ev([t,mw(r)],t.shape.length-1),n=e}else i=t;const s=px(i),o=Tv(rb(i,s),[r,n]),a=ak(o),u=Math.floor(n/2)+1,l=Gw(a),c=jx(a),h=ck(l,[u,n-u],l.shape.length-1),d=ck(c,[u,n-u],c.shape.length-1),p=i.shape.slice();return p[i.shape.length-1]=u,Tv(rb(h[0],d[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dk=nb({squaredDifference_:function(t,e){let n=tb(t,"a","squaredDifference"),r=tb(e,"b","squaredDifference");[n,r]=zy(n,r),cx(n.shape,r.shape);const i={a:n,b:r};return Hy.runKernel("SquaredDifference",i,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pk=nb({squeeze_:function(t,e){const n=tb(t,"x","squeeze","string_or_numeric");return Tv(n,Og(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fk=nb({stack_:function(t,e=0){const n=eb(t,"tensors","stack","string_or_numeric");Sg(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&Sg(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,i={axis:e};return Hy.runKernel("Pack",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gk=nb({step_:function(t,e=0){const n={x:tb(t,"x","step")},r={alpha:e};return Hy.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mk=nb({stridedSlice_:function(t,e,n,r,i=0,s=0,o=0,a=0,u=0){const l={x:tb(t,"x","stridedSlice","string_or_numeric")},c={begin:e,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};return Hy.runKernel("StridedSlice",l,c)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yk=nb({tan_:function(t){const e={x:tb(t,"x","tan","float32")};return Hy.runKernel("Tan",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bk(t,e){Cg(t);const n=Qy(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ib(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vk(t,e,n){if(Cg(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Qy(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ib(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xk(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(s+` update.rank < ${i}. `);if(t.length<r+(n.rank-i))throw new Error(s+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+t.length-r)throw new Error(s+" update.rank != "+(i+t.length-r));for(let o=0;o<i;++o)if(n.shape[o]!==e.shape[o])throw new Error(s+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==t[o+r])throw new Error(s+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${t[o+i]})`)}function wk(t,e,n){const r=e.shape.length,i=r>1?e.shape[r-1]:1,s=n.length;let o=1;for(let u=i;u<s;++u)o*=n[u];const a=i<1?1:i;return{sliceRank:i,numUpdates:Ng(e.shape)/a,sliceSize:o,strides:[...jg(n.slice(0,i)),1],outputSize:Ng(n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kk=nb({topk_:function(t,e=1,n=!0){const r=tb(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const s={x:r},o={k:e,sorted:n},[a,u]=Hy.runKernel("TopK",s,o);return{values:a,indices:u}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ik=nb({truncatedNormal_:function(t,e=0,n=1,r,i){if(Qg(t),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const s=new zw(e,n,r,!0,i),o=zb(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sk=nb({unique_:function(t,e=0){const n=tb(t,"x","unique","string_or_numeric");Sg(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},i={axis:e},[s,o]=Hy.runKernel("Unique",r,i);return{values:s,indices:o}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tk=nb({unsortedSegmentSum_:function(t,e,n){const r=tb(t,"x","unsortedSegmentSum"),i=tb(e,"segmentIds","unsortedSegmentSum","int32");Sg(Rg(n),(()=>"numSegments must be of dtype int"));const s={x:r,segmentIds:i},o={numSegments:n};return Hy.runKernel("UnsortedSegmentSum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ck=nb({unstack_:function(t,e=0){const n=tb(t,"x","unstack","string_or_numeric");Sg(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},i={axis:e};return Hy.runKernel("Unpack",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Nk(t,e){const n=[];for(let s=0;s<e.length;s++)e[s]&&n.push(s);const r=zb(t,"int32"),i=zb([n.length,t.length],"int32");for(let s=0;s<n.length;s++){const e=r.indexToLoc(n[s]),o=s*t.length;i.values.set(e,o)}return i.toTensor()}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ek=nb({transpose_:function(t,e,n){const r=tb(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),Sg(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{Sg(t>=0&&t<r.rank,(()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`))})),r.rank<=1)return r.clone();const i={x:r},s={perm:e};return"complex64"===r.dtype?Gb((()=>{let t=Gw(r),e=jx(r);return t=Hy.runKernel("Transpose",{x:t},s),e=Hy.runKernel("Transpose",{x:e},s),n&&(e=nw(e)),rb(t,e)})):Hy.runKernel("Transpose",i,s)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rk=nb({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const i=tb(t,"x","dropout");if(Sg("float32"===i.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`)),Sg(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof wy?i.clone():i;const s=function(t,e){if(null==e)return t.shape.slice();if(Eg(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(i,n),o=1-e,a=Yb(Ux(Kb(Vw(s,0,1,"float32",r),o)),o);return Qb(i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $k=nb({conv2DBackpropFilter_:function(t,e,n,r,i,s="NHWC",o){let a=t;3===t.rank&&(a=Tv(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=Tv(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Sg(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),Sg(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),Sg(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const l="NHWC"===s?a.shape[3]:a.shape[1],c="NHWC"===s?u.shape[3]:u.shape[1];Sg(l===n[2],(()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${n[2]}.`)),Sg(c===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`)),Sv("conv2dDerFilter",i,o);const h={x:a,dy:u},d={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,filterShape:n};return Hy.runKernel("Conv2DBackpropFilter",h,d)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _k(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return Qb(t,gk(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Ak(t,e){let n=e;const r=lx(t.shape,e.shape);return r.length>0&&(n=Ax(n,r)),Tv(n,t.shape)}function Dk(t,e,n,r){if("linear"===e)return t;if("relu"===e)return Hw(t);if("elu"===e)return mx(t);if("relu6"===e)return qw(t);if("prelu"===e)return Ew(t,n);if("leakyrelu"===e)return Xx(t,r);if("sigmoid"===e)return $v(t);throw new Error(`Unknown fused activation ${e}.`)}const Fk=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ok=nb({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",!1===Fk(Hy.state.gradientDepth,u)){Sg("NHWC"===i,(()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let h=qv(t,e,n,r,i,s,o);return null!=a&&(h=Kb(h,a)),Dk(h,u,l,c)}const h=tb(t,"x","conv2d","float32"),d=tb(e,"filter","conv2d","float32");let p=h,f=!1;3===h.rank&&(f=!0,p=Tv(h,[1,h.shape[0],h.shape[1],h.shape[2]])),Sg(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),Sg(4===d.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`)),Sv("fused conv2d",r,o);const g="NHWC"===i?p.shape[3]:p.shape[1];Sg(d.shape[2]===g,(()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${d.shape[2]}.`)),Sg(wv(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`));const m=pv(p.shape,d.shape,n,s,r,o);let y,b;if(null!=a&&(y=tb(a,"bias","fused conv2d"),[y]=zy(y,h),"NHWC"===i?cx(m.outShape,y.shape):(Sg(y.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`)),Sg(0===y.shape.length||y.shape[0]===m.outChannels||1===y.shape[0],(()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${m.outChannels})`)))),null!=l){const t=l.shape;if(Sg(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)Sg(1===t[0]||t[0]===m.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${m.outChannels}).`));else if(3===t.length)try{cx(t,m.outShape)}catch(pg){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${m.outShape}).`;throw Error(n)}b=tb(l,"prelu weights","fused conv2d")}const v=(t,e)=>{Sg("NHWC"===i,(()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`));const[o,a,l,c]=e,h=_k(t,l,u);Sg(xv(s),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`));const d=[Xv(a.shape,h,o,n,r),$k(a,h,o.shape,n,r)];if(null!=c){const t=Ak(c,h);d.push(t)}return d},x={x:p,filter:d,bias:y,preluActivationWeights:b},w={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:u,leakyreluAlpha:c};if(null==a){return ew(((t,e,n)=>{let r=Hy.runKernel("FusedConv2D",x,w);return n([e,t,r]),f&&(r=Tv(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}))(p,d)}return ew(((t,e,n,r)=>{let i=Hy.runKernel("FusedConv2D",x,w);return r([e,t,i,n]),f&&(i=Tv(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:v}}))(p,d,y)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lk=nb({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,i,s=[1,1],o){let a=t;3===t.rank&&(a=Tv(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=Tv(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={x:a,dy:u},c={strides:r,pad:i,dimRoundingMode:o,dilations:s,filterShape:n};return Hy.runKernel("DepthwiseConv2dNativeBackpropFilter",l,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pk=nb({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,i,s=[1,1],o){let a=e,u=!1;3===e.rank&&(u=!0,a=Tv(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={dy:a,filter:n},c={strides:r,pad:i,dimRoundingMode:o,dilations:s,inputShape:t},h=Hy.runKernel("DepthwiseConv2dNativeBackpropInput",l,c);return u?Tv(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mk=nb({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(!1===Fk(Hy.state.gradientDepth,s)){let u=Rv(t,e,n,r);return null!=i&&(u=Kb(u,i)),Dk(u,s,o,a)}let u=tb(t,"a","fused matMul"),l=tb(e,"b","fused matMul");[u,l]=zy(u,l);const c=n?u.shape[u.rank-2]:u.shape[u.rank-1],h=r?l.shape[l.rank-1]:l.shape[l.rank-2],d=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?l.shape[l.rank-2]:l.shape[l.rank-1],f=u.shape.slice(0,-2),g=l.shape.slice(0,-2),m=Ng(f),y=Ng(g);Sg(c===h,(()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=cx(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([d,p]),v=Tv(u,n?[m,c,d]:[m,d,c]),x=Tv(l,r?[y,p,h]:[y,h,p]);let w,k;null!=i&&(w=tb(i,"bias","fused matMul"),[w]=zy(w,u),cx(b,w.shape)),null!=o&&(k=tb(o,"prelu weights","fused matMul"));const I=(t,e)=>{const[o,a,u,l]=e,c=_k(Tv(t,u.shape),u,s);let h,d;if(n||r?!n&&r?(h=Rv(c,a,!1,!1),d=Rv(c,o,!0,!1)):n&&!r?(h=Rv(a,c,!1,!0),d=Rv(o,c,!1,!1)):(h=Rv(a,c,!0,!0),d=Rv(c,o,!0,!0)):(h=Rv(c,a,!1,!0),d=Rv(o,c,!0,!1)),null!=i){return[h,d,Ak(l,c)]}return[h,d]},S={a:v,b:x,bias:w,preluActivationWeights:k},T={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:a};if(null==i){return ew(((t,e,n)=>{const r=Hy.runKernel("_FusedMatMul",S,T);return n([t,e,r]),{value:Tv(r,b),gradFunc:I}}))(v,x)}return ew(((t,e,n,r)=>{const i=Hy.runKernel("_FusedMatMul",S,T);return r([t,e,i,n]),{value:Tv(i,b),gradFunc:I}}))(v,x,w)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zk=nb({cropAndResize_:function(t,e,n,r,i="bilinear",s=0){const o=tb(t,"image","cropAndResize"),a=tb(e,"boxes","cropAndResize","float32"),u=tb(n,"boxInd","cropAndResize","int32"),l=a.shape[0];Sg(4===o.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`)),Sg(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`)),Sg(1===u.rank&&u.shape[0]===l,(()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`)),Sg(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),Sg(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),Sg("bilinear"===i||"nearest"===i,(()=>`method must be bilinear or nearest, but was ${i}`));const c={image:o,boxes:a,boxInd:u},h={method:i,extrapolationValue:s,cropSize:r};return Hy.runKernel("CropAndResize",c,h)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bk=nb({flipLeftRight_:function(t){const e=tb(t,"image","flipLeftRight","float32");Sg(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return Hy.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uk=nb({grayscaleToRGB_:function(t){const e=tb(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];Sg(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),Sg(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const i=new Array(e.rank);return i.fill(1,0,n),i[n]=3,zx(e,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vk=nb({rotateWithOffset_:function(t,e,n=0,r=.5){const i=tb(t,"image","rotateWithOffset","float32");Sg(4===i.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`));const s={image:i},o={radians:e,fillValue:n,center:r};return Hy.runKernel("RotateWithOffset",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wk(t,e,n,r,i,s){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==s&&(s=0);const o=t.shape[0];return n=Math.min(n,o),Sg(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),Sg(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),Sg(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),Sg(1===e.rank,(()=>"scores must be a 1D tensor")),Sg(e.shape[0]===o,(()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`)),Sg(0<=s&&s<=1,(()=>`softNmsSigma must be in [0, 1], but was '${s}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gk=nb({nonMaxSuppression_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=tb(t,"boxes","nonMaxSuppression","float32"),o=tb(e,"scores","nonMaxSuppression","float32"),a=Wk(s,o,n,r,i),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:i=a.scoreThreshold};return Hy.runKernel("NonMaxSuppressionV3",{boxes:s,scores:o},u)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jk(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,i=t.length,s=0,o=!1;for(;r<i;){s=r+(i-r>>>1);const a=n(e,t[s]);a>0?r=s+1:(i=s,o=!a)}return o?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||Hk)}(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function Hk(t,e){return t>e?1:t<e?-1:0}function qk(t,e,n,r,i){return Yk(t,e,n,r,i,0)}function Kk(t,e,n,r,i,s){return Yk(t,e,n,r,i,0,!1,s,!0)}function Xk(t,e,n,r,i,s){return Yk(t,e,n,r,i,s,!0)}function Yk(t,e,n,r,i,s,o=!1,a=!1,u=!1){const l=[];for(let m=0;m<e.length;m++)e[m]>i&&l.push({score:e[m],boxIndex:m,suppressBeginIndex:0});l.sort(Zk);const c=s>0?-.5/s:0,h=[],d=[];for(;h.length<n&&l.length>0;){const e=l.pop(),{score:n,boxIndex:s,suppressBeginIndex:o}=e;if(n<i)break;let a=!1;for(let u=h.length-1;u>=o;--u){const n=Qk(t,s,h[u]);if(n>=r){a=!0;break}if(e.score=e.score*Jk(r,c,n),e.score<=i)break}e.suppressBeginIndex=h.length,a||(e.score===n?(h.push(s),d.push(e.score)):e.score>i&&jk(l,e,Zk))}const p=h.length,f=n-p;a&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const g={selectedIndices:h};return o&&(g.selectedScores=d),u&&(g.validOutputs=p),g}function Qk(t,e,n){const r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),p=(a-s)*(u-o),f=(h-l)*(d-c);if(p<=0||f<=0)return 0;const g=Math.max(s,l),m=Math.max(o,c),y=Math.min(a,h),b=Math.min(u,d),v=Math.max(y-g,0)*Math.max(b-m,0);return v/(p+f-v)}function Jk(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function Zk(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tI=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=tb(t,"boxes","nonMaxSuppressionAsync"),o=tb(e,"scores","nonMaxSuppressionAsync"),a=Wk(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const u=await Promise.all([s.data(),o.data()]),l=u[0],c=u[1],{selectedIndices:h}=qk(l,c,n,r,i);return s!==t&&s.dispose(),o!==e&&o.dispose(),bk(h,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eI=nb({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=tb(t,"boxes","nonMaxSuppression"),a=tb(e,"scores","nonMaxSuppression"),u=Wk(o,a,n,r,i,s),l={boxes:o,scores:a},c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:s=u.softNmsSigma},h=Hy.runKernel("NonMaxSuppressionV5",l,c);return{selectedIndices:h[0],selectedScores:h[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nI=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=tb(t,"boxes","nonMaxSuppressionAsync"),a=tb(e,"scores","nonMaxSuppressionAsync"),u=Wk(o,a,n,r,i,s);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,s=u.softNmsSigma;const l=await Promise.all([o.data(),a.data()]),c=l[0],h=l[1],{selectedIndices:d,selectedScores:p}=Xk(c,h,n,r,i,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:bk(d,"int32"),selectedScores:bk(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rI=nb({nonMaxSuppressionPadded_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=tb(t,"boxes","nonMaxSuppression"),a=tb(e,"scores","nonMaxSuppression"),u=Wk(o,a,n,r,i,null),l={boxes:o,scores:a},c={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:s},h=Hy.runKernel("NonMaxSuppressionV4",l,c);return{selectedIndices:h[0],validOutputs:h[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iI=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=tb(t,"boxes","nonMaxSuppressionAsync"),a=tb(e,"scores","nonMaxSuppressionAsync"),u=Wk(o,a,n,r,i,null),l=u.maxOutputSize,c=u.iouThreshold,h=u.scoreThreshold,[d,p]=await Promise.all([o.data(),a.data()]),{selectedIndices:f,validOutputs:g}=Kk(d,p,l,c,h,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:bk(f,"int32"),validOutputs:Rx(g,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sI=nb({resizeBilinear_:function(t,e,n=!1,r=!1){const i=tb(t,"images","resizeBilinear");Sg(3===i.rank||4===i.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`)),Sg(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),Sg(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let s=i,o=!1;3===i.rank&&(o=!0,s=Tv(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},u={alignCorners:n,halfPixelCenters:r,size:e},l=Hy.runKernel("ResizeBilinear",a,u);return o?Tv(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oI=nb({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const i=tb(t,"images","resizeNearestNeighbor");Sg(3===i.rank||4===i.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`)),Sg(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),Sg("float32"===i.dtype||"int32"===i.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),Sg(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let s=i,o=!1;3===i.rank&&(o=!0,s=Tv(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},u={alignCorners:n,halfPixelCenters:r,size:e},l=Hy.runKernel("ResizeNearestNeighbor",a,u);return o?Tv(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aI(t,e=!1){return Hy.tidy((()=>{Sg(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let i=Bx(n),s=Ub(t);const o=vk([[1]],[1,1]);let a=Ub(o);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=s,u=a,l=i;[a,s,i]=Hy.tidy((()=>{const e=_v(s,[t,t],[n-t,1]),u=Fx(e),l=_v(s,[t,t],[1,1]),c=dx(Wx(l,0),vk([[-1]]),vk([[1]])),h=sw(l,Qb(c,u)),d=Yb(e,h);a=1===d.shape[0]?Ub(o):Ev([o,_v(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const p=nw(Yb(Rv(c,h),u)),f=_v(s,[t,0],[n-t,r]),g=Qb(p,a),m=Ek(a);if(0===t)s=sw(f,Rv(g,Rv(m,f)));else{const e=sw(f,Rv(g,Rv(m,f)));s=Ev([_v(s,[0,0],[t,r]),e],0)}const y=Ek(g),b=_v(i,[0,t],[n,i.shape[1]-t]);if(0===t)i=sw(b,Rv(Rv(b,a),y));else{const e=sw(b,Rv(Rv(b,a),y));i=Ev([_v(i,[0,0],[n,t]),e],1)}return[a,s,i]})),jb([e,u,l])}return!e&&n>r&&(i=_v(i,[0,0],[n,r]),s=_v(s,[0,0],[r,r])),[i,s]}))}const uI={flipLeftRight:Bk,grayscaleToRGB:Uk,resizeNearestNeighbor:oI,resizeBilinear:sI,rotateWithOffset:Vk,cropAndResize:zk,nonMaxSuppression:Gk,nonMaxSuppressionAsync:tI,nonMaxSuppressionWithScore:eI,nonMaxSuppressionWithScoreAsync:nI,nonMaxSuppressionPadded:rI,nonMaxSuppressionPaddedAsync:iI,threshold:nb({threshold_:function(t,e="binary",n=!1,r=.5){const i=tb(t,"image","threshold"),s=i.shape[0]*i.shape[1];let o,a,u,l,c=Qb(bk([r]),255);if(Sg(3===i.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`)),Sg(3===i.shape[2]||1===i.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`)),Sg("int32"===i.dtype||"float32"===i.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`)),Sg("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===i.shape[2]){[o,a,u]=ck(i,[1,1,1],-1);const t=Qb(o,.2989),e=Qb(a,.587),n=Qb(u,.114);l=Kb(Kb(t,e),n)}else l=t;if("otsu"===e){c=function(t,e){let n,r,i,s,o,a,u=bk([-1]),l=bk([0]),c=bk([0]);for(let h=0;h<t.size-1;h++){n=_v(t,0,h+1),r=_v(t,h+1),o=Yb(Ax(n),e),a=Yb(Ax(r),e);const d=Ax(Qb(n,Ww(0,n.size)));i=Yb(d,Ax(n));const p=Uv(r.shape,n.size),f=Kb(Ww(0,r.size),p),g=Qb(r,f);s=Yb(Ax(g),Ax(r));const m=sw(i,s),y=sw(i,s),b=Qb(o,a);c=Qb(Qb(b,m),y);const v=Wx(c,l);l=dx(v,c,l),u=dx(v,bk([h]),u)}return u}(Mv(Bb(Xw(l),"int32"),sb([]),256),s)}const h=n?Qx(l,c):Wx(l,c);return Bb(Qb(h,255),"int32")}}),transform:nb({transform_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n="nearest",r="constant",i=0,s){const o=tb(t,"image","transform","float32"),a=tb(e,"transforms","transform","float32");Sg(4===o.rank,(()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`)),Sg(2===a.rank&&(a.shape[0]===o.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),Sg(null==s||2===s.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`));const u={image:o,transforms:a},l={interpolation:n,fillMode:r,fillValue:i,outputShape:s};return Hy.runKernel("Transform",u,l)}})},lI={bandPart:nb({bandPart_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=tb(t,"a","bandPart");Sg(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const i=r.shape,[s,o]=r.shape.slice(-2);let a,u;"number"==typeof e?(Sg(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),Sg(e<=s,(()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`)),a=tb(e<0?s:e,"numLower","bandPart")):(Sg("int32"===e.dtype,(()=>"bandPart(): numLower's dtype must be an int32.")),a=dx(Yx(e,0),s,bw(e,s))),"number"==typeof n?(Sg(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`)),Sg(n<=o,(()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`)),u=tb(n<0?o:n,"numUpper","bandPart")):(Sg("int32"===n.dtype,(()=>"bandPart(): numUpper's dtype must be an int32.")),u=dx(Yx(n,0),o,bw(n,o)));const l=Tv(Ww(0,s,1,"int32"),[-1,1]),c=Ww(0,o,1,"int32"),h=sw(l,c),d=uw(Qx(h,a),Gx(h,nw(u))),p=mw([s,o],r.dtype);return Tv(fk(Ck(Tv(r,[-1,s,o])).map((t=>dx(d,t,p)))),i)}}),gramSchmidt:nb({gramSchmidt_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){let e;if(Array.isArray(t)){e=!1,Sg(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)Sg(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=ck(t,t.shape[0],0).map((t=>pk(t,[0])));Sg(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let i=0;i<t.length;++i)n.push(Hy.tidy((()=>{let t=r[i];if(i>0)for(let e=0;e<i;++e){const r=Qb(Ax(Qb(n[e],t)),n[e]);t=sw(t,r)}return Yb(t,Fx(t,"euclidean"))})));return e?fk(n,0):n}}),qr:nb({qr_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=!1){if(Sg(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return aI(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=Ck(Tv(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],s=[];r.forEach((t=>{const[n,r]=aI(t,e);i.push(n),s.push(r)}));return[Tv(fk(i,0),t.shape),Tv(fk(s,0),t.shape)]}}})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class cI{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class hI{constructor(){this.classNameMap={}}static getMap(){return null==hI.instance&&(hI.instance=new hI),hI.instance}static register(t){hI.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function dI(t){Sg(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),Sg("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),Sg(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),hI.register(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pI extends cI{minimize(t,e=!1,n){const{value:r,grads:i}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:i[t.name]})));this.applyGradients(t)}else this.applyGradients(i);return jb(i),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return function(t,e){Sg(Wg(t),(()=>"The f passed in variableGrads(f) must be a function")),Sg(null==e||Array.isArray(e)&&e.every((t=>t instanceof Iy)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in Hy.registeredVariables)e.push(Hy.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,i=e.length;Sg((e=e.filter((t=>t.trainable))).length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`));const{value:s,grads:o}=Hy.gradients(t,e,null,!0);Sg(o.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),Sg(0===s.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=o[e]&&(a[t.name]=o[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:s,grads:a}}(t,e)}dispose(){null!=this.iterations_&&jb(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Rx(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(pI,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class fI extends pI{static get className(){return"Adadelta"}constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=Hy.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Hy.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:Gb((()=>px(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:Gb((()=>px(r).variable(false)))});const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;Gb((()=>{const t=Kb(Qb(s,this.rho),Qb(_x(i),1-this.rho)),e=Qb(Yb($x(Kb(o,this.epsilon)),$x(Kb(s,this.epsilon))),i),n=Kb(Qb(o,this.rho),Qb(_x(e),1-this.rho));s.assign(t),o.assign(n);const a=Kb(Qb(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(jb(this.accumulatedGrads.map((t=>t.variable))),jb(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gI extends pI{static get className(){return"Adagrad"}constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Hy.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:Gb((()=>Uv(r.shape,this.initialAccumulatorValue).variable(t)))}}const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable;Gb((()=>{const t=Kb(s,_x(i));s.assign(t);const e=Kb(Qb(Yb(i,$x(Kb(t,Hy.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&jb(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mI extends pI{static get className(){return"Adam"}constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Gb((()=>{this.accBeta1=Rx(e).variable(),this.accBeta2=Rx(n).variable()})),null==r&&(this.epsilon=Hy.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);Gb((()=>{const n=sw(1,this.accBeta1),r=sw(1,this.accBeta2);e.forEach(((e,i)=>{const s=Hy.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:Gb((()=>px(s).variable(false)))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:`${e}/v`,variable:Gb((()=>px(s).variable(false)))});const o=Array.isArray(t)?t[i].tensor:t[e];if(null==o)return;const a=this.accumulatedFirstMoment[i].variable,u=this.accumulatedSecondMoment[i].variable,l=Kb(Qb(a,this.beta1),Qb(o,1-this.beta1)),c=Kb(Qb(u,this.beta2),Qb(_x(o),1-this.beta2)),h=Yb(l,n),d=Yb(c,r);a.assign(l),u.assign(c);const p=Kb(Qb(Yb(h,Kb($x(d),this.epsilon)),-this.learningRate),s);s.assign(p)})),this.accBeta1.assign(Qb(this.accBeta1,this.beta1)),this.accBeta2.assign(Qb(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&jb(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&jb(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),Gb((()=>{this.accBeta1.assign(Ex(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ex(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yI extends pI{static get className(){return"Adamax"}constructor(t,e,n,r=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Gb((()=>{this.iteration=Rx(0).variable(),this.accBeta1=Rx(e).variable()})),null==r&&(this.epsilon=Hy.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);Gb((()=>{const n=sw(1,this.accBeta1),r=Yb(-this.learningRate,Kb(Qb(this.iteration,this.decay),1));e.forEach(((e,i)=>{const s=Hy.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:px(s).variable(false)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:`${e}/v`,variable:px(s).variable(false)});const o=Array.isArray(t)?t[i].tensor:t[e];if(null==o)return;const a=this.accumulatedFirstMoment[i].variable,u=this.accumulatedWeightedInfNorm[i].variable,l=Kb(Qb(a,this.beta1),Qb(o,1-this.beta1)),c=Qb(u,this.beta2),h=Jb(o),d=fw(c,h);a.assign(l),u.assign(d);const p=Kb(Qb(Yb(r,n),Yb(l,Kb(d,this.epsilon))),s);s.assign(p)})),this.iteration.assign(Kb(this.iteration,1)),this.accBeta1.assign(Qb(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&jb(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&jb(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bI extends pI{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const i=Hy.registeredVariables[e];Gb((()=>{const t=Kb(Qb(this.c,r),i);i.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=Hb(Rx(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vI extends bI{static get className(){return"Momentum"}constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=Rx(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Hy.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:Gb((()=>px(r).variable(t)))}}const i=this.accumulations[n].variable,s=Array.isArray(t)?t[n].tensor:t[e];null!=s&&Gb((()=>{let t;const e=Kb(Qb(this.m,i),s);t=this.useNesterov?Kb(Qb(this.c,Kb(s,Qb(e,this.m))),r):Kb(Qb(this.c,e),r),i.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&jb(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xI extends pI{static get className(){return"RMSProp"}constructor(t,e=.9,n=0,r=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=Hy.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Hy.registeredVariables[e],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:Gb((()=>px(r).variable(i)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:Gb((()=>px(r).variable(i)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:Gb((()=>px(r).variable(i)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;Gb((()=>{const t=Kb(Qb(o,this.decay),Qb(_x(s),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,i=Kb(Qb(e,this.decay),Qb(s,1-this.decay)),u=Yb(Qb(s,this.learningRate),$x(sw(t,Kb(_x(i),this.epsilon)))),l=Kb(Qb(a,this.momentum),u);o.assign(t),e.assign(i),a.assign(l);const c=sw(r,l);r.assign(c)}else{const t=Kb(Qb(o,this.decay),Qb(_x(s),1-this.decay)),e=Kb(Qb(a,this.momentum),Yb(Qb(s,this.learningRate),$x(Kb(t,this.epsilon))));o.assign(t),a.assign(e);const n=sw(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&jb(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&jb(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&jb(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wI=[fI,gI,mI,yI,vI,xI,bI];function kI(t){return new Promise((t=>setTimeout(t))).then(t)}class II{constructor(t){if(!rm().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(II.URL_SCHEME)&&(t=t.slice(II.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=db(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),i=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=r,await kI((()=>i.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await kI((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:fb(t)}}}}II.URL_SCHEME="downloads://";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SI(t,e,n,r){var i,s,o;Sg(null!=(i=t)&&Array.isArray(i)&&i.length>0,(()=>"promises must be a none empty array")),o=r=null==r?1:r,Sg((s=n=null==n?0:n)>=0&&s<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${s}`)),Sg(o>=0&&o<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${o}`)),Sg(o>=s,(()=>`startFraction must be no more than endFraction, but got startFraction ${s} and endFraction ${o}`));let a=0;return Promise.all(t.map((i=>(i.then((i=>{const s=n+ ++a/t.length*(r-n);return e(s),i})),i))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mb.registerSaveRouter((t=>rm().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(II.URL_SCHEME)?function(t="model"){return new II(t)}(t.slice(II.URL_SCHEME.length)):null));class TI{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(Sg("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=rm().platform.fetch,Sg(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&Sg(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=db(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:fb(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(pg){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return pb(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),i=n>e?t.substring(n):"";return[r+"/",i]}(e),i=this.weightPathPrefix||n,s=function(t){const e=[];for(const n of t)e.push(...n.weights);return e}(t),o=[],a=[];for(const u of t)for(const t of u.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):o.push(i+t+r);this.weightUrlConverter&&o.push(...await Promise.all(a));return[s,hb(await async function(t,e){null==e&&(e={});const n=null==e.fetchFunc?rm().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),i=(null==e.onProgress?await Promise.all(r):await SI(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(i):await SI(i,e.onProgress,.5,1)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function CI(t){return null!=t.match(TI.URL_SCHEME_REGEX)}TI.URL_SCHEME_REGEX=/^https?:\/\//;const NI=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>CI(t))):CI(t),n)return EI(t,e)}return null};function EI(t,e){return new TI(t,e)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let RI;mb.registerSaveRouter(NI),mb.registerLoadRouter(NI);const $I=nb({fromPixels_:function(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,s=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)s=!0;else if(null!=t.getContext)o=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(null!=hm("FromPixels",Hy.backendName)){const n={pixels:t},r={numChannels:e};return Hy.runKernel("FromPixels",n,r)}const[u,l]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let c,h;if(o)c=t.getContext("2d").getImageData(0,0,u,l).data;else if(r||n)c=t.data;else if(s||i||a){if(null==RI)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");RI=new OffscreenCanvas(1,1).getContext("2d")}else RI=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});RI.canvas.width=u,RI.canvas.height=l,RI.drawImage(t,0,0,u,l),c=RI.getImageData(0,0,u,l).data}if(4===e)h=new Int32Array(c);else{const t=u*l;h=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)h[n*e+t]=c[4*n+t]}return function(t,e,n){if(Cg(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Qy(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ib(t,e,r,n)}(h,[l,u,e],"int32")}});function _I(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===Ng(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,s=i[i.length-1];let o=1;for(let h=0;h<i.length-1;++h)o*=i[h];const a=t.shape,u=i.slice();u.pop();let l=1;for(let h=s;h<n;++h)l*=a[h],u.push(a[h]);const c=[...jg(t.shape).map((t=>t/l)),1].slice(0,s);return[u,o,l,c]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AI(t,e,n){const r=t.shape.length;Sg(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),Sg(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let i=0;i<r;++i)Sg(e[i]+n[i]<=t.shape[i],(()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`))}function DI(t,e,n){const r=[];for(let i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function FI(t,e,n,r){const i=[...t];for(let s=i.length;s<r.length;s++)i.push(1);for(let s=0;s<n;s++)0===s?i[e]=1:(i.splice(e,0,1),i.pop());return i}function OI(t,e,n){return n<=t?n:n-(e-1)}function LI(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function PI(t,e,n,r,i){const s=[...i],o=LI(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=0;else{const i=OI(e,n,a);let o=r[i];t&1<<i&&(o=0),s[a]=o}return s}function MI(t,e,n,r,i){const s=[...i],o=LI(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const i=OI(e,n,a);let o=r[i];t&1<<i&&(o=Number.MAX_SAFE_INTEGER),s[a]=o}for(let a=0;a<s.length;a++){const t=i[a];s[a]<0&&(s[a]+=t),s[a]=wg(0,s[a],i[a])}return s}function zI(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function BI(t,e,n,r,i,s){let o=e[i];const a=n[i]||1;(t&1<<i||s&1<<i||null==o)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[i];return o<0&&(o+=u),o=wg(0,o,u-1),o}function UI(t,e,n,r,i,s){let o=e[i];const a=n[i]||1;(t&1<<i||s&1<<i||null==o)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[i];return o<0&&(o+=u),o=a>0?wg(0,o,u):wg(-1,o,u-1),o}function VI(t,e,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function WI(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function GI(t,e,n){let r;const i=t.shape.length;let s;return r="number"==typeof e?[e,...new Array(i-1).fill(0)]:e.length<i?e.concat(new Array(i-e.length).fill(0)):e.slice(),r.forEach((t=>{Sg(-1!==t,(()=>"slice() does not support negative begin indexing."))})),s=null==n?new Array(i).fill(-1):"number"==typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,s=s.map(((e,n)=>e>=0?e:(Sg(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,s]}function jI(t,e,n,r,i,s,o,a,u){let l;if(null==r?(l=new Array(e.length),l.fill(1)):l=r,null!=o&&0!=(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:l.slice(),beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};for(let b=0;b<h.dims;b++)c&&0!=(1<<b&a)&&h.numAddAxisAfterEllipsis++,1<<b&o&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const i=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<i;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(h,d);let p=!0,f=!0,g=!0;const m=[],y=[];for(let b=0;b<t.length;++b){if(0===d.strides[b])throw Error(`strides[${b}] must be non-zero`);const e=!!(d.shrinkAxisMask&1<<b),n=t[b];if(-1===n){m.push(e?1:-1);continue}const r=[d.beginMask&1<<b,d.endMask&1<<b],i=[d.strides[b]>0?0:-1,d.strides[b]>0?n:n-1];if(e&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&1===d.strides[b];const s=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(e){const t=d.begin[b]<0?n+d.begin[b]:d.begin[b];if(d.begin[b]=t,d.end[b]=d.begin[b]+1,t<0||t>=n)throw Error(`slice index ${d.begin[b]} of dimension ${b} out of bounds.`)}else d.begin[b]=HI(d.begin[b],0,d.strides[b],n,r,i),d.end[b]=HI(d.end[b],1,d.strides[b],n,r,i);const t=1===d.strides[b]&&0===d.begin[b]&&d.end[b]===n;p=p&&t,f=f&&(0===b&&1===d.strides[b]||t)}else p=p&&1===d.strides[b]&&s,f=f&&(0===b&&1===d.strides[b]||s);let o,a=!1;if(d.beginValid&&d.endValid?(o=d.end[b]-d.begin[b],a=!0):e?(o=1,a=!0):s&&n>=0&&(o=d.strides[b]<0?-n:n,a=!0),a){let t;t=0===o||o<0!=d.strides[b]<0?0:Math.trunc(o/d.strides[b])+(o%d.strides[b]!=0?1:0),m.push(t)}else m.push(-1)}for(let b=0;b<d.finalShapeGatherIndices.length;++b){const t=d.finalShapeGatherIndices[b];t>=0?y.push(m[t]):-2===t&&y.push(1)}return{finalShapeSparse:y.filter(((t,e)=>-2!==d.finalShapeGatherIndices[e])),finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:g,begin:d.begin,end:d.end,strides:d.strides}}function HI(t,e,n,r,i,s){if(i[e])return n>0?s[e]:s[e+1&1];{const e=t<0?r+t:t;return e<s[0]?s[0]:e>s[1]?s[1]:e}}var qI=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",assertParamsValid:AI,maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:DI,stridesWithElidedDims:FI,getNormalizedAxes:function(t,e,n,r,i,s,o,a,u){const l=t.length;let c=new Array(l),h=new Array(l),d=new Array(l);if(e.length&&n>0){const u=e[0],l=n+1;c=PI(o,u,l,r,t),h=MI(a,u,l,i,t),d=FI(s,u,l,t)}else for(let p=0;p<l;p++)c[p]=BI(o,r,s,t,p,u),h[p]=UI(a,i,s,t,p,u),d[p]=zI(s,p,u);return{begin:c,end:h,strides:d}},startIndicesWithElidedDims:PI,stopIndicesWithElidedDims:MI,stridesForAxis:zI,startForAxis:BI,stopForAxis:UI,isSliceContinous:VI,computeFlatOffset:WI,parseSliceParams:GI,sliceInfo:jI});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const KI=class{static sgd(t){return new bI(t)}static momentum(t,e,n=!1){return new vI(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,i=!1){return new xI(t,e,n,r,i)}static adam(t=.001,e=.9,n=.999,r=null){return new mI(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new fI(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,i=0){return new yI(t,e,n,r,i)}static adagrad(t,e=.1){return new gI(t,e)}},XI="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YI(){return new Promise((t=>XI((()=>t()))))}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QI(t,e){const n=t[0].length;t.forEach(((t,e)=>{Sg(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),Sg(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,i)=>{for(let s=0;s<n;s++)Sg(s===e||t[s]===r[s],(()=>`Error in concat${n}D: Shape of tensors[${i}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`))}))}function JI(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ZI,tS;function eS(t,e,n){let r=new Array;if(null==n&&null==e)return r;if(null==e)for(;r.length<t+n.length;)r.push(-1);else r=e.slice();if(null==n)return r;if(t+n.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${r.length}`);for(let i=1;i<n.length;++i){const s=n[i],o=r[r.length-n.length+i],a=r[o];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${i+t}] = ${s} but shape[${i+t}] = ${a}`)}else r[o]=s}return r}function nS(t){const e={FIRST_DIM_SIZE:ZI.FIRST_DIM_SIZE,VALUE_ROWIDS:ZI.VALUE_ROWIDS,ROW_LENGTHS:ZI.ROW_LENGTHS,ROW_SPLITS:ZI.ROW_SPLITS,ROW_LIMITS:ZI.ROW_LIMITS,ROW_STARTS:ZI.ROW_STARTS},n=[];for(const r of t){if(!(r in e))break;n.push(e[r])}return n}function rS(t){return 0===t.length?0:t[0]===ZI.FIRST_DIM_SIZE?t.length-1:t.length}function iS(t,e){if(null==t||null==e)return;const n=t.length,r=e.length;if(n>=r)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let i=0;i<Math.min(n,r-1);++i){const n=t[i],r=e[i+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${i-t.length}] = ${n} but ragged tensor input.flatValues.shape[${i-t.length}] = ${r}`)}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(tS=ZI||(ZI={}))[tS.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",tS[tS.VALUE_ROWIDS=1]="VALUE_ROWIDS",tS[tS.ROW_LENGTHS=2]="ROW_LENGTHS",tS[tS.ROW_SPLITS=3]="ROW_SPLITS",tS[tS.ROW_LIMITS=4]="ROW_LIMITS",tS[tS.ROW_STARTS=5]="ROW_STARTS";function sS(t){return t<=30?t:Gg(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oS(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aS(t,e,n,r=!0){let i=[];if(r)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)i=i.concat([t[r+1]/e[r],e[r]]);i=i.concat(t.slice(n+1))}return i}function uS(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],i=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function lS(t,e,n,r=!0){const i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(let s=1;s<t.length;++s)s<=e.length?r?i.push(e[s-1]*t[s]):i.push(t[s]/e[s-1]):i.push(t[s]);return i}function cS(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function hS(t,e,n){const r=t.slice(0,1);for(let i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dS=1.0507009873554805;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pS(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function fS(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function gS(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function mS(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function yS(t,e){return{real:t[2*e],imag:t[2*e+1]}}function bS(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function vS(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const s=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function xS(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wS=/->/g;function kS(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(wS,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,i]=t.split("->");Sg(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const s=r.split(","),o=s.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<i.length;++h){const t=i[h];if(!s.some((e=>-1!==e.indexOf(t))))throw new Error(`Output subscripts contain the label ${t} not present in the input subscripts.`);-1===a.indexOf(t)&&a.push(t)}for(let h=0;h<r.length;++h){const t=r[h];-1===a.indexOf(t)&&","!==t&&a.push(t)}const u=new Array(s.length);for(let h=0;h<o;++h){if(new Set(s[h].split("")).size!==s[h].length)throw new Error(`Found duplicate axes in input component ${s[h]}. Support for duplicate axes in input is not implemented yet.`);u[h]=[];for(let t=0;t<s[h].length;++t)u[h].push(a.indexOf(s[h][t]))}const l=a.length,c=[];for(let h=i.length;h<l;++h)c.push(h);return{allDims:a,summedDims:c,idDims:u}}function IS(t,e){let n=new Array(t);n.fill(-1);for(let i=0;i<e.length;++i)n[e[i]]=i;const r=[];for(let i=0;i<t;++i)-1===n[i]&&r.push(i);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}}function SS(t,e,n){const r=new Array(t);for(let i=0;i<n.length;++i){const t=n[i].shape;for(let n=0;n<e[i].length;++n)void 0===r[e[i][n]]?r[e[i][n]]=t[n]:Sg(r[e[i][n]]===t[n],(()=>`Expected dimension ${r[e[i][n]]} at axis ${n} of input shaped ${JSON.stringify(t)}, but got dimension ${t[n]}`))}}function TS(t,e){const n=t,r=[];let i=0;0===t.length&&n.push(-1),i=t.length+1;for(let o=0;o<i;++o)r.push([]);const s=[];for(let o=0;o<n.length;++o){const t=NS(e,n[o]);for(const e of t)-1===s.indexOf(e)&&(r[o].push(e),s.push(e))}return{path:n,steps:r}}function CS(t){return t.every(((t,e)=>t===e))}function NS(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}function ES(t,e,n=0){let r=[];if("number"==typeof e)Sg(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{Sg(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const i=e.indexOf(-1);if(-1!==i){const r=e.reduce(((t,e)=>e>0?t+e:t));e[i]=t.shape[n]-r}Sg(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RS(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`}function $S(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function _S(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AS(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function DS(t,e){return`size ${t} must be non-negative, not ${e}`}function FS(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function OS(t,e){return`Input to reshape is a SparseTensor with ${Ng(t)}\n  dense values, but the requested shape requires a multiple of ${Ng(e)}. inputShape=${t} outputShape= ${e}`}function LS(t,e){return`Input to reshape is a tensor with ${Ng(t)} dense values, but the requested shape has ${Ng(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PS(){return"segment ids must be >= 0"}function MS(){return"segment ids are not increasing"}function zS(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function BS(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function US(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=Gg(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=Gg(t,n+1);return n}function VS(t,e,n){const r=[],i=t.length;for(let s=0;s<i;s++)s!==e?r.push(t[s]):r.push(n);return r}function WS(t,e,n,r){const i=e.shape.length,s=t.shape.length;if(0!==r&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let h=0;h<r;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let u=1,l=1,c=1;for(let h=0;h<r;++h)a.push(t.shape[h]),u*=t.shape[h];for(let h=r;h<n;h++)a.push(t.shape[h]),l*=t.shape[h];for(let h=r;h<i;h++)a.push(e.shape[h]);for(let h=n+1;h<s;h++)a.push(t.shape[h]),c*=t.shape[h];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:o,outputShape:a}}var GS=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",segOpComputeOptimalWindowSize:US,computeOutShape:VS,collectGatherOpShapeInfo:WS});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jS(t){try{return t.map((t=>ay(t)))}catch(zj){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${zj}`)}}function HS(t){return t.map((t=>oy(t)))}var qS=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",slice_util:qI,segment_util:GS,fromUint8ToStringArray:jS,fromStringArrayToUint8:HS,upcastType:Oy,axesAreInnerMostDims:bx,combineLocations:vx,computeOutAndReduceShapes:xx,expandShapeToKeepDim:wx,assertAxesAreInnerMostDims:kx,getAxesPermutation:Ix,getUndoAxesPermutation:Sx,getInnerMostAxes:Tx,getBroadcastDims:ux,getReductionAxes:lx,assertAndGetBroadcastShape:cx,assertParamsConsistent:QI,computeOutShape:JI,computeDilation2DInfo:cv,computePool2DInfo:hv,computePool3DInfo:dv,computeConv2DInfo:pv,computeConv3DInfo:fv,computeDefaultPad:gv,tupleValuesAreOne:xv,eitherStridesOrDilationsAreOne:wv,stridesOrDilationsArePositive:kv,convertConv2DDataFormat:Iv,checkPadOnDimRoundingMode:Sv,getFusedDyActivation:_k,getFusedBiasGradient:Ak,applyActivation:Dk,shouldFuse:Fk,get RowPartitionType(){return ZI},combineRaggedTensorToTensorShapes:eS,getRowPartitionTypesHelper:nS,getRaggedRank:rS,validateDefaultValueShape:iS,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:sS,getImageCenter:oS,getReshaped:aS,getPermuted:uS,getReshapedPermuted:lS,getSliceBeginCoords:cS,getSliceSize:hS,prepareAndValidate:_I,validateUpdateShape:xk,validateInput:function(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}xk(n,e,t)},calculateShapes:wk,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:dS,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:um,log:function(...t){rm().getBool("IS_TEST")||rm().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:pS,splitRealAndImagArrays:fS,complexWithEvenIndex:gS,complexWithOddIndex:mS,getComplexWithIndex:yS,assignToTypedArray:bS,exponents:vS,exponent:xS,decodeEinsumEquation:kS,getEinsumPermutation:IS,checkEinsumDimSizes:SS,getEinsumComputePath:TS,isIdentityPermutation:CS,prepareSplitSize:ES,getSparseFillEmptyRowsIndicesDenseShapeMismatch:RS,getSparseFillEmptyRowsNegativeIndexErrorMessage:$S,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:_S,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:AS,getSparseReshapeNegativeOutputDimErrorMessage:DS,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:FS,getSparseReshapeInputOutputMultipleErrorMessage:OS,getSparseReshapeInputOutputMismatchErrorMessage:LS,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:PS,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:MS,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:zS,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:BS});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */!function(){for(const t of wI)dI(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */();
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const KS={kernelName:"Abs",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(t,gk(Bb(n,"float32"),-1))}}},XS={kernelName:"Acos",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=_x(Bb(n,"float32")),r=$x(sw(Rx(1),e));return nw(Yb(t,r))}}}},YS={kernelName:"Acosh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=$x(sw(_x(Bb(n,"float32")),1));return Yb(t,e)}}}},QS={kernelName:"Add",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=cx(n.shape,r.shape);return{a:()=>{let e=t;const r=lx(n.shape,i);return r.length>0&&(e=Ax(e,r)),Tv(e,n.shape)},b:()=>{let e=t;const n=lx(r.shape,i);return n.length>0&&(e=Ax(e,n)),Tv(e,r.shape)}}}},JS={kernelName:"AddN",saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach(((e,r)=>{n[r]=()=>t.clone()})),n}},ZS={kernelName:"ArgMax",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>px(n)}}},tT={kernelName:"ArgMin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>px(n)}}},eT={kernelName:"Asin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Yb(t,$x(sw(Rx(1),_x(Bb(n,"float32")))))}}},nT={kernelName:"Asinh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=$x(Kb(Rx(1),_x(Bb(n,"float32"))));return Yb(t,e)}}}},rT={kernelName:"Atan2",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=cx(n.shape,r.shape);return{a:()=>{const e=Kb(_x(n),_x(r));let s=Qb(t,Yb(r,e));const o=lx(n.shape,i);return o.length>0&&(s=Ax(s,o)),Tv(s,n.shape)},b:()=>{const e=Kb(_x(n),_x(r));let s=nw(Qb(t,Yb(n,e)));const o=lx(r.shape,i);return o.length>0&&(s=Ax(s,o)),Tv(s,r.shape)}}}},iT={kernelName:"Atan",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Yb(t,Kb(_x(Bb(n,"float32")),1))}}},sT={kernelName:"Atanh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Yb(t,sw(Rx(1),_x(Bb(n,"float32"))))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oT=nb({avgPool3dGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i,s){const o=tb(t,"dy","avgPool3dGrad"),a=tb(e,"input","avgPool3dGrad");let u=o,l=a,c=!1;4===a.rank&&(c=!0,u=Tv(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=Tv(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),Sg(5===u.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`)),Sg(5===l.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`)),Sv("avgPool3dGrad",i,s);const h={dy:u,input:l},d={filterSize:n,strides:r,pad:i,dimRoundingMode:s},p=Hy.runKernel("AvgPool3DGrad",h,d);return c?Tv(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),aT={kernelName:"AvgPool3D",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:o,dimRoundingMode:a}=n;return{x:()=>oT(t,r,i,s,o,a)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uT=nb({avgPoolGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i){const s=tb(t,"dy","avgPoolGrad"),o=tb(e,"input","avgPoolGrad");Sg(o.rank===s.rank,(()=>`Rank of input (${o.rank}) does not match rank of dy (${s.rank})`));let a=o,u=s,l=!1;3===o.rank&&(l=!0,a=Tv(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Tv(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Sg(4===u.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`)),Sg(4===a.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`));const c={dy:u,input:a},h={filterSize:n,strides:r,pad:i},d=Hy.runKernel("AvgPoolGrad",c,h);return l?Tv(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),lT={kernelName:"AvgPool",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:o}=n;return{x:()=>uT(t,r,i,s,o)}}},cT={kernelName:"BatchMatMul",inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[r,i]=e,{transposeA:s,transposeB:o}=n;return s||o?!s&&o?{a:()=>Rv(t,i,!1,!1),b:()=>Rv(t,r,!0,!1)}:s&&!o?{a:()=>Rv(i,t,!1,!0),b:()=>Rv(r,t,!1,!1)}:{a:()=>Rv(i,t,!0,!0),b:()=>Rv(t,r,!0,!0)}:{a:()=>Rv(t,i,!1,!0),b:()=>Rv(r,t,!0,!1)}}},hT={kernelName:"BatchToSpaceND",gradFunc:(t,e,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>Cw(t,r,i)}}},dT={kernelName:"BroadcastTo",gradFunc:(t,e,n)=>{const r=n,i=r.inputShape,s=r.shape,o=Array.from(s);for(let u=i.length-1;u>=0;u--)if(i[u]===s[u])o[u]=1;else if(1!==i[u])throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${s}].`);const a=[];for(let u=0;u<o.length;u++)o[u]>1&&a.push(u);return{x:()=>Ax(t,a,!0)}}},pT={kernelName:"Cast",gradFunc:t=>({x:()=>t.clone()})},fT={kernelName:"Ceil",gradFunc:t=>({x:()=>px(t)})},gT={kernelName:"ClipByValue",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>dx(uw(Gx(r,i),Qx(r,s)),t,px(t))}}},mT={kernelName:"ComplexAbs",inputsToSave:["x"],gradFunc:KS.gradFunc},yT={kernelName:"Concat",saveAllInputs:!0,gradFunc:(t,e,n)=>{const r=e.map((t=>t.shape)),{axis:i}=n,s=Fg(i,e[0].shape)[0],o=r.map((t=>t[s]));return ck(t,o,s).map((t=>()=>t))}},bT={kernelName:"Conv2D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{dilations:s,strides:o,pad:a,dataFormat:u}=n;return Sg(xv(s),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`)),{x:()=>Xv(r.shape,t,i,o,a,u),filter:()=>$k(r,t,i.shape,o,a,u)}}},vT={kernelName:"Conv2DBackpropInput",inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{strides:s,pad:o,dataFormat:a,dimRoundingMode:u}=n;return{dy:()=>qv(t,i,s,o,a,1,u),filter:()=>$k(t,r,i.shape,s,o,a,u)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xT=nb({conv3DBackpropFilter_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i){let s=t;4===t.rank&&(s=Tv(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;4===o.rank&&(o=Tv(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Sg(5===s.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`)),Sg(5===o.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`)),Sg(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),Sg(s.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`)),Sg(o.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`));const a={x:s,dy:o},u={strides:r,pad:i,filterShape:n};return Hy.runKernel("Conv3DBackpropFilterV2",a,u)}}),wT={kernelName:"Conv3D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s}=n;Sg(xv(r),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`));const[o,a]=e;return{x:()=>Jv(o.shape,t,a,i,s),filter:()=>xT(o,t,a.shape,i,s)}}},kT={kernelName:"Cos",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(nw(tk(Bb(n,"float32"))),t)}}},IT={kernelName:"Cosh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(ek(Bb(n,"float32")),t)}}},ST={kernelName:"Cumsum",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i,exclusive:s,reverse:o}=n;return{x:()=>{const e=Ix([i],r.rank);let n=rx(t,i,s,!o);return null!=e&&(n=Ek(n,e)),n}}}},TT={kernelName:"DepthwiseConv2dNative",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s,dimRoundingMode:o}=n,a=null==r?[1,1]:r;Sg(xv(a),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`));const[u,l]=e;return Sg(4===u.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`)),Sg(4===l.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`)),Sg(u.shape[3]===l.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`)),Sg(wv(i,a),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`)),Sv("depthwiseConv2d",s,o),{x:()=>Pk(u.shape,t,l,i,s,a,o),filter:()=>Lk(u,t,l.shape,i,s,a,o)}}},CT={kernelName:"Dilation2D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,s={x:r,filter:i,dy:t},o={x:r,filter:i,dy:t};return{x:()=>Hy.runKernel("Dilation2DBackpropInput",s,n),filter:()=>Hy.runKernel("Dilation2DBackpropFilter",o,n)}}},NT={kernelName:"Elu",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,r={dy:t,y:n};return{x:()=>Hy.runKernel("EluGrad",r)}}},ET={kernelName:"Erf",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=Qb(Lx(nw(_x(n))),2/Math.sqrt(Math.PI));return{x:()=>Qb(t,r)}}},RT={kernelName:"Exp",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(t,n)}}},$T={kernelName:"ExpandDims",inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>Tv(t,n.shape)}}},_T={kernelName:"Expm1",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(t,Lx(n))}}},AT={kernelName:"Floor",gradFunc:t=>({x:()=>px(t)})},DT={kernelName:"FloorDiv",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=cx(n.shape,r.shape);return{a:()=>{const e=Yb(t,Bb(r,"float32")),s=lx(n.shape,i);return s.length>0?Tv(Ax(e,s),n.shape):e},b:()=>{let e=Qb(t,Bb(n,"float32"));const s=lx(r.shape,i);s.length>0&&(e=Tv(Ax(e,s),r.shape));const o=_x(r);return nw(Yb(e,Bb(o,"float32")))}}}},FT={kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:r}=n,[i,s,o,a]=e,u=null==a?Rx(1):a,l=lx(s.shape,i.shape),c=[];if(1===s.rank){for(let t=0;t<i.shape.length-1;++t)c.push(i.shape[t]);c.push(1)}const h=sw(i,s),d=Qb(t,u),p=Yw(Kb(o,Rx(r))),f=Qb(Qb(Qb(p,p),p),Rx(-.5));return{x:()=>1===s.rank?Tv(Qb(Qb(t,zx(Tv(p,[1,1,1,s.shape[0]]),c)),u),i.shape):Tv(Qb(Qb(t,p),u),i.shape),mean:()=>{let t=Qb(Qb(p,Rx(-1)),d);return 1===s.rank&&(t=Ax(t,l)),Tv(t,s.shape)},variance:()=>{let t=Qb(Qb(f,h),d);return 1===s.rank&&(t=Ax(t,l)),Tv(t,s.shape)},scale:()=>{const e=Qb(h,p);let n=Qb(t,e);return 1===s.rank&&(n=Ax(n,l)),Tv(n,s.shape)},offset:()=>{let e=t;return 1===s.rank&&(e=Ax(e,l)),Tv(e,s.shape)}}}},OT={kernelName:"GatherV2",inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[r,i]=e,{axis:s}=n,o=Fg(s,r.shape)[0];return{x:()=>{const e=r.shape,n=i.size,a=e.slice(0,o),u=a.length,l=e.slice(s,e.length).slice(1),c=l.length,h=LT(0,u),d=LT(u+1,u+1+c),p=PT([a,[n],l]),f=Tv(t,p),g=Tv(i,[n]),m=PT([[u],h,d]),y=Ek(f,m);let b=Tk(y,g,r.shape[o]);const v=Sx(m);return b=Ek(b,v),b},indices:()=>i}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LT(t,e){const n=[];for(let r=t;r<e;++r)n.push(r);return n}function PT(t){const e=[];for(let n=0;n<t.length;++n)for(let r=0;r<t[n].length;++r)e.push(t[n][r]);return e}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MT={kernelName:"GreaterEqual",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>px(n),b:()=>px(r)}}},zT={kernelName:"Identity",gradFunc:t=>({x:()=>Bb(t,"float32")})},BT={kernelName:"IsFinite",gradFunc:t=>({x:()=>px(t)})},UT={kernelName:"IsInf",gradFunc:t=>({x:()=>px(t)})},VT={kernelName:"IsNan",gradFunc:t=>({x:()=>px(t)})},WT={kernelName:"LeakyRelu",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{alpha:i}=n,s=Wx(r,0);return{x:()=>dx(s,t,Qb(t,i))}}},GT={kernelName:"Log1p",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Yb(t,Kb(n,1))}}},jT={kernelName:"Log",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Yb(t,Bb(n,"float32"))}}},HT={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;return{logits:()=>{const e=Lx(r);return sw(t,Qb(Ax(t,i,!0),e))}}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qT=nb({localResponseNormalizationBackprop_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=5,i=1,s=1,o=.5){const a={x:t,y:e,dy:n},u={depthRadius:r,bias:i,alpha:s,beta:o};return Hy.runKernel("LRNGrad",a,u)}}),KT={kernelName:"LRN",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{depthRadius:s,bias:o,alpha:a,beta:u}=n;return{x:()=>qT(r,i,t,s,o,a,u)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function XT(t,e,n,r){return e.rank<n.rank&&(e=Tv(e,wx(e.shape,r))),t.rank<n.rank&&(t=Tv(t,wx(t.shape,r))),{x:()=>Qb(t,Bb(hx(n,e),t.dtype))}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YT={kernelName:"Max",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{reductionIndices:i}=r,s=e[0],o=XT(t,e[1],s,Fg(i,s.shape));return{x:()=>o.x()}}},QT={kernelName:"Maximum",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Qb(t,Bb(Gx(n,r),"float32")),b:()=>Qb(t,Bb(Yx(n,r),"float32"))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JT=nb({maxPool3dGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i,s,o){const a=tb(t,"dy","maxPool3dGrad"),u=tb(e,"input","maxPool3dGrad"),l=tb(n,"output","maxPool3dGrad");let c=a,h=u,d=l,p=!1;4===u.rank&&(p=!0,c=Tv(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=Tv(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),d=Tv(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),Sg(5===c.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`)),Sg(5===h.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`)),Sg(5===d.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`)),Sv("maxPool3dGrad",s,o);const f={dy:c,input:h,output:d},g={filterSize:r,strides:i,pad:s,dimRoundingMode:o},m=Hy.runKernel("MaxPool3DGrad",f,g);return p?Tv(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),ZT={kernelName:"MaxPool3D",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=n;return{x:()=>JT(t,r,i,s,o,a,u)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tC=nb({maxPoolGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i,s,o){const a=tb(t,"dy","maxPoolGrad"),u=tb(e,"input","maxPoolGrad"),l=tb(n,"output","maxPoolGrad");Sg(u.rank===a.rank,(()=>`Rank of input (${u.rank}) does not match rank of dy (${a.rank})`)),Sg(4===a.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`)),Sg(4===u.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`)),Sv("maxPoolGrad",s,o);const c={dy:a,input:u,output:l},h={filterSize:r,strides:i,pad:s,dimRoundingMode:o};return Hy.runKernel("MaxPoolGrad",c,h)}}),eC={kernelName:"PadV2",inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map((t=>t[0]));return{x:()=>_v(t,s,r.shape)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nC(t,e,n){const r=t.shape.length,i=r-n.length,s=Ix(n,r);let o=t;null!=s&&(o=Ek(t,s));const a=o.shape.slice(),u=a.splice(r-n.length,n.length).reduce(((t,e)=>t*e),1);a.push(u);let l=
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=t.shape.slice();r[n]=1;const i=Tv(e,r),s=nx(t,n,!0,!1),o=nx(t,n,!0,!0),a=Qb(s,o);return Qb(i,a)}(o.reshape(a),e,i);if(l=l.reshape(o.shape),null!=s){const t=Sx(s);l=Ek(l,t)}return l}const rC={kernelName:"SpaceToBatchND",gradFunc:(t,e,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>Dv(t,r,i)}}},iC={kernelName:"SplitV",gradFunc:(t,e,n)=>{const{axis:r}=n;return{x:()=>Ev(t,r)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const sC=[KS,XS,YS,QS,JS,ZS,tT,eT,nT,rT,iT,sT,aT,lT,cT,hT,dT,pT,fT,gT,mT,yT,vT,bT,wT,kT,IT,ST,TT,CT,{kernelName:"RealDiv",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=cx(n.shape,r.shape);return{a:()=>{const e=Yb(t,Bb(r,"float32")),s=lx(n.shape,i);return s.length>0?Tv(Ax(e,s),n.shape):e},b:()=>{let e=Qb(t,Bb(n,"float32"));const s=lx(r.shape,i);s.length>0&&(e=Tv(Ax(e,s),r.shape));const o=_x(r);return nw(Yb(e,Bb(o,"float32")))}}}},NT,ET,RT,$T,_T,DT,AT,FT,OT,MT,zT,BT,UT,VT,WT,GT,jT,HT,KT,YT,YT,QT,ZT,{kernelName:"MaxPool",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,pad:a}=n;return{x:()=>tC(t,r,i,s,o,a)}}},{kernelName:"Mean",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n,s=Fg(i,r.shape),o=Ng(xx(r.shape,s)[1]);return{x:()=>{const e=r.shape.slice();s.forEach((t=>{e[t]=1}));const n=Tv(t,e);return Yb(Qb(n,yw(r.shape,"float32")),o)}}}},{kernelName:"Min",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{axis:i}=r,[s,o]=e,a=XT(t,o,s,Fg(i,s.shape));return{x:()=>a.x()}}},{kernelName:"Minimum",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Qb(t,Bb(Qx(n,r),"float32")),b:()=>Qb(t,Bb(Wx(n,r),"float32"))}}},{kernelName:"MirrorPad",inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map((t=>t[0]));return{x:()=>_v(t,s,r.shape)}}},{kernelName:"Mod",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=cx(n.shape,r.shape);return{a:()=>{const e=lx(n.shape,i);return e.length>0?Tv(Ax(t,e),n.shape):t},b:()=>{const e=Qb(t,nw(Ux(Yb(n,r)))),s=lx(r.shape,i);return s.length>0?Tv(Ax(e,s),r.shape):e}}}},{kernelName:"Multiply",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=cx(n.shape,r.shape);return{a:()=>{const e=Qb(t,Bb(r,"float32")),s=lx(n.shape,i);return s.length>0?Tv(Ax(e,s),n.shape):e},b:()=>{const e=Qb(t,Bb(n,"float32")),s=lx(r.shape,i);return s.length>0?Tv(Ax(e,s),r.shape):e}}}},{kernelName:"Neg",gradFunc:t=>({x:()=>nw(t)})},{kernelName:"OneHot",inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>mw(n.shape,"float32")}}},{kernelName:"OnesLike",gradFunc:t=>({x:()=>px(t)})},{kernelName:"Pack",saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:r}=n;return Ck(t,r).map((t=>()=>t))}},eC,eC,{kernelName:"Pow",inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,r,i]=e,s=n,o=r,a=cx(s.shape,o.shape);return{a:()=>{const e=Bb(o,"float32");let n=Qb(t,Qb(e,Ex(s,sw(e,Rx(1)))));const r=lx(s.shape,a);return r.length>0&&(n=Ax(n,r)),Tv(n,s.shape)},b:()=>{const e=Wx(s,0),n=dx(e,Zx(s),px(s));let r=Qb(t,Qb(i,n));const u=lx(o.shape,a);return u.length>0&&(r=Ax(r,u)),Tv(r,o.shape)}}}},{kernelName:"Prelu",inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,r]=e,i=Wx(n,0);return{x:()=>dx(i,t,Qb(t,r)),alpha:()=>{let e=dx(i,px(t),Qb(t,n));const s=lx(r.shape,t.shape);return s.length>0&&(e=Ax(e,s)),Tv(e,r.shape)}}}},{kernelName:"Prod",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;let s=[];return s=null==i?r.shape.map(((t,e)=>e)):"number"==typeof i?[i]:i,{x:()=>nC(r,t,s)}}},{kernelName:"Reciprocal",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Yb(t,nw(_x(n)))}}},{kernelName:"Relu6",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=Qb(Qx(n,6),gk(n));return{x:()=>Qb(t,Bb(r,"float32"))}}},{kernelName:"Relu",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(t,Bb(gk(n),"float32"))}}},{kernelName:"Reshape",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tv(t,n.shape)}}},{kernelName:"ResizeBilinear",inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Hy.runKernel("ResizeBilinearGrad",i,n)}}},{kernelName:"ResizeNearestNeighbor",inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Hy.runKernel("ResizeNearestNeighborGrad",i,n)}}},{kernelName:"Reverse",gradFunc:(t,e,n)=>{const{dims:r}=n,i=Fg(r,t.shape);return{x:()=>Kw(t,i)}}},{kernelName:"Round",gradFunc:t=>({x:()=>px(t)})},{kernelName:"Rsqrt",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nw(Yb(t,Qb(Ex(n,1.5),2)))}}},{kernelName:"Select",inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>Bb(px(n),"float32"),t:()=>Qb(t,Bb(n,t.dtype)),e:()=>Qb(t,Bb(lw(n),t.dtype))}}},{kernelName:"Selu",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=Wx(n,Rx(0)),r=Rx(1.7580993408473768),i=Rx(dS),s=Qb(t,i),o=Qb(Qb(t,r),Lx(Bb(n,"float32")));return dx(e,s,o)}}}},{kernelName:"Sigmoid",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(t,Qb(n,sw(Rx(1),n)))}}},{kernelName:"Sign",gradFunc:t=>({x:()=>px(t)})},{kernelName:"Sin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(tx(Bb(n,"float32")),t)}}},{kernelName:"Sinh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(ex(Bb(n,"float32")),t)}}},{kernelName:"Slice",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{begin:i,size:s}=n,o=r.shape,[a,u]=GI(r,i,s),l=[];for(let c=0;c<t.rank;c++)l.push([a[c],o[c]-a[c]-u[c]]);return{x:()=>Tw(t,l)}}},{kernelName:"Softmax",outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{dim:i}=n,s=Qb(t,r);return{logits:()=>sw(s,Qb(Ax(s,[i],true),r))}}},{kernelName:"Softplus",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(t,$v(n))}}},rC,rC,iC,iC,{kernelName:"Sqrt",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Yb(t,Qb($x(Bb(n,"float32")),2))}}},{kernelName:"SquaredDifference",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Rx(2);return{a:()=>Qb(t,Qb(i,sw(n,r))),b:()=>Qb(t,Qb(i,sw(r,n)))}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(t,Qb(Bb(n,"float32"),2))}}},{kernelName:"Step",gradFunc:t=>({x:()=>px(t)})},{kernelName:"Sub",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=cx(n.shape,r.shape);return{a:()=>{let e=t;const r=lx(n.shape,i);return r.length>0&&(e=Ax(e,r)),Tv(e,n.shape)},b:()=>{let e=t;const n=lx(r.shape,i);return n.length>0&&(e=Ax(e,n)),Tv(nw(e),r.shape)}}}},{kernelName:"Sum",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,i=r.shape.slice(),{axis:s}=n;Fg(s,r.shape).forEach((t=>{i[t]=1}));const o=Tv(t,i),a=Qb(o,yw(r.shape,"float32"));return{x:()=>a}}},{kernelName:"Tan",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Yb(t,_x(tx(n)))}}},{kernelName:"Tanh",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qb(sw(Rx(1),_x(n)),t)}}},{kernelName:"Tile",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{reps:i}=n;return{x:()=>{let e=px(r);if(1===r.rank)for(let n=0;n<i[0];++n)e=Kb(e,_v(t,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)e=Kb(e,_v(t,[n*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let o=0;o<i[2];++o)e=Kb(e,_v(t,[n*r.shape[0],s*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let o=0;o<i[2];++o)for(let a=0;a<i[3];++a)e=Kb(e,_v(t,[n*r.shape[0],s*r.shape[1],o*r.shape[2],a*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return e}}}},{kernelName:"Transpose",gradFunc:(t,e,n)=>{const r=n,{perm:i}=r,s=Sx(i);return{x:()=>Ek(t,s)}}},{kernelName:"Unpack",gradFunc:(t,e,n)=>{const r=n,{axis:i}=r;return{value:()=>fk(t,i)}}},{kernelName:"UnsortedSegmentSum",inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>function(t,e){const n=fw(e,px(e)),r=Vx(t,n);let i=Gx(e,Rx(0,"int32"));const s=r.rank-i.rank;for(let a=0;a<s;++a)i=Px(i,a+1);i=uw(i,yw(r.shape,"bool"));const o=px(r);return dx(i,r,o)}(t,n)}}},{kernelName:"ZerosLike",gradFunc:t=>({x:()=>px(t)})}];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const Bj of sC)gm(Bj);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ky().prototype.abs=function(){return this.throwIfDisposed(),Jb(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.acos=function(){return this.throwIfDisposed(),Zb(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.acosh=function(){return this.throwIfDisposed(),tv(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.add=function(t){return this.throwIfDisposed(),Kb(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.all=function(t,e){return this.throwIfDisposed(),ev(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.any=function(t,e){return this.throwIfDisposed(),nv(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.argMax=function(t){return this.throwIfDisposed(),rv(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.argMin=function(t){return this.throwIfDisposed(),iv(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.asScalar=function(){return this.throwIfDisposed(),Sg(1===this.size,(()=>"The array must have only 1 element.")),Tv(this,[])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.asType=function(t){return this.throwIfDisposed(),Bb(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.as1D=function(){return this.throwIfDisposed(),Tv(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.as2D=function(t,e){return this.throwIfDisposed(),Tv(this,[t,e])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),Tv(this,[t,e,n])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),Tv(this,[t,e,n,r])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.as5D=function(t,e,n,r,i){return this.throwIfDisposed(),Tv(this,[t,e,n,r,i])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.asin=function(){return this.throwIfDisposed(),sv(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.asinh=function(){return this.throwIfDisposed(),ov(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.atan=function(){return this.throwIfDisposed(),av(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.atan2=function(t){return this.throwIfDisposed(),uv(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.atanh=function(){return this.throwIfDisposed(),lv(this)},ky().prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),Cv(this,t,e,n,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Dv(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.batchNorm=function(t,e,n,r,i){return this.throwIfDisposed(),Fv(this,t,e,n,r,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.broadcastTo=function(t){return this.throwIfDisposed(),zv(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.cast=function(t){return this.throwIfDisposed(),Bb(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.ceil=function(){return this.throwIfDisposed(),Bv(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Vv(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof wy&&(t=[t]),Ev([this,...t],e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.conv1d=function(t,e,n,r,i,s){return this.throwIfDisposed(),Kv(this,t,e,n,r,i,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.conv2dTranspose=function(t,e,n,r,i){return this.throwIfDisposed(),Yv(this,t,e,n,r,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.conv2d=function(t,e,n,r,i,s){return this.throwIfDisposed(),qv(this,t,e,n,r,i,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.cos=function(){return this.throwIfDisposed(),tx(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.cosh=function(){return this.throwIfDisposed(),ex(this)},
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),nx(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),rx(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),sx(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.depthwiseConv2d=function(t,e,n,r,i,s){return this.throwIfDisposed(),ox(this,t,e,n,r,i,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.dilation2d=function(t,e,n,r,i){return this.throwIfDisposed(),ax(this,t,e,n,r,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.divNoNan=function(t){return this.throwIfDisposed(),fx(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.div=function(t){return this.throwIfDisposed(),Yb(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.dot=function(t){return this.throwIfDisposed(),gx(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.elu=function(){return this.throwIfDisposed(),mx(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.equal=function(t){return this.throwIfDisposed(),hx(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.erf=function(){return this.throwIfDisposed(),yx(this)},
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),Ox(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.exp=function(){return this.throwIfDisposed(),Lx(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.expandDims=function(t){return this.throwIfDisposed(),Px(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.expm1=function(){return this.throwIfDisposed(),Mx(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.fft=function(){return this.throwIfDisposed(),ak(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.flatten=function(){return this.throwIfDisposed(),Tv(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.floor=function(){return this.throwIfDisposed(),Ux(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.floorDiv=function(t){return this.throwIfDisposed(),Xb(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.gather=function(t,e,n){return this.throwIfDisposed(),Vx(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Gx(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.greater=function(t){return this.throwIfDisposed(),Wx(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.ifft=function(){return this.throwIfDisposed(),uk(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.irfft=function(){return this.throwIfDisposed(),lk(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.isFinite=function(){return this.throwIfDisposed(),Hx(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.isInf=function(){return this.throwIfDisposed(),qx(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.isNaN=function(){return this.throwIfDisposed(),Kx(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Xx(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.lessEqual=function(t){return this.throwIfDisposed(),Qx(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.less=function(t){return this.throwIfDisposed(),Yx(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.localResponseNormalization=function(t,e,n,r){return this.throwIfDisposed(),Jx(this,t,e,n,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.logSigmoid=function(){return this.throwIfDisposed(),iw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.logSoftmax=function(t){return this.throwIfDisposed(),ow(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),aw(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.log=function(){return this.throwIfDisposed(),Zx(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.log1p=function(){return this.throwIfDisposed(),tw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.logicalAnd=function(t){return this.throwIfDisposed(),uw(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.logicalNot=function(){return this.throwIfDisposed(),lw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.logicalOr=function(t){return this.throwIfDisposed(),cw(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.logicalXor=function(t){return this.throwIfDisposed(),hw(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),Rv(this,t,e,n)},ky().prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),dw(this,t,e,n,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.max=function(t,e){return this.throwIfDisposed(),Cx(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.maximum=function(t){return this.throwIfDisposed(),fw(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.mean=function(t,e){return this.throwIfDisposed(),gw(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.min=function(t,e){return this.throwIfDisposed(),Nx(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.minimum=function(t){return this.throwIfDisposed(),bw(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),vw(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.mod=function(t){return this.throwIfDisposed(),xw(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.mul=function(t){return this.throwIfDisposed(),Qb(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.neg=function(){return this.throwIfDisposed(),nw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.norm=function(t,e,n){return this.throwIfDisposed(),Fx(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.notEqual=function(t){return this.throwIfDisposed(),kw(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),Iw(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.onesLike=function(){return this.throwIfDisposed(),Sw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.pad=function(t,e){return this.throwIfDisposed(),Tw(this,t,e)},ky().prototype.pool=function(t,e,n,r,i,s){return this.throwIfDisposed(),Nw(this,t,e,n,r,i,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.pow=function(t){return this.throwIfDisposed(),Ex(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.prelu=function(t){return this.throwIfDisposed(),Ew(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.prod=function(t,e){return this.throwIfDisposed(),Rw(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.reciprocal=function(){return this.throwIfDisposed(),jw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.relu=function(){return this.throwIfDisposed(),Hw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.relu6=function(){return this.throwIfDisposed(),qw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.reshapeAs=function(t){return this.throwIfDisposed(),Tv(this,t.shape)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.reshape=function(t){return this.throwIfDisposed(),Tv(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),sI(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),oI(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.reverse=function(t){return this.throwIfDisposed(),Kw(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.rfft=function(){return this.throwIfDisposed(),hk(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.round=function(){return this.throwIfDisposed(),Xw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.rsqrt=function(){return this.throwIfDisposed(),Yw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.selu=function(){return this.throwIfDisposed(),Qw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.separableConv2d=function(t,e,n,r,i,s){return this.throwIfDisposed(),Jw(this,t,e,n,r,i,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.sigmoid=function(){return this.throwIfDisposed(),$v(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.sign=function(){return this.throwIfDisposed(),Zw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.sin=function(){return this.throwIfDisposed(),tk(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.sinh=function(){return this.throwIfDisposed(),ek(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.slice=function(t,e){return this.throwIfDisposed(),_v(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.softmax=function(t){return this.throwIfDisposed(),ok(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.softplus=function(){return this.throwIfDisposed(),rw(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Cw(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.split=function(t,e){return this.throwIfDisposed(),ck(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.sqrt=function(){return this.throwIfDisposed(),$x(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.square=function(){return this.throwIfDisposed(),_x(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.squaredDifference=function(t){return this.throwIfDisposed(),dk(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.squeeze=function(t){return this.throwIfDisposed(),pk(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof wy?[this,t]:[this,...t];return fk(n,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.step=function(t){return this.throwIfDisposed(),gk(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.stridedSlice=function(t,e,n,r,i,s,o,a){return this.throwIfDisposed(),mk(this,t,e,n,r,i,s,o,a)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.sub=function(t){return this.throwIfDisposed(),sw(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.sum=function(t,e){return this.throwIfDisposed(),Ax(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.tan=function(){return this.throwIfDisposed(),yk(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.tanh=function(){return this.throwIfDisposed(),Av(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.tile=function(t){return this.throwIfDisposed(),zx(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.toBool=function(){return this.throwIfDisposed(),Bb(this,"bool")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.toFloat=function(){return this.throwIfDisposed(),Bb(this,"float32")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.toInt=function(){return this.throwIfDisposed(),Bb(this,"int32")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.topk=function(t,e){return this.throwIfDisposed(),kk(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.transpose=function(t){return this.throwIfDisposed(),Ek(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.unique=function(t){return this.throwIfDisposed(),Sk(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),Tk(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.unstack=function(t){return this.throwIfDisposed(),Ck(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.where=function(t,e){return this.throwIfDisposed(),dx(t,this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ky().prototype.zerosLike=function(){return this.throwIfDisposed(),px(this)};
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class oC extends Error{constructor(t){super(t),Object.setPrototypeOf(this,oC.prototype)}}class aC extends Error{constructor(t){super(t),Object.setPrototypeOf(this,aC.prototype)}}class uC extends Error{constructor(t){super(t),Object.setPrototypeOf(this,uC.prototype)}}class lC extends Error{constructor(t){super(t),Object.setPrototypeOf(this,lC.prototype)}}class cC extends Error{constructor(t){super(t),Object.setPrototypeOf(this,cC.prototype)}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hC{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const t=this.cache.keys().next().value;this.cache.delete(t)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const t=this.cache.keys().next().value;this.cache.delete(t)}this.maxEntries=t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dC(t,e){if(Array.isArray(t)){let n=[];for(let r=0;r<e;r++)n=n.concat(t);return n}{const n=new Array(e);return n.fill(t),n}}function pC(t,e){if(!t)throw new cC(e)}function fC(t,e){let n=0;for(const r of t)r===e&&n++;return n}function gC(t){return 1===t.length?t[0]:t}function mC(t){return Array.isArray(t)?t:[t]}function yC(t){const e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function bC(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,((t,e)=>e.toUpperCase()))}let vC={};function xC(t){if(null==t)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function wC(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((t=>wC(t)));else{const e=Object.keys(t);for(const n of e){const e=t[n];null!=e&&"object"==typeof e&&(Array.isArray(e)||"ndarray"!==e.type||"number"!=typeof e.value?wC(e):t[n]=e.value)}}}function kC(t,e={},n={},r="object",i=!1){if("string"==typeof t){const i=t;let s;if(i in n)s=n[i];else if(i in vC)s=vC[i];else if(s=e[i],null==s)throw new uC(`Unknown ${r}: ${t}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}{const s=t;if(null==s.className||null==s.config)throw new uC(`${r}: Improper config format: ${JSON.stringify(s)}.\n'className' and 'config' must set.`);const o=s.className;let a,u;if(o in n?[a,u]=n[o]:o in vC?[a,u]=vC.className:o in e&&([a,u]=e[o]),null==a)throw new uC(`Unknown ${r}: ${o}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=u){const t={};for(const n of Object.keys(vC))t[n]=vC[n];for(const i of Object.keys(n))t[i]=n[i];s.config.customObjects=t;const e=Object.assign({},vC);for(const i of Object.keys(n))vC[i]=n[i];wC(s.config);const r=u(a,s.config,n,i);return vC=Object.assign({},e),r}{const t=Object.assign({},vC);for(const r of Object.keys(n))vC[r]=n[r];const e=new a(s.config);return vC=Object.assign({},t),e}}}function IC(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function SC(t){if(null==t)return t;const e=[];for(const n of t)-1===e.indexOf(n)&&e.push(n);return e}function TC(t){if(null==t)throw new uC(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function CC(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new uC(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function NC(t,e,n=0,r=1/0){return pC(n>=0),pC(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every((t=>typeof t===e))}function EC(t,e){Array.isArray(t)?(Sg(t.length>0,(()=>`${e} is unexpectedly an empty array.`)),t.forEach(((t,n)=>EC(t,`element ${n+1} of ${e}`)))):Sg(Number.isInteger(t)&&t>0,(()=>`Expected ${e} to be a positive integer, but got ${RC(t)}.`))}function RC(t){return null===t?"null":Array.isArray(t)?"["+t.map((t=>RC(t))).join(",")+"]":"string"==typeof t?`"${t}"`:`${t}`}function $C(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let _C=0;function AC(){return _C++}const DC={};function FC(t=""){return t in DC||(DC[t]=0),DC[t]+=1,t+DC[t].toString()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const OC=["channelsFirst","channelsLast"],LC=["nearest","bilinear"],PC=["valid","same","causal"],MC=["max","avg"],zC=["sum","mul","concat","ave"],BC=new Map;function UC(t){CC(OC,"DataFormat",t)}function VC(t){CC(PC,"PaddingMode",t)}function WC(t){CC(MC,"PoolMode",t)}const GC=[];function jC(t,e){GC.push(t);try{const t=e();return GC.pop(),t}catch(pg){throw GC.pop(),pg}}function HC(t){if(!XC(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===GC.length?"":GC.join("/")+"/")+t}function qC(t){if(!XC(t))throw new Error("Not a valid tensor name: '"+t+"'");BC.has(t)||BC.set(t,0);const e=BC.get(t);if(BC.set(t,BC.get(t)+1),e>0){const n=`${t}_${e}`;return BC.set(n,1),n}return t}const KC=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function XC(t){return!!t.match(KC)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function YC(t,e,n){null==e&&(e=0),null==n&&(n=t.length);let r=1;for(let i=e;i<n;++i)r*=t[i];return r}function QC(t){if(0===t.length)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r<e&&(e=r)}return e}function JC(t){if(0===t.length)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r>e&&(e=r)}return e}function ZC(t,e){if(e<t)throw new uC(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let r=t;r<e;++r)n.push(r);return n}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let tN;function eN(){return null==tN&&(tN=Hy.backend.epsilon()),tN}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function nN(t,e){return Bb(t,e)}function rN(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),Tv(t,n)}function iN(t,e,n){return Gb((()=>{switch(t.rank){case 1:return nk(t,e,n);case 2:return rk(t,[e,0],[n,t.shape[1]]);case 3:return ik(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return sk(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return _v(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return _v(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new uC(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function sN(t,e,n){return Gb((()=>{switch(t.rank){case 1:return nk(t,e,n);case 2:return rk(t,[0,e],[t.shape[0],n]);case 3:return ik(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return sk(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new uC(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function oN(t,e,n,r){return Gb((()=>{switch(t.rank){case 1:return nk(t,e,n);case 2:switch(r){case 1:return iN(t,e,n);case 2:return sN(t,e,n);default:throw new uC(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return iN(t,e,n);case 2:return ik(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return sN(t,e,n);default:throw new uC(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return iN(t,e,n);case 2:return sk(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return sk(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return sN(t,e,n);default:throw new uC(`The axis is not within the rank of the tensor ${r}`)}default:throw new uC(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function aN(t,e=-1){let n;return e<0&&(n=t[0].rank,e=0!==n?n:0),e===t[0].rank&&(e=-1),Ev(t,e)}function uN(t,e){switch(t.rank){case 1:return Wv([t,e]);case 2:return Gv([t,e],0);case 3:return jv([t,e],0);case 4:return Hv([t,e],0);default:throw new uC(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function lN(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new uC(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return zx(t,e)}function cN(t,e=0,n=1,r,i){return Uw(t,e,n,r,i)}function hN(t,e,n,r){if(t.rank<2||e.rank<2)throw new lC(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){if(t.shape.slice(-1)[0]!==e.shape.slice(-2)[0])throw new lC(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(2===t.rank&&2===e.rank){return Mk({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?fN(t.rank,r,"channelsLast"):null,activation:n})}{const i=t.shape.slice(),s=i.pop();t=Tv(t,[-1,s]);const o=e.shape.slice(),a=o.pop(),u=o.pop(),l=[...o,a],c=Array.from({length:e.rank},((t,n)=>0===n?e.rank-2:n<=e.rank-2?n-1:n));e=Tv(Ek(e,c),[u,-1]);const h=[...i,...l];return Tv(Mk({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?fN(t.rank,r,"channelsLast"):null,activation:n}),h)}}function dN(t,e,n){return Gb((()=>(e=Array.isArray(e)?bk(e,"int32"):Bb(e,"int32"),Vx(t,e,n))))}function pN(t){return Qb(t,t)}function fN(t,e,n){const r=e.shape;if(1!==e.rank&&e.rank!==t)throw new uC(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(5===t){if("channelsFirst"===n)return 1===r.length?Tv(e,[1,r[0],1,1,1]):Tv(e,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?Tv(e,[1,1,1,1,r[0]]):Tv(e,[1].concat(r))}else if(4===t){if("channelsFirst"===n)return 1===r.length?Tv(e,[1,r[0],1,1]):Tv(e,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?Tv(e,[1,1,1,r[0]]):Tv(e,[1].concat(r))}else if(3===t){if("channelsFirst"===n)return 1===r.length?Tv(e,[1,r[0],1]):Tv(e,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?Tv(e,[1,1,r[0]]):Tv(e,[1].concat(r))}else if(t<3)return e;throw new uC(`Unsupported input rank by biasAdd: ${e.rank}`)}function gN(t,e,n){return Gb((()=>(null==n&&(n="channelsLast"),UC(n),Kb(t,fN(t.rank,e,n)))))}function mN(t,e,n,r){return Gb((()=>Rk(t,e,n,r)))}function yN(t,e,n=!1){return n?t():e()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const bN=["fanIn","fanOut","fanAvg"],vN=["normal","uniform","truncatedNormal"];class xN extends cI{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class wN extends xN{apply(t,e){return mw(t,e)}}wN.className="Zeros",dI(wN);class kN extends xN{apply(t,e){return yw(t,e)}}kN.className="Ones",dI(kN);class IN extends xN{constructor(t){if(super(),"object"!=typeof t)throw new uC(`Expected argument of type ConstantConfig but got ${t}`);if(void 0===t.value)throw new uC(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return Gb((()=>Qb(Rx(this.value),yw(t,e))))}getConfig(){return{value:this.value}}}IN.className="Constant",dI(IN);class SN extends xN{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return Vw(t,this.minval,this.maxval,e,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}SN.className="RandomUniform",dI(SN);class TN extends xN{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new lC(`randomNormal does not support dType ${e}.`);return cN(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}TN.className="RandomNormal",dI(TN);class CN extends xN{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new lC(`truncatedNormal does not support dType ${e}.`);return Ik(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}CN.className="TruncatedNormal",dI(CN);class NN extends xN{constructor(t){super(),this.gain=null!=t.gain?t.gain:1}apply(t,e){return Gb((()=>{if(2!==t.length||t[0]!==t[1])throw new uC("Identity matrix initializer can only be used for 2D square matrices.");return Qb(this.gain,Bx(t[0]))}))}getConfig(){return{gain:this.gain}}}NN.className="Identity",dI(NN);class EN extends xN{constructor(t){if(super(),t.scale<0)throw new uC(`scale must be a positive float. Got: ${t.scale}`);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var e;this.scale=null==t.scale?1:t.scale,this.mode=null==t.mode?"fanIn":t.mode,e=this.mode,CC(bN,"FanMode",e),this.distribution=null==t.distribution?"normal":t.distribution,function(t){CC(vN,"Distribution",t)}(this.distribution),this.seed=t.seed}apply(t,e){const n=function(t,e="channelsLast"){let n,r;if(UC(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length)){if("channelsFirst"===e){const e=YC(t,2);n=t[1]*e,r=t[0]*e}else if("channelsLast"===e){const e=YC(t,0,t.length-2);n=t[t.length-2]*e,r=t[t.length-1]*e}}else{const e=YC(t);n=Math.sqrt(e),r=Math.sqrt(e)}return[n,r]}(t),r=n[0],i=n[1];let s=this.scale;if("fanIn"===this.mode?s/=Math.max(1,r):"fanOut"===this.mode?s/=Math.max(1,i):s/=Math.max(1,(r+i)/2),"normal"===this.distribution){const n=Math.sqrt(s);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new lC(`${this.getClassName()} does not support dType ${e}.`);return Ik(t,0,n,e,this.seed)}{const n=Math.sqrt(3*s);return Vw(t,-n,n,e,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}EN.className="VarianceScaling",dI(EN);class RN extends EN{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return EN.className}}RN.className="GlorotUniform",dI(RN);class $N extends EN{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return EN.className}}$N.className="GlorotNormal",dI($N);class _N extends EN{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return EN.className}}_N.className="HeNormal",dI(_N);class AN extends EN{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return EN.className}}AN.className="HeUniform",dI(AN);class DN extends EN{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return EN.className}}DN.className="LeCunNormal",dI(DN);class FN extends EN{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return EN.className}}FN.className="LeCunUniform",dI(FN);class ON extends xN{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==t.gain?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,e){return Gb((()=>{if(t.length<2)throw new lC("Shape must be at least 2D.");if("int32"!==e&&"float32"!==e&&void 0!==e)throw new TypeError(`Unsupported data type ${e}.`);e=e;const n=Ng(t.slice(0,-1)),r=t[t.length-1],i=n*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const s=cN([Math.max(r,n),Math.min(r,n)],0,1,e,this.seed),o=lI.qr(s,!1);let a=o[0];const u=o[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return a=Qb(a,u.sign()),n<r&&(a=a.transpose()),Qb(Rx(this.gain),a.reshape(t))}))}getConfig(){return{gain:this.gain,seed:this.seed}}}ON.className="Orthogonal",dI(ON);const LN={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function PN(t,e={}){return kC(t,hI.getMap().classNameMap,e,"initializer")}function MN(t){return xC(t)}function zN(t){if("string"==typeof t){const e=t in LN?LN[t]:t;if("GlorotNormal"===e)return new $N;if("GlorotUniform"===e)return new RN;if("HeNormal"===e)return new _N;if("HeUniform"===e)return new AN;if("LeCunNormal"===e)return new DN;if("LeCunUniform"===e)return new FN;{const t={};return t.className=e,t.config={},PN(t)}}return t instanceof xN?t:PN(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function BN(t){return Array.isArray(t)&&Array.isArray(t[0])}function UN(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function VN(t){let e;if(Array.isArray(t)){if(1!==t.length)throw new uC(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function WN(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new uC(`Expected exactly 1 Shape; got ${t.length}`)}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GN(t){let e=0;for(const n of t)0===n.shape.length?e+=1:e+=n.shape.reduce(((t,e)=>t*e));return e}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jN{constructor(t,e="float32",n="Variable",r=!0,i=null){this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=AC(),n=null==n?"Variable":n,this.originalName=HC(n),this.name=qC(this.originalName),this.trainable_=r,this.constraint=i,this.val=function(t,e=!0,n,r){return Hy.makeVariable(t,e,n,r)}(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function HN(t){return t.map((t=>t.read()))}function qN(t){t.forEach((t=>{t[0].write(t[1])}))}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class KN{constructor(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class XN{constructor(t,e,n,r,i,s,o){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=AC(),null!=s&&(this.originalName=HC(s),this.name=qC(this.originalName)),this.rank=e.length}}let YN=0;class QN{constructor(t,e){this.callArgs=e,this.id=YN++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const n of t.inboundLayers)null!=n&&n.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)null!=e?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let JN=0;class ZN extends cI{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=JN++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const t=this.getClassName();e=yC(t)+"_"+FC(t)}if(this.name=e,this.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){let e;if(null!=t.batchInputShape)e=t.batchInputShape;else if(null!=t.inputShape){let n=null;null!=t.batchSize&&(n=t.batchSize),e=[n].concat(t.inputShape)}this.batchInputShape=e;let n=t.dtype;null==n&&(n=t.inputDType),null==n&&(n="float32"),this.dtype=n}null!=t.weights?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(0===this.inboundNodes.length)throw new aC(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new uC(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return gC(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return gC(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new oC(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new oC(`Layer ${this.name} is not connected, no input to return.`);return gC(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new oC(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new oC(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return gC(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((t=>t()))}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach((e=>e.trainable=t)),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((t=>t.trainable)):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((t=>!t.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=mC(t),null==this.inputSpec||0===this.inputSpec.length)return;const e=mC(this.inputSpec);if(t.length!==e.length)throw new uC(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let n=0;n<t.length;n++){const r=t[n],i=e[n];if(null==i)continue;const s=r.rank;if(null!=i.ndim&&s!==i.ndim)throw new uC(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(null!=i.maxNDim&&s>i.maxNDim)throw new uC(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(null!=i.minNDim&&s<i.minNDim)throw new uC(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(null!=i.dtype&&r.dtype!==i.dtype)throw new uC(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const t=r.shape;for(const e in i.axes){const r=Number(e),s=i.axes[e],o=r>=0?t[r]:t[t.length+r];if(null!=s&&-1===[s,null].indexOf(o))throw new uC(`Input ${n} is incompatible with layer ${this.name}: expected axis ${r} of input shape to have value ${s} but got shape ${t}.`)}}if(null!=i.shape)for(let t=0;t<i.shape.length;++t){const e=i.shape[t],s=r.shape[t];if(null!=e&&null!=s&&e!==s)throw new uC(`Input ${n} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){null!=this._callHook&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const n=mC(t);let r=!0;for(const s of n)if(!(s instanceof XN)){r=!1;break}let i=!0;for(const s of n)if(s instanceof XN){i=!1;break}if(r===i)throw new uC("Arguments to apply() must be all SymbolicTensors or all Tensors");return jC(this.name,(()=>{if(!this.built){this.assertInputCompatibility(t);const e=[];for(const n of mC(t))e.push(n.shape);this.build(gC(e)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(t),i){let r=this.call(t,e);const i=mC(r),s=[];for(let t of i)-1!==n.indexOf(t)&&(t=t.clone()),s.push(t);if(r=gC(s),null!=this.activityRegularizer)throw new lC("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(t){t=mC(t);const e=[];for(const n of t)e.push(n.shape);return gC(e)}(t),r=this.computeOutputShape(n);let i;const s="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(t)?n[0]:n),i=null!=r&&r.length>0&&Array.isArray(r[0])?r.map(((n,r)=>new XN(s,n,this,mC(t),e,this.name,r))):new XN(s,r,this,mC(t),e,this.name),this.addInboundNode(t,i,null,null,n,r,e),this._refCount++,null!=this.activityRegularizer)throw new lC("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}}))}warnOnIncompatibleInputShape(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach(((n,r)=>{null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)})),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new oC(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const n=JSON.stringify(e.outputShapes);-1===t.indexOf(n)&&t.push(n)}if(1===t.length){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&1===t.length?t[0]:t}throw new oC(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new aC(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return GN(this.weights)}build(t){this.built=!0}getWeights(t=!1){return HN(t?this.trainableWeights:this.weights)}setWeights(t){Gb((()=>{const e=this.weights;if(e.length!==t.length)throw new uC(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(0===e.length)return;const n=[],r=HN(e);for(let i=0;i<r.length;++i){const s=r[i],o=e[i],a=t[i];if(!Eg(s.shape,a.shape))throw new uC(`Layer weight shape ${s.shape} not compatible with provided weight shape ${a.shape}`);n.push([o,a])}qN(n)}))}addWeight(t,e,n,r,i,s,o,a){if(-1!==this._addedWeightNames.indexOf(t))throw new uC(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=a?a():zN("zeros"));const u=r.apply(e,n),l=new jN(u,n,t,s,o);return u.dispose(),null!=i&&this.addLoss((()=>i.apply(l.read()))),null==s&&(s=!0),s?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){null==t||Array.isArray(t)&&0===t.length||(t=mC(t),void 0!==this._losses&&null!==this._losses&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);e.forEach((t=>{if(null!=t)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return e}addInboundNode(t,e,n,r,i,s,o=null){const a=mC(t);e=mC(e),n=mC(n),r=mC(r),i=UN(i),s=UN(s);const u=[],l=[],c=[];for(const h of a)u.push(h.sourceLayer),l.push(h.nodeIndex),c.push(h.tensorIndex);new QN({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:a,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:s},o);for(let h=0;h<e.length;h++)e[h].sourceLayer=this,e[h].nodeIndex=this.inboundNodes.length-1,e[h].tensorIndex=h}getConfig(){const t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach((t=>t.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function tE(t,e,n){if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];{const t=e.inboundNodes[n];if(0===t.inboundLayers.length)return t.inputTensors;{const e=[];for(let n=0;n<t.inboundLayers.length;n++){const r=tE(t.inputTensors[n],t.inboundLayers[n],t.nodeIndices[n]);for(const t of r)-1===e.indexOf(t)&&e.push(t)}return e}}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class eE extends ZN{constructor(t){if(super({dtype:t.dtype,name:null!=t.name?t.name:FC("input").toString()}),null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new uC("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(null==e){if(null==t.inputShape)throw new uC("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new uC("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=t.dtype||"float32";this.batchInputShape=e,this.dtype=n,this.inputSpec=[{shape:e}];const r=new XN(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new QN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new uC(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}eE.className="InputLayer",dI(eE);class nE{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof nE)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(null==t)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,n){if(null!=this.id2Value[t.id])throw new uC(`Duplicate key: name=${t.name}, id=${t.id}`);return this.id2Value[t.id]=
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return Bb(e,t.dtype)}catch(zj){throw new uC(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return null!=this.id2Value[t.id]}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof XN){if(null==this.id2Value[t.id])throw new uC(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}{const e=this.name2Id[t];if(null==e)throw new uC(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof XN){if(null==this.id2Value[t.id])throw new uC(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}{const e=this.name2Id[t];if(null==e)throw new uC(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){null!=this.id2Mask&&jb(this.id2Mask)}}const rE=new hC,iE=new hC;function sE(t,e,n,r){const i=null!=n&&n.training,s=Array.isArray(t),o=s?t:[t],a=o.map((t=>t.name)),u=[],l=e.names();for(const f of a)-1!==l.indexOf(f)?u.push(e.getValue(f)):u.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const c=a.join(",")+"|"+e.names().sort().join(",");let h,d=rE.get(c);if(null==d){const t=function(t,e){Sg(null!=t&&t.length>0,(()=>"Expected at least one fetch, got none"));let n=[],r={};if(1===t.length){const i=aE(t[0],e);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const s of t){const{sorted:t,recipientMap:o}=aE(s,e);for(const e of t)i.has(e.name)||(n.push(e),i.add(e.name));for(const e in o)null==r[e]&&(r[e]=new Set),o[e].forEach((t=>r[e].add(t)))}}return{sorted:n,recipientCounts:oE(r)}}(o,e);d=t.sorted,h=t.recipientCounts,rE.put(c,d),iE.put(c,h)}h={},i||Object.assign(h,iE.get(c));const p=new nE(e);for(let f=0;f<d.length;++f){if(null!=r){const t=Wb().numTensors;t>r.maxNumTensors&&(r.maxNumTensors=t),t<r.minNumTensors&&(r.minNumTensors=t)}const t=d[f],s=t.sourceLayer;if(s instanceof eE)continue;const o=[],l=[],c=[];let g=!1;for(const n of t.inputs){const t=p.getValue(n),r=p.getMask(n);o.push(t),l.push(r),null!=r&&(g=!0),i||(h[n.name]--,0!==h[n.name]||e.hasKey(n)||-1!==a.indexOf(n.name)||t.isDisposed||!0===n.sourceLayer.stateful||c.push(t))}g&&((n=n||{}).mask=l[0]);const m=mC(s.apply(o,n));let y=null;s.supportsMasking&&(y=s.computeMask(o,l));const b=uE(t),v=Array.isArray(b)?b:[b];for(let e=0;e<v.length;++e){p.hasKey(v[e])||p.add(v[e],m[e],Array.isArray(y)?y[0]:y);const t=a.indexOf(v[e].name);-1!==t&&(u[t]=m[e])}i||jb(c)}return p.disposeMasks(),s?u:u[0]}function oE(t){const e={};for(const n in t)e[n]=t[n].size;return e}function aE(t,e){const n=new Set,r=[],i={};for(const a of e.names())n.add(a);const s=[],o=[];for(s.push(t);s.length>0;){const t=s[s.length-1];if(n.has(t.name)){s.pop();continue}const e=o[o.length-1]===s.length-1;if(0===t.inputs.length||e)s.pop(),r.push(t),n.add(t.name),e&&o.pop();else{o.push(s.length-1);for(const e of t.inputs)null==i[e.name]&&(i[e.name]=new Set),i[e.name].add(t.name),n.has(e.name)||s.push(e)}}return{sorted:r,recipientMap:i}}function uE(t){let e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{let n=null;for(let e=0;e<t.sourceLayer.inboundNodes.length;++e)for(const r of t.sourceLayer.inboundNodes[e].outputTensors)if(r.id===t.id){n=e;break}e=t.sourceLayer.getOutputAt(n)}return e}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function lE(t,e){return Gb((()=>$x(Ax(Qb(t,t),e,!0))))}rm().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(()=>100),(function(t){null!=rE&&rE.setMaxEntries(t),null!=iE&&iE.setMaxEntries(t)}));class cE extends cI{getConfig(){return{}}}class hE extends cE{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return Gb((()=>{const e=lE(t,this.axis),n=Vv(e,0,this.maxValue);return Qb(t,Yb(n,Kb(eN(),e)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}hE.className="MaxNorm",dI(hE);class dE extends cE{constructor(t){super(),this.defaultAxis=0,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return Gb((()=>Yb(t,Kb(eN(),lE(t,this.axis)))))}getConfig(){return{axis:this.axis}}}dE.className="UnitNorm",dI(dE);class pE extends cE{apply(t){return Hw(t)}}pE.className="NonNeg",dI(pE);class fE extends cE{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=t.minValue?t.minValue:this.defaultMinValue,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.rate=null!=t.rate?t.rate:this.defaultRate,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return Gb((()=>{const e=lE(t,this.axis),n=Kb(Qb(this.rate,Vv(e,this.minValue,this.maxValue)),Qb(1-this.rate,e));return Qb(t,Yb(n,Kb(eN(),e)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}fE.className="MinMaxNorm",dI(fE);const gE={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function mE(t){return xC(t)}function yE(t,e={}){return kC(t,hI.getMap().classNameMap,e,"constraint")}function bE(t){if(null==t)return null;if("string"==typeof t){return yE({className:t in gE?gE[t]:t,config:{}})}return t instanceof cE?t:yE(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function vE(t){if(null==t)return;const e=[],n=[],r=[];for(const i in t){const s=t[i];if("number"!=typeof s){const t=s;e.push(t.data()),n.push(i),r.push(t)}}if(e.length>0){const i=await Promise.all(e);for(let e=0;e<i.length;++e)t[n[e]]=i[e][0];jb(r)}}function xE(t){if(null!=t)for(const e in t){const n=t[e];"number"!=typeof n&&n.dispose()}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var wE,kE;(kE=wE||(wE={}))[kE.SILENT=0]="SILENT",kE[kE.VERBOSE=1]="VERBOSE";class IE{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class SE{constructor(t,e=10){null==t&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochBegin(t,e)}async onEpochEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochEnd(t,e)}async onBatchBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchBegin(t,e)}async onBatchEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchEnd(t,e)}async onTrainBegin(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class TE extends IE{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){null==e&&(e={});const n=null==e.size?0:e.size;this.seen+=n;for(const r in e){const t=e[r];if("number"==typeof t)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+t*n;else{let e;r in this.totals?e=this.totals[r]:this.totals[r]=0;const i=Gb((()=>Kb(this.totals[r],Qb(t,n))));this.totals[r]=i,null!=e&&e.dispose()}}}async onEpochEnd(t,e){if(null!=e)for(const n of this.params.metrics)null!=this.totals[n]&&("number"==typeof this.totals[n]?e[n]=this.totals[n]/this.seen:Gb((()=>{const t=Qb(Yb(1,this.seen),this.totals[n]);e[n]=t,this.totals[n].dispose(),Hb(e[n])})))}}class CE extends IE{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){null==e&&(e={}),this.epoch.push(t);for(const n in e)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(e[n])}async syncData(){const t=[],e=[],n=[];for(const i in this.history){const r=this.history[i];for(let s=0;s<r.length;++s)if("number"!=typeof r[s]){const o=r[s];t.push(o.data()),e.push(i),n.push(s)}}const r=await Promise.all(t);for(let i=0;i<r.length;++i){this.history[e[i]][n[i]].dispose(),this.history[e[i]][n[i]]=r[i][0]}}}class NE extends IE{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||YI,this.yieldEvery=e||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Ug(this.yieldEvery)&&(this.maybeWait=function(t,e,n){let r,i=null!=n?n():sy();return(...s)=>{const o=null!=n?n():sy();return o-i<e||(i=o,r=t(...s)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,n){const r=[];null!=this.yield&&(await vE(n),r.push(this.yield(t,e,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(t,e){this.currentEpoch=t,null!=this.epochBegin&&(await vE(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const n=[];null!=this.epochEnd&&(await vE(e),n.push(this.epochEnd(t,e))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(t,e){null!=this.batchBegin&&(await vE(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const n=[];null!=this.batchEnd&&(await vE(e),n.push(this.batchEnd(t,e))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):Ug(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(n)}async onTrainBegin(t){null!=this.trainBegin&&(await vE(t),await this.trainBegin(t))}async onTrainEnd(t){null!=this.trainEnd&&(await vE(t),await this.trainEnd(t))}}function EE(t,e){if(null==t&&(t={}),t instanceof IE)return[t];if(Array.isArray(t)&&t[0]instanceof IE)return t;return mC(t).map((t=>new NE(t,e)))}class RE{constructor(){}static registerCallbackConstructor(t,e){Sg(t>=0&&Number.isInteger(t),(()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`)),RE.checkForDuplicate(e),null==RE.constructors[t]&&(RE.constructors[t]=[]),RE.constructors[t].push(e)}static checkForDuplicate(t){for(const e in RE.constructors){RE.constructors[+e].forEach((e=>{if(e===t)throw new uC("Duplicate callback constructor.")}))}}static clear(){RE.constructors={}}static createCallbacks(t){const e=[];for(const n in RE.constructors){const r=+n;t>=r&&e.push(...RE.constructors[r])}return e.map((t=>new t))}}function $E(t,e,n,r,i,s,o,a,u){const l=new CE,c=[new TE,...RE.createCallbacks(e)];null!=t&&c.push(...t),c.push(l);const h=new SE(c);return h.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:o,verbose:e,doValidation:a,metrics:u}),{callbackList:h,history:l}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _E(t,e={},n=!1){return kC(t,hI.getMap().classNameMap,e,"layer",n)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function AE(t,e){return Gb((()=>{"float32"!==t.dtype&&(t=Bb(t,"float32"));const n=Ax(pN(t),e,!0),r=Uv(n.shape,eN()),i=$x(fw(n,r));return Yb(t,i)}))}function DE(t,e){return Gb((()=>gw(pN(sw(e,t)),-1)))}function FE(t,e){return Gb((()=>gw(Jb(sw(e,t)),-1)))}function OE(t,e){return Gb((()=>{const n=sw(t,e),r=Vv(Jb(t),eN(),Number.MAX_VALUE),i=Jb(Yb(n,r));return Qb(100,gw(i,-1))}))}function LE(t,e,n=!1){return Gb((()=>{if(n)e=ok(e);else{const t=Ax(e,e.shape.length-1,!0);e=Yb(e,t)}return e=Vv(e,eN(),1-eN()),nw(Ax(Qb(Bb(t,"float32"),Zx(e)),e.shape.length-1))}))}function PE(t,e,n=!1){return Gb((()=>{const r=Bb(Ux(function(t){const e=[YC(t.shape)];return Tv(t,e)}(t)),"int32"),i=(e=Vv(e,eN(),1-eN())).shape;return LE(Tv(Iw(r,i[i.length-1]),i),e,n)}))}function ME(t,e){return Gb((()=>{let n;return n=Vv(e,eN(),1-eN()),n=Zx(Yb(n,sw(1,n))),gw(function(t,e){if(!Eg(t.shape,e.shape))throw new uC(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return Gb((()=>{const n=Hw(e),r=nw(Jb(e));return Kb(sw(n,Qb(e,t)),tw(Lx(r)))}))}(t,n),-1)}))}function zE(t,e){return Gb((()=>{const n=AE(t,-1),r=AE(e,-1),i=Qb(n,r);return nw(Ax(i,-1))}))}RE.constructors={};const BE={meanSquaredError:DE,meanAbsoluteError:FE,meanAbsolutePercentageError:OE,meanSquaredLogarithmicError:function(t,e){return Gb((()=>{const n=Vv(e,eN(),Number.MAX_VALUE),r=Zx(Kb(1,n)),i=Vv(t,eN(),Number.MAX_VALUE),s=Zx(Kb(1,i));return gw(pN(sw(r,s)),-1)}))},squaredHinge:function(t,e){return Gb((()=>{const n=fw(0,sw(1,Qb(t,e)));return gw(pN(n),-1)}))},hinge:function(t,e){return Gb((()=>{const n=fw(0,sw(1,Qb(t,e)));return gw(n,-1)}))},categoricalHinge:function(t,e){return Gb((()=>{const n=Ax(Qb(t,e),-1),r=Cx(Qb(sw(1,t),e),-1);return fw(0,Kb(1,sw(r,n)))}))},logcosh:function(t,e){return Gb((()=>{const n=Math.log(2),r=sw(e,t),i=sw(Kb(r,rw(Qb(-2,r))),n);return gw(i,-1)}))},categoricalCrossentropy:LE,sparseCategoricalCrossentropy:PE,binaryCrossentropy:ME,kullbackLeiblerDivergence:function(t,e){return Gb((()=>{const n=Vv(t,eN(),1),r=Vv(e,eN(),1);return Ax(Qb(t,Zx(Yb(n,r))),-1)}))},poisson:function(t,e){return Gb((()=>{const n=Zx(Kb(eN(),e));return gw(sw(e,Qb(t,n)),-1)}))},cosineProximity:zE};function UE(t){if("string"==typeof t){if(t in BE)return BE[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new uC(e)}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VE(t,e){return Gb((()=>{const n=Qb(.5,Sw(e)),r=nN(Wx(e,n),t.dtype);return gw(hx(t,r),-1)}))}function WE(t,e){return Gb((()=>nN(hx(rv(t,-1),rv(e,-1)),"float32")))}function GE(t,e){return ME(t,e)}function jE(t,e){return t.rank===e.rank&&(t=pk(t,[t.rank-1])),(e=rv(e,-1)).dtype!==t.dtype&&(e=Bb(e,t.dtype)),Bb(hx(t,e),"float32")}const HE=LE,qE=PE,KE={binaryAccuracy:VE,categoricalAccuracy:WE,precision:function(t,e){return Gb((()=>{const n=function(t,e){return Gb((()=>Bb(Ax(uw(hx(t,1),hx(e,1))),"float32")))}(t,e),r=function(t,e){return Gb((()=>Bb(Ax(uw(hx(t,0),hx(e,1))),"float32")))}(t,e),i=Kb(n,r);return Bb(dx(Wx(i,0),Yb(n,i),0),"float32")}))},categoricalCrossentropy:HE,sparseCategoricalCrossentropy:qE,mse:DE,MSE:DE,mae:FE,MAE:FE,mape:OE,MAPE:OE,cosine:zE};function XE(t){if("string"==typeof t&&t in KE)return KE[t];if("string"!=typeof t&&null!=t)return t;throw new uC(`Unknown metric ${t}`)}function YE(t){if(pC(null!==t,`Unknown LossOrMetricFn ${t}`),"string"==typeof t)return t;{let e;for(const n of Object.keys(BE))if(BE[n]===t){e=n;break}if(void 0!==e)return e;for(const n of Object.keys(KE))if(KE[n]===t){e=n;break}return void 0!==e?e:t.name}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QE(t,e,n=!1){if(null==t||"object"!=typeof t||Object.getPrototypeOf(t)!==Object.prototype||!JE(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(t);n.length>1048576&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function JE(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e){if("string"!=typeof n)return!1;if(!JE(t[n]))return!1}return!0}if(Array.isArray(t)){for(const e of t)if(!JE(e))return!1;return!0}return!1}{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ZE(t,e,n,r=console.log){const i=function(t){let e=!0;const n=[],r=[];for(const i in t.nodesByDepth)n.push(t.nodesByDepth[i]);for(const i of n){if(i.length>1||1===i.length&&i[0].inboundLayers.length>1){e=!1;break}r.push(...i)}if(e)for(const i of t.layers){let t=!1;for(const n of i.inboundNodes)if(-1!==r.indexOf(n)){if(t){e=!1;break}t=!0}if(!e)break}return e}(t),s=["Layer (type)","Input Shape","Output shape","Param #"];let o;if(i?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((t=>Math.floor(e*t)))),!i){s.push("Receives inputs"),o=[];for(const e in t.nodesByDepth)o.push(...t.nodesByDepth[e])}r("_".repeat(e)),tR(s,n,r),r("=".repeat(e));const a=t.layers;for(let c=0;c<a.length;++c)i?eR(a[c],n,r):nR(a[c],n,o,r),r((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const u=function(t){let e;e=null!=t.collectedTrainableWeights?GN(t.collectedTrainableWeights):GN(t.trainableWeights);return e}(t),l=GN(t.nonTrainableWeights);r(`Total params: ${u+l}`),r(`Trainable params: ${u}`),r(`Non-trainable params: ${l}`),r("_".repeat(e))}function tR(t,e,n=console.log){let r="";for(let i=0;i<t.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=t[i],r=r.slice(0,e[i]),r+=" ".repeat(e[i]-r.length);n(r)}function eR(t,e,n){let r,i;try{i=t.inboundNodes.map((t=>JSON.stringify(t.inputShapes))).join(",")}catch(zj){i="multiple"}try{r=JSON.stringify(t.outputShape)}catch(zj){r="multiple"}tR([`${t.name} (${t.getClassName()})`,i,r,t.countParams().toString()],e,n)}function nR(t,e,n,r){let i,s;try{s=t.inboundNodes.map((t=>JSON.stringify(t.inputShapes))).join(",")}catch(zj){s="multiple"}try{i=JSON.stringify(t.outputShape)}catch(zj){i="multiple"}const o=[];for(const c of t.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(let t=0;t<c.inboundLayers.length;++t){const e=c.inboundLayers[t].name,n=c.nodeIndices[t],r=c.tensorIndices[t];o.push(`${e}[${n}][${r}]`)}const a=t.name,u=t.getClassName(),l=0===o.length?"":o[0];tR([`${a} (${u})`,s,i,t.countParams().toString(),l],e,r);for(let c=1;c<o.length;++c)tR(["","","","",o[c]],e,r)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rR(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function iR(t,e){if(null===t)return null;if("string"==typeof t)return bC(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const r=t[i];rR(e,i,r)?n.push(r):n.push(iR(r,e))}return n}{const e={};for(const n of Object.keys(t)){const r=t[n];if("name"===n&&"string"==typeof r)e[n]=r;else{const t=bC(n);e[t]=iR(r,t)}}return e}}function sR(t,e){if(null==t)return null;if("string"==typeof t)return yC(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const r=t[i];rR(e,i,r)?n.push(r):n.push(sR(r,e))}return n}{const e={};for(const n of Object.keys(t)){const r=t[n],i=yC(n);e[i]="name"!==n&&"className"!==n||"string"!=typeof r?sR(r,n):r}return e}}
/** @license See the LICENSE file. */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class oR extends ZN{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,null==this.name){const t=this.getClassName().toLowerCase();this.name=FC(t)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],SC(this.inputs).length!==this.inputs.length)throw new uC(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((t=>t.name))}`);SC(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map((t=>t.name))}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const t=y.sourceLayer,e=y.nodeIndex,n=y.tensorIndex;this.outputLayers.push(t),this.outputLayersNodeIndices.push(e),this.outputLayersTensorIndices.push(n)}for(const y of this.inputs){const t=y.sourceLayer,e=y.nodeIndex,n=y.tensorIndex;pC(0===e,"input layer has >1 nodes"),pC(0===n,"input layer has >1 tensors"),this.inputLayers.push(t),this.inputLayersNodeIndices.push(e),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const e=this.inputLayers[y];if(!(e instanceof eE))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${y} (0-based) originates from layer type ${e.getClassName()}.`);this.inputNames.push(e.name),this.feedInputShapes.push(e.batchInputShape),this.feedInputNames.push(e.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map((t=>t.shape)),this.internalOutputShapes=this.outputs.map((t=>t.shape));const e={},n={},r={},i={},s={},o=[],a=(t,e,n,r,i,u)=>{null!=r&&null!=i&&null!=u||(r=t.sourceLayer,i=t.nodeIndex,u=t.tensorIndex);const l=r.inboundNodes[i];if(-1!==n.indexOf(l))throw new aC(`The tensor ${t.name} at layer "${r.name}" is part of a cycle.`);if(-1!==e.indexOf(l))return;this.containerNodes.add(oR.nodeKey(r,i)),r.id in s||(s[r.id]=Object.keys(s).length),-1===n.indexOf(l)&&n.push(l);const c=l.inboundLayers.length;for(let s=0;s<c;s++){const t=l.inputTensors[s],r=l.inboundLayers[s],i=l.nodeIndices[s],o=l.tensorIndices[s];a(t,e,n,r,i,o)}for(e.push(l);n.indexOf(l)>=0;)n.splice(n.indexOf(l),1);o.push(l)},u=[],l=[];for(const y of this.outputs)a(y,u,l);const c=o.slice().reverse();for(const y of c){n[y.id]=y,y.id in e||(e[y.id]=0);let t=e[y.id];const s=null==r[y.outboundLayer.id]?0:r[y.outboundLayer.id];t=Math.max(t,s),r[y.outboundLayer.id]=t,i[y.outboundLayer.id]=y.outboundLayer,e[y.id]=t;for(let r=0;r<y.inboundLayers.length;r++){const i=y.inboundLayers[r],s=y.nodeIndices[r],o=i.inboundNodes[s],a=null==e[o.id]?0:e[o.id];e[o.id]=Math.max(t+1,a),n[o.id]=o}}const h={};for(const y in e){const t=e[y];t in h||(h[t]=[]),h[t].push(n[y])}const d={};for(const y in r){const t=r[y];t in d||(d[t]=[]),d[t].push(i[y])}let p=Object.keys(d).map((t=>parseInt(t,10))).sort(IC);this.layers=[];for(const y of p){const t=d[y];t.sort(((t,e)=>{const n=s[t.id],r=s[e.id];return n<r?-1:n>r?1:0}));for(const e of t)e instanceof oR&&this.internalContainerRefs.push(e),this.layers.push(e)}this.layersByDepth=d,p=Object.keys(h).map((t=>parseInt(t,10))).sort(IC);const f=this.inputs.slice(),g=[];for(const y of p)for(const t of h[y]){const e=t.outboundLayer;if(null!=e){for(const n of t.inputTensors)if(-1===f.indexOf(n))throw new aC(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${e.name}". The following previous layers were accessed without issue: ${g}`);for(const e of t.outputTensors)f.push(e);g.push(e.name)}}this.nodesByDepth=h;const m=this.layers.map((t=>t.name));for(const y of m){const t=m.filter((t=>t===y)).length;if(1!==t)throw new aC(`The name "${y}" is used ${t} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(m))}this.outboundNodes=[],this.inboundNodes=[],new QN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((t=>null)),outputMasks:this.outputs.map((t=>null)),inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs.map((t=>t.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach((e=>{e._trainableWeights.forEach((e=>e.trainable=t))})),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new uC("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.layers)e.push(...t.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const n={};let r=0;for(const s of this.layers)for(const t of s.weights){if(null!=n[t.originalName])throw new uC(`Duplicate weight name: ${t.originalName}`);n[t.originalName]=t,r++}const i=[];for(const s in t){let r=s;if(null==n[s]){const t=s.split("/");r=t.slice(0,-2).concat([t[t.length-1]]).join("/")}if(null!=n[r])i.push([n[r],t[s]]);else if(e)throw new uC(`Provided weight data has no target variable: ${s}`);delete n[r]}if(e){const t=[];for(const e in n)t.push(e);if(t.length>0)throw new uC(`${t.length} of ${r} weights are not set: ${t}`)}qN(i)}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers 4.4.0",e.backend="TensorFlow.js",e}toJSON(t,e=!0){const n=sR(this.updatedConfig());return e?JSON.stringify(n):n}call(t,e){return Gb((()=>{t=mC(t);const n=new nE;for(let e=0;e<this.inputs.length;++e)n.add(this.inputs[e],t[e]);return sE(this.outputs,n,e)}))}computeMask(t,e){return Gb((()=>{let n;return t=mC(t),n=null==e?dC(null,t.length):mC(e),this.runInternalGraph(t,n)[1]}))}computeOutputShape(t){const e=UN(t);if(e.length!==this.inputLayers.length)throw new uC(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let o=0;o<e.length;o++){const t=this.inputLayers[o],r=e[o];n[t.name+"_0_0"]=r}const r=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(IC);if(r.length>1)for(const o of r){const t=this.nodesByDepth[o];for(const e of t){const t=e.outboundLayer;if(-1!==this.inputLayers.map((t=>t.id)).indexOf(t.id))continue;const r=[];for(let o=0;o<e.inboundLayers.length;o++){const t=e.inboundLayers[o],i=e.nodeIndices[o],s=e.tensorIndices[o],a=n[`${t.name}_${i}_${s}`];r.push(a)}const i=UN(t.computeOutputShape(gC(r))),s=t.inboundNodes.indexOf(e);for(let e=0;e<i.length;e++){n[`${t.name}_${s}_${e}`]=i[e]}}}const i=[],s=[];for(let o=0;o<this.outputLayers.length;o++){const t=this.outputLayers[o],e=this.outputLayersNodeIndices[o],n=this.outputLayersTensorIndices[o],r=`${t.name}_${e}_${n}`;s.push(r)}for(let o=0;o<s.length;o++){const t=s[o];pC(t in n),i.push(n[t])}return gC(i)}runInternalGraph(t,e){null==e&&(e=dC(null,t.length));const n={};for(let a=0;a<this.inputs.length;++a){const r=this.inputs[a],i=t[a],s=e[a];n[r.id]=[i,s]}const r=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(IC);for(const a of r){const t=this.nodesByDepth[a];for(const e of t){const t=e.outboundLayer,r=e.inputTensors,i=e.outputTensors,s=new Array;for(const e of r)e.id in n&&s.push(n[e.id]);if(s.length===r.length){let r,o,a,u,l={};if(null!=e.callArgs&&(l=e.callArgs),1===s.length){const[e,n]=s[0];null==l.mask&&(l.mask=n),a=mC(t.call(e,l)),u=mC(t.computeMask(e,n)),r=[e],o=[n]}else r=s.map((t=>t[0])),o=s.map((t=>t[1])),null==l.mask&&(l.mask=o),a=mC(t.call(r,l)),u=mC(t.computeMask(r,o));if(t.activityRegularizer)throw new lC("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let t=0;t<i.length;++t){const e=i[t],r=a[t],s=u[t];n[e.id]=[r,s]}}}}const i=[],s=[],o=[];for(const a of this.outputs){pC(a.id in n,`Could not compute output ${a.name} : ${a.id}`);const[t,e]=n[a.id];o.push(t.shape),i.push(t),s.push(e)}return[i,s,o]}buildNodeConversionMap(t){const e={};let n;for(const r of this.layers){n=r instanceof oR?1:0;for(let t=0;t<r.inboundNodes.length;t++){const i=oR.nodeKey(r,t);this.containerNodes.has(i)&&(e[i]=n,n+=1)}}return e}getLayer(t,e){if(null!=e){if(this.layers.length<=e)throw new uC(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}if(null==t)throw new uC("Provide either a layer name or layer index");for(const n of this.layers)if(n.name===t)return n;throw new uC(`No such layer: ${t}`)}calculateLosses(){return Gb((()=>{const t=[];for(const e of this.layers)for(let n=0;n<e.inboundNodes.length;++n){const r=oR.nodeKey(e,n);this.containerNodes.has(r)&&t.push(...e.calculateLosses())}return t}))}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),n=[];for(const s of this.layers){const t=s.getClassName(),r=s.getConfig(),i=[];for(let n=0;n<s.inboundNodes.length;n++){const t=s.inboundNodes[n],r=oR.nodeKey(s,n);let o={};if(this.containerNodes.has(r)){if(t.callArgs)try{JSON.stringify(t.callArgs),o=t.callArgs}catch(zj){console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${t.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),o={}}if(t.inboundLayers.length>0){const n=[];for(let r=0;r<t.inboundLayers.length;r++){const i=t.inboundLayers[r],s=t.nodeIndices[r],a=t.tensorIndices[r];let u=e[oR.nodeKey(i,s)];null==u&&(u=0),n.push([i.name,u,a,o])}i.push(n)}}}const o={};o.name=s.name,o.className=t,o.config=r,o.inboundNodes=i,n.push(o)}t.layers=n;const r=[];for(let s=0;s<this.inputLayers.length;s++){const t=this.inputLayers[s],n=this.inputLayersNodeIndices[s],i=oR.nodeKey(t,n);if(!this.containerNodes.has(i))continue;let o=e[i];null==o&&(o=0);const a=this.inputLayersTensorIndices[s];r.push([t.name,o,a])}t.inputLayers=r;const i=[];for(let s=0;s<this.outputLayers.length;s++){const t=this.outputLayers[s],n=this.outputLayersNodeIndices[s],r=oR.nodeKey(t,n);if(!this.containerNodes.has(r))continue;let o=e[r];null==o&&(o=0);const a=this.outputLayersTensorIndices[s];i.push([t.name,o,a])}return t.outputLayers=i,t}static fromConfig(t,e,n={},r=!1){const i={},s={};function o(t,e){t.name in s?s[t.name].push(e):s[t.name]=[e]}function a(t,e){const n=[];let r;for(const s of e){const a=s[0],u=s[1],l=s[2];if(r=null==s[3]?{}:s[3],!(a in i))return void o(t,e);const c=i[a];if(c.inboundNodes.length<=u)return void o(t,e);const h=c.inboundNodes[u];n.push(h.outputTensors[l])}n.length>0&&t.apply(gC(n),r)}function u(t){const n=t.name,s=_E(t,null!=e.customObjects?e.customObjects:{});s.setFastWeightInitDuringBuild(r),i[n]=s;t.inboundNodes.forEach((t=>{if(!(t instanceof Array))throw new uC(`Corrupted configuration, expected array for nodeData: ${t}`);o(s,t)}))}const l=e.name,c=e.layers;for(const g of c)u(g);for(;!TC(s);)for(const t of c){const e=i[t.name];if(e.name in s){const t=s[e.name];delete s[e.name];for(const n of t)a(e,n)}}const h=[],d=[],p=e.inputLayers;for(const g of p){const t=g[0],e=g[1],n=g[2];pC(t in i);const r=i[t].inboundNodes[e].outputTensors;h.push(r[n])}const f=e.outputLayers;for(const g of f){const t=g[0],e=g[1],n=g[2];pC(t in i);const r=i[t].inboundNodes[e].outputTensors;d.push(r[n])}return new t({inputs:h,outputs:d,name:l})}get stateful(){if(this._stateful)throw new uC("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){Gb((()=>{this.layers.forEach((t=>{t.stateful&&t.resetStates()}))}))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aR(t,e){return function(t,e,n){const r=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>null));if(1===r)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){const n=[];return e.forEach((e=>{e in t?n.push(t[e]):n.push(null)})),n}throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}(t,e,"classWeight")}async function uR(t,e,n,r){if(null!=e||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const e=Gb((()=>{if(1===t.shape.length)return Ub(t);if(2===t.shape.length){if(t.shape[1]>1){return rv(t,1)}if(1===t.shape[1])return Tv(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),r=Array.from(await e.data());jb(e);const i=[];return r.forEach((t=>{if(null==n[t])throw new Error(`classWeight must contain all classes in the training data. The class ${t} exists in the data but not in classWeight`);i.push(n[t])})),bk(i,"float32")}return null}function lR(t,e){return Qb(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cR(t,e){let n,r;const i=e;n=i.xs,r=i.ys,Sg(null!=n&&null!=r,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`));const s=hR("input",t.inputNames,n),o=hR("output",t.outputNames,r),a=s[0].shape[0];Sg(s.length===t.inputs.length,(()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`)),Sg(o.length===t.outputs.length,(()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`));for(let u=0;u<s.length;u++)Sg(s[u].shape[0]===a,(()=>`Batch size mismatch: input ${t.inputNames[u]} has ${s[u].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`));for(let u=0;u<o.length;u++)Sg(o[u].shape[0]===a,(()=>`Batch size mismatch: output ${t.outputNames[u]} has ${o[u].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`));return{xs:s,ys:o}}function hR(t,e,n){if(n instanceof wy)return[n];if(Array.isArray(n))return Sg(n.length===e.length,(()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`)),n;{const r=[];for(const i of e){if(null==n[i])throw new uC(`The feature data generated by the dataset lacks the required ${t} key '${i}'.`);r.push(n[i])}return r}}async function dR(t,e,n){const r=null!=n.batchesPerEpoch;if(Sg(null!=t.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),Sg(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),Sg(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),Sg(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),Sg(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const i=null!=n.validationData;let s,o;if(i)if(pR(n.validationData))Sg(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const t=function(t){if(3===t.length)throw new lC("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData);s=t.xs,o=t.ys}const a=t.makeTrainFunction(),u=t.getDedupedMetricsNames();let l;l=i?u.slice().concat(u.map((t=>"val_"+t))):u.slice();const c=EE(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:d,history:p}=$E(c,h,n.epochs,null,null,function(t,e){let n=null;null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size);return n}(e,n),null,i,l);d.setModel(t),t.history=p,await d.onTrainBegin(),t.stopTraining_=!1;let f=null==n.initialEpoch?0:n.initialEpoch,g=await e.iterator();for(;f<n.epochs;){const l={};await d.onEpochBegin(f);let c=0,h=0;for(r||(g=await e.iterator());!r||c<n.batchesPerEpoch;){const e=await g.next();if(r&&e.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${c} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(null!=e.value){const{xs:r,ys:i}=cR(t,e.value),s={};s.batch=h,s.size=r[0].shape[0],await d.onBatchBegin(h,s);const o=[];if(null!=n.classWeight){const e=aR(n.classWeight,t.outputNames);for(let t=0;t<e.length;++t)o.push(await uR(i[t],null,e[t]))}const l=r.concat(i).concat(o),p=a(l);jb(l);for(let t=0;t<u.length;++t){const e=u[t],n=p[t];s[e]=n,Hb(n)}await d.onBatchEnd(h,s),xE(s),h++,c++}if(r?c>=n.batchesPerEpoch:e.done){if(i){let e;e=pR(n.validationData)?mC(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):mC(t.evaluate(s,o,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<t.metricsNames.length;++n)l[`val_${t.metricsNames[n]}`]=e[n]}break}if(t.stopTraining_)break}if(await d.onEpochEnd(f,l),f++,t.stopTraining_)break}return await d.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function pR(t){return"function"==typeof t.iterator}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function fR(t){Sg(t>0&&Number.isInteger(t),(()=>`batchSize is required to be a positive integer, but got ${t}`))}function gR(t,e,n){return null==t?[null]:Array.isArray(t)?t.map((t=>iN(t,e,n-e))):iN(t,e,n-e)}function mR(t,e){return Gb((()=>null==t?null:Array.isArray(t)?t.map((t=>mR(t,e))):dN(t,"int32"===e.dtype?e:Bb(e,"int32"))))}function yR(t,e){const n=[];let r=0,i=null;for(;r<t;)i=r+e,i>=t&&(i=t),n.push([r,i]),r=i;return n}function bR(t){const e=[];t instanceof wy&&(t=[t]);for(let n=0;n<t.length;++n){const r=t[n];if(1===r.rank)e.push(rN(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function vR(t,e){if(null==t)return;const n=[];if(e instanceof wy)n.push(e.id);else if(Array.isArray(e))e.forEach((t=>n.push(t.id)));else if(null!=e)for(const i in e){const t=e[i];n.push(t.id)}const r=[];if(t instanceof wy)-1===n.indexOf(t.id)&&r.push(t);else if(Array.isArray(t))t.forEach((t=>{-1===n.indexOf(t.id)&&r.push(t)}));else if(null!=t)for(const i in t){const e=t[i];-1===n.indexOf(e.id)&&r.push(e)}r.forEach((t=>{t.isDisposed||t.dispose()}))}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xR(t){return Array.isArray(t)}function wR(t){return!function(t){return t instanceof wy}(t)&&!xR(t)}function kR(t,e,n,r=!0,i=""){if(null==e||0===e.length){if(null!=t){let e=!1;if(xR(t)&&t.length>0)e=!0;else if(wR(t)){for(const n in t)if(t.hasOwnProperty(n)){e=!0;break}}else e=!0;if(e)throw new uC(`Error when checking model ${i} expected no data, but got ${t}`)}return[]}if(null==t)return e.map((t=>null));let s;if(wR(t)){t=t,s=[];for(const n of e){if(null==t[n])throw new uC(`No data provided for "${n}". Need data for each key in: ${e}`);s.push(t[n])}}else if(xR(t)){if((t=t).length!==e.length)throw new uC(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);s=t}else{if(t=t,e.length>1)throw new uC(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);s=[t]}if(s=bR(s),null!=n)for(let o=0;o<e.length;++o){if(null==n[o])continue;const t=s[o];if(t.shape.length!==n[o].length)throw new uC(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${t.shape}`);for(let e=0;e<n[o].length;++e){if(0===e&&!r)continue;const s=t.shape[e],a=n[o][e];if(null!=a&&a>=0&&s!==a)throw new uC(`${i} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${i} received an input with ${t.shape[0]} examples, each with shape [${t.shape.slice(1,t.shape.length)}] (tensor shape [${t.shape}])`)}}return s}function IR(t,e,n,r=!0,i=""){let s;if(Array.isArray(t)){if(t.length!==e.length)throw new uC(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);s=t}else{if(e.length>1)throw new uC(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);s=[t]}if(null!=n)for(let o=0;o<e.length;++o){if(null==n[o])continue;const t=s[o];if(t.shape.length!==n[o].length)throw new uC(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(t.shape)}`);for(let s=0;s<n[o].length;++s){if(0===s&&!r)continue;const a=t.shape[s],u=n[o][s];if(null!=u&&u!==a)throw new uC(`Error when checking ${i}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(t.shape)}.`)}}}class SR extends oR{constructor(t){super(t),this.isTraining=!1}summary(t,e,n=console.log){if(!this.built)throw new uC("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");ZE(this,t,e,n)}compile(t){if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){const e={Adagrad:()=>KI.adagrad(.01),Adadelta:()=>KI.adadelta(1,.95,eN()),Adam:()=>KI.adam(.001,.9,.999,eN()),Adamax:()=>KI.adamax(.002,.9,.999,eN(),0),RMSProp:()=>KI.rmsprop(.001,.9,0,eN()),SGD:()=>KI.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new uC(`Unknown Optimizer ${t}`)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof pI))throw new uC("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new uC(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);const n=t.loss;e=n.map((t=>UE(t)))}else{const n=UE(t.loss);this.outputs.forEach((t=>{e.push(n)}))}else{t.loss=t.loss;for(const e in t.loss)if(-1===this.outputNames.indexOf(e))throw new uC(`Unknown entry in loss dictionary: "${e}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==t.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),e.push(UE(t.loss[n]))}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let s=0;s<this.outputs.length;++s){const t=this.internalOutputShapes[s],e=this.outputNames[s];this.feedOutputNames.push(e),this.feedOutputShapes.push(t),this.feedLossFns.push(this.lossFunctions[s])}const n=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],jC("loss",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;const e=this.lossFunctions[t];this.outputs.length>1&&(this.metricsTensors.push([e,t]),this.metricsNames.push(this.outputNames[t]+"_loss"))}}));const r=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>[]));let n;if("string"==typeof t||"function"==typeof t)n=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);n=t}if(Array.isArray(n))return e.map((t=>n));{const t=[];for(const r of e){let e=n.hasOwnProperty(r)?n[r]:[];Array.isArray(e)||(e=[e]),t.push(e)}return t}}(t.metrics,this.outputNames),i=(t,e,n)=>{this.outputNames.length>1&&(e=this.outputNames[t]+"_"+e),this.metricsNames.push(e),this.metricsTensors.push([n,t])};jC("metric",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;(e=>{let n,r,s;for(const o of e){if("string"==typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){const e=this.internalOutputShapes[t];let i;1===e[e.length-1]||this.lossFunctions[t]===ME?-1!==["accuracy","acc"].indexOf(o)?r=VE:-1!==["crossentropy","ce"].indexOf(o)&&(r=GE):this.lossFunctions[t]===PE?-1!==["accuracy","acc"].indexOf(o)?r=jE:-1!==["crossentropy","ce"].indexOf(o)&&(r=qE):-1!==["accuracy","acc"].indexOf(o)?r=WE:-1!==["crossentropy","ce"].indexOf(o)&&(r=HE),-1!==["accuracy","acc"].indexOf(o)?i="acc":-1!==["crossentropy","ce"].indexOf(o)&&(i="ce"),s=r,n=""+i}else{const t=XE(o);s=t,n=""+YE(o)}let e;jC(n,(()=>{e=s})),i(t,n,e)}})(r[t])}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,n={}){const r=null==n.batchSize?32:n.batchSize;fR(r);const i=this.standardizeUserDataXY(t,e,!0,r);try{const s=i[0].concat(i[1]);this.makeTestFunction();const o=this.testFunction;return gC(this.testLoop(o,s,r,n.verbose,n.steps))}finally{vR(i[0],t),vR(i[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),async function(t,e,n){const r=null!=(n=n||{}).batches,i=t.testFunction;let s=[];if(n.verbose>0)throw new lC("Verbose mode is not implemented yet.");Sg(!r||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const o="function"==typeof e.next?e:await e.iterator();let a=0,u=0;for(;!r||u<n.batches;){const e=await o.next();if(s=Gb((()=>{if(e.value){const{xs:n,ys:r}=cR(t,e.value),o=n.concat(r),l=Gb((()=>i(o)));if(jb(o),0===u)for(let t=0;t<l.length;++t)s.push(Rx(0));const c=o[0].shape[0];for(let t=0;t<l.length;++t){const e=l[t],n=s[t];s[t]=Gb((()=>Kb(s[t],Qb(c,e)))),u>0&&jb(n)}jb(l),a+=c,++u}return s})),e.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<s.length;++l){const t=s[l];s[l]=Yb(s[l],a),jb(t)}return gC(s)}(this,t,e)}checkNumSamples(t,e,n,r="steps"){let i;if(null!=n){if(i=null,null!=e)throw new uC(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else{if(null==t)throw new uC(`Either the input data should have a defined shape, or ${r} shoud be specified.`);i=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return i}execute(t,e){if(Array.isArray(e)&&0===e.length)throw new uC("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(e),r=n?e:[e],i=this.retrieveSymbolicTensors(r),s=new nE;if(t instanceof wy&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new uC(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let e=0;e<this.inputs.length;++e)s.add(this.inputs[e],t[e])}else for(const a of this.inputs){const e=t[a.name];if(null==e)throw new uC(`No value is provided for the model's input ${a.name}`);s.add(a,e)}const o=sE(i,s);return n?o:o[0]}retrieveSymbolicTensors(t){const e=dC(null,t.length);let n=t.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],s=i.map((t=>t.name));for(let r=0;r<t.length;++r){const o=s.indexOf(t[r]);if(-1!==o&&(e[r]=i[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw e.forEach(((e,r)=>{null==e&&n.push(t[r])})),new uC(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return e}predictLoop(t,e=32,n=!1){return Gb((()=>{const r=this.checkNumSamples(t);if(n)throw new lC("Verbose predictLoop() is not implemented yet.");const i=yR(r,e),s=this.outputs.map((t=>[]));for(let e=0;e<i.length;++e){Gb((()=>{const n=i[e][0],r=i[e][1],s=gR(t,n,r),o=[];if(Array.isArray(s))for(let t=0;t<s.length;++t)o.push({key:this.inputs[t],value:s[t]});else o.push({key:this.inputs[0],value:s});const a=new nE(o);return sE(this.outputs,a)})).forEach(((t,e)=>s[e].push(t)))}return gC(s.map((t=>Ev(t,0))))}))}predict(t,e={}){const n=bR(t);IR(n,this.inputNames,this.feedInputShapes,!1);try{const r=null==e.batchSize?32:e.batchSize;return fR(r),this.predictLoop(n,r)}finally{vR(n,t)}}predictOnBatch(t){IR(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,n=!0,r){if(null==this.optimizer_)throw new aC("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let s=0;s<this.feedOutputShapes.length;++s){const t=this.feedOutputShapes[s];this.feedLossFns[s]===PE?i.push(t.slice(0,t.length-1).concat([1])):i.push(t)}if(function(t,e,n){const r=SC(t.map((t=>t.shape[0])));r.sort();const i=SC(e.map((t=>t.shape[0])));if(i.sort(),r.length>1)throw new uC(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((t=>t.shape)))}`);if(i.length>1)throw new uC(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((t=>t.shape)))}`);if(r.length>0&&i.length>0&&!Eg(r,i))throw new uC(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}(t=kR(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=kR(e,this.feedOutputNames,i,!1,"target")),function(t,e,n){const r=[DE,ME,LE];for(let i=0;i<t.length;++i){const s=t[i],o=e[i],a=n[i];if(null!=o){if(o===LE&&1===s.shape[s.shape.length-1])throw new uC(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(o)){const t=s.shape.slice(1),e=a.slice(1);for(let n=0;n<t.length;++n){const r=t[n],i=e[n];if(null!=i&&r!==i)throw new uC(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&t[0].shape[0]%r!=0)throw new uC(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,n,r,i=!0,s){const[o,a]=this.standardizeUserDataXY(t,e,i,s);if(null!=n)throw new Error("sample weight is not supported yet.");let u=null;if(null!=r){const t=aR(r,this.outputNames);u=[];for(let e=0;e<t.length;++e)u.push(await uR(a[e],null,t[e]))}return[o,a,u]}testLoop(t,e,n,r=0,i){return Gb((()=>{const s=this.checkNumSamples(e,n,i,"steps"),o=[];if(r>0)throw new lC("Verbose mode is not implemented yet.");if(null!=i)throw new lC("steps mode in testLoop() is not implemented yet");{const r=yR(s,n),i=bk(ZC(0,s));for(let n=0;n<r.length;++n){const s=r[n][0],a=r[n][1],u=iN(i,s,a-s),l=mR(e,u),c=t(l);if(0===n)for(let t=0;t<c.length;++t)o.push(Rx(0));for(let t=0;t<c.length;++t){const e=c[t];o[t]=Kb(o[t],Qb(a-s,e))}}for(let t=0;t<o.length;++t)o[t]=Yb(o[t],s)}return o}))}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let n=0;n<t.length;++n){const r=t[n];let i=r;if(fC(t,r)>1){i+=`_${fC(t.slice(0,n),r)}`}e.push(i)}return e}makeTrainFunction(){return t=>{const e=[],n=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),s=[],o=this.collectedTrainableWeights.map((t=>t.read()));return[this.optimizer_.minimize((()=>{const t=[];for(let e=0;e<this.inputs.length;++e)t.push({key:this.inputs[e],value:n[e]});const o=new nE(t),a=sE(this.outputs,o,{training:!0});let u;for(let n=0;n<this.lossFunctions.length;++n){let t=(0,this.lossFunctions[n])(r[n],a[n]);null!=i[n]&&(t=lR(t,i[n]));const s=gw(t);e.push(s),u=0===n?t:Kb(u,t)}for(let n=0;n<this.metricsTensors.length;++n){let t;if(this.outputs.length>1&&n<this.outputs.length)t=e[n];else{const e=this.metricsTensors[n][0],i=this.metricsTensors[n][1];t=gw(e(r[i],a[i]))}Hb(t),s.push(t)}return u=gw(u),this.calculateLosses().forEach((t=>{u=Kb(u,t)})),u}),!0,o)].concat(s)}}makeTestFunction(){this.testFunction=t=>Gb((()=>{const e=[];let n;const r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let t=0;t<this.inputs.length;++t)s.push({key:this.inputs[t],value:r[t]});const o=new nE(s),a=sE(this.outputs,o);for(let t=0;t<this.lossFunctions.length;++t){const r=this.lossFunctions[t],s=gw(r(i[t],a[t]));n=0===t?s:Kb(n,s),e.push(n)}for(let t=0;t<this.metricsTensors.length;++t){const n=this.metricsTensors[t][0],r=this.metricsTensors[t][1],s=gw(n(i[r],a[r]));e.push(s)}return e}))}async fit(t,e,n={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let r,i,s,o,a,u,l,c,h;this.isTraining=!0;try{const d=null==n.batchSize?32:n.batchSize;fR(d);const p=!1,f=await this.standardizeUserData(t,e,n.sampleWeight,n.classWeight,p,d);r=f[0],i=f[1],h=f[2];let g,m=!1;if(null!=n.validationData&&n.validationData.length>0){if(m=!0,2!==n.validationData.length)throw 3===n.validationData.length?new lC("validationData including sample weights is not supported yet."):new uC(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);a=n.validationData[0],u=n.validationData[1];const t=!0,e=await this.standardizeUserData(a,u,null,null,t,d);l=e[0],c=e[1],g=l.concat(c)}else if(null!=n.validationSplit&&n.validationSplit>0&&n.validationSplit<1){m=!0;const t=Math.floor(r[0].shape[0]*(1-n.validationSplit)),e=r[0].shape[0];l=gR(r,t,e),s=r,r=gR(r,0,t),c=gR(i,t,e),o=i,i=gR(i,0,t),g=l.concat(c)}else null!=n.validationSteps&&(m=!0);const y=r.concat(i).concat(h);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let x,w;m?(this.makeTestFunction(),x=this.testFunction,w=v.slice().concat(v.map((t=>"val_"+t)))):(x=null,g=[],w=v.slice());const k=EE(n.callbacks,n.yieldEvery);return await this.fitLoop(b,y,v,d,n.epochs,n.verbose,k,x,g,n.shuffle,w,n.initialEpoch,null,null)}finally{this.isTraining=!1,vR(r,t),vR(i,e),vR(s,t),vR(o,e),vR(l,a),vR(c,u),null!=h&&jb(h)}}async fitLoop(t,e,n,r,i,s,o,a,u,l,c,h,d,p){null==r&&(r=32),null==i&&(i=1),null==l&&(l=!0),null==h&&(h=0);let f=!1;if(null!=a&&null!=u&&(f=!0),null!=p&&(f=!0,null==d))throw new uC("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(e,r,d,"steps_per_epoch");let m;null!=g&&(m=ZC(0,g)),null==s&&(s=1);const{callbackList:y,history:b}=$E(o,s,i,h,g,d,r,f,c);y.setModel(this),this.history=b,await y.onTrainBegin(),this.stopTraining_=!1;for(let v=h;v<i;++v){await y.onEpochBegin(v);const i={};if(null!=d)throw new lC("stepsPerEpoch mode is not implemented yet.");{if("batch"===l)throw new lC("batch shuffling is not implemneted yet");l&&xg(m);const s=bk(m),o=yR(g,r);for(let l=0;l<o.length;++l){const c={};if(await y.onBatchBegin(l,c),Gb((()=>{const h=o[l][0],d=o[l][1],p=iN(s,h,d-h);c.batch=l,c.size=d-h;const g=mR(e,p),m=t(g);for(let t=0;t<n.length;++t){const e=n[t],r=m[t];c[e]=r,Hb(r)}if(l===o.length-1&&f){const t=this.testLoop(a,u,r);for(let e=0;e<n.length;++e){const r=n[e],s=t[e];Hb(s),i["val_"+r]=s}}})),await y.onBatchEnd(l,c),xE(c),this.stopTraining_)break}s.dispose()}if(await y.onEpochEnd(v,i),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,e){return dR(this,t,e)}async trainOnBatch(t,e){const n=await this.standardizeUserData(t,e),r=n[0],i=n[1],s=this.makeTrainFunction()(r.concat(i)),o=[];for(const a of s){const t=await a.data();o.push(t[0])}return jb(s),vR(n[0],t),vR(n[1],e),gC(o)}getNamedWeights(t){const e=[],n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let s=0;s<r.length;++s)n&&!r[s].trainable||e.push({name:r[s].originalName,tensor:i[s]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const e=Wb().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-Wb().numTensors}return t}getLossIdentifiers(){let t;if("string"==typeof this.loss)t=yC(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if("string"!=typeof t)throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map((t=>yC(t)))}else{const e=Object.keys(this.loss);t={};const n=this.loss;for(const r of e){if("string"!=typeof n[r])throw new Error("Serialization of non-string loss is not supported.");t[r]=yC(n[r])}}return t}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[yC(YE(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((t=>yC(YE(t))));{const t={};for(const e in this.metrics)t[e]=yC(YE(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const e=_E(iR(t.optimizer_config));let n,r;if("string"==typeof t.loss)n=bC(t.loss);else if(Array.isArray(t.loss))n=t.loss.map((t=>bC(t)));else if(null!=t.loss){n={};for(const e in t.loss)n[e]=bC(t.loss[e])}if(Array.isArray(t.metrics))r=t.metrics.map((t=>bC(t)));else if(null!=t.metrics){r={};for(const e in t.metrics)r[e]=bC(t.metrics[e])}this.compile({loss:n,metrics:r,optimizer:e})}async save(t,e){if("string"==typeof t){const e=(n=t,mb.getSaveHandlers(n));if(0===e.length)throw new uC(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new uC(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}var n;if(null==t.save)throw new uC("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await ab(this.getNamedWeights(e)),i={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v4.4.0",convertedBy:null};if(null!=e&&e.includeOptimizer&&null!=this.optimizer){i.trainingConfig=this.getTrainingConfig();const t="optimizer",{data:e,specs:n}=await ab(await this.optimizer.getWeights(),t);r.specs.push(...n),r.data=hb([r.data,e])}if(null!=this.userDefinedMetadata){const t=!0;QE(this.userDefinedMetadata,this.name,t),i.userDefinedMetadata=this.userDefinedMetadata}return i.weightData=r.data,i.weightSpecs=r.specs,t.save(i)}setUserDefinedMetadata(t){QE(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}SR.className="Model",dI(SR);class TR extends SR{}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
async function CR(t,e){if(null==e&&(e={}),"string"==typeof t){const i=(n=t,r=e,mb.getLoadHandlers(n,r));if(0===i.length)i.push(function(t,e){return EI(t,e)}(t,e));else if(i.length>1)throw new uC(`Found more than one (${i.length}) load handlers for URL '${t}'`);t=i[0]}var n,r;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */return async function(t,e,n){null==n&&(n={});if(null==t.load)throw new uC("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await t.load();let i=r.modelTopology;null!=i.model_config&&(i=i.model_config);const s=null==n.strict||n.strict,o=null!=r.weightData&&null!=r.weightSpecs&&s,a=_E(iR(i),e,o),u=r.trainingConfig;null!=u&&a.loadTrainingConfig(u);null!=r.userDefinedMetadata&&a.setUserDefinedMetadata(r.userDefinedMetadata);if(null!=r.weightData){if(null==r.weightSpecs)throw new uC("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:t,optimizerWeights:e}=function(t,e){const n=function(t,e){const n={};let r,i=0;for(const s of e){const e=s.name,o=s.dtype,a=s.shape,u=Ng(a);let l;if("quantization"in s){const n=s.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${s.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${s.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==o)throw new Error(`Weight ${s.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${o}.`)}const a=ob[n.dtype],c=t.slice(i,i+u*a),h="uint8"===n.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===o)if("uint8"===n.dtype||"uint16"===n.dtype){l=new Float32Array(h.length);for(let t=0;t<h.length;t++){const e=h[t];l[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=gb()),l=r(h)}else{if("int32"!==o)throw new Error(`Unsupported dtype in weight '${e}': ${o}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);l=new Int32Array(h.length);for(let t=0;t<h.length;t++){const e=h[t];l[t]=Math.round(e*n.scale+n.min)}}i+=u*a}else if("string"===o){const e=Ng(s.shape);l=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(i,i+4))[0];i+=4;const n=new Uint8Array(t.slice(i,i+e));l.push(n),i+=e}}else{const r=ob[o],s=t.slice(i,i+u*r);if("float32"===o)l=new Float32Array(s);else if("int32"===o)l=new Int32Array(s);else if("bool"===o)l=new Uint8Array(s);else{if("complex64"!==o)throw new Error(`Unsupported dtype in weight '${e}': ${o}`);{l=new Float32Array(s);const t=new Float32Array(l.length/2),r=new Float32Array(l.length/2);for(let e=0;e<t.length;e++)t[e]=l[2*e],r[e]=l[2*e+1];const i=sb(t,a,"float32"),o=sb(r,a,"float32");n[e]=rb(i,o),i.dispose(),o.dispose()}}i+=u*r}"complex64"!==o&&(n[e]=sb(l,a,o))}return n}(t,e),r={},i=[];return e.forEach((t=>{"optimizer"===t.group?i.push({name:t.name,tensor:n[t.name]}):r[t.name]=n[t.name]})),{modelWeights:r,optimizerWeights:i}}(r.weightData,r.weightSpecs);a.loadWeights(t,s),null!=a.optimizer&&e.length>0&&await a.optimizer.setWeights(e),jb(t),jb(e.map((t=>t.tensor)))}return a}(t,void 0,e)}TR.className="Functional",dI(TR);class NR extends SR{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=null!=t.name?t.name:FC("sequential_"),null!=t.layers)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some((t=>t<0)))throw new uC(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof NR||t instanceof SR;let n;if(e){if(n=t,1!==n.outputs.length)throw new uC("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new uC("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new uC("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const e=function(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new uC("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));let n=t.dtype;return null==n&&(n="float32"),new eE({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(e)}if(e)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new uC(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(1!==t.inboundNodes[0].outputTensors.length)throw new uC("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=tE(this.outputs[0])}this.inboundNodes=[],new QN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:dC(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs[0].shape})}else{const e=t.apply(this.outputs[0]);if(Array.isArray(e))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[e],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return null==this.model&&this.build(),this.model.call(t,e)}build(t){if(WN(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new SR({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,n=console.log){this.built||this.build(),super.summary(t,e,n)}setWeights(t){null==this.model&&this.build(),this.model.setWeights(t)}evaluate(t,e,n={}){if(!this.built)throw new aC("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)}async evaluateDataset(t,e){if(!this.built)throw new aC("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return null==this.model&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,n={}){if(!this.built)throw new aC("The model needs to be compiled before being used.");return this.model.fit(t,e,n)}async fitDataset(t,e){if(!this.built)throw new aC("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,n={},r=!1){let i,s={};if(e instanceof Array){if(null==e[0].className||"Merge"===e[0].className)throw new uC("Legacy serialization format not supported yet.");i=e}else Sg(null!=e.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),i=e.layers,delete e.layers,s=e;const o=new t(s);if(!(o instanceof NR))throw new lC(`Sequential.fromConfig called on non-Sequential input: ${o}`);for(const a of i){const t=_E(a,void 0,r);r&&t.setFastWeightInitDuringBuild(!0),o.add(t)}return o}set stopTraining(t){if(null==this.model)throw new uC("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(null==this.model)throw new uC("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const n={};n.className=e.getClassName(),n.config=e.getConfig(),t.push(n)}return{name:this.name,layers:t}}}NR.className="Sequential",dI(NR);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class ER extends cI{getConfig(){return{}}}class RR extends ER{apply(t,e=1){return function(t,e=1){if(1!==e)throw new lC(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return mx(t)}(t,e)}}RR.className="elu",dI(RR);class $R extends ER{apply(t){return Qw(t)}}$R.className="selu",dI($R);class _R extends ER{apply(t){return Hw(t)}}_R.className="relu",dI(_R);class AR extends ER{apply(t){return Gb((()=>bw(6,Hw(t))))}}AR.className="relu6",dI(AR);class DR extends ER{apply(t){return t}}DR.className="linear",dI(DR);class FR extends ER{apply(t){return $v(t)}}FR.className="sigmoid",dI(FR);class OR extends ER{apply(t){return function(t){return Gb((()=>{const e=Kb(.5,Qb(.2,t));return Vv(e,0,1)}))}(t)}}OR.className="hardSigmoid",dI(OR);class LR extends ER{apply(t){return rw(t)}}LR.className="softplus",dI(LR);class PR extends ER{apply(t){return function(t){return Gb((()=>Yb(t,Kb(Jb(t),1))))}(t)}}PR.className="softsign",dI(PR);class MR extends ER{apply(t){return Av(t)}}MR.className="tanh",dI(MR);class zR extends ER{apply(t,e=-1){return ok(t,e)}}zR.className="softmax",dI(zR);class BR extends ER{apply(t,e=-1){return ow(t,e)}}BR.className="logSoftmax",dI(BR);class UR extends ER{apply(t,e=1){return Gb((()=>Qb($v(Qb(t,e)),t)))}}UR.className="swish",dI(UR);class VR extends ER{apply(t){return Gb((()=>Qb(t,Av(rw(t)))))}}function WR(t){return t.getClassName()}function GR(t,e={}){return kC(t,hI.getMap().classNameMap,e,"activation")}function jR(t){if(null==t){const t={className:"linear",config:{}};return GR(t)}if("string"==typeof t){const e={};return e.className=t,e.config={},GR(e)}return t instanceof ER?t:GR(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */VR.className="mish",dI(VR);class HR extends cI{}class qR extends HR{constructor(t){super(),function(t){if(null!=t&&"object"!=typeof t)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}(t),this.l1=null==t||null==t.l1?.01:t.l1,this.l2=null==t||null==t.l2?.01:t.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(t){return Gb((()=>{let e=mw([1]);return this.hasL1&&(e=Kb(e,Ax(Qb(this.l1,Jb(t))))),this.hasL2&&(e=Kb(e,Ax(Qb(this.l2,pN(t))))),Tv(e,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}qR.className="L1L2",dI(qR);const KR={l1l2:"L1L2"};function XR(t){return xC(t)}function YR(t,e={}){return kC(t,hI.getMap().classNameMap,e,"regularizer")}function QR(t){if(null==t)return null;if("string"==typeof t){return YR({className:t in KR?KR[t]:t,config:{}})}return t instanceof HR?t:YR(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class JR extends ZN{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,null!=t&&(this.maxValue=t.maxValue)}call(t,e){t=VN(t);let n=Hw(t);return null!=this.maxValue&&(n=Vv(n,0,this.maxValue)),n}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}JR.className="ReLU",dI(JR);class ZR extends ZN{constructor(t){super(null==t?{}:t),this.DEFAULT_ALPHA=.3,null==t&&(t={}),this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=VN(t);return Xx(n,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}ZR.className="LeakyReLU",dI(ZR);class t$ extends ZN{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),this.supportsMasking=!0,this.alphaInitializer=zN(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=QR(t.alphaRegularizer),this.alphaConstraint=bE(t.alphaConstraint),null==t.sharedAxes)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new uC(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`);this.sharedAxes=[t.sharedAxes]}}build(t){const e=(t=WN(t)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)e[r-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<t.length;++r)n[r]=t[r];this.inputSpec=[new KN({ndim:t.length,axes:n})],this.built=!0}call(t,e){return t=VN(t),Ew(t,this.alpha.read())}getConfig(){const t={alphaInitializer:MN(this.alphaInitializer),alphaRegularizer:XR(this.alphaRegularizer),alphaConstraint:mE(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}t$.className="PReLU",dI(t$);class e$ extends ZN{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==this.DEFAULT_ALPHA)throw new lC(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=VN(t);return mx(n)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}e$.className="ELU",dI(e$);class n$ extends ZN{constructor(t){super(null==t?{}:t),this.DEFAULT_THETA=1,null==t&&(t={}),this.theta=null==t.theta?this.DEFAULT_THETA:t.theta}call(t,e){const n=VN(t);return Qb(n,Bb(Wx(n,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}n$.className="ThresholdedReLU",dI(n$);class r$ extends ZN{constructor(t){super(null==t?{}:t),this.DEFAULT_AXIS=1,null==t&&(t={}),this.softmax=(new zR).apply,this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis}call(t,e){const n=VN(t);return this.softmax(n,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function i$(t,e,n){if("number"==typeof t)return dC(t,e);if(t.length!==e)throw new uC(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let i=0;i<e;++i){const s=t[i];if((r=s)!==parseInt(r.toString(),10))throw new uC(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${s}`)}return t;var r}function s$(t,e,n,r,i=1){if(null==t)return t;let s;return s="same"===n?t:t-(e+(e-1)*(i-1))+1,Math.floor((s+r-1)/r)}function o$(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+JC([n-e,0]);else{if("same"!==r)throw new uC(`Unsupport padding mode: ${r}.`);t*=e}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function a$(t,e){return Gb((()=>(UC(e),"channelsFirst"===e?Ek(t,[0,2,3,1]):t)))}function u$(t,e){return Gb((()=>(UC(e),"channelsFirst"===e?Ek(t,[0,2,3,4,1]):t)))}function l$(t,e,n,r=[1,1],i="valid",s,o,a=null){return Gb((()=>{if(null==s&&(s="channelsLast"),UC(s),3!==t.rank&&4!==t.rank)throw new uC(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(3!==e.rank&&4!==e.rank)throw new uC(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let u=a$(t,s);if("causal"===i)throw new lC("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Ok({x:u,filter:e,strides:r,pad:"same"===i?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),"channelsFirst"===s&&(u=Ek(u,[0,3,1,2])),u}))}r$.className="Softmax",dI(r$);class c$ extends ZN{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",c$.verifyArgs(e),this.rank=t,EC(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new lC(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=i$(e.kernelSize,t,"kernelSize"),this.strides=i$(null==e.strides?1:e.strides,t,"strides"),this.padding=null==e.padding?"valid":e.padding,VC(this.padding),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,UC(this.dataFormat),this.activation=jR(e.activation),this.useBias=null==e.useBias||e.useBias,this.biasInitializer=zN(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=bE(e.biasConstraint),this.biasRegularizer=QR(e.biasRegularizer),this.activityRegularizer=QR(e.activityRegularizer),this.dilationRate=i$(null==e.dilationRate?1:e.dilationRate,t,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new uC(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new uC(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new uC(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(t){if(pC("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!NC(t.kernelSize,"number",1,3))throw new uC(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:WR(this.activation),useBias:this.useBias,biasInitializer:MN(this.biasInitializer),biasRegularizer:XR(this.biasRegularizer),activityRegularizer:XR(this.activityRegularizer),biasConstraint:mE(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class h$ extends c${constructor(t,e){super(t,e),this.kernel=null,h$.verifyArgs(e),this.filters=e.filters,EC(this.filters,"filters"),this.kernelInitializer=zN(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=bE(e.kernelConstraint),this.kernelRegularizer=QR(e.kernelRegularizer)}build(t){t=WN(t);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new uC(`The channel dimension of the input should be defined. Found ${t[e]}`);const n=t[e],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:n}}],this.built=!0}call(t,e){return Gb((()=>{let e;t=VN(t);const n=null==this.bias?null:this.bias.read(),r=$C(this.activation.getClassName());if(null!=r&&2===this.rank)e=l$(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)e=function(t,e,n,r=1,i="valid",s,o=1){return Gb((()=>{if(null==s&&(s="channelsLast"),UC(s),3!==t.shape.length)throw new uC(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(3!==e.shape.length)throw new uC(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new uC(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if("channelsFirst"===s&&(t=Ek(t,[0,2,1])),"causal"===i)throw new lC("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Kv(t,e,r,"same"===i?"same":"valid","NWC",o);return null!=n&&(a=gN(a,n)),a}))}(t,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)e=l$(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new lC("convolutions greater than 3D are not implemented yet.");e=function(t,e,n,r=[1,1,1],i="valid",s,o){return Gb((()=>{if(null==s&&(s="channelsLast"),UC(s),4!==t.rank&&5!==t.rank)throw new uC(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(4!==e.rank&&5!==e.rank)throw new uC(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=u$(t,s);if("causal"===i)throw new lC("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=Qv(a,e,r,"same"===i?"same":"valid","NDHWC",o),null!=n&&(a=gN(a,n)),"channelsFirst"===s&&(a=Ek(a,[0,4,1,2,3])),a}))}(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(e=this.activation.apply(e))}return e}))}computeOutputShape(t){t=WN(t);const e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2);for(let i=0;i<n.length;++i){const t=s$(n[i],this.kernelSize[i],this.padding,this.strides[i],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[i]);e.push(t)}let r=[t[0]];return"channelsLast"===this.dataFormat?(r=r.concat(e),r.push(this.filters)):(r.push(this.filters),r=r.concat(e)),r}getConfig(){const t={filters:this.filters,kernelInitializer:MN(this.kernelInitializer),kernelRegularizer:XR(this.kernelRegularizer),kernelConstraint:mE(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new uC(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class d$ extends h${constructor(t){super(2,t),d$.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!NC(t.kernelSize,"number",1,2))throw new uC(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}d$.className="Conv2D",dI(d$);class p$ extends h${constructor(t){super(3,t),p$.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new uC(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}p$.className="Conv3D",dI(p$);class f$ extends d${constructor(t){if(super(t),this.inputSpec=[new KN({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new uC(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(4!==(t=WN(t)).length)throw new uC("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new uC("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new KN({ndim:4,axes:{[e]:n}})],this.built=!0}call(t,e){return Gb((()=>{let e=VN(t);if(4!==e.shape.length)throw new uC(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let i,s;"channelsFirst"===this.dataFormat?(i=2,s=3):(i=1,s=2);const o=n[i],a=n[s],u=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],h=this.strides[1],d=[r,o$(o,c,u,this.padding),o$(a,h,l,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=Ek(e,[0,2,3,1]));let p=Yv(e,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=Ek(p,[0,3,1,2])),null!=this.bias&&(p=gN(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p}))}computeOutputShape(t){const e=(t=WN(t)).slice();let n,r,i;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3):(n=3,r=1,i=2);const s=this.kernelSize[0],o=this.kernelSize[1],a=this.strides[0],u=this.strides[1];return e[n]=this.filters,e[r]=o$(e[r],a,s,this.padding),e[i]=o$(e[i],u,o,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}f$.className="Conv2DTranspose",dI(f$);class g$ extends p${constructor(t){if(super(t),this.inputSpec=[new KN({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new uC(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(5!==(t=WN(t)).length)throw new uC("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new uC("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new KN({ndim:5,axes:{[e]:n}})],this.built=!0}call(t,e){return Gb((()=>{let e=VN(t);if(5!==e.shape.length)throw new uC(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let i,s,o;"channelsFirst"===this.dataFormat?(o=2,i=3,s=4):(o=1,i=2,s=3);const a=n[o],u=n[i],l=n[s],c=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],p=this.strides[0],f=this.strides[1],g=this.strides[2],m=[r,o$(a,p,c,this.padding),o$(u,f,h,this.padding),o$(l,g,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=Ek(e,[0,2,3,4,1]));let y=Zv(e,this.kernel.read(),m,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(y=Ek(y,[0,4,1,2,3])),null!==this.bias&&(y=gN(y,this.bias.read(),this.dataFormat)),null!==this.activation&&(y=this.activation.apply(y)),y}))}computeOutputShape(t){const e=(t=WN(t)).slice();let n,r,i,s;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3,s=4):(n=4,r=1,i=2,s=3);const o=this.kernelSize[0],a=this.kernelSize[1],u=this.kernelSize[2],l=this.strides[0],c=this.strides[1],h=this.strides[2];return e[n]=this.filters,e[r]=o$(e[r],l,o,this.padding),e[i]=o$(e[i],c,a,this.padding),e[s]=o$(e[s],h,u,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}g$.className="Conv3DTranspose",dI(g$);class m$ extends h${constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==e.filters)throw new uC("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=e.kernelInitializer||null!=e.kernelRegularizer||null!=e.kernelConstraint)throw new uC("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=e.padding&&"same"!==e.padding&&"valid"!==e.padding)throw new uC(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=zN(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=QR(e.depthwiseRegularizer),this.depthwiseConstraint=bE(e.depthwiseConstraint),this.pointwiseInitializer=zN(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=QR(e.pointwiseRegularizer),this.pointwiseConstraint=bE(e.pointwiseConstraint)}build(t){if((t=WN(t)).length<this.rank+2)throw new uC(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e]||t[e]<0)throw new uC(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const n=t[e],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let o=0;o<this.rank;++o)i.push(1);i.push(n*this.depthMultiplier,this.filters);const s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new KN({ndim:this.rank+2,axes:{[e]:n}})],this.built=!0}call(t,e){return Gb((()=>{let e;if(t=VN(t),1===this.rank)throw new lC("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(t=Ek(t,[0,2,3,1])),e=Jw(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(e=gN(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),"channelsFirst"===this.dataFormat&&(e=Ek(e,[0,3,1,2])),e}))}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=MN(this.depthwiseInitializer),t.pointwiseInitializer=MN(this.pointwiseInitializer),t.depthwiseRegularizer=XR(this.depthwiseRegularizer),t.pointwiseRegularizer=XR(this.pointwiseRegularizer),t.depthwiseConstraint=mE(this.depthwiseConstraint),t.pointwiseConstraint=mE(this.pointwiseConstraint),t}}m$.className="SeparableConv";class y$ extends m${constructor(t){super(2,t)}}y$.className="SeparableConv2D",dI(y$);class b$ extends h${constructor(t){super(1,t),b$.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!NC(t.kernelSize,"number",1,1))throw new uC(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}b$.className="Conv1D",dI(b$);class v$ extends ZN{constructor(t){super(t),"number"==typeof t.cropping?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return Gb((()=>{if(t=VN(t),"channelsLast"===this.dataFormat){const e=oN(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return oN(e,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const e=oN(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return oN(e,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}v$.className="Cropping2D",dI(v$);class x$ extends ZN{constructor(t){var e;super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==t.size?this.DEFAULT_SIZE:t.size,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,UC(this.dataFormat),this.interpolation=null==t.interpolation?"nearest":t.interpolation,e=this.interpolation,CC(LC,"InterpolationFormat",e)}computeOutputShape(t){if("channelsFirst"===this.dataFormat){const e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}{const e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2];return[t[0],e,n,t[3]]}}call(t,e){return Gb((()=>{let e=VN(t);const n=e.shape;if("channelsFirst"===this.dataFormat){e=Ek(e,[0,2,3,1]);const t=this.size[0]*n[2],r=this.size[1]*n[3],i="nearest"===this.interpolation?uI.resizeNearestNeighbor(e,[t,r]):uI.resizeBilinear(e,[t,r]);return Ek(i,[0,3,1,2])}{const t=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?uI.resizeNearestNeighbor(e,[t,r]):uI.resizeBilinear(e,[t,r])}}))}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}x$.className="UpSampling2D",dI(x$);class w$ extends c${constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=zN(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=bE(t.depthwiseConstraint),this.depthwiseRegularizer=QR(t.depthwiseRegularizer)}build(t){if((t=WN(t)).length<4)throw new uC(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new uC(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const n=t[e],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return Gb((()=>{let e=
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function(t,e,n=[1,1],r="valid",i,s){return Gb((()=>{null==i&&(i="channelsLast"),UC(i);let o=a$(t,i);if(4!==t.rank)throw new uC(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(4!==e.rank)throw new uC(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=ox(o,e,n,"same"===r?"same":"valid","NHWC",s),"channelsFirst"===i&&(o=Ek(o,[0,3,1,2])),o}))}(t=VN(t),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(e=gN(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),e}))}computeOutputShape(t){t=WN(t);const e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=s$(e,this.kernelSize[0],this.padding,this.strides[0]),s=s$(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],r,i,s]:[t[0],i,s,r]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=MN(this.depthwiseInitializer),t.depthwiseRegularizer=XR(this.depthwiseRegularizer),t.depthwiseConstraint=mE(this.depthwiseRegularizer),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function k$(t,e,n,r){if(Array.isArray(t)){if(null!=e||null!=n)throw new uC("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=i(e),constants:n=i(n)}}function I$(t,e,n,r=!1,i,s,o=!1,a=!1){return Gb((()=>{const u=e.shape.length;if(u<3)throw new uC(`Input should be at least 3D, but is ${u}D.`);const l=[1,0].concat(ZC(2,u));if(e=Ek(e,l),null!=s)throw new lC("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=Bb(Bb(i,"bool"),"float32")).rank===u-1&&(i=Px(i,-1)),i=Ek(i,l)),r&&(e=Kw(e,0),null!=i&&(i=Kw(i,0)));const c=[];let h,d=n;const p=e.shape[0],f=Ck(e);let g,m;null!=i&&(g=Ck(i));for(let e=0;e<p;++e){const n=f[e],r=Gb((()=>t(n,d)));if(null==i)h=r[0],d=r[1];else{const t=Gb((()=>{const t=g[e],n=sw(Sw(t),t);return{output:Kb(Qb(r[0],t),Qb(d[0],n)),newStates:d.map(((e,i)=>Kb(Qb(r[1][i],t),Qb(e,n))))}}));h=t.output,d=t.newStates}a&&c.push(h)}if(a){m=fk(c,1)}return[h,m,d]}))}w$.className="DepthwiseConv2D",dI(w$);class S$ extends ZN{constructor(t){let e;if(super(t),null==t.cell)throw new uC("cell property is missing for the constructor of RNN.");if(e=Array.isArray(t.cell)?new A$({cells:t.cell}):t.cell,null==e.stateSize)throw new uC("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=null!=t.returnSequences&&t.returnSequences,this.returnState=null!=t.returnState&&t.returnState,this.goBackwards=null!=t.goBackwards&&t.goBackwards,this._stateful=null!=t.stateful&&t.stateful,this.unroll=null!=t.unroll&&t.unroll,this.supportsMasking=!0,this.inputSpec=[new KN({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return ZC(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((t=>null))}return this.states_}setStates(t){this.states_=t}computeOutputShape(t){BN(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const n=e[0];let r;if(r=this.returnSequences?[t[0],t[1],n]:[t[0],n],this.returnState){const n=[];for(const r of e)n.push([t[0],r]);return[r].concat(n)}return r}computeMask(t,e){return Gb((()=>{Array.isArray(e)&&(e=e[0]);const t=this.returnSequences?e:null;if(this.returnState){const e=this.states.map((t=>null));return[t].concat(e)}return t}))}get states(){if(null==this.states_){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let n=0;n<t;++n)e.push(null);return e}return this.states_}set states(t){this.states_=t}build(t){if(null!=this.numConstants)throw new lC("Constants support is not implemented in RNN yet.");BN(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,n=t.slice(2);this.inputSpec[0]=new KN({shape:[e,null,...n]});const r=[t[0]].concat(t.slice(2));let i;if(this.cell.build(r),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Eg(this.stateSpec.map((t=>t.shape[t.shape.length-1])),i))throw new uC(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map((t=>new KN({shape:[null,t]})));this.stateful&&this.resetStates()}resetStates(t,e=!1){Gb((()=>{if(!this.stateful)throw new oC("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new uC("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>mw([n,t]))):this.states_=[mw([n,this.cell.stateSize])];else if(null==t)jb(this.states_),null!=this.keptStates&&(jb(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>mw([n,t]))):this.states_[0]=mw([n,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new uC(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);!0===e?this.keptStates.push(this.states_.slice()):jb(this.states_);for(let e=0;e<this.states_.length;++e){const r=t[e],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[e]:this.cell.stateSize,s=[n,i];if(!Eg(r.shape,s))throw new uC(`State ${e} is incompatible with layer ${this.name}: expected shape=${s}, received shape=${r.shape}`);this.states_[e]=r}}this.states_=this.states_.map((t=>Hb(t.clone())))}))}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=k$(t,n,r,this.numConstants);t=i.inputs,n=i.initialState,r=i.constants;let s=[],o=[];if(null!=n){e.initialState=n,s=s.concat(n),this.stateSpec=[];for(const t of n)this.stateSpec.push(new KN({shape:t.shape}));o=o.concat(this.stateSpec)}null!=r&&(e.constants=r,s=s.concat(r),this.numConstants=r.length);if(s[0]instanceof XN){const n=[t].concat(s),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return Gb((()=>{const n=null==e?null:e.mask,r=null==e?null:e.training;let i=null==e?null:e.initialState;t=VN(t),null==i&&(i=this.stateful?this.states_:this.getInitialState(t));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==s)throw new uC(`RNN Layer has ${s} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:r},a=I$(((t,e)=>{const n=this.cell.call([t].concat(e),o);return[n[0],n.slice(1)]}),t,i,this.goBackwards,n,null,this.unroll,this.returnSequences),u=a[0],l=a[1],c=a[2];this.stateful&&this.resetStates(c,r);const h=this.returnSequences?l:u;return this.returnState?[h].concat(c):h}))}getInitialState(t){return Gb((()=>{let e=mw(t.shape);return e=Ax(e,[1,2]),e=rN(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((t=>t>1?lN(e,[1,t]):e)):this.cell.stateSize>1?[lN(e,[1,this.cell.stateSize])]:[e]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===S$.className&&(e.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),t),e)}static fromConfig(t,e,n={}){const r=_E(e.cell,n);return new t(Object.assign(e,{cell:r}))}}S$.className="RNN",dI(S$);class T$ extends ZN{}class C$ extends T${constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,EC(this.units,"units"),this.activation=jR(null==t.activation?this.DEFAULT_ACTIVATION:t.activation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=zN(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=zN(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=zN(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=QR(t.kernelRegularizer),this.recurrentRegularizer=QR(t.recurrentRegularizer),this.biasRegularizer=QR(t.biasRegularizer),this.kernelConstraint=bE(t.kernelConstraint),this.recurrentConstraint=bE(t.recurrentConstraint),this.biasConstraint=bE(t.biasConstraint),this.dropout=QC([1,JC([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=QC([1,JC([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=WN(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return Gb((()=>{if(2!==(t=t).length)throw new uC(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let n=t[1];t=t[0];const r=null!=e.training&&e.training;let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=D$({ones:()=>Sw(t),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=D$({ones:()=>Sw(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;i=hN(null!=s?Qb(t,s):t,this.kernel.read()),null!=this.bias&&(i=gN(i,this.bias.read())),null!=o&&(n=Qb(n,o));let a=Kb(i,hN(n,this.recurrentKernel.read()));return null!=this.activation&&(a=this.activation.apply(a)),[a,a]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:WR(this.activation),useBias:this.useBias,kernelInitializer:MN(this.kernelInitializer),recurrentInitializer:MN(this.recurrentInitializer),biasInitializer:MN(this.biasInitializer),kernelRegularizer:XR(this.kernelRegularizer),recurrentRegularizer:XR(this.recurrentRegularizer),biasRegularizer:XR(this.biasRegularizer),activityRegularizer:XR(this.activityRegularizer),kernelConstraint:mE(this.kernelConstraint),recurrentConstraint:mE(this.recurrentConstraint),biasConstraint:mE(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),e)}}C$.className="SimpleRNNCell",dI(C$);class N$ extends S${constructor(t){t.cell=new C$(t),super(t)}call(t,e){return Gb((()=>{null!=this.cell.dropoutMask&&(jb(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jb(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return new t(e)}}N$.className="SimpleRNN",dI(N$);class E$ extends T${constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new uC("GRUCell does not support reset_after parameter set to true.");this.units=t.units,EC(this.units,"units"),this.activation=jR(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=jR(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=zN(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=zN(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=zN(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=QR(t.kernelRegularizer),this.recurrentRegularizer=QR(t.recurrentRegularizer),this.biasRegularizer=QR(t.biasRegularizer),this.kernelConstraint=bE(t.kernelConstraint),this.recurrentConstraint=bE(t.recurrentConstraint),this.biasConstraint=bE(t.biasConstraint),this.dropout=QC([1,JC([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=QC([1,JC([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){const e=(t=WN(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return Gb((()=>{if(2!==(t=t).length)throw new uC(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const n=null!=e.training&&e.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=D$({ones:()=>Sw(t),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=D$({ones:()=>Sw(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,s=this.recurrentDropoutMask;let o,a,u;0<this.dropout&&this.dropout<1&&(t=Qb(t,i[0]));let l=hN(t,this.kernel.read());this.useBias&&(l=gN(l,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Qb(r,s[0]));const c=this.recurrentKernel.read(),[h,d]=ck(c,[2*this.units,this.units],c.rank-1),p=hN(r,h),[f,g,m]=ck(l,3,l.rank-1),[y,b]=ck(p,2,p.rank-1);o=this.recurrentActivation.apply(Kb(f,y)),a=this.recurrentActivation.apply(Kb(g,b));const v=hN(Qb(a,r),d);u=this.activation.apply(Kb(m,v));const x=Kb(Qb(o,r),Qb(Kb(1,nw(o)),u));return[x,x]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:WR(this.activation),recurrentActivation:WR(this.recurrentActivation),useBias:this.useBias,kernelInitializer:MN(this.kernelInitializer),recurrentInitializer:MN(this.recurrentInitializer),biasInitializer:MN(this.biasInitializer),kernelRegularizer:XR(this.kernelRegularizer),recurrentRegularizer:XR(this.recurrentRegularizer),biasRegularizer:XR(this.biasRegularizer),activityRegularizer:XR(this.activityRegularizer),kernelConstraint:mE(this.kernelConstraint),recurrentConstraint:mE(this.recurrentConstraint),biasConstraint:mE(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),e)}}E$.className="GRUCell",dI(E$);class R$ extends S${constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new E$(t),super(t)}call(t,e){return Gb((()=>{null!=this.cell.dropoutMask&&(jb(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jb(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}R$.className="GRU",dI(R$);class $$ extends T${constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,EC(this.units,"units"),this.activation=jR(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=jR(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=zN(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=zN(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=zN(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=QR(t.kernelRegularizer),this.recurrentRegularizer=QR(t.recurrentRegularizer),this.biasRegularizer=QR(t.biasRegularizer),this.kernelConstraint=bE(t.kernelConstraint),this.recurrentConstraint=bE(t.recurrentConstraint),this.biasConstraint=bE(t.biasConstraint),this.dropout=QC([1,JC([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=QC([1,JC([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;const n=(t=WN(t))[t.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const t=this.biasInitializer,n=this.units;r=new((e=class extends xN{apply(e,r){const i=t.apply([n]),s=(new kN).apply([n]),o=t.apply([2*n]);return uN(uN(i,s),o)}}).className="CustomInit",e)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return Gb((()=>{const n=null!=e.training&&e.training;if(3!==(t=t).length)throw new uC(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let r=t[1];const i=t[2];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=D$({ones:()=>Sw(t),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=D$({ones:()=>Sw(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;let a,u,l,c;0<this.dropout&&this.dropout<1&&(t=Qb(t,s[0]));let h=hN(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Qb(r,o[0])),h=Kb(h,hN(r,this.recurrentKernel.read())),this.useBias&&(h=gN(h,this.bias.read()));const[d,p,f,g]=ck(h,4,h.rank-1);a=this.recurrentActivation.apply(d),u=this.recurrentActivation.apply(p),l=Kb(Qb(u,i),Qb(a,this.activation.apply(f))),c=this.recurrentActivation.apply(g);const m=Qb(c,this.activation.apply(l));return[m,m,l]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:WR(this.activation),recurrentActivation:WR(this.recurrentActivation),useBias:this.useBias,kernelInitializer:MN(this.kernelInitializer),recurrentInitializer:MN(this.recurrentInitializer),biasInitializer:MN(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:XR(this.kernelRegularizer),recurrentRegularizer:XR(this.recurrentRegularizer),biasRegularizer:XR(this.biasRegularizer),activityRegularizer:XR(this.activityRegularizer),kernelConstraint:mE(this.kernelConstraint),recurrentConstraint:mE(this.recurrentConstraint),biasConstraint:mE(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),e)}}$$.className="LSTMCell",dI($$);class _$ extends S${constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new $$(t),super(t)}call(t,e){return Gb((()=>{null!=this.cell.dropoutMask&&(jb(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jb(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}_$.className="LSTM",dI(_$);class A$ extends T${constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return Gb((()=>{let n=(t=t).slice(1);const r=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?r.push(n.splice(0,t.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let s;for(let o=0;o<this.cells.length;++o){const a=this.cells[o];n=r[o],s=0===o?[t[0]].concat(n):[s[0]].concat(n),s=a.call(s,e),i.push(s.slice(1))}n=[];for(const t of i.slice().reverse())n.push(...t);return[s[0]].concat(n)}))}build(t){let e;BN(t)&&(t=t[0]),t=t,this.cells.forEach(((n,r)=>{jC(`RNNCell_${r}`,(()=>{n.build(t),e=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,t=[t[0],e]}))})),this.built=!0}getConfig(){const t=super.getConfig(),e={cells:this.cells.map((t=>({className:t.getClassName(),config:t.getConfig()})))};return Object.assign(Object.assign({},t),e)}static fromConfig(t,e,n={}){const r=[];for(const i of e.cells)r.push(_E(i,n));return new t({cells:r})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return HN(t)}setWeights(t){const e=[];for(const n of this.cells){const r=n.weights.length,i=t.splice(r);for(let t=0;t<n.weights.length;++t)e.push([n.weights[t],i[t]])}qN(e)}}function D$(t){const{ones:e,rate:n,training:r=!1,count:i=1,dropoutFunc:s}=t,o=()=>null!=s?s(e(),n):mN(e(),n),a=()=>yN(o,e,r);if(!i||i<=1)return Hb(a().clone());return Array(i).fill(void 0).map(a).map((t=>Hb(t.clone())))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */A$.className="StackedRNNCells",dI(A$);class F$ extends S${constructor(t){if(t.unroll)throw new lC("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new lC("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new KN({ndim:5})]}call(t,e){return Gb((()=>{if(null!=this.cell.dropoutMask&&(jb(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jb(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new uC("ConvRNN2D cell does not support constants");const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return Gb((()=>{const{stateSize:e}=this.cell,n=t.shape,r=this.computeSingleOutputShape(n),i=mw([r[0],...r.slice(2)]);return Array.isArray(e)?Array(e.length).fill(i):[i]}))}resetStates(t,e=!1){Gb((()=>{if(!this.stateful)throw new oC("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)];if(null==n[0])throw new uC("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>mw(i))):this.states_=[mw(i)];else if(null==t)jb(this.states_),null!=this.keptStates&&(jb(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>mw(i))):this.states_[0]=mw(i);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new uC(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):jb(this.states_);for(let e=0;e<this.states_.length;++e){const n=t[e],r=i;if(!Eg(n.shape,r))throw new uC(`State ${e} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${n.shape}`);this.states_[e]=n}}this.states_=this.states_.map((t=>Hb(t.clone())))}))}computeSingleOutputShape(t){const{dataFormat:e,filters:n,kernelSize:r,padding:i,strides:s,dilationRate:o}=this.cell,a="channelsFirst"===e,u=t[a?3:2],l=t[a?4:3],c=s$(u,r[0],i,s[0],o[0]),h=s$(l,r[1],i,s[1],o[1]);return[...t.slice(0,2),...a?[n,c,h]:[c,h,n]]}}F$.className="ConvRNN2D";class O$ extends $${constructor(t){const{filters:e,kernelSize:n,strides:r,padding:i,dataFormat:s,dilationRate:o}=t;super(Object.assign(Object.assign({},t),{units:e})),this.filters=e,EC(this.filters,"filters"),this.kernelSize=i$(n,2,"kernelSize"),this.kernelSize.forEach((t=>EC(t,"kernelSize"))),this.strides=i$(r||1,2,"strides"),this.strides.forEach((t=>EC(t,"strides"))),this.padding=i||"valid",VC(this.padding),this.dataFormat=s||"channelsLast",UC(this.dataFormat),this.dilationRate=i$(o||1,2,"dilationRate"),this.dilationRate.forEach((t=>EC(t,"dilationRate")))}build(t){var e;t=WN(t);const n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new uC(`The channel dimension of the input should be defined. Found ${t[n]}`);const r=t[n],i=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const s=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",s,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let t;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;t=new((e=class extends xN{apply(t,e){return aN([n.apply([r]),yw([r]),n.apply([2*r])])}}).className="CustomInit",e)}else t=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,t,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return Gb((()=>{if(3!==t.length)throw new uC(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const n=e.training||!1,r=t[0],i=t[1],s=t[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=D$({ones:()=>Sw(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=(t,e,n)=>e&&e[n]?Qb(e[n],t):t;let u=a(r,o,0),l=a(r,o,1),c=a(r,o,2),h=a(r,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=D$({ones:()=>Sw(i),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let p=a(i,d,0),f=a(i,d,1),g=a(i,d,2),m=a(i,d,3);const[y,b,v,x]=ck(this.kernel.read(),4,3),[w,k,I,S]=this.useBias?ck(this.bias.read(),4):[null,null,null,null];u=this.inputConv(u,y,w,this.padding),l=this.inputConv(l,b,k,this.padding),c=this.inputConv(c,v,I,this.padding),h=this.inputConv(h,x,S,this.padding);const[T,C,N,E]=ck(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,T),f=this.recurrentConv(f,C),g=this.recurrentConv(g,N),m=this.recurrentConv(m,E);const R=this.recurrentActivation.apply(Kb(u,p)),$=this.recurrentActivation.apply(Kb(l,f)),_=Kb(Qb($,s),Qb(R,this.activation.apply(Kb(c,g)))),A=Qb(this.recurrentActivation.apply(Kb(h,m)),this.activation.apply(_));return[A,A,_]}))}getConfig(){const t=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(super.getConfig(),["units"]),e={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),e)}inputConv(t,e,n,r){const i=qv(t,e,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?gN(i,n,this.dataFormat):i}recurrentConv(t,e){return qv(t,e,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}O$.className="ConvLSTM2DCell",dI(O$);class L$ extends F${constructor(t){const e=new O$(t);super(Object.assign(Object.assign({},t),{cell:e}))}static fromConfig(t,e){return new t(e)}}L$.className="ConvLSTM2D",dI(L$);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class P$ extends ZN{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(null==this.noiseShape)return this.noiseShape;const e=t.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?e[r]:this.noiseShape[r]);return n}call(t,e){return Gb((()=>{this.invokeCallHook(t,e);const n=VN(t);if(0<this.rate&&this.rate<1){const t=null!=e.training&&e.training,r=this.getNoiseShape(n);return yN((()=>mN(n,this.rate,r,this.seed)),(()=>n),t)}return t}))}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}P$.className="Dropout",dI(P$);class M$ extends P${constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}M$.className="SpatialDropout1D",dI(M$);class z$ extends ZN{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){let e=null;null!=t.batchSize&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,EC(this.units,"units"),this.activation=jR(t.activation),null!=t.useBias&&(this.useBias=t.useBias),this.kernelInitializer=zN(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=zN(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=bE(t.kernelConstraint),this.biasConstraint=bE(t.biasConstraint),this.kernelRegularizer=QR(t.kernelRegularizer),this.biasRegularizer=QR(t.biasRegularizer),this.activityRegularizer=QR(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){const e=(t=WN(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){const e=(t=WN(t)).slice();return e[e.length-1]=this.units,e}call(t,e){return Gb((()=>{this.invokeCallHook(t,e);const n=VN(t),r=$C(this.activation.getClassName());let i;return null!=r?i=hN(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=hN(n,this.kernel.read()),null!=this.bias&&(i=gN(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i}))}getConfig(){const t={units:this.units,activation:WR(this.activation),useBias:this.useBias,kernelInitializer:MN(this.kernelInitializer),biasInitializer:MN(this.biasInitializer),kernelRegularizer:XR(this.kernelRegularizer),biasRegularizer:XR(this.biasRegularizer),activityRegularizer:XR(this.activityRegularizer),kernelConstraint:mE(this.kernelConstraint),biasConstraint:mE(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}z$.className="Dense",dI(z$);class B$ extends ZN{constructor(t){super(t=t||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=WN(t);for(const e of t.slice(1))if(null==e)throw new uC(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],YC(t,1)]}call(t,e){return Gb((()=>{this.invokeCallHook(t,e);let n=VN(t);if("channelsFirst"===this.dataFormat&&n.rank>1){const t=[0];for(let e=2;e<n.rank;++e)t.push(e);t.push(1),n=Ek(n,t)}return function(t){if(t.rank<=1)throw new uC(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],YC(t.shape,1)];return Tv(t,e)}(n)}))}getConfig(){const t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}B$.className="Flatten",dI(B$);class U$ extends ZN{constructor(t){super(t),this.supportsMasking=!0,this.activation=jR(t.activation)}call(t,e){return Gb((()=>{this.invokeCallHook(t,e);const n=VN(t);return this.activation.apply(n)}))}getConfig(){const t={activation:WR(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}U$.className="Activation",dI(U$);class V$ extends ZN{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return Gb((()=>{return t=VN(t),e=t,n=this.n,Gb((()=>{if(2!==e.shape.length)throw new uC(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);return lN(rN(e,1),[1,n,1])}));var e,n}))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}V$.className="RepeatVector",dI(V$);class W$ extends ZN{constructor(t){super(t),this.targetShape=t.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(t){return t<0||null==t}fixUnknownDimension(t,e){const n="Total size of new array must be unchanged.",r=e.slice();let i=1,s=null;for(let a=0;a<r.length;++a){const t=r[a];if(this.isUnknown(t)){if(null!==s)throw new uC("Can only specifiy one unknown dimension.");s=a}else i*=t}const o=YC(t);if(null!==s){if(0===i||o%i!=0)throw new uC(n);r[s]=o/i}else if(o!==i)throw new uC(n);return r}computeOutputShape(t){let e=!1;for(let n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return Gb((()=>{this.invokeCallHook(t,e);const n=VN(t),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return Tv(n,i)}))}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}W$.className="Reshape",dI(W$);class G$ extends ZN{constructor(t){if(super(t),null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=ZC(1,t.dims.length+1);if(!Eg(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new KN({ndim:this.dims.length+1})]}computeOutputShape(t){const e=(t=WN(t)).slice();return this.dims.forEach(((n,r)=>{e[r+1]=t[n]})),e}call(t,e){return Ek(VN(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}G$.className="Permute",dI(G$);class j$ extends ZN{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,this.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const n=VN(t);return nv(kw(n,this.maskValue),-1)}call(t,e){return Gb((()=>{this.invokeCallHook(t,e);const n=VN(t),r=nv(kw(n,this.maskValue),-1,!0);return Qb(n,Bb(r,n.dtype))}))}}j$.className="Masking",dI(j$);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class H$ extends ZN{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){let e=null;null!=t.batchSize&&(e=t.batchSize),null==t.inputLength?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(mC(t.inputLength))}this.inputDim=t.inputDim,EC(this.inputDim,"inputDim"),this.outputDim=t.outputDim,EC(this.outputDim,"outputDim"),this.embeddingsInitializer=zN(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=QR(t.embeddingsRegularizer),this.activityRegularizer=QR(t.activityRegularizer),this.embeddingsConstraint=bE(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return Gb((()=>this.maskZero?(t=VN(t),kw(t,px(t))):null))}computeOutputShape(t){if(t=WN(t),null==this.inputLength)return[...t,this.outputDim];const e=mC(this.inputLength);if(e.length!==t.length-1)throw new uC(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let n=0;for(let r=0;r<e.length;++r){const i=e[r],s=t[r+1];if(null!=i&&null!=s&&i!==s)throw new uC(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);null==i&&(e[n]=s),n++}}return[t[0],...e,this.outputDim]}call(t,e){return Gb((()=>{this.invokeCallHook(t,e);let n=VN(t);"int32"!==n.dtype&&(n=nN(n,"int32"));const r=dN(this.embeddings.read(),Tv(n,[n.size]));return Tv(r,WN(this.computeOutputShape(n.shape)))}))}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:MN(this.embeddingsInitializer),embeddingsRegularizer:XR(this.embeddingsRegularizer),activityRegularizer:XR(this.activityRegularizer),embeddingsConstraint:mE(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}H$.className="Embedding",dI(H$);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class q$ extends ZN{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new lC}computeElementwiseOpOutputShape(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;const n=t.slice(0,t.length-e.length);for(let r=0;r<e.length;++r){const i=t[t.length-e.length+r],s=e[r];if(null==i||null==s||i<0||s<0)n.push(null);else if(1===i)n.push(s);else if(1===s)n.push(i);else{if(i!==s)throw new uC("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(i)}}return n}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[WN(t)]),(t=t).length<2)throw new uC(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const i of t)null!=i&&null!==i[0]&&e.push(i[0]);if(e=SC(e),e.length>1)throw new uC(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let n=null==t[0]?null:t[0].slice(1);for(let i=1;i<t.length;++i){const e=null==t[i]?null:t[i].slice(1);n=this.computeElementwiseOpOutputShape(n,e)}const r=t.map((t=>t.length));-1===t.indexOf(null)&&1===SC(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return Gb((()=>{if(t=t,this.reshapeRequired){const e=[],n=t.map((t=>t.rank));if(-1===n.indexOf(null)){const r=JC(n);for(let n of t){const t=n.rank;for(let e=0;e<r-t;++e)n=rN(n,1);e.push(n)}return this.mergeFunction(e)}{let n=!1;for(const s of t){const t=s.rank;if(null==t){const t=s.shape,r=t[0],i=t.slice(1).concat([r]);let o=Tv(s,[r].concat(YC(t.slice(1))));o=Ek(o,[1,0]),o=Tv(o,i),e.push(o),n=!0}else if(t>1){const r=ZC(1,t).concat([0]);e.push(Ek(s,r)),n=!0}else e.push(s)}let r=this.mergeFunction(e);const i=r.rank;if(n)if(null==i){const t=r.shape,e=t[t.length-1],n=[e].concat(t.slice(0,t.length-1));r=Tv(Ek(Tv(r,[-1,e]),[1,0]),n)}else if(i>1){const t=[i-1].concat(ZC(0,i-1));r=Ek(r,t)}return r}}return this.mergeFunction(t)}))}computeOutputShape(t){let e;e=null==(t=t)[0]?null:t[0].slice(1);for(let r=1;r<t.length;++r){const n=null==t[r]?null:t[r].slice(1);e=this.computeElementwiseOpOutputShape(e,n)}let n=[];for(const r of t)null!=r&&null!==r[0]&&n.push(r[0]);return n=SC(n),e=1===n.length?n.concat(e):[null].concat(e),e}computeMask(t,e){return Gb((()=>{if(null==e)return null;if(!Array.isArray(e))throw new uC("`mask` should be an Array");if(!Array.isArray(t))throw new uC("`inputs` should be an Array");if(e.length!==t.length)throw new uC(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every((t=>null==t)))return null;let n=(e=e.map((t=>null==t?t:Px(t,0))))[0];for(let t=1;t<e.length-1;++t)n=uw(n,e[t]);return n}))}}class K$ extends q${constructor(t){super(t)}mergeFunction(t){return Gb((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Kb(e,t[n]);return e}))}}K$.className="Add",dI(K$);class X$ extends q${constructor(t){super(t)}mergeFunction(t){return Gb((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Qb(e,t[n]);return e}))}}X$.className="Multiply",dI(X$);class Y$ extends q${constructor(t){super(t)}mergeFunction(t){return Gb((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Kb(e,t[n]);return Qb(1/t.length,e)}))}}Y$.className="Average",dI(Y$);class Q$ extends q${constructor(t){super(t)}mergeFunction(t){return Gb((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=fw(e,t[n]);return e}))}}Q$.className="Maximum",dI(Q$);class J$ extends q${constructor(t){super(t)}mergeFunction(t){return Gb((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=bw(e,t[n]);return e}))}}J$.className="Minimum",dI(J$);class Z$ extends q${constructor(t){super(t),this.DEFAULT_AXIS=-1,null==t&&(t={}),this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new uC("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const r of t)if(null!=r){e=!1;break}if(e)return;const n=[];for(let r=0;r<t.length;++r){const e=t[r].slice();e.splice(this.axis,1);let i=!1;for(const t of n)if(Eg(t,e)){i=!0;break}i||n.push(e)}if(n.length>1)throw new uC("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return Gb((()=>aN(t,this.axis)))}computeOutputShape(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new uC("A `Concatenate` layer should be called on a list of inputs.");const e=t,n=e[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const i of e.slice(1)){if(null==n[r]||null==i[r]){n[r]=null;break}n[r]+=i[r]}return n}computeMask(t,e){if(null==e)return null;if(!Array.isArray(e))throw new uC("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new uC("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new uC(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return Gb((()=>{let n=!0;if(e.forEach((t=>{null==t||(n=!1)})),n)return null;const r=[];for(let s=0;s<t.length;++s)null==e[s]?r.push(Bb(Sw(t[s]),"bool")):e[s].rank<t[s].rank?r.push(Px(e[s],-1)):r.push(e[s]);const i=Ev(r,this.axis);return ev(i,-1,!1)}))}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function t_(t,e){for(;t<0;)t+=e;return t}Z$.className="Concatenate",dI(Z$);class e_ extends q${constructor(t){super(t),this.axes=t.axes,this.normalize=null!=t.normalize&&t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){Sg(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0],n=t[1];if(e.length>3||n.length>3)throw new lC("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);if(e[r[0]]!==n[r[1]])throw new uC(`Dimension incompatibility: ${e[r[0]]} !== ${n[r[1]]}`)}mergeFunction(t){if(2!==t.length)throw new uC(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e,n=t[0],r=t[1];return e=Array.isArray(this.axes)?this.axes.map(((e,n)=>t_(e,t[n].shape.length))):[t_(this.axes,n.shape.length),t_(this.axes,r.shape.length)],this.normalize&&(n=AE(n,e[0]),r=AE(r,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new lC("batchDot is not implemented for tensors of 4D or higher rank yet");if(Sg(t.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`)),Sg(t.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`)),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new lC("batchDot is not implemented for complex64-type Tensors yet.");const r=t.shape.length,i=e.shape.length;null==n&&(n=[r-1,i-2]);const s=n;return Gb((()=>{let n,o;if(r>i){n=r-i;const t=[];for(let e=0;e<n;++e)t.push(1);e=Tv(e,e.shape.concat(t))}else if(i>r){n=i-r;const e=[];for(let t=0;t<n;++t)e.push(1);t=Tv(t,t.shape.concat(e))}else n=0;if(2===t.shape.length&&2===e.shape.length)o=s[0]===s[1]?Ax(Qb(t,e),s[0]):Ax(Qb(Ek(t,[1,0]),e),s[1]);else{const n=s[0]!==t.shape.length-1,r=s[1]===e.shape.length-1;o=Rv(t,e,n,r)}if(n>0){let t;t=r>i?r+i-3:r-1;const e=[];for(let r=t;r<t+n;++r)e.push(r);o=pk(o,e)}return 1===o.shape.length&&(o=Px(o,1)),o}))}(n,r,e)}interpretAxes(t,e){let n;return n=Array.isArray(this.axes)?this.axes:[t_(this.axes,t.length),t_(this.axes,e.length)],n}computeOutputShape(t){Sg(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new lC("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);e.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const i=e.concat(n);return 1===i.length&&i.push(1),i}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}e_.className="Dot",dI(e_);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class n_ extends ZN{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return Gb((()=>{this.invokeCallHook(t,e);const n=VN(t);return yN((()=>Kb(cN(n.shape,0,this.stddev),n)),(()=>n),e.training||!1)}))}}n_.className="GaussianNoise",dI(n_);class r_ extends ZN{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return Gb((()=>{this.invokeCallHook(t,e);const n=VN(t);if(this.rate>0&&this.rate<1){return yN((()=>{const t=Math.sqrt(this.rate/(1-this.rate));return Qb(n,cN(n.shape,1,t))}),(()=>n),e.training||!1)}return n}))}}r_.className="GaussianDropout",dI(r_);class i_ extends ZN{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||VN(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return Gb((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(t);return yN((()=>{const e=VN(t),r=-1.7580993408473766;let i=Gx(Vw(n),this.rate);i=nN(i,"float32");const s=((1-this.rate)*(1+this.rate*r**2))**-.5,o=-s*r*this.rate,a=Kb(Qb(e,i),Qb(Kb(i,-1),r));return Kb(Qb(a,s),o)}),(()=>VN(t)),e.training||!1)}return t}))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function s_(t,e,n,r,i,s=.001){let o;if(2===t.rank)o=Ov(t,e,n,r,i,s);else if(3===t.rank)o=Lv(t,e,n,r,i,s);else{if(4!==t.rank)throw new lC(`batchNormalization is not implemented for array of rank ${t.rank} yet`);o=Pv(t,e,n,r,i,s)}return o}function o_(t,e,n,r,i=.001){return Eg(r.slice().sort(),ZC(0,t.rank-1))?function(t,e,n,r,i=.001){return Gb((()=>{const s=ww(t,r),o=s.mean,a=s.variance;return[s_(t,o,a,n,e,i),o,a]}))}(t,e,n,r,i):function(t,e,n,r,i=.001){return Gb((()=>{const s=ww(t,r),o=s.mean,a=s.variance,u=[];for(const e of ZC(0,t.rank))-1!==r.indexOf(e)?u.push(1):u.push(t.shape[e]);const l=Tv(o,u),c=Tv(a,u),h=null==e?null:Tv(e,u),d=null==n?null:Tv(n,u);return[s_(t,l,c,d,h,i),o,a]}))}(t,e,n,r,i)}i_.className="AlphaDropout",dI(i_);class a_ extends ZN{constructor(t){null==t&&(t={}),super(t),this.supportsMasking=!0,this.axis=null==t.axis?-1:t.axis,this.momentum=null==t.momentum?.99:t.momentum,this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=zN(t.betaInitializer||"zeros"),this.gammaInitializer=zN(t.gammaInitializer||"ones"),this.movingMeanInitializer=zN(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=zN(t.movingVarianceInitializer||"ones"),this.betaConstraint=bE(t.betaConstraint),this.gammaConstraint=bE(t.gammaConstraint),this.betaRegularizer=QR(t.betaRegularizer),this.gammaRegularizer=QR(t.gammaRegularizer)}build(t){t=WN(t);const e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new uC(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new KN({ndim:t.length,axes:{[e]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return Gb((()=>{const n=null!=e.training&&e.training,r=VN(t),i=r.shape,s=i.length,o=ZC(0,s),a=this.axis>=0?this.axis:this.axis+s;o.splice(a,1);const u=dC(1,s);u[a]=i[a];const l=o.slice();l.sort();const c=!Eg(l,ZC(0,s).slice(0,s-1));if(!n)return(()=>{if(c){const t=Tv(this.movingMean.read(),u),e=Tv(this.movingVariance.read(),u),n=this.center?Tv(this.beta.read(),u):null,i=this.scale?Tv(this.gamma.read(),u):null;return s_(r,t,e,n,i,this.epsilon)}return s_(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,d,p]=o_(r,this.gamma.read(),this.beta.read(),o,this.epsilon),f=(t,e,n)=>{Gb((()=>{const r=1-n,i=t.read(),s=Qb(sw(i,e),r);t.write(sw(i,s))}))};return(()=>{f(this.movingMean,d,this.momentum),f(this.movingVariance,p,this.momentum)})(),h}))}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:MN(this.betaInitializer),gammaInitializer:MN(this.gammaInitializer),movingMeanInitializer:MN(this.movingMeanInitializer),movingVarianceInitializer:MN(this.movingVarianceInitializer),betaRegularizer:XR(this.betaRegularizer),gammaRegularizer:XR(this.gammaRegularizer),betaConstraint:mE(this.betaConstraint),gammaConstraint:mE(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}a_.className="BatchNormalization",dI(a_);class u_ extends ZN{constructor(t){if(null==t&&(t={}),super(t),this.axis=null==t.axis?-1:t.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=zN(t.betaInitializer||"zeros"),this.gammaInitializer=zN(t.gammaInitializer||"ones"),this.betaRegularizer=QR(t.betaRegularizer),this.gammaRegularizer=QR(t.gammaRegularizer),this.supportsMasking=!0}build(t){const e=(t=WN(t)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=e);for(const r of this.axis)if(r<0||r>=e)throw new Error(`Invalid axis: ${r}`);if(this.axis.length!==SC(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((e=>t[e]));this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}call(t,e){const n=VN(t),r=n.shape,i=r.length;return Gb((()=>{let{mean:t,variance:e}=ww(n,this.axis,!0);const s=dC(1,i);for(const n of this.axis)s[n]=r[n];const o=t=>null!=t&&t.shape.length!==i?Tv(t,s):t;let a=this.scale?o(this.gamma.read()):null,u=this.center?o(this.beta.read()):null;const l=[],c=[];for(let n=0;n<i;++n)-1!==this.axis.indexOf(n)?(l.push(r[n]),c.push(1)):(l.push(1),c.push(r[n]));return t=zx(t,l),e=zx(e,l),null!=a&&(a=zx(a,c)),null!=u&&(u=zx(u,c)),s_(n,t,e,u,a,this.epsilon)}))}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:MN(this.betaInitializer),gammaInitializer:MN(this.gammaInitializer),betaRegularizer:XR(this.betaRegularizer),gammaRegularizer:XR(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}u_.className="LayerNormalization",dI(u_);class l_ extends ZN{constructor(t){if(null==t&&(t={}),super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new uC(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,n;if("number"==typeof t.padding[0])e=[t.padding[0],t.padding[0]],n=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new uC(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],2!==t.padding[1].length)throw new uC(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);n=t.padding[1]}this.padding=[e,n]}this.inputSpec=[new KN({ndim:4})]}computeOutputShape(t){let e,n;return t=WN(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])}call(t,e){return Gb((()=>{return e=VN(t),n=this.padding,r=this.dataFormat,Gb((()=>{if(4!==e.rank)throw new uC(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new uC("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r="channelsLast"),"channelsLast"!==r&&"channelsFirst"!==r)throw new uC(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let t;return t="channelsFirst"===r?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],Tw(e,t)}));
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var e,n,r}))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function c_(t,e,n,r,i,s){return Gb((()=>{let o;UC(i),WC(s),VC(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=a$(t,i);const a="same"===r?"same":"valid";return o="max"===s?dw(t,e,n,a):Cv(t,e,n,a),"channelsFirst"===i&&(o=Ek(o,[0,3,1,2])),o}))}function h_(t,e,n,r,i,s){return Gb((()=>{let o;UC(i),WC(s),VC(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=u$(t,i);const a="same"===r?"same":"valid";return o="max"===s?pw(t,e,n,a):Nv(t,e,n,a),"channelsFirst"===i&&(o=Ek(o,[0,4,1,2,3])),o}))}l_.className="ZeroPadding2D",dI(l_);class d_ extends ZN{constructor(t){if(null==t.poolSize&&(t.poolSize=2),super(t),"number"==typeof t.poolSize)this.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new uC(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);this.poolSize=t.poolSize}if(EC(this.poolSize,"poolSize"),null==t.strides)this.strides=this.poolSize;else if("number"==typeof t.strides)this.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new uC(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);this.strides=t.strides}EC(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,VC(this.padding),this.inputSpec=[new KN({ndim:3})]}computeOutputShape(t){const e=s$((t=WN(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return Gb((()=>{this.invokeCallHook(t,e),t=rN(VN(t),2);const n=this.poolingFunction(VN(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return pk(n,[2])}))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class p_ extends d_{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return UC(i),VC(r),c_(t,e,n,r,i,"max")}}p_.className="MaxPooling1D",dI(p_);class f_ extends d_{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return UC(i),VC(r),c_(t,e,n,r,i,"avg")}}f_.className="AveragePooling1D",dI(f_);class g_ extends ZN{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new uC(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];EC(this.poolSize,"poolSize"),EC(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,UC(this.dataFormat),VC(this.padding),this.inputSpec=[new KN({ndim:4})]}computeOutputShape(t){t=WN(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=s$(e,this.poolSize[0],this.padding,this.strides[0]),n=s$(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]}call(t,e){return Gb((()=>(this.invokeCallHook(t,e),this.poolingFunction(VN(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class m_ extends g_{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return UC(i),VC(r),c_(t,e,n,r,i,"max")}}m_.className="MaxPooling2D",dI(m_);class y_ extends g_{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return UC(i),VC(r),c_(t,e,n,r,i,"avg")}}y_.className="AveragePooling2D",dI(y_);class b_ extends ZN{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new uC(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];EC(this.poolSize,"poolSize"),EC(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,UC(this.dataFormat),VC(this.padding),this.inputSpec=[new KN({ndim:5})]}computeOutputShape(t){t=WN(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[4]:t[3];return e=s$(e,this.poolSize[0],this.padding,this.strides[0]),n=s$(n,this.poolSize[1],this.padding,this.strides[1]),r=s$(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n,r]:[t[0],e,n,r,t[4]]}call(t,e){return Gb((()=>(this.invokeCallHook(t,e),this.poolingFunction(VN(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class v_ extends b_{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return UC(i),VC(r),h_(t,e,n,r,i,"max")}}v_.className="MaxPooling3D",dI(v_);class x_ extends b_{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return UC(i),VC(r),h_(t,e,n,r,i,"avg")}}x_.className="AveragePooling3D",dI(x_);class w_ extends ZN{constructor(t){super(t),this.inputSpec=[new KN({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new lC}}class k_ extends w_{constructor(t){super(t||{})}call(t,e){return Gb((()=>{const e=VN(t);return gw(e,1)}))}}k_.className="GlobalAveragePooling1D",dI(k_);class I_ extends w_{constructor(t){super(t||{})}call(t,e){return Gb((()=>{const e=VN(t);return Cx(e,1)}))}}I_.className="GlobalMaxPooling1D",dI(I_);class S_ extends ZN{constructor(t){super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,UC(this.dataFormat),this.inputSpec=[new KN({ndim:4})]}computeOutputShape(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new lC}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class T_ extends S_{call(t,e){return Gb((()=>{const e=VN(t);return"channelsLast"===this.dataFormat?gw(e,[1,2]):gw(e,[2,3])}))}}T_.className="GlobalAveragePooling2D",dI(T_);class C_ extends S_{call(t,e){return Gb((()=>{const e=VN(t);return"channelsLast"===this.dataFormat?Cx(e,[1,2]):Cx(e,[2,3])}))}}C_.className="GlobalMaxPooling2D",dI(C_);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class N_ extends ZN{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(t){null!=this.layer&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,n={}){const r=_E(e.layer,n);delete e.layer;const i={layer:r};return Object.assign(i,e),new t(i)}}class E_ extends N_{constructor(t){super(t),this.supportsMasking=!0}build(t){if((t=WN(t)).length<3)throw new uC(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){const e=[(t=WN(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),r=t[1];return[n[0],r].concat(n.slice(1))}call(t,e){return Gb((()=>I$(((t,n)=>[VN(this.layer.call(t,e)),[]]),t=VN(t),[],!1,null,null,!1,!0)[1]))}}E_.className="TimeDistributed",dI(E_);class R_ extends N_{constructor(t){super(t);const e=t.layer.getConfig(),n={};n.className=t.layer.getClassName(),n.config=e,this.forwardLayer=_E(n),e.goBackwards=!0!==e.goBackwards;const r={};var i;if(r.className=t.layer.getClassName(),r.config=e,this.backwardLayer=_E(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===t.mergeMode?"concat":t.mergeMode,i=this.mergeMode,CC(zC,"BidirectionalMergeMode",i),t.weights)throw new lC("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))}computeOutputShape(t){let e,n,r,i=this.forwardLayer.computeOutputShape(t);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),e=i[0]):e=i[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[e].concat(r).concat(r.slice()):gC(n)}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=k$(t,n,r,this.numConstants);if(t=i.inputs,n=i.initialState,r=i.constants,Array.isArray(t)&&(n=t.slice(1),t=t[0]),(null==n||0===n.length)&&null==r)return super.apply(t,e);const s=[],o=[];if(null!=n){const t=n.length;if(t%2>0)throw new uC("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=n,s.push(...n);const r=n.map((t=>new KN({shape:t.shape})));this.forwardLayer.stateSpec=r.slice(0,t/2),this.backwardLayer.stateSpec=r.slice(t/2),o.push(...r)}if(null!=r)throw new lC("Support for constants in Bidirectional layers is not implemented yet.");const a=s[0]instanceof XN;for(const u of s)if(u instanceof XN!==a)throw new uC("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(a){const n=[t].concat(s),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return Gb((()=>{const n=e.initialState;let r,i,s,o;if(null==n)r=this.forwardLayer.call(t,e),i=this.backwardLayer.call(t,e);else{const s=n.slice(0,n.length/2),o=n.slice(n.length/2);r=this.forwardLayer.call(t,Object.assign(e,{initialState:s})),i=this.backwardLayer.call(t,Object.assign(e,{initialState:o}))}return this.returnState&&(Array.isArray(r)&&(s=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Kw(i,1)),"concat"===this.mergeMode?o=aN([r,i]):"sum"===this.mergeMode?o=Kb(r,i):"ave"===this.mergeMode?o=Qb(.5,Kb(r,i)):"mul"===this.mergeMode?o=Qb(r,i):null==this.mergeMode&&(o=[r,i]),this.returnState?null==this.mergeMode?o.concat(s):[o].concat(s):o}))}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){jC(this.forwardLayer.name,(()=>{this.forwardLayer.build(t)})),jC(this.backwardLayer.name,(()=>{this.backwardLayer.build(t)})),this.built=!0}computeMask(t,e){let n;if(Array.isArray(e)&&(e=e[0]),n=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){const t=this.forwardLayer.states.map((t=>null));return Array.isArray(n)?n.concat(t).concat(t):[n].concat(t).concat(t)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const n=_E(e.layer);if(delete e.layer,null!=e.numConstants)throw new lC("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=e;return r.layer=n,new t(r)}}R_.className="Bidirectional",dI(R_);
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class $_ extends ZN{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return Gb((()=>("float32"!==(t=VN(t)).dtype&&(t=nN(t,"float32")),Kb(Qb(t,this.scale),this.offset))))}}$_.className="Rescaling",dI($_);
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
const{resizeBilinear:__,cropAndResize:A_}=uI;class D_ extends ZN{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,e,n,r,i,s,o,a){return Gb((()=>{let u,l=!1;const c=[e/s,n/o,(r+e)/s,(i+n)/o],h=[];3===t.rank?(l=!0,u=fk([t])):u=t;for(let t=0;t<u.shape[0];t++)h.push(c);const d=sb(h,[h.length,4]),p=Ww(0,h.length,1,"int32"),f=A_(u,d,p,[r,i],"nearest");return nN(l?VN(Ck(f)):f,a)}))}upsize(t,e,n,r){return Gb((()=>nN(__(t,[e,n]),r)))}call(t,e){return Gb((()=>{const e=VN(t),n=e.dtype,r=e.shape,i=r[r.length-3],s=r[r.length-2];let o=0;i!==this.height&&(o=Math.floor((i-this.height)/2));let a=0;return s!==this.width&&(a=Math.floor((s-this.width)/2),0===a&&(a=1)),o>=0&&a>=0?this.centerCrop(e,o,a,this.height,this.width,i,s,n):this.upsize(t,this.height,this.width,n)}))}getConfig(){const t={height:this.height,width:this.width},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){const e=(t=WN(t)).length-3,n=t.length-2;return t[e]=this.height,t[n]=this.width,t}}D_.className="CenterCrop",dI(D_);
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class F_ extends ZN{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){return null==(t=WN(t))?[this.numTokens]:"oneHot"===this.outputMode&&1!==t[t.length-1]?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,e){return Gb((()=>{let n;if("int32"!==(t=VN(t)).dtype&&(t=nN(t,"int32")),void 0!==e.countWeights){if("count"!==this.outputMode)throw new uC(`countWeights is not used when outputMode !== count.\n              Received countWeights=${e.countWeights}`);n=VN(e.countWeights)}const r=Cx(t),i=Nx(t),s=Wx(this.numTokens,r).bufferSync().get(0),o=Gx(i,0).bufferSync().get(0);if(!s||!o)throw new uC(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
return function(t,e,n,r){let i=VN(t);if("int32"!==i.dtype&&(i=nN(i,"int32")),"int"===e)return i;const s=i.shape;if(0===i.rank&&(i=Px(i,-1)),"oneHot"===e&&1!==i.shape[i.shape.length-1]&&(i=Px(i,-1)),i.rank>2)throw new uC(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${s} which would result in output rank ${i.rank}.`);const o=["multiHot","oneHot"].includes(e);let a;if(a=ix(i,void 0!==r&&"count"===e?r:[],n,o),"tfIdf"!==e)return a;if(r)return Qb(a,r);throw new uC("When outputMode is 'tfIdf', weights must be provided.")}(t,this.outputMode,this.numTokens,n)}))}}F_.className="CategoryEncoding",dI(F_);
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
const O_=new Set(["bilinear","nearest"]);class L_ extends ZN{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation){if(!O_.has(t.interpolation))throw new uC(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);this.interpolation=t.interpolation}else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(t.cropToAspectRatio)}computeOutputShape(t){const e=(t=WN(t))[2];return[this.height,this.width,e]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return Gb((()=>{const e=[this.height,this.width];if("bilinear"===this.interpolation)return uI.resizeBilinear(t,e,!this.cropToAspectRatio);if("nearest"===this.interpolation)return uI.resizeNearestNeighbor(t,e,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...O_]} are supported`)}))}}L_.className="Resizing",dI(L_);
/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class P_{constructor(t){this.seed=t}next(){if(void 0!==this.seed)return this.seed++}}P_.className="RandomSeed";
/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class M_ extends ZN{constructor(t){super(t),this.randomGenerator=new P_(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},e=super.getConfig();return Object.assign(t,e),t}}M_.className="BaseRandomLayer";
/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
const z_=new Set(["bilinear","nearest"]);class B_ extends M_{constructor(t){super(t);const{factor:e,interpolation:n="bilinear"}=t;if(this.factor=e,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else{if(Array.isArray(this.factor)||!(this.factor>0))throw new uC(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);this.widthLower=-this.factor,this.widthUpper=this.factor}if(this.widthLower<-1||this.widthUpper<-1)throw new uC(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new uC(`factor cannot have upper bound less than lower bound.\n        Got upper bound: ${this.widthUpper}.\n        Got lower bound: ${this.widthLower}\n      `);if(n){if(!z_.has(n))throw new uC(`Invalid interpolation parameter: ${n} is not implemented`);this.interpolation=n}}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){const e=(t=WN(t))[2];return[this.imgHeight,-1,e]}call(t,e){return Gb((()=>{const e=VN(t);this.imgHeight=e.shape[e.shape.length-3];const n=e.shape[e.shape.length-2];this.widthFactor=Vw([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*n;r=Math.round(r);const i=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return uI.resizeBilinear(t,i);case"nearest":return uI.resizeNearestNeighbor(t,i);default:throw new Error(`Interpolation is ${this.interpolation}\n          but only ${[...z_]} are supported`)}}))}}B_.className="RandomWidth",dI(B_);
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var U_,V_,W_,G_,j_,H_,q_;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function K_(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&Sg("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the CPU backend.`))}))}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */rm().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),(V_=U_||(U_={}))[V_.DT_INVALID=0]="DT_INVALID",V_[V_.DT_FLOAT=1]="DT_FLOAT",V_[V_.DT_DOUBLE=2]="DT_DOUBLE",V_[V_.DT_INT32=3]="DT_INT32",V_[V_.DT_UINT8=4]="DT_UINT8",V_[V_.DT_INT16=5]="DT_INT16",V_[V_.DT_INT8=6]="DT_INT8",V_[V_.DT_STRING=7]="DT_STRING",V_[V_.DT_COMPLEX64=8]="DT_COMPLEX64",V_[V_.DT_INT64=9]="DT_INT64",V_[V_.DT_BOOL=10]="DT_BOOL",V_[V_.DT_QINT8=11]="DT_QINT8",V_[V_.DT_QUINT8=12]="DT_QUINT8",V_[V_.DT_QINT32=13]="DT_QINT32",V_[V_.DT_BFLOAT16=14]="DT_BFLOAT16",V_[V_.DT_QINT16=15]="DT_QINT16",V_[V_.DT_QUINT16=16]="DT_QUINT16",V_[V_.DT_UINT16=17]="DT_UINT16",V_[V_.DT_COMPLEX128=18]="DT_COMPLEX128",V_[V_.DT_HALF=19]="DT_HALF",V_[V_.DT_RESOURCE=20]="DT_RESOURCE",V_[V_.DT_VARIANT=21]="DT_VARIANT",V_[V_.DT_UINT32=22]="DT_UINT32",V_[V_.DT_UINT64=23]="DT_UINT64",V_[V_.DT_FLOAT_REF=101]="DT_FLOAT_REF",V_[V_.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",V_[V_.DT_INT32_REF=103]="DT_INT32_REF",V_[V_.DT_UINT8_REF=104]="DT_UINT8_REF",V_[V_.DT_INT16_REF=105]="DT_INT16_REF",V_[V_.DT_INT8_REF=106]="DT_INT8_REF",V_[V_.DT_STRING_REF=107]="DT_STRING_REF",V_[V_.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",V_[V_.DT_INT64_REF=109]="DT_INT64_REF",V_[V_.DT_BOOL_REF=110]="DT_BOOL_REF",V_[V_.DT_QINT8_REF=111]="DT_QINT8_REF",V_[V_.DT_QUINT8_REF=112]="DT_QUINT8_REF",V_[V_.DT_QINT32_REF=113]="DT_QINT32_REF",V_[V_.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",V_[V_.DT_QINT16_REF=115]="DT_QINT16_REF",V_[V_.DT_QUINT16_REF=116]="DT_QUINT16_REF",V_[V_.DT_UINT16_REF=117]="DT_UINT16_REF",V_[V_.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",V_[V_.DT_HALF_REF=119]="DT_HALF_REF",V_[V_.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",V_[V_.DT_VARIANT_REF=121]="DT_VARIANT_REF",V_[V_.DT_UINT32_REF=122]="DT_UINT32_REF",V_[V_.DT_UINT64_REF=123]="DT_UINT64_REF",G_=W_||(W_={}),(j_=G_.CheckpointFormatVersion||(G_.CheckpointFormatVersion={}))[j_.LEGACY=0]="LEGACY",j_[j_.V1=1]="V1",j_[j_.V2=2]="V2",(q_=H_||(H_={}))[q_.FAIL=0]="FAIL",q_[q_.SHORTEST=1]="SHORTEST",q_[q_.LONGEST=2]="LONGEST";const X_=Nk;class Y_ extends bg{nextDataId(){return Y_.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new yg(this,Vb())}write(t,e,n){this.firstUse&&(this.firstUse=!1,rm().get("IS_NODE")&&um("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:t,dtype:n,refCount:1}),r}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&Bg(n[0])){const i=n.map((t=>oy(t)));r=this.write(i,t,e)}else r=this.write(n,t,e);return{dataId:r,shape:t,dtype:e}}refCount(t){if(this.data.has(t)){return this.data.get(t).refCount}return 0}incRef(t){this.data.get(t).refCount++}decRef(t){if(this.data.has(t)){this.data.get(t).refCount--}}move(t,e,n,r,i){this.data.set(t,{values:e,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:n}=this.data.get(t);if("complex64"===e){return pS(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return function(t,e){if(Array.isArray(t))return t;if("float32"===e)return t instanceof Float32Array?t:new Float32Array(t);if("int32"===e)return t instanceof Int32Array?t:new Int32Array(t);if("bool"===e||"string"===e)return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}(this.data.get(t).values,e)}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>ay(t)));return zb(t.shape,t.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return zb(t.shape,t.dtype,e)}makeOutput(t,e,n){return Vb().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(t);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=sy();t();return{kernelMs:sy()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){K_([t],"where");const e=this.readSync(t.dataId);return X_(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Q_(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}Y_.nextDataId=0;const J_={kernelName:"Abs",backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend;K_(e,"abs");let r=new Float32Array(Ng(e.shape));return r=Q_(n.data.get(e.dataId).values),n.makeOutput(r,e.shape,e.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Z_(t){return(e,n,r,i,s)=>{const o=cx(e,n),a=o.length,u=jg(o),l=Lg(s,Ng(o)),c=e.length,h=n.length,d=jg(e),p=jg(n),f=ux(e,o),g=ux(n,o);if(f.length+g.length===0)for(let m=0;m<l.length;++m)l[m]=t(r[m%r.length],i[m%i.length]);else for(let m=0;m<l.length;++m){const e=Zg(m,a,u),n=e.slice(-c);f.forEach((t=>n[t]=0));const s=Jg(n,c,d),o=e.slice(-h);g.forEach((t=>o[t]=0));const y=Jg(o,h,p);l[m]=t(r[s],i[y])}return[l,o]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tA(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(r.shape,"complex64");return n.data.get(a.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const eA={kernelName:"Complex",backendName:"cpu",kernelFunc:tA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nA(t,e,n="float32"){if("complex64"===n){return tA({inputs:{real:nA(t,e,"float32"),imag:nA(t,e,"float32")},backend:t})}const r=Xg(Ng(e),n);return t.makeTensorInfo(e,n,r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rA(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const iA={kernelName:"Identity",backendName:"cpu",kernelFunc:rA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sA(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const oA={kernelName:"Real",backendName:"cpu",kernelFunc:sA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aA(t,e,n,r){if("int32"===r){return[e,"int32",Int32Array.from(t)]}if("bool"===r){const r=iy([0],n),[i,s]=Z_(((t,e)=>t!==e?1:0))(e,[],t,r,"bool");return[s,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function uA(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dtype:s}=r;if("complex64"===s){if("complex64"===i.dtype)return rA({inputs:{x:i},backend:n});const t=nA(n,i.shape,i.dtype),e=uA({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=tA({inputs:{real:e,imag:t},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),r}if("complex64"===i.dtype){const t=sA({inputs:{input:i},backend:n}),e=uA({inputs:{x:t},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(t),e}if(!Mg(i.dtype,s)){const t=rA({inputs:{x:i},backend:n});return{dataId:t.dataId,shape:t.shape,dtype:s}}const o=n.data.get(i.dataId).values,[a,u,l]=aA(o,i.shape,i.dtype,s);return n.makeTensorInfo(a,u,l)}const lA={kernelName:"Cast",backendName:"cpu",kernelFunc:uA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cA(t,e,n,r){return null==n?({inputs:n,backend:i})=>{const{a:s,b:o}=n,a=i;K_([s,o],t);const u=a.data.get(s.dataId).values,l=a.data.get(o.dataId).values,c="string"===s.dtype?jS(u):u,h="string"===s.dtype?jS(l):l,d=r||s.dtype,[p,f]=e(s.shape,o.shape,c,h,d);return a.makeTensorInfo(f,d,p)}:({inputs:t,backend:i})=>{const{a:s,b:o}=t,a=i;if("complex64"===s.dtype||"complex64"===o.dtype){const t=uA({inputs:{x:s},backend:a,attrs:{dtype:"complex64"}}),e=a.data.get(t.dataId),r=e.complexTensorInfos.real,i=e.complexTensorInfos.imag,u=a.data.get(r.dataId).values,l=a.data.get(i.dataId).values,c=uA({inputs:{x:o},backend:a,attrs:{dtype:"complex64"}}),h=a.data.get(c.dataId),d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,f=a.data.get(d.dataId).values,g=a.data.get(p.dataId).values,[m,y,b]=n(s.shape,o.shape,u,l,f,g),v=a.makeTensorInfo(b,"float32",m),x=a.makeTensorInfo(b,"float32",y),w=tA({inputs:{real:v,imag:x},backend:a});return a.disposeIntermediateTensorInfo(t),a.disposeIntermediateTensorInfo(c),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(x),w}{const t=a.data.get(s.dataId).values,n=a.data.get(o.dataId).values,i=r||s.dtype,[u,l]=e(s.shape,o.shape,t,n,i);return a.makeTensorInfo(l,i,u)}}}function hA(t){return(e,n,r,i,s,o)=>{const a=cx(e,n),u=Ng(a),l=a.length,c=jg(a),h=Lg("float32",u),d=Lg("float32",u),p=ux(e,a),f=ux(n,a),g=pS(r,i),m=pS(s,o),y=e.length,b=jg(e),v=n.length,x=jg(n);if(p.length+f.length===0)for(let w=0;w<h.length;w++){const e=w%g.length,n=w%m.length,r=t(g[2*e],g[2*e+1],m[2*n],m[2*n+1]);h[w]=r.real,d[w]=r.imag}else for(let w=0;w<h.length;w++){const e=Zg(w,l,c),n=e.slice(-y);p.forEach((t=>n[t]=0));const r=Jg(n,y,b),i=e.slice(-v);f.forEach((t=>i[t]=0));const s=Jg(i,v,x),o=t(g[2*r],g[2*r+1],m[2*s],m[2*s+1]);h[w]=o.real,d[w]=o.imag}return[h,d,a]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dA=Z_(((t,e)=>t+e)),pA=cA("Add",dA,hA(((t,e,n,r)=>({real:t+n,imag:e+r})))),fA={kernelName:"Add",backendName:"cpu",kernelFunc:pA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gA(t,e,n,r,i){const s=Ng(r),o=Xg(i,n);for(let a=0;a<t.length;a++){const n=t[a];if(n<0)throw new Error("Input x must be non-negative!");n>=i||(o[n]+=s>0?e[a]:1)}return o}function mA(t,e,n,r=!1){const i=t.shape[0],s=t.shape[1],o=zb([i,n],e.dtype);for(let a=0;a<i;a++)for(let i=0;i<s;i++){const s=t.get(a,i);if(s<0)throw new Error("Input x must be non-negative!");s>=n||(r?o.set(1,a,s):e.size>0?o.set(o.get(a,s)+e.get(a,i),a,s):o.set(o.get(a,s)+1,a,s))}return o}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yA(t){return(e,n,r)=>{const i=Pg(n,e.length);for(let s=0;s<e.length;++s)i[s]=t(e[s],r);return i}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bA(t,e,n){return vA(t,yA(e),n)}function vA(t,e,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;K_(o,t);const a=s,u=a.data.get(o.dataId).values;let l;if("string"===o.dtype){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");l=jS(u)}else l=u;const c=n||o.dtype,h=e(l,c,i);return a.makeTensorInfo(o.shape,c,h)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xA=yA((t=>Math.ceil(t))),wA={kernelName:"Ceil",backendName:"cpu",kernelFunc:vA("Ceil",xA)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kA(t,e,n,r){const i=Pg(n,Ng(e));if(r&&"string"!==n){let e=0;t.forEach((t=>{const n=Ng(t.shape);i.set(t.vals,e),e+=n}))}else{let r=0;t.forEach((t=>{const s="string"===n?jS(t.vals):t.vals;let o=0;for(let n=0;n<t.shape[0];++n){const a=n*e[1]+r;for(let e=0;e<t.shape[1];++e)i[a+e]=s[o++]}r+=t.shape[1]}))}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IA=Z_(((t,e)=>t===e?1:0)),SA=cA("Equal",IA,null,"bool"),TA={kernelName:"Equal",backendName:"cpu",kernelFunc:SA},CA=yA((t=>Math.exp(t))),NA=vA("Exp",CA,"float32"),EA={kernelName:"Exp",backendName:"cpu",kernelFunc:NA},RA=yA((t=>Math.expm1(t))),$A={kernelName:"Expm1",backendName:"cpu",kernelFunc:vA("Expm1",RA)},_A=yA((t=>Math.floor(t))),AA={kernelName:"Floor",backendName:"cpu",kernelFunc:vA("Floor",_A)},DA=Z_(((t,e)=>Math.floor(t/e))),FA={kernelName:"FloorDiv",backendName:"cpu",kernelFunc:cA("FloorDiv",DA,null,"int32")};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function OA(t,e,n,r,i,s,o,a,u){const l=zb([r,s],n);for(let c=0;c<r;c++){const n=[];let r=0;for(let e=0;e<i;e++){const s=t[c*i+e];r+=s*o[e],n.push(s)}if(r<0||r>=u/s)throw new Error(`Invalid indices: ${n} does not index into ${a}`);for(let t=0;t<s;t++)l.values[c*s+t]=e.get(...e.indexToLoc(r*s+t))}return l}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LA(t,e,n){const r=zb(n,t.dtype);for(let i=0;i<r.size;++i){const n=r.indexToLoc(i).slice(),s=n[0],o=n[2],a=e.locToIndex([s,o]);n[2]=e.values[a];const u=t.locToIndex(n);0<=u&&u<t.values.length&&(r.values[i]=t.values[u])}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PA=Z_(((t,e)=>t>e?1:0)),MA={kernelName:"Greater",backendName:"cpu",kernelFunc:cA("Greater",PA,null,"bool")},zA=Z_(((t,e)=>t>=e?1:0)),BA={kernelName:"GreaterEqual",backendName:"cpu",kernelFunc:cA("GreaterEqual",zA,null,"bool")},UA=Z_(((t,e)=>t<e?1:0)),VA={kernelName:"Less",backendName:"cpu",kernelFunc:cA("Less",UA,null,"bool")},WA=Z_(((t,e)=>t<=e?1:0)),GA={kernelName:"LessEqual",backendName:"cpu",kernelFunc:cA("LessEqual",WA,null,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jA(t,e,n){const r=(e-t)/(n-1),i=Xg(n,"float32");i[0]=t;for(let s=1;s<i.length;s++)i[s]=i[s-1]+r;return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HA=yA((t=>Math.log(t))),qA={kernelName:"Log",backendName:"cpu",kernelFunc:vA("Log",HA)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function KA(t,e,n,r){const i=Lg(r,Ng(n));for(let s=0;s<i.length;++s){const n=s*e;let r=t[n];for(let i=0;i<e;++i){const e=t[n+i];(Number.isNaN(e)||e>r)&&(r=e)}i[s]=r}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XA=Z_(((t,e)=>Math.max(t,e))),YA={kernelName:"Maximum",backendName:"cpu",kernelFunc:cA("Maximum",XA)},QA=Z_(((t,e)=>Math.min(t,e))),JA={kernelName:"Minimum",backendName:"cpu",kernelFunc:cA("Minimum",QA)},ZA=Z_(((t,e)=>t*e)),tD=hA(((t,e,n,r)=>({real:t*n-e*r,imag:t*r+e*n}))),eD=cA("Multiply",ZA,tD),nD={kernelName:"Multiply",backendName:"cpu",kernelFunc:eD};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rD(t,e,n){const r=ry(-1,n);return ZA([],e,r,t,n)}const iD={kernelName:"Neg",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;K_(r,"neg");const i=n.data.get(r.dataId).values,[s,o]=rD(i,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,s)}},sD=Z_(((t,e)=>t!==e?1:0)),oD={kernelName:"NotEqual",backendName:"cpu",kernelFunc:cA("NotEqual",sD,null,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function aD(t,e,n,r,i){const s=e.length,o=Ng(e),a=jg(e),u=jg(i),l=Lg(n,Ng(i));for(let c=0;c<o;++c){const e=Zg(c,s,a),n=new Array(e.length);for(let t=0;t<n.length;t++)n[t]=e[r[t]];l[Jg(n,s,u)]=t[c]}return l}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(t){const{inputs:e,attrs:n,backend:r}=t,{x:i}=e,{perm:s}=n;K_(i,"transpose");const o=i.shape.length,a=new Array(o);for(let l=0;l<a.length;l++)a[l]=i.shape[s[l]];const u=aD(r.data.get(i.dataId).values,i.shape,i.dtype,s,a);return{dataId:r.write(u,a,i.dtype),shape:a,dtype:i.dtype}}const lD={kernelName:"Transpose",backendName:"cpu",kernelFunc:uD};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cD(t,e,n,r){const[i,s]=xx(t,r),o=Oy(e,"int32"),a=Xg(Ng(i),o),u=Ng(s);for(let l=0;l<a.length;++l){const t=l*u;let e=1;for(let r=0;r<u;++r)e*=n[t+r];a[l]=e}return{outVals:a,outShape:i,outDtype:o}}const hD={kernelName:"Prod",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;K_(i,"prod");const a=i.shape.length,u=Fg(s,i.shape),l=Ix(u,a);let c=u,h=i;const d=[];null!=l&&(h=uD({inputs:{x:i},backend:n,attrs:{perm:l}}),d.push(h),c=Tx(c.length,a));const p=n.data.get(h.dataId).values,{outVals:f,outShape:g,outDtype:m}=cD(h.shape,h.dtype,p,c);let y=g;return o&&(y=wx(g,u)),d.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(y,m,f)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dD(t,e,n,r){const i=[];let s=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map((()=>[0]));!function(t,e){for(let n=0;n<t.length;++n){const r=t[n],i=n===t.length-1?e:t[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let t=1;t<r.length;++t)if(r[t-1]>r[t])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let u=1;for(let l=0;l<e.length-1;++l){u*=e[l];const t=e[l+1];for(let e=1;e<u+1;++e)a[l].push(e*t)}for(let l=0;l<t.length;++l){let r=t[l],o=t[l]+1;for(let t=0;t<n.length;++t){const i=n[t],s=t+e.length-1;if(s>=0){const t=a[s],e=t[t.length-1]-i[r];for(let n=r;n<o;++n)a[s].push(i[n+1]+e)}r=i[r],o=i[o]}o!==r&&(i.push([r,o]),s+=o-r)}return{outSplits:a,valueSlices:i,numValues:s}}function pD(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let r=e;r<t.length;r++)n[e-1]*=t[r];return n}function fD(t,e,n,r,i){const s=e.slice();s[0]=i;const o=Pg(n,Ng(s)),a=t.length;return function(t,e,n,r,i,s){const o=pD(e,2)[1],a=pD(s,2)[1];let u=0;for(const l of n)for(let e=l[0];e<l[1];++e){for(let n=0;n<r;++n)i[u*a+n]=t[e*o+n];++u}}(t,e,r,0===a?0:a/e[0],o,s),[o,s]}function gD(t,e,n,r,i,s,o,a){if(0===t.length)throw new Error("paramsNestedSplits must be non empty");if(0===e[0].length)throw new Error("Split tensors must not be scalars");if(function(t,e,n){t.forEach(((t,r)=>{if(t<0||t>=n){const i=Zg(r,e.length,jg(e)).join(",");throw new Error(`indices[${i}] = ${t} is not in [0, ${n})`)}}))}(s,o,e[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");const u=r[0],{outSplits:l,valueSlices:c,numValues:h}=dD(s,o,t,u),d=function(t){const e=[];for(let n=0;n<t.length;++n){const r=Pg("int32",t[n].length);e.push(r),t[n].forEach(((t,e)=>r[e]=t))}return e}(l),p=fD(n,r,i,c,h);return[d,p[0],p[1]]}
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mD(t,e,n,r,i,s,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=0===e.length,u=0===i.length,l=0===o.length,c=[];a||c.push(e[0]),u||c.push(i[0]),l||c.push(o[0]);for(let g=1;g<c.length;++g)if(c[g]!==c[g-1])throw new Error("starts, limits, and deltas must have the same shape");const h=0===c.length?1:c[0],d=Pg("int32",h+1);d[0]=0;for(let g=0;g<h;++g){const e=a?t[0]:t[g],n=u?r[0]:r[g],i=l?s[0]:s[g];if(0===i)throw new Error("Requires delta != 0");let o;if(i>0&&n<e||i<0&&n>e)o=0;else if(o=Math.ceil(Math.abs((n-e)/i)),o>2147483647)throw new Error("Requires ((limit - start) / delta) <= 2147483647");d[g+1]=d[g]+o}const p=Pg(n,d[h]);let f=0;for(let g=0;g<h;++g){const e=d[g+1]-d[g];let n=a?t[0]:t[g];const r=l?s[0]:s[g];for(let t=0;t<e;++t)p[f++]=n,n+=r}return[d,p]}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var yD=ZI;class bD{constructor(t,e,n,r,i,s,o,a,u,l){this.shape=t,this.shapeShape=e,this.values=n,this.valuesShape=r,this.valuesDType=i,this.defaultValue=s,this.defaultValueShape=o,this.rowPartitionValues=a,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=nS(l),this.raggedRank=rS(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===yD.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===yD.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case yD.VALUE_ROWIDS:return bD.getMaxWidthValueRowID(e);case yD.ROW_SPLITS:return bD.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${yD[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(0===e||1===e)return 0;let n=0;for(let r=0;r<e-1;++r){const e=t[r+1]-t[r];e>n&&(n=e)}return n}static getMaxWidthValueRowID(t){const e=t.length;if(0===e)return 0;let n=0,r=t[0],i=0;for(let s=1;s<e;++s){const e=t[s];e!==r&&(r=e,i=Math.max(s-n,i),n=s)}return Math.max(e-n,i)}tensorShapeFromTensor(t,e,n=!0){if(0===e.length){if(-1===t[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return xD(t,n)}calculateOutputSize(t){const e=this.valuesShape;iS(this.defaultValueShape,e);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=eS(this.raggedRank,n,e);r[0]<0&&(r[0]=t);for(let i=1;i<=this.raggedRank;++i)r[i]<0&&(r[i]=this.getMaxWidth(i));return r}calculateFirstParentOutputIndex(t,e,n){const r=Math.min(t,n),i=[];let s=0;for(let o=0;o<r;++o,s+=e)i.push(s);for(let o=r;o<t;++o)i.push(-1);return Sg(i.length===t,(()=>"Final length of result must be equal to firstDimension.")),i}calculateOutputIndexRowSplit(t,e,n,r){const i=t.length,s=[];for(let o=0;o<i-1;++o){const i=t[o+1]-t[o];let a=Math.min(r,i),u=e[o];-1===u&&(a=0);for(let t=0;t<a;++t)s.push(u),u+=n;for(let t=0;t<i-a;++t)s.push(-1)}if(i>0&&s.length!==t[i-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(t,e,n,r){const i=t.length,s=[];if(0===i)return[];let o=0,a=t[0];if(a>=e.length)throw new Error(`Got currentValueRowId=${a}, which is not less than ${e.length}`);let u=e[a];s.push(u);for(let l=1;l<i;++l){const i=t[l];if(i===a)u>=0&&(++o,o<r?u+=n:u=-1);else{if(o=0,a=i,i>=e.length)throw new Error(`Got nextValueRowId=${i} which is not less than ${e.length}`);u=e[i]}s.push(u)}if(s.length!==t.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(t,e,n,r){const i=this.getRowPartitionTensor(t),s=this.getRowPartitionTypeByDimension(t);switch(s){case yD.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,e,n,r);case yD.ROW_SPLITS:if(i.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(i,e,n,r);default:throw new Error(`Unsupported partition type: ${yD[s]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case yD.FIRST_DIM_SIZE:return t[0];case yD.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case yD.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${yD[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),e=this.calculateOutputSize(t),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let s=n.length-2;s>=0;--s)n[s]=n[s+1]*e[s+1];const r=xD(e,!1),i=Pg(this.valuesDType,Ng(r));if(n[0]*e[0]>0){let s=this.calculateFirstParentOutputIndex(t,n[0],e[0]);for(let t=1;t<=this.raggedRank;++t){s=this.calculateOutputIndex(t-1,s,n[t],e[t])}this.setOutput(this.raggedRank,s,i,r)}return[r,i]}setOutput(t,e,n,r){if(0===n.length)return;const i=this.values,s=n;let o=r.slice();o=o.slice(t+1);const a=Ng(o),u=e.length;let l=this.defaultValue;if(l.length!==a&&1!==l.length){const t=this.defaultValueShape;Gb((()=>{const e=Tv(l,t),n=zv(e,o);l=n.dataSync()}))}let c=0,h=0,d=0;for(let p=0;p<=u;++p){let t=p<u?e[p]:-1;if(t!==d){if(h<d){const t=i.subarray(c*a);vD(s.subarray(h*a),t,(d-h)*a)}if(p>=u){const e=n.length;t=Math.floor(e/a)}if(t>d)if(1===this.defaultValue.length)s.subarray(d*a,t*a).fill(this.defaultValue[0]),d=t;else for(;t>d;){vD(s.slice(d*a),l,a),++d}t<0?(c=p+1,h=d):(c=p,h=d,d=h+1)}else++d}}}function vD(t,e,n){for(let r=0;r<n;r++)t[r]=e[r]}function xD(t,e){const n=[];for(let r of t){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function wD(t,e,n,r,i,s,o,a,u,l){return new bD(t,e,n,r,i,s,o,a,u,l).compute()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kD(t,e,n,r){if(t===e||t<e&&n<0||e<t&&n>1)return Xg(0,r);const i=Xg(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),i[0]=t;for(let s=1;s<i.length;s++)i[s]=i[s-1]+n;return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ID=yA((t=>1/Math.sqrt(t))),SD={kernelName:"Rsqrt",backendName:"cpu",kernelFunc:vA("Rsqrt",ID)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function TD(t,e,n,r,i,s,o,a,u,l){const c=[r/i,i],h=t.values,d=e.values;if(0===r)return zb(n,e.dtype);const p=u instanceof by?u:zb(c,e.dtype);"string"==typeof u||"number"==typeof u?p.values.fill(u):"boolean"==typeof u&&p.values.fill(+u);for(let f=0;f<s;f++){const t=[];let s=0;for(let e=0;e<o;e++){const n=h[f*o+e];t.push(n),s+=n*a[e]}if(s<0||s>=r/i)throw new Error(`Invalid indices: ${t} does not index into ${n}`);for(let n=0;n<i;n++)l?p.values[s*i+n]+=d[f*i+n]:p.values[s*i+n]=0===e.rank?d[0]:d[f*i+n]}return p}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CD=yA((t=>1/(1+Math.exp(-t)))),ND=bA("Sigmoid",(t=>1/(1+Math.exp(-t)))),ED={kernelName:"Sigmoid",backendName:"cpu",kernelFunc:ND};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function RD(t,e,n,r,i){const s=VI(r,e,n),o=Ng(n),a=jg(r);if(s){const n=WI(e,a);return"string"===i?t.slice(n,n+o):t.subarray(n,n+o)}const u=zb(r,i,"string"===i?jS(t):t),l=zb(n,i);for(let c=0;c<l.size;++c){const t=l.indexToLoc(c),n=t.map(((t,n)=>t+e[n]));l.set(u.get(...n),...t)}return"string"===i?HS(l.values):l.values}function $D(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:o}=r;K_(i,"slice");const[a,u]=GI(i,s,o);AI(i,a,u);const l=RD(n.data.get(i.dataId).values,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,l)}const _D={kernelName:"Slice",backendName:"cpu",kernelFunc:$D};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AD(t,e,n,r,i,s,o){const a=e[0],u=s[0],l=new Array(u),c=new Array(a),h=e[1];if(0===u){if(0!==a)throw new Error(RS(a));return[Pg(n,0),[0,h],Pg(i,0),l,c]}let d=!0,p=0;const f=new Array(u).fill(0);for(let m=0;m<a;++m){const e=t[m*h];if(e<0)throw new Error($S(m,e));if(e>=u)throw new Error(_S(m,e,u));++f[e],d=d&&e>=p,p=e}let g=!0;for(let m=0;m<u;++m){const t=0===f[m];l[m]=t,g=g&&!t,f[m]=Math.max(f[m],1),m>0&&(f[m]+=f[m-1])}if(g&&d){const e=t,n=r;for(let t=0;t<a;++t)c[t]=t;return[e,[a,h],n,l,c]}{const e=f[u-1],s=Pg(n,e*h),d=Pg(i,e),p=new Array(u).fill(0);for(let n=0;n<a;++n){const e=t[n*h],i=p[e],o=(0===e?0:f[e-1])+i;p[e]++;for(let r=0;r<h;++r)s[o*h+r]=t[n*h+r];d[o]=r[n],c[n]=o}for(let t=0;t<u;++t){if(0===p[t]){const e=0===t?0:f[t-1];s[e*h+0]=t;for(let t=1;t<h;++t)s[e*h+t]=0;d[e]=o}}return[s,[e,h],d,l,c]}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DD(t,e,n,r,i){const s=Ng(r),o=e[0],a=i.length,u=[];let l=1,c=-1;for(let g=0;g<a;++g){const t=i[g];if(-1===t){if(-1!==c)throw new Error(AS(c,g));c=g,u.push(1)}else{if(t<0)throw new Error(DS(g,t));l*=t,u.push(t)}}if(-1!==c){if(l<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const t=Math.trunc(s/l);if(l*t!==s)throw new Error(OS(r,u));u[c]=t}if(Ng(u)!==s)throw new Error(LS(r,u));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let t=h-2;t>=0;--t)d[t]=d[t+1]*r[t+1]}const p=[];if(a>0){p[a-1]=1;for(let t=a-2;t>=0;--t)p[t]=p[t+1]*u[t+1]}const f=Pg(n,o*a);for(let g=0;g<o;++g){let e=0;for(let n=0;n<h;++n)e+=t[g*h+n]*d[n];for(let t=0;t<a;++t)f[g*a+t]=Math.trunc(e/p[t]),e%=p[t]}return[f,[o,a],u]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FD(t,e,n,r,i,s=!1,o=0){const a=r.length,u=[e[0],t.length/e[0]],l=u[1],c=a>0?i[a-1]+1:0;if(c<0)throw new Error("segment ids must be >= 0");const h=e.slice();h[0]=c;const d=Pg(n,h.reduce(((t,e)=>t*e),1));if(0===a)return c>0&&d.fill(o),[d,h];if(c<=0)throw new Error("segment ids must be >= 0");let p=0,f=1,g=0,m=i[p];for(;;){let e=0;if(f<a){if(e=i[f],m===e){++f;continue}if(m>=e)throw new Error("segment ids are not increasing")}if(m<0||m>=c)throw new Error(zS(m,c));m>g&&d.fill(o,g*l,m*l);for(let n=p;n<f;++n){const e=r[n];if(e<0||e>=u[0])throw new Error(BS(n,r[n],u[0]));for(let n=0;n<l;n++)d[m*l+n]+=t[e*l+n]}if(s)for(let t=0;t<l;t++)d[m*l+t]/=f-p;if(p=f,++f,g=m+1,m=e,f>a)break}return g<c&&d.fill(o,g*l,c*l),[d,h]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OD=yA((t=>Math.sqrt(t))),LD={kernelName:"Sqrt",backendName:"cpu",kernelFunc:bA("Sqrt",(t=>Math.sqrt(t)))},PD=Z_(((t,e)=>{const n=t-e;return n*n})),MD={kernelName:"SquaredDifference",backendName:"cpu",kernelFunc:cA("SquaredDifference",PD)},zD=yA(((t,e)=>{const{pattern:n,replaceGlobal:r,rewrite:i}=e;return t.replace(new RegExp(n,r?"g":""),i)})),BD={kernelName:"StaticRegexReplace",backendName:"cpu",kernelFunc:vA("StaticRegexReplace",zD)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function UD(t,e,n,r){const i=zb(t,e.dtype);for(let s=0;s<i.size;s++){const t=i.indexToLoc(s),o=new Array(t.length);for(let e=0;e<o.length;e++)o[e]=t[e]*n[e]+r[e];i.set(e.get(...o),...t)}return i}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VD{constructor(t,e,n,r,i,s){this.separator=oy(t),this.nGramWidths=e,this.leftPad=oy(n),this.rightPad=oy(r),this.padWidth=i,this.preserveShort=s}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const n=this.getPadWidth(e);return Math.max(0,t+2*n-e+1)}createNGrams(t,e,n,r,i,s){for(let o=0;o<i;++o){const a=this.getPadWidth(s),u=Math.max(0,a-o),l=Math.max(0,a-(i-(o+1))),c=s-(u+l),h=e+(u>0?0:o-a);let d=0;d+=u*this.leftPad.length;for(let e=0;e<c;++e)d+=t[h+e].length;d+=l*this.rightPad.length;d+=(u+l+c-1)*this.separator.length,n[r+o]=new Uint8Array(d);const p=n[r+o];let f=0;const g=t=>t.forEach((t=>p[f++]=t));for(let t=0;t<u;++t)g(this.leftPad),g(this.separator);for(let e=0;e<c-1;++e)g(t[h+e]),g(this.separator);if(c>0){g(t[h+c-1]);for(let t=0;t<l;++t)g(this.separator),g(this.rightPad)}else{for(let t=0;t<l-1;++t)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(t,e){const n=t.length,r=e.length;if(r>0){let t=e[0];if(0!==t)throw new Error(`First split value must be 0, got ${t}`);for(let i=1;i<r;++i){let r=e[i]>=t;if(r=r&&e[i]<=n,!r)throw new Error(`Invalid split value ${e[i]}, must be in [${t}, ${n}]`);t=e[i]}if(t!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${t}`)}const i=r-1,s=Pg("int32",r);if(0===n||0===r){const t=new Array(n);for(let e=0;e<=i;++e)s[e]=0;return[t,s]}s[0]=0;for(let a=1;a<=i;++a){const t=e[a]-e[a-1];let n=0;this.nGramWidths.forEach((e=>{n+=this.getNumNGrams(t,e)})),this.preserveShort&&t>0&&0===n&&(n=1),s[a]=s[a-1]+n}const o=new Array(s[i]);for(let a=0;a<i;++a){const n=e[a];let r=s[a];if(this.nGramWidths.forEach((i=>{const s=e[a+1]-e[a],u=this.getNumNGrams(s,i);this.createNGrams(t,n,o,r,u,i),r+=u})),this.preserveShort&&r===s[a]){const i=e[a+1]-e[a];if(0===i)continue;const s=i+2*this.padWidth,u=1;this.createNGrams(t,n,o,r,u,s)}}return[o,s]}}function WD(t,e,n,r,i,s,o,a){return new VD(n,r,i,s,o,a).compute(t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GD(t,e,n,r){if(!t.length)return;if(0===e.length){for(let e=0;e<t.length;++e)r.push(t.subarray(e,e+1));return}if(1===e.length){const i=e[0];let s=t.indexOf(i);for(;-1!==s;){const e=t.subarray(0,s);n&&0===e.length||r.push(e),s=(t=t.subarray(s+1)).indexOf(i)}return void(n&&0===t.length||r.push(t))}let i=0;for(let s=0;s<t.length+1;s++)if(s===t.length||-1!==e.indexOf(t[s])){const e=t.subarray(i,s);n&&0===e.length||r.push(e),i=s+1}}function jD(t,e,n){const r=t.length,i=[];let s=0,o=0;const a=new Array(r);for(let d=0;d<r;++d){const r=i.length;GD(t[d],e,n,i);const u=i.length-r;a[d]=u,s+=u,o=Math.max(o,u)}const u=Pg("int32",2*s),l=new Array(s),c=[r,o];let h=0;for(let d=0;d<r;++d)for(let t=0;t<a[d];++t)u[2*h]=d,u[2*h+1]=t,l[h]=i[h],++h;return[u,l,c]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HD(t,e){const n=Pg("int32",t.length);for(let r=0;r<t.length;++r)n[r]=ny(t[r]).modulo(e).getLowBitsUnsigned();return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qD=Z_(((t,e)=>t-e)),KD=cA("Sub",qD,hA(((t,e,n,r)=>({real:t-n,imag:e-r})))),XD={kernelName:"Sub",backendName:"cpu",kernelFunc:KD};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function YD(t,e){const n=new Array(t.rank);for(let i=0;i<n.length;i++)n[i]=t.shape[i]*e[i];const r=zb(n,t.dtype);for(let i=0;i<r.values.length;++i){const e=r.indexToLoc(i),n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=e[r]%t.shape[r];const s=t.locToIndex(n);r.values[i]=t.values[s]}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QD=(t,e)=>{const n=e.value-t.value;return 0===n?t.index-e.index:n};function JD(t,e,n=0,r=t.length-1){for(;r>n;){if(r-n>600){const i=r-n+1,s=e-n+1,o=Math.log(i),a=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*a*(i-a)/i)*Math.sign(s-i/2);JD(t,e,Math.max(n,Math.floor(e-s*a/i+u)),Math.min(r,Math.floor(e+(i-s)*a/i+u)))}const i=t[e];let s=n,o=r;for(Ig(t,n,e),QD(t[r],i)>0&&Ig(t,n,r);s<o;){for(Ig(t,s,o),s++,o--;QD(t[s],i)<0;)s+=1;for(;QD(t[o],i)>0;)o-=1}0===QD(t[n],i)?Ig(t,n,o):(o+=1,Ig(t,o,r)),o<=e&&(n=o+1),e<=o&&(r=o-1)}}function ZD(t,e,n,r,i){const s=e[e.length-1],[o,a]=[t.length/s,s],u=Lg(n,o*r),l=Lg("int32",o*r);for(let h=0;h<o;h++){const e=h*a,n=t.subarray(e,e+a);let s=new Array(n.length);n.forEach(((t,e)=>s[e]={value:t,index:e})),r<s.length&&(JD(s,r),s=s.slice(0,r)),i&&s.sort(QD);const o=h*r,c=u.subarray(o,o+r),d=l.subarray(o,o+r);for(let t=0;t<r;t++)c[t]=s[t].value,d[t]=s[t].index}const c=e.slice();return c[c.length-1]=r,[zb(c,n,u),zb(c,"int32",l)]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tF(t,e,n,r){const i=Fg(e,n)[0],s=[1,n[0],1];for(let f=0;f<i;f++)s[0]*=n[f];s[1]=n[i];for(let f=i+1;f<n.length;f++)s[2]*=n[f];const o=new Map,a=new Int32Array(n[i]),u=new by(s,r,t),l=[],c=1===s[0]&&1===s[2];for(let f=0;f<n[i];f++){let e;if(c)e=t[f].toString();else{const t=[];for(let e=0;e<s[0];e++)for(let n=0;n<s[2];n++)t.push(u.get(e,f,n));e=t.join(",")}const n=o.get(e);if(null!=n)a[f]=n;else{const t=o.size;o.set(e,t),a[f]=t,l.push(f)}}const h=s.slice();h[1]=o.size;const d=new by(h,r);l.forEach(((t,e)=>{for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)d.set(u.get(n,t,r),n,e,r)}));const p=n.slice();return p[i]=h[1],{outputValues:d.values,outputShape:p,indices:a}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var eF=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",simpleAbsImpl:Q_,addImpl:dA,bincountImpl:gA,bincountReduceImpl:mA,castImpl:aA,ceilImpl:xA,concatImpl:kA,equalImpl:IA,expImpl:CA,expm1Impl:RA,floorImpl:_A,floorDivImpl:DA,gatherNdImpl:OA,gatherV2Impl:LA,greaterImpl:PA,greaterEqualImpl:zA,lessImpl:UA,lessEqualImpl:WA,linSpaceImpl:jA,logImpl:HA,maxImpl:KA,maximumImpl:XA,minimumImpl:QA,multiplyImpl:ZA,negImpl:rD,notEqualImpl:sD,prodImpl:cD,raggedGatherImpl:gD,raggedRangeImpl:mD,raggedTensorToTensorImpl:wD,rangeImpl:kD,rsqrtImpl:ID,scatterImpl:TD,sigmoidImpl:CD,sliceImpl:RD,sparseFillEmptyRowsImpl:AD,sparseReshapeImpl:DD,sparseSegmentReductionImpl:FD,sqrtImpl:OD,squaredDifferenceImpl:PD,staticRegexReplaceImpl:zD,stridedSliceImpl:UD,stringNGramsImpl:WD,stringSplitImpl:jD,stringToHashBucketFastImpl:HD,subImpl:qD,tileImpl:YD,topKImpl:ZD,transposeImpl:aD,uniqueImpl:tF});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */qb("cpu",(()=>new Y_),1);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const nF=bA("Elu",(t=>t>=0?t:Math.exp(t)-1)),rF={kernelName:"Elu",backendName:"cpu",kernelFunc:nF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function iF(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r;K_([i],"leakyRelu");const o=Ng(i.shape),a=n.data.get(i.dataId).values,u=Lg("float32",o);for(let l=0;l<a.length;l++)u[l]=a[l]<0?s*a[l]:a[l];return n.makeTensorInfo(i.shape,"float32",u)}const sF={kernelName:"LeakyRelu",backendName:"cpu",kernelFunc:iF},oF=Z_(((t,e)=>t<0?e*t:t));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aF(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e;K_([r,i],"prelu");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,[a,u]=oF(r.shape,i.shape,s,o,"float32");return n.makeTensorInfo(u,"float32",a)}const uF={kernelName:"Prelu",backendName:"cpu",kernelFunc:aF},lF=bA("Relu",(t=>Math.max(0,t))),cF={kernelName:"Relu",backendName:"cpu",kernelFunc:lF},hF=bA("Relu6",(t=>Math.min(Math.max(0,t),6))),dF={kernelName:"Relu6",backendName:"cpu",kernelFunc:hF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pF(t,e,n,r,i){if("linear"===n)return rA({inputs:{x:e},backend:t});if("relu"===n)return lF({inputs:{x:e},backend:t});if("elu"===n)return nF({inputs:{x:e},backend:t});if("relu6"===n)return hF({inputs:{x:e},backend:t});if("prelu"===n)return aF({inputs:{x:e,alpha:r},backend:t});if("leakyrelu"===n)return iF({inputs:{x:e},backend:t,attrs:{alpha:i}});if("sigmoid"===n)return ND({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fF(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,o=Ng(i.shape),a=Dg(s,o),u=Ng(a);Sg(o===u,(()=>`The new shape (${a}) has ${u} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(i.dataId);const l=n.data.get(i.dataId);if(null!=l.complexTensorInfos){const t=l.complexTensorInfos.real,e=l.complexTensorInfos.imag;t.shape=a,e.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const gF={kernelName:"Reshape",backendName:"cpu",kernelFunc:fF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mF(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:o,transposeB:a}=r;K_([i,s],"matMul");const u=i.shape.length,l=s.shape.length,c=o?i.shape[u-2]:i.shape[u-1],h=a?s.shape[l-1]:s.shape[l-2],d=o?i.shape[u-1]:i.shape[u-2],p=a?s.shape[l-2]:s.shape[l-1],f=i.shape.slice(0,-2),g=s.shape.slice(0,-2),m=Ng(f),y=Ng(g),b=cx(i.shape.slice(0,-2),s.shape.slice(0,-2)).concat([d,p]);Sg(c===h,(()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${o} and transposeB=${a} must match.`));const v=a?[y,p,h]:[y,h,p],x=fF({inputs:{x:i},backend:n,attrs:{shape:o?[m,c,d]:[m,d,c]}}),w=fF({inputs:{x:s},backend:n,attrs:{shape:v}}),k=o?x.shape[1]:x.shape[2],I=o?x.shape[2]:x.shape[1],S=a?w.shape[1]:w.shape[2],T=Math.max(m,y),C=n.data.get(x.dataId).values,N=n.data.get(w.dataId).values,E=jg(x.shape),R=jg(w.shape),[$,_,A]=o?[E[0],1,E[1]]:[E[0],E[1],1],[D,F,O]=a?[1,R[1],R[0]]:[R[1],1,R[0]],L=I*S,P=zb([T,I,S],x.dtype),M=P.values,z=n.blockSize;for(let B=0;B<T;B++){const t=B%m,e=B%y;for(let n=0;n<I;n+=z){const r=Math.min(n+z,I);for(let i=0;i<S;i+=z){const s=Math.min(i+z,S);for(let o=0;o<k;o+=z){const a=Math.min(o+z,k);for(let u=n;u<r;u++)for(let n=i;n<s;n++){let r=0;for(let i=o;i<a;i++){r+=C[t*$+u*_+i*A]*N[i*D+n*F+e*O]}M[B*L+(u*S+n)]+=r}}}}}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(b,P.dtype,P.values)}const yF={kernelName:"BatchMatMul",backendName:"cpu",kernelFunc:mF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bF={kernelName:"_FusedMatMul",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:h}=r;let d,p,f;const g=[];d=mF({inputs:{a:i,b:s},attrs:{transposeA:u,transposeB:l},backend:n}),o&&(p=pA({inputs:{a:d,b:o},backend:n}),g.push(d),d=p),c&&(f=pF(n,d,c,a,h),g.push(d),d=f);for(const m of g)n.disposeIntermediateTensorInfo(m);return d}},vF={kernelName:"Acos",backendName:"cpu",kernelFunc:bA("Acos",(t=>Math.acos(t)))},xF={kernelName:"Acosh",backendName:"cpu",kernelFunc:bA("Acosh",(t=>Math.acosh(t)))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wF={kernelName:"AddN",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,r=e;K_(e,"addN");const i=r.map((t=>n.data.get(t.dataId).values)),s=zb(r[0].shape,r[0].dtype),o=s.values;for(let a=0;a<r.length;a++){const t=i[a];for(let e=0;e<o.length;e++)o[e]+=t[e]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kF={kernelName:"All",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;K_(i,"all");const a=Fg(s,i.shape);let u=a;const l=Ix(u,i.shape.length);let c=i;null!=l&&(c=uD({inputs:{x:i},backend:n,attrs:{perm:l}}),u=Tx(u.length,i.shape.length)),kx("all",u,c.shape.length);const[h,d]=xx(c.shape,u),p=Ng(d),f=Xg(Ng(h),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const t=y*p;let e=g[t];for(let n=0;n<p;++n){const r=g[t+n];e=e&&r}f[y]=e}null!=l&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(h,c.dtype,f);if(o){const t=fF({inputs:{x:m},backend:n,attrs:{shape:wx(h,a)}});return n.disposeIntermediateTensorInfo(m),t}return m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IF={kernelName:"Any",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;K_(i,"any");const a=Fg(s,i.shape);let u=a;const l=Ix(u,i.shape.length);let c=i;null!=l&&(c=uD({inputs:{x:i},backend:n,attrs:{perm:l}}),u=Tx(u.length,i.shape.length)),kx("any",u,c.shape.length);const[h,d]=xx(c.shape,u),p=Ng(d),f=Xg(Ng(h),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const t=y*p;let e=g[t];for(let n=0;n<p;++n){const r=g[t+n];e=e||r}f[y]=e}null!=l&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(h,c.dtype,f);if(o){const t=fF({inputs:{x:m},backend:n,attrs:{shape:wx(h,a)}});return n.disposeIntermediateTensorInfo(m),t}return m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SF={kernelName:"ArgMax",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;K_(i,"argMax");let o=Fg(s,i.shape);const a=Ix(o,i.shape.length);let u=i;const l=[];null!=a&&(u=uD({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=Tx(o.length,u.shape.length)),o=[o[0]],kx("argMax",o,u.shape.length);const[c,h]=xx(u.shape,o),d=Xg(Ng(c),"int32"),p=Ng(h),f=n.data.get(u.dataId).values;for(let g=0;g<d.length;++g){const t=g*p;let e=f[t],n=0;for(let r=0;r<p;++r){const i=f[t+r];i>e&&(e=i,n=r)}d[g]=n}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(c,"int32",d)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TF={kernelName:"ArgMin",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;K_(i,"argMin");let o=Fg(s,i.shape);const a=Ix(o,i.shape.length);let u=i;const l=[];null!=a&&(u=uD({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=Tx(o.length,u.shape.length)),o=[o[0]],kx("argMin",o,u.shape.length);const[c,h]=xx(u.shape,o),d=Xg(Ng(c),"int32"),p=Ng(h),f=n.data.get(u.dataId).values;for(let g=0;g<d.length;++g){const t=g*p;let e=f[t],n=0;for(let r=0;r<p;++r){const i=f[t+r];i<e&&(e=i,n=r)}d[g]=n}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(c,"int32",d)}},CF={kernelName:"Asin",backendName:"cpu",kernelFunc:bA("Asin",(t=>Math.asin(t)))},NF={kernelName:"Asinh",backendName:"cpu",kernelFunc:bA("Asinh",(t=>Math.asinh(t)))},EF={kernelName:"Atan",backendName:"cpu",kernelFunc:bA("Atan",(t=>Math.atan(t)))},RF={kernelName:"Atan2",backendName:"cpu",kernelFunc:cA("Atan2",Z_(((t,e)=>Math.atan2(t,e))))},$F={kernelName:"Atanh",backendName:"cpu",kernelFunc:bA("Atanh",(t=>Math.atanh(t)))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _F(t,e,n,r,i,s){const o=i.strideHeight,a=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,d=i.padInfo.top,p=i.padInfo.left,f="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=zb(i.outShape,n),m=g.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],v=i.outShape[3];for(let x=0;x<i.batchSize;++x){const e=x*y,n=x*r[0];for(let g=0;g<i.inChannels;++g)for(let y=0;y<i.outHeight;++y){const x=y*o-d,w=Math.max(0,x),k=Math.min(i.inHeight,c+x),I=e+y*b;for(let e=0;e<i.outWidth;++e){const o=e*a-p,c=Math.max(0,o),d=Math.min(i.inWidth,h+o);let y=f,b=0,x=0;for(let e=w;e<k;e+=u){const i=n+e*r[1];for(let e=c;e<d;e+=l){const n=t[i+e*r[2]+g];"max"===s&&n>y?y=n:"avg"===s&&(b+=n,x++)}if(isNaN(y))break}m[I+e*v+g]="avg"===s?b/x:y}}}return g}function AF(t,e,n,r,i=!1,s=!1){const o=zb(r.outShape,"int32"),a=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,g=zb(e,n,t);for(let m=0;m<r.batchSize;++m)for(let t=0;t<r.inChannels;++t)for(let e=0;e<r.outHeight;++e){const n=e*a-p;let y=n;for(;y<0;)y+=l;const b=Math.min(r.inHeight,h+n);for(let a=0;a<r.outWidth;++a){const h=a*u-f;let p=h;for(;p<0;)p+=c;const v=Math.min(r.inWidth,d+h);let x=Number.NEGATIVE_INFINITY,w=-1;for(let e=y;e<b;e+=l){const o=e-n;for(let n=p;n<v;n+=c){const a=n-h,u=g.get(m,e,n,t);u>x&&(x=u,w=i?s?((m*r.inHeight+e)*r.inWidth+n)*r.inChannels+t:(e*r.inWidth+n)*r.inChannels+t:o*d+a)}}o.set(w,m,e,a,t)}}return o}function DF(t,e,n,r,i,s){const o=i.strideDepth,a=i.strideHeight,u=i.strideWidth,l=i.dilationDepth,c=i.dilationHeight,h=i.dilationWidth,d=i.effectiveFilterDepth,p=i.effectiveFilterHeight,f=i.effectiveFilterWidth,g=i.padInfo.front,m=i.padInfo.top,y=i.padInfo.left,b="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=zb(i.outShape,n),x=v.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],k=i.outShape[2]*i.outShape[3]*i.outShape[4],I=i.outShape[3]*i.outShape[4],S=i.outShape[4];for(let T=0;T<i.batchSize;++T){const e=T*w,n=T*r[0];for(let v=0;v<i.inChannels;++v)for(let w=0;w<i.outDepth;++w){const T=w*o-g;let C=T;for(;C<0;)C+=l;const N=Math.min(i.inDepth,d+T),E=e+w*k;for(let e=0;e<i.outHeight;++e){const o=e*a-m;let d=o;for(;d<0;)d+=c;const g=Math.min(i.inHeight,p+o),w=E+e*I;for(let e=0;e<i.outWidth;++e){const o=e*u-y;let a=o;for(;a<0;)a+=h;const p=Math.min(i.inWidth,f+o),m=w+e*S;let k=b,I=0,T=0;for(let e=C;e<N;e+=l){const i=n+e*r[1];for(let e=d;e<g;e+=c){const n=i+e*r[2];for(let e=a;e<p;e+=h){const i=t[n+e*r[3]+v];if("max"===s&&i>k?k=i:"avg"===s&&(I+=i,T++),isNaN(k))break}if(isNaN(k))break}if(isNaN(k))break}x[m+v]="avg"===s?I/Math.max(T,1):k}}}}return v}const FF={kernelName:"AvgPool",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;K_(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r;Sg(wv(o,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const l=hv(i.shape,s,o,1,a,u);let c;if(1===l.filterWidth&&1===l.filterHeight&&Eg(l.inShape,l.outShape))c=rA({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=jg(i.shape),r=_F(t,i.shape,i.dtype,e,l,"avg");c=n.makeTensorInfo(l.outShape,i.dtype,r.values)}return c}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OF={kernelName:"AvgPool3D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r;K_(i,"avgPool3d");const c=dv(i.shape,s,o,1,a,u,l),h=DF(n.data.get(i.dataId).values,i.shape,i.dtype,jg(i.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LF={kernelName:"AvgPool3DGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=r;K_([i,s],"avgPool3DGrad");const c=dv(s.shape,o,a,1,u,l),h=c.strideDepth,d=c.strideHeight,p=c.strideWidth,f=c.filterDepth,g=c.filterHeight,m=c.filterWidth,y=c.dilationDepth,b=c.dilationHeight,v=c.dilationWidth,x=c.effectiveFilterDepth,w=c.effectiveFilterHeight,k=c.effectiveFilterWidth,I=x-1-c.padInfo.front,S=k-1-c.padInfo.left,T=w-1-c.padInfo.top,C=zb(s.shape,"float32"),N=1/(f*g*m),E=n.bufferSync(i);for(let R=0;R<c.batchSize;++R)for(let t=0;t<c.inChannels;++t)for(let e=0;e<c.inDepth;++e)for(let n=0;n<c.inHeight;++n)for(let r=0;r<c.inWidth;++r){const i=e-I,s=n-T,o=r-S;let a=0;for(let e=0;e<x;e+=y){const n=(i+e)/h;if(!(n<0||n>=c.outDepth||Math.floor(n)!==n))for(let e=0;e<w;e+=b){const r=(s+e)/d;if(!(r<0||r>=c.outHeight||Math.floor(r)!==r))for(let e=0;e<k;e+=v){const i=(o+e)/p;if(i<0||i>=c.outWidth||Math.floor(i)!==i)continue;a+=E.get(R,n,r,i,t)}}}C.set(a*N,R,e,n,r,t)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PF={kernelName:"AvgPoolGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s;K_([i,s],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=r,c=hv(o.shape,a,u,1,l),h=c.strideHeight,d=c.strideWidth,p=c.filterHeight,f=c.filterWidth,g=c.dilationHeight,m=c.dilationWidth,y=c.effectiveFilterHeight,b=c.effectiveFilterWidth,v=b-1-c.padInfo.left,x=y-1-c.padInfo.top,w=zb(o.shape,"float32"),k=1/(p*f),I=n.data.get(i.dataId).values,S=zb(i.shape,"float32",I);for(let T=0;T<c.batchSize;++T)for(let t=0;t<c.inChannels;++t)for(let e=0;e<c.inHeight;++e)for(let n=0;n<c.inWidth;++n){const r=e-x,i=n-v;let s=0;for(let e=0;e<y;e+=g){const n=(r+e)/h;if(!(n<0||n>=c.outHeight||Math.floor(n)!==n))for(let e=0;e<b;e+=m){const r=(i+e)/d;if(r<0||r>=c.outWidth||Math.floor(r)!==r)continue;s+=S.get(T,n,r,t)}}w.set(s*k,T,e,n,t)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MF={kernelName:"FusedBatchNorm",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,scale:s,offset:o,mean:a,variance:u}=e;Sg(a.shape.length===u.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Sg(null==o||a.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Sg(null==s||a.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),K_([i,a,u,s,o],"batchNorm");let{varianceEpsilon:l}=r;null==l&&(l=.001);const c=n.data.get(i.dataId).values,h=n.data.get(a.dataId).values,d=n.data.get(u.dataId).values,p=s?n.data.get(s.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(c.length),m=f.length,y=p.length,b=d.length,v=h.length;let x=0,w=0,k=0,I=0;for(let S=0;S<c.length;++S)g[S]=f[x++]+(c[S]-h[w++])*p[k++]/Math.sqrt(d[I++]+l),x>=m&&(x=0),w>=v&&(w=0),k>=y&&(k=0),I>=b&&(I=0);return n.makeTensorInfo(i.shape,i.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zF={kernelName:"BatchToSpaceND",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:o}=r;K_([i],"batchToSpaceND");const a=s.reduce(((t,e)=>t*e)),u=aS(i.shape,s,a),l=uS(u.length,s.length),c=lS(i.shape,s,a),h=cS(o,s.length),d=hS(c,o,s.length),p=fF({inputs:{x:i},backend:n,attrs:{shape:u}}),f=uD({inputs:{x:p},backend:n,attrs:{perm:l}}),g=fF({inputs:{x:f},backend:n,attrs:{shape:c}}),m=$D({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BF={kernelName:"Bincount",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o}=r,a=gA(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,a)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UF={kernelName:"BroadcastArgs",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=cx(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}},VF={kernelName:"ClipByValue",backendName:"cpu",kernelFunc:bA("ClipByValue",((t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}))},WF={kernelName:"ComplexAbs",backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend,r=new Float32Array(Ng(e.shape)),i=n.data.get(e.dataId),s=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values;for(let l=0;l<a.length;l++){const t=a[l],e=u[l];r[l]=Math.hypot(t,e)}return n.makeOutput(r,e.shape,"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function GF(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const jF={kernelName:"Imag",backendName:"cpu",kernelFunc:GF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HF(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=Fg(i,e[0].shape)[0];QI(e.map((t=>t.shape)),s);let o=JI(e.map((t=>t.shape)),s);if(0===Ng(o))return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter((t=>Ng(t.shape)>0));if(1===a.length)return rA({inputs:{x:a[0]},backend:n});if("complex64"===a[0].dtype){const t=a.map((t=>sA({inputs:{input:t},backend:n}))),e=a.map((t=>GF({inputs:{input:t},backend:n}))),r=HF({inputs:t,backend:n,attrs:{axis:s}}),i=HF({inputs:e,backend:n,attrs:{axis:s}}),o=tA({inputs:{real:r,imag:i},backend:n});return t.forEach((t=>n.disposeIntermediateTensorInfo(t))),e.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),o}const u=a.map((t=>{const e=Ng(t.shape.slice(s));return fF({inputs:{x:t},backend:n,attrs:{shape:[-1,e]}})})),l=u.map((t=>({vals:n.data.get(t.dataId).values,shape:t.shape})));o=JI(u.map((t=>t.shape)),1);const c=1===u[0].shape[0],h=kA(l,o,e[0].dtype,c),d=JI(a.map((t=>t.shape)),s),p=n.makeTensorInfo(d,e[0].dtype,h);return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),p}const qF={kernelName:"Concat",backendName:"cpu",kernelFunc:HF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KF(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=r;K_([i,s],"conv2d");const h=Iv(u),d=pv(i.shape,s.shape,o,l,a,c,!1,h),p=d.filterHeight,f=d.filterWidth,g=d.dilationHeight,m=d.dilationWidth,y=d.padInfo.left,b=d.padInfo.top,v="channelsLast"===d.dataFormat,x=new by(d.outShape,i.dtype),w=jg(i.shape),k=jg(s.shape),I=w[0],S=v?w[1]:w[2],T=v?w[2]:1,C=v?1:w[1],N=x.strides[0],E=v?x.strides[1]:x.strides[2],R=v?x.strides[2]:1,$=v?1:x.strides[1],_=n.data.get(i.dataId).values,A=n.data.get(s.dataId).values,D=x.values;for(let F=0;F<d.batchSize;++F){const t=F*I,e=F*N;for(let n=0;n<d.outHeight;++n){const r=e+n*E,i=n*d.strideHeight-b;for(let e=0;e<p;++e){const n=i+e*g;if(n<0||n>=d.inHeight)continue;const s=e*k[0],o=t+n*S;for(let t=0;t<d.outWidth;++t){const e=r+t*R,n=t*d.strideWidth-y;for(let t=0;t<f;++t){const r=n+t*m;if(r<0||r>=d.inWidth)continue;const i=o+r*T;let a=s+t*k[1];for(let t=0;t<d.inChannels;++t){const n=_[i+t*C];for(let t=0;t<d.outChannels;++t)D[e+t*$]+=n*A[a+t];a+=d.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,D)}const XF={kernelName:"Conv2D",backendName:"cpu",kernelFunc:KF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YF={kernelName:"Conv2DBackpropFilter",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=r;K_([i,s],"conv2dBackpropFilter");const h=Iv(u),d=pv(i.shape,c,o,1,a,l,!1,h),{strideHeight:p,strideWidth:f,filterHeight:g,filterWidth:m}=d,y="channelsLast"===d.dataFormat,b=new by(d.filterShape,"float32"),v=d.padInfo.left,x=d.padInfo.top,w=n.data.get(i.dataId).values,k=n.data.get(s.dataId).values,I=new by(i.shape,i.dtype,w),S=new by(s.shape,s.dtype,k);for(let T=0;T<g;++T){const t=Math.max(0,Math.ceil((x-T)/p)),e=Math.min(d.outHeight,(d.inHeight+x-T)/p);for(let n=0;n<m;++n){const r=Math.max(0,Math.ceil((v-n)/f)),i=Math.min(d.outWidth,(d.inWidth+v-n)/f);for(let s=0;s<d.inChannels;++s)for(let o=0;o<d.outChannels;++o){let a=0;for(let u=0;u<d.batchSize;++u)for(let l=t;l<e;++l){const t=T+l*p-x;for(let e=r;e<i;++e){const r=n+e*f-v;a+=y?I.get(u,t,r,s)*S.get(u,l,e,o):I.get(u,s,t,r)*S.get(u,o,l,e)}}b.set(a,T,n,s,o)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QF={kernelName:"Conv2DBackpropInput",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=r;K_([i,s],"conv2dBackpropInput");const h=jg(s.shape),d=jg(i.shape);let p=Iv(l);const f=pv(o,s.shape,a,1,u,c,!1,p),g=new by(f.inShape,"float32"),m=g.values,y=n.data.get(i.dataId).values,b=n.data.get(s.dataId).values,[v,x,w]=h,{batchSize:k,filterHeight:I,filterWidth:S,inChannels:T,inHeight:C,inWidth:N,outChannels:E,outHeight:R,outWidth:$,strideHeight:_,strideWidth:A}=f;p=f.dataFormat;const D=I-1-f.padInfo.top,F=S-1-f.padInfo.left,O="channelsLast"===p,L=g.strides[0],P=O?g.strides[1]:g.strides[2],M=O?g.strides[2]:1,z=O?1:g.strides[1],B=d[0],U=O?d[1]:d[2],V=O?d[2]:1,W=O?1:d[1];for(let G=0;G<k;++G)for(let t=0;t<T;++t)for(let e=0;e<C;++e){const n=e-D,r=Math.max(0,Math.ceil(n/_)),i=Math.min(R,(I+n)/_);for(let s=0;s<N;++s){const o=s-F,a=Math.max(0,Math.ceil(o/A)),u=Math.min($,(S+o)/A);let l=0;for(let e=r;e<i;++e){const r=e*_-n;for(let n=a;n<u;++n){const i=B*G+U*e+V*n,s=v*(I-1-r)+x*(S-1-(n*A-o))+w*t;for(let t=0;t<E;++t){l+=y[i+W*t]*b[s+t]}}}m[L*G+P*e+M*s+z*t]=l}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JF={kernelName:"Conv3D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:u}=r;K_([i,s],"conv3d");const l=fv(i.shape,s.shape,o,u,a),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:g,padInfo:m}=l,y=m.front,b=m.left,v=m.top,x=new by(l.outShape,i.dtype),w=n.data.get(i.dataId).values,k=n.data.get(s.dataId).values,I=x.values,S=jg(i.shape),T=jg(s.shape);for(let C=0;C<l.batchSize;++C){const t=C*S[0],e=C*x.strides[0];for(let n=0;n<l.outDepth;++n){const r=e+n*x.strides[1],i=n*l.strideDepth-y;for(let e=0;e<c;++e){const n=i+e*p;if(n<0||n>=l.inDepth)continue;const s=e*T[0],o=t+n*S[1];for(let t=0;t<l.outHeight;++t){const e=r+t*x.strides[2],n=t*l.strideHeight-v;for(let t=0;t<h;++t){const r=n+t*f;if(r<0||r>=l.inHeight)continue;const i=s+t*T[1],a=o+r*S[2];for(let t=0;t<l.outWidth;++t){const n=e+t*l.outChannels,r=t*l.strideWidth-b;for(let t=0;t<d;++t){const e=r+t*g;if(e<0||e>=l.inWidth)continue;const s=i+t*T[2],o=a+e*l.inChannels;let u=s;for(let t=0;t<l.inChannels;++t){const e=w[o+t];for(let t=0;t<l.outChannels;++t)I[n+t]+=e*k[u+t];u+=l.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZF={kernelName:"Conv3DBackpropFilterV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,filterShape:u}=r;K_([i,s],"conv3dBackpropFilterV2");const l=jg(i.shape),c=jg(s.shape),h=fv(i.shape,u,o,1,a),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,g=h.filterDepth,m=h.filterHeight,y=h.filterWidth,b=new by(h.filterShape,"float32"),v=b.values,[x,w,k,I]=b.strides,S=n.data.get(s.dataId).values,[T,C,N,E]=c,R=n.data.get(i.dataId).values,[$,_,A,D]=l,F=h.padInfo.front,O=h.padInfo.left,L=h.padInfo.top;for(let P=0;P<g;++P){const t=Math.max(0,Math.ceil((F-P)/d)),e=Math.min(h.outDepth,(h.inDepth+F-P)/d),n=P*x;for(let r=0;r<m;++r){const i=Math.max(0,Math.ceil((L-r)/p)),s=Math.min(h.outHeight,(h.inHeight+L-r)/p),o=r*w+n;for(let n=0;n<y;++n){const a=Math.max(0,Math.ceil((O-n)/f)),u=Math.min(h.outWidth,(h.inWidth+O-n)/f),l=n*k+o;for(let o=0;o<h.inChannels;++o){const c=o*I+l;for(let l=0;l<h.outChannels;++l){let g=0;for(let c=0;c<h.batchSize;++c){const h=c*$,m=c*T;for(let c=t;c<e;++c){const t=(P+c*d-F)*_+h,e=c*C+m;for(let c=i;c<s;++c){const i=(r+c*p-L)*A+t,s=c*N+e;for(let t=a;t<u;++t){const e=t*E+s;g+=R[(n+t*f-O)*D+i+o]*S[e+l]}}}}v[c+l]=g}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tO={kernelName:"Conv3DBackpropInputV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:o,strides:a,inputShape:u}=r;K_([i],"conv3dBackpropInputV2");const l=jg(i.shape),c=jg(s.shape),h=fv(u,s.shape,a,1,o),d=new by(h.inShape,"float32"),p=d.values,[f,g,m,y]=d.strides,b=n.data.get(i.dataId).values,[v,x,w,k]=l,I=n.data.get(s.dataId).values,[S,T,C,N]=c,{batchSize:E,filterDepth:R,filterHeight:$,filterWidth:_,inChannels:A,inDepth:D,inHeight:F,inWidth:O,outChannels:L,outDepth:P,outHeight:M,outWidth:z,strideDepth:B,strideHeight:U,strideWidth:V}=h,W=R-1-h.padInfo.front,G=$-1-h.padInfo.top,j=_-1-h.padInfo.left;for(let H=0;H<E;++H)for(let t=0;t<A;++t)for(let e=0;e<D;++e){const n=e-W,r=Math.max(0,Math.ceil(n/B)),i=Math.min(P,(R+n)/B);for(let s=0;s<F;++s){const o=s-G,a=Math.max(0,Math.ceil(o/U)),u=Math.min(M,($+o)/U);for(let l=0;l<O;++l){const c=l-j,h=Math.max(0,Math.ceil(c/V)),d=Math.min(z,(_+c)/V);let E=0;for(let e=r;e<i;++e){const r=e*B-n;for(let n=a;n<u;++n){const i=n*U-o;for(let s=h;s<d;++s){const o=v*H+x*e+w*n+k*s,a=S*(R-1-r)+T*($-1-i)+C*(_-1-(s*V-c))+N*t;for(let t=0;t<L;++t){E+=b[o+t]*I[a+t]}}}}p[f*H+g*e+m*s+y*l+t]=E}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},eO={kernelName:"Cos",backendName:"cpu",kernelFunc:bA("Cos",(t=>Math.cos(t)))},nO={kernelName:"Cosh",backendName:"cpu",kernelFunc:bA("Cosh",(t=>Math.cosh(t)))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rO={kernelName:"CropAndResize",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:o}=e,{cropSize:a,method:u,extrapolationValue:l}=r,[c,h,d,p]=i.shape,f=s.shape[0],[g,m]=a,y=zb([f,g,m,p],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(o.dataId).values,x=n.data.get(i.dataId).values,w=jg(i.shape),k=jg(y.shape);for(let I=0;I<f;I++){const t=4*I,e=b[t],n=b[t+1],r=b[t+2],i=b[t+3],s=v[I];if(s>=c)continue;const o=g>1?(r-e)*(h-1)/(g-1):0,a=m>1?(i-n)*(d-1)/(m-1):0;for(let c=0;c<g;c++){const t=g>1?e*(h-1)+c*o:.5*(e+r)*(h-1);if(t<0||t>h-1)for(let e=0;e<m;e++)for(let t=0;t<p;t++){const n=t+e*k[2]+c*k[1]+I*k[0];y.values[n]=l}else if("bilinear"===u){const e=Math.floor(t),r=Math.ceil(t),o=t-e;for(let t=0;t<m;t++){const u=m>1?n*(d-1)+t*a:.5*(n+i)*(d-1);if(u<0||u>d-1){for(let e=0;e<p;e++){const n=e+t*k[2]+c*k[1]+I*k[0];y.values[n]=l}continue}const h=Math.floor(u),f=Math.ceil(u),g=u-h;for(let n=0;n<p;n++){let i=n+h*w[2]+e*w[1]+s*w[0];const a=x[i];i=n+f*w[2]+e*w[1]+s*w[0];const u=x[i];i=n+h*w[2]+r*w[1]+s*w[0];const l=x[i];i=n+f*w[2]+r*w[1]+s*w[0];const d=a+(u-a)*g,p=l+(x[i]-l)*g;i=n+t*k[2]+c*k[1]+I*k[0],y.values[i]=d+(p-d)*o}}}else for(let e=0;e<m;++e){const r=m>1?n*(d-1)+e*a:.5*(n+i)*(d-1);if(r<0||r>d-1){for(let t=0;t<p;t++){const n=t+e*k[2]+c*k[1]+I*k[0];y.values[n]=l}continue}const o=Math.round(r),u=Math.round(t);for(let t=0;t<p;t++){const n=t+o*w[2]+u*w[1]+s*w[0],r=t+e*k[2]+c*k[1]+I*k[0];y.values[r]=x[n]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iO={kernelName:"Cumprod",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;K_(i,"cumprod");const u=Ix([s],i.shape.length);let l=i;null!=u&&(l=uD({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=Tx(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const h=Oy(l.dtype,"int32"),d=Kg(Ng(l.shape),h),p=n.data.get(l.dataId).values,f=l.shape[l.shape.length-1],g=a?(t,e)=>t+f-e-1:(t,e)=>t+e;for(let y=0;y<p.length;y+=f)for(let t=0;t<f;t++){const e=g(y,t);if(0===t)d[e]=o?1:p[e];else{const n=g(y,t-1);d[e]=o?p[n]*d[n]:p[e]*d[n]}}const m=n.makeTensorInfo(l.shape,h,d);if(null!=u){const t=uD({inputs:{x:m},backend:n,attrs:{perm:Sx(u)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),t}return m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sO={kernelName:"Cumsum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;K_(i,"cumsum");const u=Ix([s],i.shape.length);let l=i;null!=u&&(l=uD({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=Tx(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const h=Oy(l.dtype,"int32"),d=Xg(Ng(l.shape),h),p=n.data.get(l.dataId).values,f=l.shape[l.shape.length-1],g=a?(t,e)=>t+f-e-1:(t,e)=>t+e;for(let y=0;y<p.length;y+=f)for(let t=0;t<f;t++){const e=g(y,t);if(0===t)d[e]=o?0:p[e];else{const n=g(y,t-1);d[e]=o?p[n]+d[n]:p[e]+d[n]}}const m=n.makeTensorInfo(l.shape,h,d);if(null!=u){const t=uD({inputs:{x:m},backend:n,attrs:{perm:Sx(u)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),t}return m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oO={kernelName:"DenseBincount",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o,binaryOutput:a}=r;if(1===i.shape.length){const t=gA(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,t)}if(2===i.shape.length){const t=mA(n.bufferSync(i),n.bufferSync(s),o,a);return n.makeTensorInfo(t.shape,s.dtype,t.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aO={kernelName:"DepthToSpace",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:o}=r;Sg("NHWC"===o,(()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`));const a=i.shape[0],u=i.shape[1],l=i.shape[2],c=i.shape[3],h=u*s,d=l*s,p=c/(s*s),f=n.data.get(i.dataId).values,g=new Float32Array(a*h*d*p);let m=0;for(let y=0;y<a;++y)for(let t=0;t<h;++t){const e=Math.floor(t/s),n=t%s;for(let t=0;t<d;++t){const r=Math.floor(t/s),i=(n*s+t%s)*p;for(let t=0;t<p;++t){const n=t+i+c*(r+l*(e+u*y));g[m++]=f[n]}}}return n.makeTensorInfo([a,h,d,p],i.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uO(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=r;K_([i,s],"depthwiseConv2DNative");const c=jg(i.shape),h=jg(s.shape);let d=u;null==d&&(d=[1,1]),Sg(wv(o,d),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`));const p=pv(i.shape,s.shape,o,d,a,l,!0),{filterHeight:f,filterWidth:g,dilationHeight:m,dilationWidth:y,padInfo:b}=p,v=b.left,x=b.top,w=p.outChannels/p.inChannels,k=new by(p.outShape,i.dtype),I=n.data.get(i.dataId).values,S=n.data.get(s.dataId).values,T=k.values;for(let C=0;C<p.batchSize;++C){const t=C*c[0],e=C*k.strides[0];for(let n=0;n<p.outHeight;++n){const r=e+n*k.strides[1],i=n*p.strideHeight-x;for(let e=0;e<f;++e){const n=i+e*m;if(n<0||n>=p.inHeight)continue;const s=e*h[0],o=t+n*c[1];for(let t=0;t<p.outWidth;++t){const e=r+t*k.strides[2],n=t*p.strideWidth-v;for(let t=0;t<g;++t){const r=n+t*y;if(r<0||r>=p.inWidth)continue;const i=s+t*h[1],a=o+r*p.inChannels;let u=e,l=i;for(let t=0;t<p.inChannels;++t){const e=I[a+t];for(let t=0;t<w;++t)T[u+t]+=e*S[l+t];u+=w,l+=w}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const lO={kernelName:"DepthwiseConv2dNative",backendName:"cpu",kernelFunc:uO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cO={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=r;K_([i,s],"depthwiseConv2dNativeBackpropFilter");const h=pv(i.shape,c,o,a,u,l,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:g}=h,m=new by(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,x=n.data.get(i.dataId).values,w=new by(i.shape,i.dtype,x),k=n.data.get(s.dataId).values,I=new by(s.shape,s.dtype,k);for(let S=0;S<f;++S){const t=Math.max(0,Math.ceil((b-S)/d)),e=Math.min(h.outHeight,(h.inHeight+b-S)/d);for(let n=0;n<g;++n){const r=Math.max(0,Math.ceil((y-n)/p)),i=Math.min(h.outWidth,(h.inWidth+y-n)/p);for(let s=0;s<h.outChannels;++s){const o=Math.trunc(s/v),a=s%v;let u=0;for(let l=0;l<h.batchSize;++l)for(let a=t;a<e;++a){const t=S+a*d-b;for(let e=r;e<i;++e){const r=n+e*p-y;u+=w.get(l,t,r,o)*I.get(l,a,e,s)}}m.set(u,S,n,o,a)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hO={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=r;K_([i,s],"depthwiseConv2DNativeBackpropInput");const h=jg(i.shape),d=jg(s.shape),p=pv(c,s.shape,o,a,u,l,!0),f=new by(p.inShape,"float32"),g=f.values,[m,y,b]=f.strides,v=n.data.get(i.dataId).values,[x,w,k]=h,I=n.data.get(s.dataId).values,[S,T,C]=d,{batchSize:N,filterHeight:E,filterWidth:R,inChannels:$,inHeight:_,inWidth:A,outChannels:D,outHeight:F,outWidth:O,strideHeight:L,strideWidth:P}=p,M=E-1-p.padInfo.top,z=R-1-p.padInfo.left,B=D/$;for(let U=0;U<N;++U)for(let t=0;t<$;++t)for(let e=0;e<_;++e){const n=e-M,r=Math.max(0,Math.ceil(n/L)),i=Math.min(F,(E+n)/L);for(let s=0;s<A;++s){const o=s-z,a=Math.max(0,Math.ceil(o/P)),u=Math.min(O,(R+o)/P);let l=0;for(let e=r;e<i;++e){const r=e*L-n;for(let n=a;n<u;++n){const i=x*U+w*e+k*n,s=S*(E-1-r)+T*(R-1-(n*P-o))+C*t;for(let e=0;e<B;++e){l+=v[i+(t*B+e)]*I[s+e]}}}g[m*U+y*e+b*s+t]=l}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dO={kernelName:"Diag",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=Ng(r.shape),s=n.data.get(r.dataId).values,o=zb([i,i],r.dtype),a=o.values;for(let l=0;l<s.length;l++)a[l*i+l]=s[l];const u=[...r.shape,...r.shape];return n.makeTensorInfo(u,o.dtype,o.values)}},pO={kernelName:"Dilation2D",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i}=t,{strides:s,pad:o,dilations:a}=n,u=e,l=u.data.get(r.dataId).values,c=r.shape.length,h=u.data.get(i.dataId).values,d=i.shape.length,{batchSize:p,inHeight:f,inWidth:g,inChannels:m,outHeight:y,outWidth:b,padInfo:v,strideHeight:x,strideWidth:w,filterHeight:k,filterWidth:I,dilationHeight:S,dilationWidth:T,outShape:C}=cv(r.shape,i.shape,s,o,"NHWC",a),N=Ng(C),E=C.length,R=Pg(r.dtype,N);for(let $=0;$<p;++$)for(let t=0;t<y;++t){const e=t*x-v.top;for(let n=0;n<b;++n){const s=n*w-v.left;for(let o=0;o<m;++o){let a=Number.MIN_SAFE_INTEGER;for(let t=0;t<k;++t){const n=e+t*S;if(n>=0&&n<f)for(let e=0;e<I;++e){const u=s+e*T;if(u>=0&&u<g){const s=Jg([$,n,u,o],c,jg(r.shape)),p=Jg([t,e,o],d,jg(i.shape)),f=l[s]+h[p];f>a&&(a=f)}}}R[Jg([$,t,n,o],E,jg(C))]=a}}}return{dataId:u.write(iy(R,r.dtype),C,r.dtype),shape:C,dtype:r.dtype}}},fO={kernelName:"Dilation2DBackpropFilter",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:o,pad:a,dilations:u}=n,l=e,c=qg(r.shape,l.data.get(r.dataId).values),h=qg(i.shape,l.data.get(i.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:g,outHeight:m,outWidth:y,padInfo:b,strideHeight:v,strideWidth:x,filterHeight:w,filterWidth:k,dilationHeight:I,dilationWidth:S,outShape:T}=cv(r.shape,i.shape,o,a,"NHWC",u);Sg(s.rank===T.length,(()=>`Error in Dilation2DBackpropFilter, dy must have the same rank as output ${T.length}, but got ${s.rank}`));const C=qg(T,l.data.get(s.dataId).values),N=Yg(i.shape,i.dtype);for(let E=0;E<d;++E)for(let t=0;t<m;++t){const e=t*v-b.top;for(let n=0;n<y;++n){const r=n*x-b.left;for(let i=0;i<g;++i){let s=Number.MIN_SAFE_INTEGER,o=0,a=0;for(let t=0;t<w;++t){const n=e+t*I;if(n>=0&&n<p)for(let e=0;e<k;++e){const u=r+e*S;if(u>=0&&u<f){const r=c[E][n][u][i]+h[t][e][i];r>s&&(s=r,o=t,a=e)}}}N[o][a][i]+=C[E][t][n][i]}}}return{dataId:l.write(iy(N,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},gO={kernelName:"Dilation2DBackpropInput",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:o,pad:a,dilations:u}=n,l=e,c=qg(r.shape,l.data.get(r.dataId).values),h=qg(i.shape,l.data.get(i.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:g,outHeight:m,outWidth:y,padInfo:b,strideHeight:v,strideWidth:x,filterHeight:w,filterWidth:k,dilationHeight:I,dilationWidth:S,outShape:T}=cv(r.shape,i.shape,o,a,"NHWC",u);Sg(s.rank===T.length,(()=>`Error in Dilation2DBackpropInput, dy must have the same rank as output ${T.length}, but got ${s.rank}`));const C=qg(T,l.data.get(s.dataId).values),N=Yg(r.shape,r.dtype);for(let E=0;E<d;++E)for(let t=0;t<m;++t){const e=t*v-b.top;for(let n=0;n<y;++n){const r=n*x-b.left;for(let i=0;i<g;++i){let s=Number.MIN_SAFE_INTEGER,o=e<0?0:e,a=r<0?0:r;for(let t=0;t<w;++t){const n=e+t*I;if(n>=0&&n<p)for(let e=0;e<k;++e){const u=r+e*S;if(u>=0&&u<f){const r=c[E][n][u][i]+h[t][e][i];r>s&&(s=r,o=n,a=u)}}}N[E][o][a][i]+=C[E][t][n][i]}}}return{dataId:l.write(iy(N,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mO(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;let a;K_(i,"sum"),a="bool"===i.dtype?uA({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):rA({inputs:{x:i},backend:n});const u=a.shape.length,l=Fg(s,a.shape),c=Ix(l,u);let h=l,d=a;null!=c&&(d=uD({inputs:{x:a},backend:n,attrs:{perm:c}}),h=Tx(h.length,u)),kx("sum",h,d.shape.length);const[p,f]=xx(d.shape,h);let g=nA(n,p,Oy(d.dtype,"int32"));const m=Ng(f),y=n.data.get(g.dataId).values,b=n.data.get(d.dataId).values;for(let v=0;v<y.length;++v){const t=v*m;let e=0;for(let n=0;n<m;++n)e+=b[t+n];y[v]=e}if(o){const t=g;g=fF({inputs:{x:g},backend:n,attrs:{shape:wx(g.shape,l)}}),n.disposeIntermediateTensorInfo(t)}return n.disposeIntermediateTensorInfo(a),null!=c&&n.disposeIntermediateTensorInfo(d),g}const yO={kernelName:"Sum",backendName:"cpu",kernelFunc:mO};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bO={kernelName:"Einsum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:o,summedDims:a,idDims:u}=kS(i,s.length);SS(o.length,u,s);const{path:l,steps:c}=TS(a,u),h=c.length;let d=null,p=o.length;const f=[];for(let g=0;g<h;++g){for(const t of c[g]){const{permutationIndices:e,expandDims:r}=IS(p,u[t]);let i;CS(e)?i=s[t]:(i=uD({inputs:{x:s[t]},backend:n,attrs:{perm:e}}),f.push(i));const o=i.shape.slice();for(let t=0;t<r.length;++t)o.splice(r[t],0,1);Eg(i.shape,o)||(i=fF({inputs:{x:i},backend:n,attrs:{shape:o}}),f.push(i)),null===d?d=i:(d=eD({inputs:{a:i,b:d},backend:n}),f.push(d))}g<h-1&&(l[g]>=0&&(d=mO({inputs:{x:d},backend:n,attrs:{axis:l[g]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const g of f)g!==d&&n.disposeIntermediateTensorInfo(g);return d}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vO={kernelName:"EluGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{dy:r,y:i}=e;K_([r,i],"eluGrad");const s=new Float32Array(Ng(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values;for(let u=0;u<o.length;++u){const t=o[u];s[u]=t>=0?a[u]:a[u]*(t+1)}return n.makeTensorInfo(i.shape,"float32",s)}},xO={kernelName:"Erf",backendName:"cpu",kernelFunc:bA("Erf",(t=>{const e=Math.sign(t),n=Math.abs(t),r=1/(1+.3275911*n);return e*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))}))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function wO(t){const{inputs:e,backend:n,attrs:r}=t,{input:i}=e,{dim:s}=r,o=i.shape.length,a=i.shape.slice();let u=s;return s<0&&(Sg(-(o+1)<=s,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),u=o+s+1),a.splice(u,0,1),fF({inputs:{x:i},backend:n,attrs:{shape:a}})}const kO={kernelName:"ExpandDims",backendName:"cpu",kernelFunc:wO},IO=cA("RealDiv",Z_(((t,e)=>t/e))),SO={kernelName:"RealDiv",backendName:"cpu",kernelFunc:IO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function TO(t,e,n){const r=t.shape,i=r[0],s=r[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,l=[i,s],c=Ng(l),h=Lg("float32",c),d=Lg("float32",c);for(let m=0;m<i;m++){const t=$D({inputs:{x:a},backend:n,attrs:{begin:[m,0],size:[1,s]}}),r=$D({inputs:{x:u},backend:n,attrs:{begin:[m,0],size:[1,s]}}),i=tA({inputs:{real:t,imag:r},backend:n}),{real:o,imag:l}=CO(i,e,n),c=pS(o,l);for(let e=0;e<s;e++){const t=yS(c,e);h[m*s+e]=t.real,d[m*s+e]=t.imag}n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i)}const p=n.makeTensorInfo(l,"float32",h),f=n.makeTensorInfo(l,"float32",d),g=tA({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}function CO(t,e,n){const r=Ng(t.shape),i=n.data.get(t.dataId),s=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0==((a=r)&a-1)){const i=NO(s,o,r,e,n),a=[t.shape[0],t.shape[1]];if(e){const t=n.makeTensorInfo(a,"float32",i.real),e=n.makeTensorInfo(a,"float32",i.imag),s=n.makeTensorInfo([],"float32",ry(r,"float32")),o=rA({inputs:{x:s},backend:n}),u=SO.kernelFunc({inputs:{a:t,b:s},backend:n}),l=SO.kernelFunc({inputs:{a:e,b:o},backend:n}),c=n.data.get(u.dataId).values,h=n.data.get(l.dataId).values;return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),{real:c,imag:h}}return i}return fS(function(t,e,n){const r=new Float32Array(2*e);for(let i=0;i<e;i++){let s=0,o=0;for(let r=0;r<e;r++){const a=xS(i*r,e,n),u=yS(t,r);s+=u.real*a.real-u.imag*a.imag,o+=u.real*a.imag+u.imag*a.real}n&&(s/=e,o/=e),bS(r,s,o,i)}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(pS(s,o),r,e));var a}function NO(t,e,n,r,i){if(1===n)return{real:t,imag:e};const s=pS(t,e),o=n/2,a=gS(s),u=a.real,l=a.imag,c=[u.length],h=i.makeTensorInfo(c,"float32",u),d=i.makeTensorInfo(c,"float32",l),p=tA({inputs:{real:h,imag:d},backend:i}),f=mS(s),g=f.real,m=f.imag,y=[g.length],b=i.makeTensorInfo(y,"float32",g),v=i.makeTensorInfo(y,"float32",m),x=tA({inputs:{real:b,imag:v},backend:i}),w=NO(u,l,o,r,i),k=w.real,I=w.imag,S=[k.length],T=i.makeTensorInfo(S,"float32",k),C=i.makeTensorInfo(S,"float32",I),N=tA({inputs:{real:T,imag:C},backend:i}),E=NO(g,m,o,r,i),R=E.real,$=E.imag,_=[R.length],A=i.makeTensorInfo(_,"float32",R),D=i.makeTensorInfo(_,"float32",$),F=tA({inputs:{real:A,imag:D},backend:i}),O=vS(n,r),L=[O.real.length],P=i.makeTensorInfo(L,"float32",O.real),M=i.makeTensorInfo(L,"float32",O.imag),z=tA({inputs:{real:P,imag:M},backend:i}),B=eD({inputs:{a:z,b:F},backend:i}),U=pA({inputs:{a:N,b:B},backend:i}),V=KD({inputs:{a:N,b:B},backend:i}),W=sA({inputs:{input:U},backend:i}),G=sA({inputs:{input:V},backend:i}),j=GF({inputs:{input:U},backend:i}),H=GF({inputs:{input:V},backend:i}),q=HF({inputs:[W,G],backend:i,attrs:{axis:0}}),K=HF({inputs:[j,H],backend:i,attrs:{axis:0}}),X=i.data.get(q.dataId).values,Y=i.data.get(K.dataId).values;return i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(T),i.disposeIntermediateTensorInfo(C),i.disposeIntermediateTensorInfo(N),i.disposeIntermediateTensorInfo(A),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(P),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(K),{real:X,imag:Y}}const EO={kernelName:"FFT",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e,i=Ng(r.shape),s=r.shape[r.shape.length-1],o=fF({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),a=TO(o,!1,n),u=fF({inputs:{x:a},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RO(t){const{backend:e,attrs:n}=t,{shape:r,value:i,dtype:s}=n,o=s||Vg(i),a=Pg(o,Ng(r));return function(t,e,n){t.fill(e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(a,i),e.makeTensorInfo(r,o,a)}const $O={kernelName:"Fill",backendName:"cpu",kernelFunc:RO};const _O={kernelName:"FlipLeftRight",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,i=n,s=Lg(r.dtype,Ng(r.shape)),[o,a,u,l]=r.shape,c=i.data.get(r.dataId).values;for(let h=0;h<o;h++){const t=h*u*a*l;for(let e=0;e<a;e++){const n=e*(u*l);for(let e=0;e<u;e++){const r=e*l;for(let i=0;i<l;i++){const o=Math.round(u-e-1),a=t+n+r+i;let h=c[a];if(o>=0&&o<u){h=c[t+n+o*l+i]}s[a]=h}}}}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AO={kernelName:"FusedConv2D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let g=KF({inputs:{x:i,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const t=g;if("NCHW"===c&&1===o.shape.length&&1!==o.shape[0]){const t=fF({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});g=pA({inputs:{a:g,b:t},backend:n}),n.disposeIntermediateTensorInfo(t)}else g=pA({inputs:{a:g,b:o},backend:n});n.disposeIntermediateTensorInfo(t)}if(p){const t=g;if("NCHW"===c&&"prelu"===p&&1===a.shape.length&&1!==a.shape[0]){const t=fF({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});g=pF(n,g,p,t,f),n.disposeIntermediateTensorInfo(t)}else g=pF(n,g,p,a,f);n.disposeIntermediateTensorInfo(t)}return g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DO={kernelName:"FusedDepthwiseConv2D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let g=uO({inputs:{x:i,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const t=g;g=pA({inputs:{a:g,b:o},backend:n}),n.disposeIntermediateTensorInfo(t)}if(p){const t=g;g=pF(n,g,p,a,f),n.disposeIntermediateTensorInfo(t)}return g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FO={kernelName:"GatherNd",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=Ng(r.shape),o=i.shape,a=o[o.length-1],[u,l,c,h]=_I(r,i);if(0===l)return n.makeTensorInfo(u,r.dtype,[]);const d=OA(n.data.get(i.dataId).values,n.bufferSync(r),r.dtype,l,a,c,h,r.shape,s);return n.makeTensorInfo(u,r.dtype,d.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OO={kernelName:"GatherV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:o,batchDims:a}=r;K_([i,s],"gatherV2");const u=Fg(o,i.shape)[0],l=n.data.get(s.dataId).values,c=i.shape[u];for(let v=0;v<l.length;++v){const t=l[v];Sg(t<=c-1&&t>=0,(()=>`GatherV2: the index value ${t} is not in [0, ${c-1}]`))}let h=a;null==a&&(h=0);const d=Ng(s.shape),p=WS(i,s,u,h),f=fF({inputs:{x:i},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=fF({inputs:{x:s},backend:n,attrs:{shape:[p.batchSize,d/p.batchSize]}}),m=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize],y=n.bufferSync(g),b=LA(n.bufferSync(f),y,m);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(p.outputShape,b.dtype,b.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LO={kernelName:"IFFT",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e,i=Ng(r.shape),s=r.shape[r.shape.length-1],o=fF({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),a=TO(o,!0,n),u=fF({inputs:{x:a},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}},PO={kernelName:"IsFinite",backendName:"cpu",kernelFunc:bA("IsFinite",(t=>Number.isFinite(t)?1:0),"bool")},MO={kernelName:"IsInf",backendName:"cpu",kernelFunc:bA("IsInf",(t=>Math.abs(t)===1/0?1:0),"bool")},zO={kernelName:"IsNan",backendName:"cpu",kernelFunc:bA("IsNan",(t=>Number.isNaN(t)?1:0),"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BO={kernelName:"LinSpace",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,o=jA(r,i,s);return e.makeTensorInfo([o.length],"float32",o)}},UO={kernelName:"Log1p",backendName:"cpu",kernelFunc:bA("Log1p",(t=>Math.log1p(t)))},VO={kernelName:"LogicalAnd",backendName:"cpu",kernelFunc:cA("LogicalAnd",Z_(((t,e)=>t&&e)),null,"bool")},WO={kernelName:"LogicalNot",backendName:"cpu",kernelFunc:bA("LogicalNot",(t=>t?0:1),"bool")},GO={kernelName:"LogicalOr",backendName:"cpu",kernelFunc:cA("LogicalOr",Z_(((t,e)=>t||e)),null,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jO={kernelName:"LRN",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:o,alpha:a,beta:u}=r;K_(i,"LRN");const l=i.shape[3],c=l-1,h=n.data.get(i.dataId).values,d=Ng(i.shape),p=new Float32Array(d);function f(t){const e=t%l;let n=t-e+Math.max(0,e-s);const r=t-e+Math.min(e+s,c);let i=0;for(;n<=r;n++){const t=h[n];i+=t*t}return i}for(let g=0;g<d;g++){const t=f(g),e=h[g]*Math.pow(o+a*t,-u);p[g]=e}return n.makeTensorInfo(i.shape,i.dtype,p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HO={kernelName:"LRNGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:o}=e,{depthRadius:a,bias:u,alpha:l,beta:c}=r;K_(o,"LRNGrad");const h=Ng(o.shape),d=o.shape[3],p=n.data.get(o.dataId).values,f=n.data.get(i.dataId).values,g=n.data.get(s.dataId).values,m=new Float32Array(h),y=h;for(let b=0;b<y;b++){const t=b%d,e=b-t+Math.max(0,t-a),n=b-t+Math.min(d,t+a+1);let r=0;for(let i=e;i<n;i++)r+=Math.pow(f[i],2);r=l*r+u;for(let i=e;i<n;i++){let t=-2*l*c*f[i]*g[b]/r;b===i&&(t+=Math.pow(r,-c)),t*=p[b],m[i]+=t}}return n.makeTensorInfo(o.shape,i.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qO(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:o}=r,a=n;let u=i.shape;const l=u.length,c=Fg(s,u);let h=c;const d=Ix(h,l);let p=a.data.get(i.dataId).values;if(null!=d){const t=new Array(l);for(let e=0;e<t.length;e++)t[e]=u[d[e]];p=aD(p,u,i.dtype,d,t),h=Tx(h.length,l),u=t}K_(i,"max"),kx("max",h,l);const[f,g]=xx(u,h),m=KA(p,Ng(g),f,i.dtype),y=a.write(m,f,i.dtype);let b=f;if(o){b=wx(f,c)}return{dataId:y,shape:b,dtype:i.dtype}}const KO={kernelName:"Max",backendName:"cpu",kernelFunc:qO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XO={kernelName:"MaxPool",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;K_(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r;Sg(wv(o,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const l=hv(i.shape,s,o,1,a,u);let c;if(1===l.filterWidth&&1===l.filterHeight&&Eg(l.inShape,l.outShape))c=rA({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=jg(i.shape),r=_F(t,i.shape,i.dtype,e,l,"max");c=n.makeTensorInfo(l.outShape,i.dtype,r.values)}return c}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YO={kernelName:"MaxPool3D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r;K_(i,"maxPool3d");const c=dv(i.shape,s,o,1,a,u,l),h=DF(n.data.get(i.dataId).values,i.shape,i.dtype,jg(i.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QO={kernelName:"MaxPool3DGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=r;K_([i,s],"maxPool3DGrad");const c=dv(s.shape,o,a,1,u,l),h=function(t,e){const n=zb(e.outShape,"int32"),r=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let m=0;m<e.inChannels;++m)for(let y=0;y<e.outDepth;++y){const b=y*r-d;let v=b;for(;v<0;)v+=o;const x=Math.min(e.inDepth,l+b);for(let r=0;r<e.outHeight;++r){const l=r*i-p;let d=l;for(;d<0;)d+=a;const w=Math.min(e.inHeight,c+l);for(let i=0;i<e.outWidth;++i){const p=i*s-f;let k=p;for(;k<0;)k+=u;const I=Math.min(e.inWidth,h+p);let S=Number.NEGATIVE_INFINITY,T=-1;for(let e=v;e<x;e+=o){const n=e-b;for(let r=d;r<w;r+=a){const i=r-l;for(let s=k;s<I;s+=u){const o=s-p,a=t.get(g,e,r,s,m);a>=S&&(S=a,T=n*c*h+i*c+o)}}}n.set(T,g,y,r,i,m)}}}return n}(n.bufferSync(s),c),d=c.strideDepth,p=c.strideHeight,f=c.strideWidth,g=c.dilationDepth,m=c.dilationHeight,y=c.dilationWidth,b=c.effectiveFilterDepth,v=c.effectiveFilterHeight,x=c.effectiveFilterWidth,w=b-1-c.padInfo.front,k=x-1-c.padInfo.left,I=v-1-c.padInfo.top,S=zb(s.shape,"float32"),T=n.bufferSync(i);for(let C=0;C<c.batchSize;++C)for(let t=0;t<c.inChannels;++t)for(let e=0;e<c.inDepth;++e)for(let n=0;n<c.inHeight;++n)for(let r=0;r<c.inWidth;++r){const i=e-w,s=n-I,o=r-k;let a=0;for(let e=0;e<b;e+=g){const n=(i+e)/d;if(!(n<0||n>=c.outDepth||Math.floor(n)!==n))for(let r=0;r<v;r+=m){const i=(s+r)/p;if(!(i<0||i>=c.outHeight||Math.floor(i)!==i))for(let s=0;s<x;s+=y){const u=(o+s)/f;if(u<0||u>=c.outWidth||Math.floor(u)!==u)continue;const l=b*v*x-1-h.get(C,n,i,u,t)===e*v*x+r*x+s?1:0;if(0===l)continue;a+=T.get(C,n,i,u,t)*l}}}S.set(a,C,e,n,r,t)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JO={kernelName:"MaxPoolGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:o}=e,a=s;K_([s,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:h}=r,d=hv(a.shape,u,l,1,c,h),p=n.data.get(a.dataId).values,f=zb(d.outShape,a.dtype,AF(p,a.shape,a.dtype,d).values),g=d.strideHeight,m=d.strideWidth,y=d.dilationHeight,b=d.dilationWidth,v=d.effectiveFilterHeight,x=d.effectiveFilterWidth,w=x-1-d.padInfo.left,k=v-1-d.padInfo.top,I=zb(a.shape,"float32"),S=n.data.get(i.dataId).values,T=zb(i.shape,"float32",S);for(let C=0;C<d.batchSize;++C)for(let t=0;t<d.inChannels;++t)for(let e=0;e<d.inHeight;++e)for(let n=0;n<d.inWidth;++n){const r=e-k,i=n-w;let s=0;for(let e=0;e<v;e+=y){const n=(r+e)/g;if(!(n<0||n>=d.outHeight||Math.floor(n)!==n))for(let r=0;r<x;r+=b){const o=(i+r)/m;if(o<0||o>=d.outWidth||Math.floor(o)!==o)continue;const a=v*x-1-f.get(C,n,o,t)===e*x+r?1:0;if(0===a)continue;s+=T.get(C,n,o,t)*a}}I.set(s,C,e,n,t)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const ZO={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=e,u=n;K_(r,"MaxPoolWithArgmax");const l=u.data.get(r.dataId).values,c=hv(r.shape,i,s,[1,1],o),[h,d]=function(t,e,n,r,i){const s=_F(t,0,n,jg(e),i,"max"),o=AF(t,e,n,i,!0,r);return[s.values,o.values]}(l,r.shape,r.dtype,a,c),p=u.write(h,c.outShape,r.dtype),f=u.write(d,c.outShape,r.dtype);return[{dataId:p,shape:c.outShape,dtype:r.dtype},{dataId:f,shape:c.outShape,dtype:"int32"}]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tL={kernelName:"Mean",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=Fg(s,i.shape),u=Ng(xx(i.shape,a)[1]),l=[],c=n.makeTensorInfo([],"float32",new Float32Array([u]));l.push(c);const h=uA({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});l.push(h);const d=IO({inputs:{a:h,b:c},backend:n});l.push(d);const p=mO({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:o}});return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eL={kernelName:"Min",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;K_(i,"min");const a=Fg(s,i.shape);let u=a;const l=Ix(u,i.shape.length);let c=i;null!=l&&(c=uD({inputs:{x:i},backend:n,attrs:{perm:l}}),u=Tx(u.length,i.shape.length)),kx("min",u,c.shape.length);const[h,d]=xx(c.shape,u),p=Ng(d),f=Xg(Ng(h),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const t=y*p;let e=g[t];for(let n=0;n<p;++n){const r=g[t+n];(Number.isNaN(r)||r<e)&&(e=r)}f[y]=e}null!=l&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(h,c.dtype,f);if(o){const t=fF({inputs:{x:m},backend:n,attrs:{shape:wx(h,a)}});return n.disposeIntermediateTensorInfo(m),t}return m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nL={kernelName:"MirrorPad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,mode:o}=r;K_(i,"mirrorPad");const a=s.map(((t,e)=>t[0]+i.shape[e]+t[1])),u=s.map((t=>t[0])),l=s.map(((t,e)=>t[0]+i.shape[e])),c="reflect"===o?0:1,h=n.data.get(i.dataId).values,d=i.shape.length,p=jg(i.shape),f=Ng(a),g=a.length,m=jg(a),y=Lg(i.dtype,f);for(let b=0;b<f;b++){let t=Zg(b,g,m);for(let n=0;n<g;n++)t[n]<u[n]?t[n]=2*u[n]-t[n]-c:t[n]>=l[n]&&(t[n]=2*(l[n]-1)-t[n]+c);t=t.map(((t,e)=>t-u[e]));const e=Jg(t,d,p);y[b]=h[e]}return{dataId:n.write(y,a,i.dtype),shape:a,dtype:i.dtype}}},rL={kernelName:"Mod",backendName:"cpu",kernelFunc:cA("Mod",Z_(((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function iL(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,o=i.shape.length;let a=s;if(-1===a&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const u=Fg([a],i.shape),l=qO({inputs:{x:i},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),c=wx(l.shape,u),h=fF({inputs:{x:l},backend:n,attrs:{shape:c}}),d=KD({inputs:{a:i,b:h},backend:n}),p=NA({inputs:{x:d},backend:n}),f=mO({inputs:{x:p},backend:n,attrs:{axis:u,keepDims:!1}}),g=fF({inputs:{x:f},backend:n,attrs:{shape:c}}),m=IO({inputs:{a:p,b:g},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}const sL={kernelName:"Softmax",backendName:"cpu",kernelFunc:iL};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oL={kernelName:"Multinomial",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:o,normalized:a}=r;K_(i,"multinomial");const u=a?i:iL({inputs:{logits:i},backend:n,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],h=n.data.get(u.dataId).values,d=[l,s],p=Xg(Ng(d),"int32");for(let f=0;f<l;++f){const t=f*c,e=new Float32Array(c-1);e[0]=h[t];for(let i=1;i<e.length;++i)e[i]=e[i-1]+h[t+i];const n=Mw.alea(o.toString()),r=f*s;for(let i=0;i<s;++i){const t=n();p[r+i]=e.length;for(let n=0;n<e.length;n++)if(t<e[n]){p[r+i]=n;break}}}return a||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(d,"int32",p)}},aL=qk;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uL={kernelName:"NonMaxSuppressionV3",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=r;K_(i,"NonMaxSuppression");const l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,{selectedIndices:h}=aL(l,c,o,a,u);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},lL=Kk;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cL={kernelName:"NonMaxSuppressionV4",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=r;K_(i,"NonMaxSuppressionPadded");const c=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,{selectedIndices:d,validOutputs:p}=lL(c,h,o,a,u,l);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},hL=Xk;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dL={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=r;K_(i,"NonMaxSuppressionWithScore");const c=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,d=o,p=a,f=u,g=l,{selectedIndices:m,selectedScores:y}=hL(c,h,d,p,f,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pL={kernelName:"OneHot",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{dtype:s,depth:o,onValue:a,offValue:u}=r;K_(i,"oneHot");const l=Ng(i.shape),c=new Float32Array(l*o);c.fill(u);const h=n.data.get(i.dataId).values;for(let d=0;d<l;++d)h[d]>=0&&h[d]<o&&(c[d*o+h[d]]=a);return n.makeTensorInfo([...i.shape,o],s,c)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(t){const{inputs:e,backend:n}=t,{x:r}=e;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const t=sA({inputs:{input:r},backend:n}),e=fL({inputs:{x:t},backend:n}),i=GF({inputs:{input:r},backend:n}),s=fL({inputs:{x:i},backend:n}),o=tA({inputs:{real:e,imag:s},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),o}return RO({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const gL={kernelName:"ZerosLike",backendName:"cpu",kernelFunc:fL};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mL={kernelName:"OnesLike",backendName:"cpu",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===i.dtype){const e=sA({inputs:{input:i},backend:r}),n=t({inputs:{x:e},backend:r}),s=GF({inputs:{input:i},backend:r}),o=fL({inputs:{x:s},backend:r}),a=tA({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}return RO({backend:r,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yL(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(1===e.length)return wO({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,o=e[0].dtype;e.forEach((t=>{Tg(s,t.shape,"All tensors passed to stack must have matching shapes"),Sg(o===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],u=HF({inputs:e.map((t=>{const e=wO({inputs:{input:t},backend:n,attrs:{dim:i}});return a.push(e),e})),backend:n,attrs:{axis:i}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}const bL={kernelName:"Pack",backendName:"cpu",kernelFunc:yL};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vL={kernelName:"PadV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:o}=r;K_(i,"pad");const a=s.map(((t,e)=>t[0]+i.shape[e]+t[1])),u=s.map((t=>t[0])),l=n.data.get(i.dataId).values,c=Ng(i.shape),h=i.shape.length,d=jg(i.shape),p=Ng(a),f=a.length,g=jg(a),m=Lg(i.dtype,p);0!==o&&m.fill(o);for(let y=0;y<c;y++){m[Jg(Zg(y,h,d).map(((t,e)=>t+u[e])),f,g)]=l[y]}return{dataId:n.write(m,a,i.dtype),shape:a,dtype:i.dtype}}},xL={kernelName:"Pow",backendName:"cpu",kernelFunc:cA("Pow",Z_(((t,e)=>Math.pow(t,e))))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wL={kernelName:"RaggedGather",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=e,a=i.map((t=>n.data.get(t.dataId).values)),u=i.map((t=>t.shape)),l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values,[h,d,p]=gD(a,u,l,s.shape,s.dtype,c,o.shape),f=h.map((t=>n.makeTensorInfo([t.length],"int32",t))),g=n.makeTensorInfo(p,s.dtype,d);return f.concat([g])}};
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kL={kernelName:"RaggedRange",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{starts:r,limits:i,deltas:s}=e,o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=mD(o,r.shape,r.dtype,a,i.shape,u,s.shape);return[n.makeTensorInfo([l.length],"int32",l),n.makeTensorInfo([c.length],r.dtype,c)]}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IL={kernelName:"RaggedTensorToTensor",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:u}=r,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,h=n.data.get(o.dataId).values,d=a.map((t=>n.data.get(t.dataId).values)),p=a.map((t=>t.shape)),[f,g]=wD(l,i.shape,c,s.shape,s.dtype,h,o.shape,d,p,u);return n.makeTensorInfo(f,s.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SL={kernelName:"Range",backendName:"cpu",kernelFunc:function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,dtype:s,step:o}=n,a=kD(r,i,o,s);return e.makeTensorInfo([a.length],s,a)}},TL={kernelName:"Reciprocal",backendName:"cpu",kernelFunc:bA("Reciprocal",(t=>1/t))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CL={kernelName:"ResizeBilinear",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r;K_(i,"resizeBilinear");const u=jg(i.shape),[l,c]=a,[h,d,p,f]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(Ng([h,l,c,f])),y=[s&&l>1?d-1:d,s&&c>1?p-1:p],b=[s&&l>1?l-1:l,s&&c>1?c-1:c];let v=0;const x=y[0]/b[0],w=y[1]/b[1];for(let k=0;k<h;k++)for(let t=0;t<l;t++){let e;e=o?x*(t+.5)-.5:x*t;const n=Math.max(0,Math.floor(e)),r=e-n,i=Math.min(d-1,Math.ceil(e)),s=k*u[0]+n*u[1],a=k*u[0]+i*u[1];for(let t=0;t<c;t++){let e;e=o?w*(t+.5)-.5:w*t;const n=Math.max(0,Math.floor(e)),i=e-n,l=Math.min(p-1,Math.ceil(e)),c=s+n*u[2],h=a+n*u[2],d=s+l*u[2],y=a+l*u[2];for(let t=0;t<f;t++){const e=g[c+t],n=g[h+t],s=e+(g[d+t]-e)*i,o=s+(n+(g[y+t]-n)*i-s)*r;m[v++]=o}}}return n.makeTensorInfo([h,l,c,f],"float32",m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NL={kernelName:"ResizeBilinearGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r;K_([s,i],"resizeBilinearGrad");const a=jg(i.shape),[u,l,c,h]=i.shape,[,d,p]=s.shape,f=new Float32Array(u*l*c*h),g=[o&&d>1?l-1:l,o&&p>1?c-1:c],m=[o&&d>1?d-1:d,o&&p>1?p-1:p],y=g[0]/m[0],b=g[1]/m[1],v=n.data.get(s.dataId).values;let x=0;for(let w=0;w<u;w++){const t=w*a[0];for(let e=0;e<d;e++){const n=e*y,r=Math.floor(n),i=Math.min(Math.ceil(n),l-1),s=t+r*a[1],o=t+i*a[1],u=n-r,d=1-u;for(let t=0;t<p;t++){const e=t*b,n=Math.floor(e),r=Math.min(Math.ceil(e),c-1),i=e-n,l=1-i,p=s+n*a[2],g=s+r*a[2],m=o+n*a[2],y=o+r*a[2],w=d*l,k=d*i,I=u*l,S=u*i;for(let t=0;t<h;t++){const e=v[x++];f[p+t]+=e*w,f[g+t]+=e*k,f[m+t]+=e*I,f[y+t]+=e*S}}}}return n.makeTensorInfo([u,c,l,h],"float32",f)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EL={kernelName:"ResizeNearestNeighbor",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r;K_(i,"resizeNearestNeighbor");const u=jg(i.shape),[l,c]=a,[h,d,p,f]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(h*l*c*f),y=[s&&l>1?d-1:d,s&&c>1?p-1:p],b=[s&&l>1?l-1:l,s&&c>1?c-1:c],v=y[0]/b[0],x=y[1]/b[1];let w=0;for(let k=0;k<h;k++){const t=k*u[0];for(let e=0;e<l;e++){const n=o?v*(e+.5):v*e;let r=Math.min(d-1,s?Math.round(n):Math.floor(n));o&&(r=Math.max(0,r));const i=t+r*u[1];for(let t=0;t<c;t++){const e=o?x*(t+.5):x*t;let n=Math.min(p-1,s?Math.round(e):Math.floor(e));o&&(n=Math.max(0,n));const r=i+n*u[2];for(let t=0;t<f;t++){const e=g[r+t];m[w++]=e}}}}return n.makeTensorInfo([h,l,c,f],i.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RL={kernelName:"ResizeNearestNeighborGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r;K_([s,i],"resizeNearestNeighborGrad");const a=jg(i.shape),u=jg(s.shape),[l,c,h,d]=i.shape,[,p,f]=s.shape,g=new Float32Array(l*c*h*d),m=n.data.get(s.dataId).values,y=[o&&p>1?c-1:c,o&&f>1?h-1:h],b=[o&&p>1?p-1:p,o&&f>1?f-1:f],v=y[0]/b[0],x=y[1]/b[1],w=1/v,k=1/x,I=2*Math.ceil(w)+2,S=2*Math.ceil(k)+2;for(let T=0;T<l;T++){const t=T*a[0];for(let e=0;e<c;e++){const n=t+e*a[1],r=Math.floor(e*w),i=Math.floor(r-I/2);for(let s=0;s<h;s++){const r=n+s*a[2],l=Math.floor(s*k),y=Math.floor(l-S/2);for(let n=0;n<d;n++){let a=0;for(let r=0;r<I;r++){const l=r+i;if(l<0||l>=p)continue;const d=t+l*u[1],g=l*v;if(e===Math.min(c-1,o?Math.round(g):Math.floor(g)))for(let t=0;t<S;t++){const e=t+y;if(e<0||e>=f)continue;const r=d+e*u[2],i=e*x;s===Math.min(h-1,o?Math.round(i):Math.floor(i))&&(a+=m[r+n])}}g[r+n]=a}}}}return n.makeTensorInfo(i.shape,i.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $L={kernelName:"Reverse",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r;K_(i,"reverse");const o=i.shape.length,a=Fg(s,i.shape);if(0===o)return rA({inputs:{x:i},backend:n});const u=new by(i.shape,i.dtype),l=n.bufferSync(i);for(let c=0;c<u.size;c++){const t=u.indexToLoc(c),e=t.slice();a.forEach((t=>e[t]=i.shape[t]-1-e[t])),u.set(l.get(...e),...t)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}},_L={kernelName:"RotateWithOffset",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:o}=e,a=n,u=Lg(r.dtype,Ng(r.shape)),[l,c,h,d]=r.shape,[p,f]=oS(o,c,h),g=Math.sin(i),m=Math.cos(i),y=a.data.get(r.dataId).values;for(let b=0;b<l;b++){const t=b*h*c*d;for(let e=0;e<c;e++){const n=e*(h*d);for(let r=0;r<h;r++){const i=r*d;for(let o=0;o<d;o++){const a=[l,e,r,o],b=a[2],v=a[1];let x=(b-p)*m-(v-f)*g,w=(b-p)*g+(v-f)*m;x=Math.round(x+p),w=Math.round(w+f);let k=s;if("number"!=typeof s&&(k=3===o?255:s[o]),x>=0&&x<h&&w>=0&&w<c){k=y[t+w*(h*d)+x*d+o]}u[t+n+i+o]=k}}}}return{dataId:a.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},AL={kernelName:"Round",backendName:"cpu",kernelFunc:bA("Round",(t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2==0?e:e+1}))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DL={kernelName:"ScatterNd",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:o}=r,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:h}=wk(0,i,o),d=TD(n.bufferSync(i),n.bufferSync(s),o,h,l,u,a,c,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FL(t,e){let n=0,r=t.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),t[i]<e?n=i+1:r=i;return r}function OL(t,e){let n=0,r=t.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),t[i]<=e?n=i+1:r=i;return r}const LL={kernelName:"SearchSorted",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:i,values:s}=e,{side:o}=r,a=function(t,e,n,r,i,s){const o=Pg("int32",n*i);for(let a=0;a<n;++a){const n=t.slice(a*r,(a+1)*r),u=a*i;for(let t=0;t<i;++t)o[u+t]="left"===s?FL(n,e[t+u]):OL(n,e[t+u])}return o}(n.data.get(i.dataId).values,n.data.get(s.dataId).values,i.shape[0],i.shape[1],s.shape[1],o);return n.makeTensorInfo(s.shape,"int32",a)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PL={kernelName:"Select",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e;K_([r,i,s],"select");const o=r.shape.length,a=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=Oy(i.dtype,s.dtype),h=Xg(Ng(i.shape),c);let d=0;const p=0===o||o>1||1===i.shape.length?1:Ng(i.shape.slice(1));for(let f=0;f<a.length;f++)for(let t=0;t<p;t++)1===a[f]?h[d++]=u[f]:h[d++]=l[f];return n.makeTensorInfo(i.shape,c,h)}},ML={kernelName:"Selu",backendName:"cpu",kernelFunc:bA("Selu",(t=>t>=0?1.0507009873554805*t:1.7580993408473768*(Math.exp(t)-1)))},zL={kernelName:"Sign",backendName:"cpu",kernelFunc:bA("Sign",(t=>t<0?-1:t>0?1:0))},BL={kernelName:"Sin",backendName:"cpu",kernelFunc:bA("Sin",(t=>Math.sin(t)))},UL={kernelName:"Sinh",backendName:"cpu",kernelFunc:bA("Sinh",(t=>Math.sinh(t)))},VL=Math.log(1.1920928955078125e-7)+2,WL={kernelName:"Softplus",backendName:"cpu",kernelFunc:bA("Softplus",(t=>{const e=t>-VL,n=t<VL,r=Math.exp(t);let i;return i=n?r:e?t:Math.log(1+r),i}))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GL={kernelName:"SpaceToBatchND",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:o}=r;K_([i],"spaceToBatchND");const a=Ng(s),u=[[0,0]];u.push(...o);for(let m=1+s.length;m<i.shape.length;++m)u.push([0,0]);const l=vL.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),c=aS(l.shape,s,a,!1),h=uS(c.length,s.length,!1),d=lS(l.shape,s,a,!1),p=fF({inputs:{x:l},backend:n,attrs:{shape:c}}),f=uD({inputs:{x:p},backend:n,attrs:{perm:h}}),g=fF({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jL={kernelName:"SparseFillEmptyRows",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:o}=e;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n        ${s.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n        ${i.shape}`);if(0!==o.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${o.shape}`);const a=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values[0],[h,d,p,f,g]=AD(a,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HL={kernelName:"SparseReshape",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${i.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.data.get(i.dataId).values),a=n.data.get(r.dataId).values,u=Array.from(n.data.get(s.dataId).values),[l,c,h]=DD(a,r.shape,r.dtype,o,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qL={kernelName:"SparseSegmentMean",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n          ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n          ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=FD(o,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(c,r.dtype,l)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KL={kernelName:"SparseSegmentSum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n         ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n         ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=FD(o,r.shape,r.dtype,a,u);return n.makeTensorInfo(c,r.dtype,l)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XL={kernelName:"SparseToDense",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=wk(0,i,a),p=!1,f=n.bufferSync(i);let g;switch(s.dtype){case"bool":g=TD(f,n.bufferSync(s),a,d,c,l,u,h,Boolean(n.data.get(o.dataId).values[0]),p);break;case"float32":g=TD(f,n.bufferSync(s),a,d,c,l,u,h,n.data.get(o.dataId).values[0],p);break;case"int32":g=TD(f,n.bufferSync(s),a,d,c,l,u,h,n.data.get(o.dataId).values[0],p);break;case"string":g=TD(f,n.bufferSync(s),a,d,c,l,u,h,ay(n.data.get(o.dataId).values[0]),p);break;default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(a,g.dtype,g.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YL={kernelName:"SplitV",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:o}=r,a=Fg(o,i.shape)[0],u=ES(i,s,a),l=new Array(i.shape.length).fill(0),c=i.shape.slice();return u.map((t=>{const e=[...c];e[a]=t;const r=$D({inputs:{x:i},backend:n,attrs:{begin:l,size:e}});return l[a]+=t,r}))}},QL={kernelName:"Square",backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,r=e;K_(n,"square");const i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let o=0;o<i.length;++o){const t=i[o];s[o]=t*t}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},JL={kernelName:"Step",backendName:"cpu",kernelFunc:bA("Step",((t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}))};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZL={kernelName:"StridedSlice",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=r;K_(i,"stridedSlice");const{finalShapeSparse:p,finalShape:f,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:b,end:v,strides:x}=jI(i.shape,s,o,a,u,l,c,h,d);let w;if(g)w=fF({inputs:{x:i},backend:n,attrs:{shape:f}});else if(m||y){Sg(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const t=DI(b,v,x),e=$D({inputs:{x:i},backend:n,attrs:{begin:b,size:t}});w=fF({inputs:{x:e},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(e)}else{const t=UD(p,n.bufferSync(i),x,b);w=n.makeTensorInfo(f,t.dtype,t.values)}return w}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tP={kernelName:"StringNGrams",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:h}=e,d=n.data.get(c.dataId).values,p=n.data.get(h.dataId).values,[f,g]=WD(d,p,i,s,o,a,u,l);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eP={kernelName:"StringSplit",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:o}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==o.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values[0],[l,c,h]=jD(a,u,i),d=c.length;return[n.makeTensorInfo([d,2],"int32",l),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nP={kernelName:"StringToHashBucketFast",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=HD(n.data.get(s.dataId).values,i);return n.makeTensorInfo(s.shape,"int32",o)}},rP={kernelName:"Tan",backendName:"cpu",kernelFunc:bA("Tan",(t=>Math.tan(t)))},iP=bA("Tanh",(t=>Math.tanh(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sP(t,e,n){switch(n){case"reflect":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=2*e;n<t&&(n=t*Math.trunc(-n/t)+n),n=n<-e?n+t:-n-1}else if(n>e-1)if(e<=1)n=0;else{const t=2*e;n-=t*Math.trunc(n/t),n>=e&&(n=t-n-1)}return wg(0,n,e-1)}(t,e);case"wrap":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=e-1;n+=e*(Math.trunc(-n/t)+1)}else if(n>e-1)if(e<=1)n=0;else{const t=e-1;n-=e*Math.trunc(n/t)}return wg(0,n,e-1)}(t,e);case"nearest":return function(t,e){return wg(0,t,e-1)}(t,e);case"constant":default:return function(t,e){return t}(t)}}function oP(t,e,n,r,i,s,o,a,u,l,c){return 0<=a&&a<e&&0<=u&&u<n?t[o*r+a*i+u*s+l]:c}function aP(t,e,n,r,i,s,o,a,u,l,c){return oP(t,e,n,r,i,s,o,Math.round(a),Math.round(u),l,c)}function uP(t,e,n,r,i,s,o,a,u,l,c){const h=Math.floor(a),d=Math.floor(u),p=h+1,f=d+1;return(p-a)*((f-u)*oP(t,e,n,r,i,s,o,h,d,l,c)+(u-d)*oP(t,e,n,r,i,s,o,h,f,l,c))+(a-h)*((f-u)*oP(t,e,n,r,i,s,o,p,d,l,c)+(u-d)*oP(t,e,n,r,i,s,o,p,f,l,c))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lP=[bF,J_,vF,xF,fA,wF,kF,IF,SF,TF,CF,NF,EF,RF,$F,FF,OF,LF,PF,yF,MF,zF,BF,UF,lA,wA,VF,eA,WF,qF,XF,YF,QF,JF,ZF,tO,eO,nO,rO,iO,sO,oO,aO,lO,cO,hO,dO,pO,fO,gO,bO,rF,vO,TA,xO,EA,kO,$A,EO,$O,_O,AA,FA,AO,DO,FO,OO,MA,BA,iA,LO,jF,PO,MO,zO,sF,VA,GA,BO,qA,UO,VO,WO,GO,jO,HO,KO,YA,XO,YO,QO,JO,ZO,tL,eL,JA,nL,rL,oL,nD,iD,uL,cL,dL,oD,pL,mL,bL,vL,xL,uF,hD,wL,kL,IL,SL,oA,SO,TL,cF,dF,gF,CL,NL,EL,RL,$L,_L,AL,SD,DL,LL,PL,ML,ED,zL,BL,UL,_D,sL,WL,GL,jL,HL,qL,KL,XL,YL,LD,QL,MD,BD,JL,ZL,tP,eP,nP,XD,yO,rP,{kernelName:"Tanh",backendName:"cpu",kernelFunc:iP},{kernelName:"TensorScatterUpdate",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{tensor:r,indices:i,updates:s}=e,{sliceRank:o,numUpdates:a,sliceSize:u,strides:l,outputSize:c}=wk(0,i,r.shape),h=n.bufferSync(i),d=n.bufferSync(s),p=n.bufferSync(r),f=TD(h,d,r.shape,c,u,a,o,l,p,!1);return n.makeTensorInfo(r.shape,f.dtype,f.values)}},{kernelName:"Tile",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;K_(i,"tile");const o=YD(n.bufferSync(i),s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},{kernelName:"TopK",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:o}=r;K_(i,"topk");const a=n.data.get(i.dataId).values,[u,l]=ZD(a,i.shape,i.dtype,s,o);return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},{kernelName:"Transform",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,attrs:n,backend:r}=t,{image:i,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=n,[c,h,d,p]=i.shape,[f,g]=null!=l?l:[h,d],m=[c,f,g,p],y=jg(i.shape),b=y[0],v=y[1],x=y[2],w=jg(m),k=w[0],I=w[1],S=w[2],T=Lg(i.dtype,Ng(m));T.fill(u);const C=r.data.get(i.dataId).values,N=r.data.get(s.dataId).values;for(let E=0;E<c;++E){const t=1===s.shape[0]?N:N.subarray(8*E,8*E+8);for(let e=0;e<f;++e)for(let n=0;n<g;++n)for(let r=0;r<p;++r){let i;const s=t[6]*n+t[7]*e+1;if(0===s)continue;const l=(t[0]*n+t[1]*e+t[2])/s,c=(t[3]*n+t[4]*e+t[5])/s,p=sP(l,d,a),f=sP(c,h,a);switch(o){case"nearest":i=aP(C,h,d,b,v,x,E,f,p,r,u);break;case"bilinear":i=uP(C,h,d,b,v,x,E,f,p,r,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}T[E*k+e*I+n*S+r]=i}return r.makeTensorInfo(m,i.dtype,T)}return{dataId:r.write(T,m,i.dtype),shape:i.shape,dtype:i.dtype}}},lD,{kernelName:"Unique",backendName:"cpu",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;K_(s,"unique");const o=r.data.get(s.dataId).values,{outputValues:a,outputShape:u,indices:l}=tF(o,i,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}},{kernelName:"Unpack",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i.shape.length,a=i.shape[s],u=new Array(o-1);let l=0;for(let p=0;p<o;p++)p!==s&&(u[l++]=i.shape[p]);const c=new Array(o).fill(0),h=i.shape.slice();h[s]=1;const d=new Array(a);for(let p=0;p<d.length;p++){c[s]=p;const t=$D({inputs:{x:i},backend:n,attrs:{begin:c,size:h}});d[p]=fF({inputs:{x:t},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(t)}return d}},{kernelName:"UnsortedSegmentSum",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:o}=r;K_(i,"unsortedSegmentSum");const a=[],u=[],l=i.shape.length-s.shape.length;let c=s;for(let d=0;d<l;++d){const t=wO({inputs:{input:c},backend:n,attrs:{dim:d+1}});c=t,u.push(t)}for(let d=0;d<o;++d){const t=ry(d,"int32"),e=n.makeTensorInfo([],"int32",t),r=SA({inputs:{a:e,b:c},backend:n}),s=uA({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),o=eD({inputs:{a:s,b:i},backend:n}),l=mO({inputs:{x:o},backend:n,attrs:{axis:0,keepDims:!1}});a.push(l),u.push(e),u.push(r),u.push(s),u.push(o),u.push(l)}const h=yL({inputs:a,backend:n,attrs:{axis:0}});return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),h}},gL];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const Bj of lP)fm(Bj);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cP={},hP={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function dP(t,e){if(!(t in cP)||null!=e){const n=function(t,e){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==e?function(t){if(rm().getBool("IS_SAFARI")||"undefined"==typeof OffscreenCanvas||2!==t){if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(t):e;n.addEventListener("webglcontextlost",(e=>{e.preventDefault(),delete cP[t]}),!1),rm().getBool("SOFTWARE_WEBGL_ENABLED")&&(hP.failIfMajorPerformanceCaveat=!1);if(1===t)return n.getContext("webgl",hP)||n.getContext("experimental-webgl",hP);return n.getContext("webgl2",hP)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e);if(null===n)return console.log("Could not get context for WebGL version",t),null;cP[t]=n}const n=cP[t];return null==n||n.isContextLost()?(delete cP[t],dP(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),cP[t])}var pP,fP,gP,mP,yP,bP;function vP(t,e){return[e,t]}function xP(t){const e=Ng(t);return $g(Math.ceil(e/4))}function wP(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function kP(t,e){const n=t;let r,i,s,o,a,u,l,c,h,d;return 2===rm().getNumber("WEBGL_VERSION")?(r=n.R32F,i=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,l=4,c=1,h=n.HALF_FLOAT,d=n.FLOAT,u=n.RGBA8):(r=t.RGBA,i=t.RGBA,s=t.RGBA,o=n.RGBA,a=t.RGBA,l=4,c=4,h=null!=e?e.HALF_FLOAT_OES:null,d=t.FLOAT,u=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IP(t,e){const n=e();return rm().getBool("DEBUG")&&function(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+function(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}(t,e))}(t),n}(fP=pP||(pP={}))[fP.DENSE=0]="DENSE",fP[fP.SHARED_BATCH=1]="SHARED_BATCH",(mP=gP||(gP={}))[mP.RENDER=0]="RENDER",mP[mP.UPLOAD=1]="UPLOAD",mP[mP.PIXELS=2]="PIXELS",mP[mP.DOWNLOAD=3]="DOWNLOAD",(bP=yP||(yP={}))[bP.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",bP[bP.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",bP[bP.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",bP[bP.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",bP[bP.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16";function SP(t){return!!(rm().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function TP(t,e){return FP(t,(()=>t.getExtension(e)),'Extension "'+e+'" not supported on this browser.')}const CP=/ERROR: [0-9]+:([0-9]+):/g;function NP(t,e){const n=CP.exec(e);if(null==n)return console.log(`Couldn't parse line number in error: ${e}`),void console.log(t);const r=+n[1],i=t.split("\n"),s=i.length.toString().length+2,o=i.map(((t,e)=>_g((e+1).toString(),s)+t));let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const u=o.slice(0,r-1),l=o.slice(r-1,r),c=o.slice(r);console.log(u.join("\n")),console.log(e.split("\n")[0]),console.log(`%c ${_g(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}function EP(t,e){if(IP(t,(()=>t.validateProgram(e))),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function RP(t,e,n,r,i,s,o){const a=t.getAttribLocation(e,n);return-1!==a&&(IP(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,r))),IP(t,(()=>t.vertexAttribPointer(a,i,t.FLOAT,!1,s,o))),IP(t,(()=>t.enableVertexAttribArray(a))),!0)}function $P(t,e,n){!function(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${n}]`}.`)}}(t,n),IP(t,(()=>t.activeTexture(t.TEXTURE0+n))),IP(t,(()=>t.bindTexture(t.TEXTURE_2D,e)))}function _P(t,e,n){IP(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,n))),IP(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)))}function AP(t,e){IP(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,e))),IP(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)))}function DP(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}(t,e))}function FP(t,e,n){const r=IP(t,(()=>e()));if(null==r)throw new Error(n);return r}function OP(t,e=2){return Ng(t.slice(0,t.length-e))}function LP(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function PP(t){let e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[OP(t),...LP(t)]),e}function MP(t){return t%2==0}function zP(t,e){if(Eg(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){const n=t[t.length-1],r=e[e.length-1];if(n===r)return!0;if(MP(n)&&MP(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&MP(t[0])&&MP(e[0])}let BP,UP;function VP(t,e){return null!=t.getExtension(e)}function WP(t){try{if(null!=dP(t))return!0}catch(pg){return console.log("Error when getting WebGL context: ",pg),!1}return!1}function GP(t){if(0===t)return!1;const e=dP(t);if(1!==t){if(VP(e,"EXT_color_buffer_float"))return jP(e);const t="EXT_color_buffer_half_float";if(VP(e,t)){const n=e.getExtension(t);return function(t,e){const n=kP(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const i=1,s=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,i,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),a}(e,n)}return!1}if(!VP(e,"OES_texture_float"))return!1;if(!VP(e,"WEBGL_color_buffer_float"))return!1;return jP(e)}function jP(t){const e=kP(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function HP(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&Sg("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the WebGL backend.`))}))}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qP=rm();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function KP(){let t,e,n,r,i,s,o,a,u,l;return 2===rm().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",i="texture",s="outputColor",o="out vec4 outputColor;",a=rm().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",o="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XP(t,e,n="index"){const r=jg(e);return r.map(((e,i)=>`${`int ${t[i]} = ${n} / ${e}`}; ${i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${e}`:`index -= ${t[i]} * ${e}`};`)).join("")}function YP(t,e,n="index"){const r=jg(e);return r.map(((e,i)=>`${`int ${t[i]} = ${n} / outShapeStrides[${i}]`}; ${i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`};`)).join("")}function QP(t,e,n="index"){const r=function(t,e){const n=t.length,r=t.map((t=>`${e}[${t}]`)),i=new Array(n-1);i[n-2]=r[n-1];for(let s=n-3;s>=0;--s)i[s]=`(${i[s+1]} * ${r[s+1]})`;return i}(t.map(((t,e)=>e)),e);return r.map(((e,i)=>`${`int ${t[i]} = ${n} / ${r[i]}`}; ${i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r[i]}`:`index -= ${t[i]} * ${r[i]}`};`)).join("")}function JP(t){const e=jg(t).map((t=>t.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;\n  }\n`}qP.registerFlag("HAS_WEBGL",(()=>qP.getNumber("WEBGL_VERSION")>0)),qP.registerFlag("WEBGL_VERSION",(()=>WP(2)?2:WP(1)?1:0)),qP.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),qP.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===qP.get("WEBGL_VERSION"))),qP.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),qP.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),qP.registerFlag("WEBGL_PACK",(()=>qP.getBool("HAS_WEBGL"))),qP.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_PACK_CLIP",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_PACK_REDUCE",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_LAZILY_UNPACK",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_CONV_IM2COL",(()=>qP.getBool("WEBGL_PACK"))),qP.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(t){if(null==BP){const e=dP(t);BP=e.getParameter(e.MAX_TEXTURE_SIZE)}return BP}(qP.getNumber("WEBGL_VERSION")))),qP.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(t){if(null==UP){const e=dP(t);UP=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,UP)}(qP.getNumber("WEBGL_VERSION")))),qP.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const t=qP.getNumber("WEBGL_VERSION");return 0===t?0:function(t){if(0===t)return 0;let e;const n=dP(t);return e=VP(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:VP(n,"EXT_disjoint_timer_query")?1:0,e}(t)})),qP.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>qP.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Ky())),qP.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(t){if(0===t)return!1;const e=dP(t);if(1===t){if(!VP(e,"OES_texture_float"))return!1}else if(!VP(e,"EXT_color_buffer_float"))return!1;return jP(e)}(qP.getNumber("WEBGL_VERSION")))),qP.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!qP.getBool("WEBGL_FORCE_F16_TEXTURES")&&qP.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),qP.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>GP(qP.getNumber("WEBGL_VERSION")))),qP.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(t=qP.getNumber("WEBGL_VERSION"))&&null!=dP(t).fenceSync;var t})),qP.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>qP.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),qP.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)})),qP.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>Ky()?1:-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)})),qP.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),qP.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),qP.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),qP.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),qP.registerFlag("WEBGL_EXP_CONV",(()=>!1)),qP.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>qP.getBool("IS_TEST"))),qP.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),qP.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),qP.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1)),qP.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));const ZP="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:tM}=qS;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eM(t,e,n){const r=[];if(t.forEach((t=>{const e=Ng(t.shapeInfo.logicalShape);if(t.shapeInfo.isUniform?r.push(`uniform float ${t.name}${e>1?`[${e}]`:""};`):(r.push(`uniform sampler2D ${t.name};`),r.push(`uniform int offset${t.name};`)),n.enableShapeUniforms){const{uniformShape:e}=dM(n.packedInputs,t.shapeInfo.logicalShape,t.shapeInfo.texShape);switch(e.length){case 1:r.push(`uniform int ${t.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${t.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${t.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${t.name}Shape;`)}r.push(`uniform ivec2 ${t.name}TexShape;`)}})),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((t=>{r.push(`uniform ${t.type} ${t.name}${t.arrayIndex?`[${t.arrayIndex}]`:""};`)}));const i=r.join("\n"),s=t.map((t=>function(t,e,n=!1,r){let i="";i+=n?rM(t,r):nM(t,r);const s=t.shapeInfo.logicalShape,o=e.logicalShape;s.length<=o.length&&(i+=n?function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=tM(t.shapeInfo.logicalShape,e.logicalShape),u=hM(o),l=o-s;let c;const h=["x","y","z","w","u","v"];c=0===s?"":o<2&&a.length>=1?"coords = 0;":a.map((t=>`coords.${h[t+l]} = 0;`)).join("\n");let d="";d=o<2&&s>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${h[e+l]}`)).join(", ");let p="return outputValue;";const f=1===Ng(t.shapeInfo.logicalShape),g=1===Ng(e.logicalShape);if(1!==s||f||g){if(f&&!g)p=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(a.length){const t=s-2,e=s-1;a.indexOf(t)>-1&&a.indexOf(e)>-1?p="return vec4(outputValue.x);":a.indexOf(t)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(e)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${i}() {\n      ${u} coords = getOutputCoords();\n      ${c}\n      vec4 outputValue = get${r}(${d});\n      ${p}\n    }\n  `}(t,e):function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===u&&null==t.shapeInfo.flatOffset&&Eg(o,s))return`\n      float ${i}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const l=hM(u),c=tM(t.shapeInfo.logicalShape,e.logicalShape),h=u-a;let d;const p=["x","y","z","w","u","v"];d=0===a?"":u<2&&c.length>=1?"coords = 0;":c.map((t=>`coords.${p[t+h]} = 0;`)).join("\n");let f="";f=u<2&&a>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${p[e+h]}`)).join(", ");return`\n    float ${i}() {\n      ${l} coords = getOutputCoords();\n      ${d}\n      return get${r}(${f});\n    }\n  `}(t,e));return i}(t,e,n.packedInputs,n.enableShapeUniforms))).join("\n"),o=e.texShape,a=KP(),u=function(t){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${t.texture2D}(textureSampler, uv).r;\n    }\n  `}(a);let l,c,h=function(t){return`${t.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${t.varyingFs} vec2 resultUV;\n    ${t.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${t.defineSpecialNaN}\n    ${t.defineSpecialInf}\n    ${t.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${iM}\n    ${sM}\n    ${oM}\n  `}(a);e.isPacked?(l=function(t,e,n){switch(t.length){case 0:return uM();case 1:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `;if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,e,n);case 2:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Eg(t,e))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const i=Math.ceil(t[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),s=i*Math.ceil(t[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(t,e,n);default:return function(t,e,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),s=i*Math.ceil(t[t.length-2]/2);let o=s,a="",u="b, r, c";for(let l=2;l<t.length-1;l++)o*=t[t.length-l-1],a=`\n      int b${l} = index / ${o};\n      index -= b${l} * ${o};\n    `+a,u=`b${l}, `+u;return`\n    ivec${t.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${a}\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec${t.length}(${u});\n    }\n  `}(t,e,n)}}(e.logicalShape,o,n.enableShapeUniforms),c=function(t){return`\n    void setOutput(vec4 val) {\n      ${t.output} = val;\n    }\n  `}(a)):(l=function(t,e,n){switch(t.length){case 0:return uM();case 1:return function(t,e,n){if(1===e[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${e[1]}.0);\n      }\n    `;if(1===e[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${e[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      return resTexRC.x * ${e[1]} + resTexRC.y;\n    }\n  `}(0,e,n);case 2:return function(t,e,n){if(Eg(t,e))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));\n      }\n    `;if(1===t[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `;if(1===t[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `;if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      int r = index / ${t[1]};\n      int c = index - r * ${t[1]};\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n){return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${YP(["r","c","d"],t)}\n    return ivec3(r, c, d);\n  }\n`}const r=XP(["r","c","d"],t);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(t,e,n);case 4:return function(t,e,n){if(n){return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${YP(["r","c","d","d2"],t)}\n      return ivec4(r, c, d, d2);\n    }\n  `}const r=XP(["r","c","d","d2"],t);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(t,e,n);case 5:return function(t,e){const n=XP(["r","c","d","d2","d3"],t);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},\n                             ${e[1]}));\n\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(t,e);case 6:return function(t,e){const n=XP(["r","c","d","d2","d3","d4"],t);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}(e.logicalShape,o,n.enableShapeUniforms),c=function(t){return`\n    void setOutput(float val) {\n      ${t.output} = vec4(val, 0, 0, 0);\n    }\n  `}(a)),n.packedInputs&&(h+=aM);return[h,u,c,i,l,s,n.userCode].join("\n")}function nM(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,s]=t.shapeInfo.texShape;if(1===i&&1===s)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const o=lM(n);if(e)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[a,u]=t.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${a}, ${u}, ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${cM(t)}\n      }\n    `;const i=t.shapeInfo.texShape,s=i[0],o=i[1];if(1===o&&1===s)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const a=lM(n);if(1===o)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(1===s)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(e)return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `;return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${s}, ${o}, index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape;if(null!=s&&Eg(n,s)){if(e)return`\n      float ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const t=s[0];return`\n    float ${i}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${s[1]}.0, ${t}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:o,keptDims:a}=Og(n),u=o;if(u.length<n.length){const n=["row","col"];return`\n      ${nM(pM(t,u),e)}\n      float ${i}(int row, int col) {\n        return ${i}(${fM(n,a)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${cM(t)}\n      }\n    `;const l=s[0],c=s[1],h=lM(r);if(1===c)return e?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(1===l)return e?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(e)return`\n      float ${i}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${h};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `;return`\n  float ${i}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${h};\n    vec2 uv = uvFromFlat(${l}, ${c}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],o=n[2],{newShape:a,keptDims:u}=Og(n),l=a;if(l.length<n.length){const n=["row","col","depth"];return`\n        ${nM(pM(t,l),e)}\n        float ${i}(int row, int col, int depth) {\n          return ${i}(${fM(n,u)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${s}, ${o}, 1)));\n        ${cM(t)}\n      }\n    `;const c=t.shapeInfo.texShape,h=c[0],d=c[1],p=t.shapeInfo.flatOffset;if(d===s&&null==p)return e?`\n      float ${i}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${i}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${o}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${d}.0, ${h}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(d===o&&null==p)return e?`\n      float ${i}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const f=lM(r);if(e)return`\n    float ${i}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ${f};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `;return`\n      float ${i}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${s} + col * ${o} + depth + ${f};\n        vec2 uv = uvFromFlat(${h}, ${d}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(t,e);case 4:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],o=n[2]*s,a=n[1]*o,{newShape:u,keptDims:l}=Og(n);if(u.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${nM(pM(t,u),e)}\n      float ${i}(int row, int col, int depth, int depth2) {\n        return ${i}(${fM(n,l)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${a}, ${o}, ${s}, 1)));\n        ${cM(t)}\n      }\n    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1],f=`int stride2 = ${r}Shape[3];`,g=`int stride1 = ${r}Shape[2] * stride2;`,m=`int stride0 = ${r}Shape[1] * stride1;`;if(p===a&&null==c)return e?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        ${f}\n        ${g}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${o}, ${s}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(p===s&&null==c)return e?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const y=lM(r);if(e)return`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${f}\n      ${g}\n      ${m}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `;return`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${o} +\n          depth * ${s} + depth2;\n      vec2 uv = uvFromFlat(${d}, ${p}, index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `}(t,e);case 5:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],s=e[3]*i,o=e[2]*s,a=e[1]*o,{newShape:u,keptDims:l}=Og(e);if(u.length<e.length){const e=["row","col","depth","depth2","depth3"];return`\n      ${nM(pM(t,u))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${fM(e,l)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${a}, ${o}, ${s}, ${i})) +\n          depth3;\n        ${cM(t)}\n      }\n    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1];if(p===a&&null==c)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${o}, ${s}, ${i}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===i&&null==c)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]},\n               ${e[2]*e[3]}, ${e[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const f=lM(n);return`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${o} + depth * ${s} +\n          depth2 * ${i} + depth3 + ${f};\n      vec2 uv = uvFromFlat(${d}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);case 6:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:s}=Og(e);if(i.length<e.length){const e=["row","col","depth","depth2","depth3","depth4"];return`\n      ${nM(pM(t,i))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${fM(e,s)});\n      }\n    `}const o=e[5],a=e[4]*o,u=e[3]*a,l=e[2]*u,c=e[1]*l;if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${c}, ${l}, ${u}, ${a})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${o}, 1)));\n        ${cM(t)}\n      }\n    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===c&&null==h)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${l}, ${u}, ${a}, ${o})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(f===o&&null==h)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]*e[4]},\n               ${e[2]*e[3]*e[4]},\n               ${e[3]*e[4]},\n               ${e[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const g=lM(n);return`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${c} + col * ${l} + depth * ${u} +\n          depth2 * ${a} + depth3 * ${o} + depth4 + ${g};\n      vec2 uv = uvFromFlat(${p}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function rM(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=KP();return`\n    vec4 ${n}() {\n      return ${r.texture2D}(${e}, halfCR);\n    }\n  `}(t);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,s=KP();if(e)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${o[0]}, ${o[1]}, index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,o=s[0],a=s[1],u=KP();if(null!=s&&Eg(n,s))return e?`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `;if(e)return`\n    vec4 ${i}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `;const l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Math.ceil(n[1]/2);return`\n    vec4 ${i}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){const r=[1,2],s=["b","row","col"];return`\n        ${rM(pM(t,n.slice(1)),e)}\n        vec4 ${i}(int b, int row, int col) {\n          return ${i}(${fM(s,r)});\n        }\n      `}const a=KP();if(e)return`\n    vec4 ${i}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `;const u=o[0],l=o[1],c=Math.ceil(n[2]/2),h=c*Math.ceil(n[1]/2);return`\n    vec4 ${i}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${u}, ${l}, ${h}, ${c}, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `}(t,e);default:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=KP();if(e)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);\n    }\n  `;const s=t.shapeInfo.logicalShape,o=s.length,a=t.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=u[0],c=u[1],h=Math.ceil(s[o-1]/2);let d=h*Math.ceil(s[o-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<o-1;g++)p=`int b${g}, `+p,d*=s[o-g-1],f=`b${g} * ${d} + `+f;return`\n    vec4 ${r}(${p}) {\n      int index = ${f};\n      int texR = index / ${c};\n      int texC = index - texR * ${c};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});\n      return ${i.texture2D}(${n}, uv);\n    }\n  `}(t,e)}}const iM="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",sM="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",oM="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",aM="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function uM(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function lM(t){return`offset${t}`}function cM(t){const e=t.name,n=Ng(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${e}[i];\n      }\n    }\n  `}function hM(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function dM(t,e,n){const{newShape:r,keptDims:i}=Og(e),s=e.length,o=t&&3===s&&1===e[0],a=o?e.slice(1):r,u=!t&&s>1&&!Eg(e,n)&&r.length<s||o;return{useSqueezeShape:u,uniformShape:u?a:e,keptDims:i}}function pM(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function fM(t,e){return e.map((e=>t[e])).join(", ")}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gM(t,e,n,r){const i=n.map(((t,n)=>{const r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),s=i.map((t=>t.shapeInfo)),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=eM(i,o,e),u=function(t,e){const n=FP(t,(()=>t.createShader(t.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(IP(t,(()=>t.shaderSource(n,e))),IP(t,(()=>t.compileShader(n))),rm().get("ENGINE_COMPILE_ONLY"))return n;if(!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw NP(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t.gl,a),l=t.createProgram(u);return rm().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o},mM(t,e,l))}function mM(t,e,n){const r=[],i=[];let s,o,a,u=null,l=null;l=t.getUniformLocation(n,"NAN",!1),1===rm().getNumber("WEBGL_VERSION")&&(u=t.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const h of e.variableNames){const i={name:h,uniform:t.getUniformLocation(n,h,c),offset:t.getUniformLocation(n,`offset${h}`,c)};e.enableShapeUniforms&&(i.shape=t.getUniformLocation(n,`${h}Shape`,c),i.texShape=t.getUniformLocation(n,`${h}TexShape`,c)),r.push(i)}if(e.enableShapeUniforms&&(s=t.getUniformLocation(n,"outShape",c),a=t.getUniformLocation(n,"outShapeStrides",c),o=t.getUniformLocation(n,"outTexShape",c)),e.customUniforms)for(const h of e.customUniforms)i.push(t.getUniformLocation(n,h.name,c));return{variablesLocations:r,customUniformLocations:i,infLoc:u,nanLoc:l,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:o}}function yM(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach(((t,n)=>{const r=t.logicalShape,i=e[n],s=i.shape;if(!Eg(r,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${s} must match`);if(t.isUniform&&i.isUniform)return;const o=t.texShape,a=i.isUniform?null:i.texData.texShape;if(!Eg(o,a))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${a} must match`)}))}function bM(t){return rm().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vM{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=pP.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=KP();this.outputShape=t,this.enableShapeUniforms=bM(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?YP(["r","c","d"],t):XP(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xM{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=pP.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=KP();this.outputShape=t,this.enableShapeUniforms=bM(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?YP(["r","c","d"],t):XP(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wM{constructor(t){this.variableNames=["A"],this.outTexUsage=gP.DOWNLOAD;const e=KP();this.outputShape=t,this.userCode=`\n      ${ZP}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kM{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=gP.DOWNLOAD;const e=KP();this.outputShape=t,this.userCode=`\n      ${ZP}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IM={R:0,G:1,B:2,A:3};class SM{constructor(t,e=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=KP();this.outputShape=t,this.enableShapeUniforms=bM(this.outputShape.length);let i="result";e&&(i="floor(result * 255. + 0.5)");let s="";for(let o=0;o<n.length;o++){const t=n[o];s+=`\n          if(offset == ${o}) {\n            result = values[${IM[t]}];\n          }`}this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":JP(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ${n.length});\n\n        flatIndex = idiv(flatIndex, ${n.length}, 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ${r.texture2D}(A, uv);\n          ${s}\n        }\n        ${r.output} = vec4(${i}, 0., 0., 0.);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TM{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=KP();this.outputShape=t,this.enableShapeUniforms=bM(this.outputShape.length);let r="",i="result";e&&(i="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let e=0;e<=1;e++){const i=2*s+e;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${e} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {\n          localCoords[2] += ${e};\n          if (localCoords[1] + ${s} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {\n            localCoords[1] += ${s};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${i}] = values[0];\n            } else if (offset == 1) {\n              result[${i}] = values[1];\n            } else if (offset == 2) {\n              result[${i}] = values[2];\n            } else {\n              result[${i}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":JP(t)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${i};\n        }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CM(t){const e=KP();return function(t,e){const n=FP(t,(()=>t.createShader(t.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(IP(t,(()=>t.shaderSource(n,e))),IP(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(t,`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function NM(t){return function(t,e){const n=FP(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return IP(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),IP(t,(()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function EM(t){return function(t,e){const n=FP(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return IP(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n))),IP(t,(()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Uint16Array([0,1,2,2,1,3]))}function RM(t,e,n,r,i,s){!function(t,e){const n=rm().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0)throw new Error(`Requested texture size [${t}x${e}] is invalid.`);if(t>n||e>n)throw new Error(`Requested texture size [${t}x${e}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(e,n);const o=function(t){return FP(t,(()=>t.createTexture()),"Unable to create WebGLTexture.")}(t),a=t.TEXTURE_2D;return IP(t,(()=>t.bindTexture(a,o))),IP(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE))),IP(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))),IP(t,(()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST))),IP(t,(()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST))),1===rm().getNumber("WEBGL_VERSION")?IP(t,(()=>t.texImage2D(a,0,r,e,n,0,i,s,null))):IP(t,(()=>t.texStorage2D(a,1,r,e,n))),IP(t,(()=>t.bindTexture(t.TEXTURE_2D,null))),{texture:o,texShape:[n,e]}}function $M(t){return t.internalFormatFloat}function _M(t){return t.internalFormatHalfFloat}function AM(t){return t.downloadTextureFormat}function DM(t){return t.internalFormatPackedFloat}function FM(t){return t.internalFormatPackedHalfFloat}function OM(t,e,n,r,i,s,o,a){const u=t,l=new Float32Array(function(t,e){const[n,r]=wP(t,e);return n*r*4}(s,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class LM{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const e=rm().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,function(t,e){cP[t]=e}(e,t)):this.gl=dP(e),t=this.gl,2===rm().getNumber("WEBGL_VERSION")){const e=t;this.createVertexArray=()=>IP(e,(()=>e.createVertexArray())),this.bindVertexArray=t=>IP(e,(()=>e.bindVertexArray(t))),this.deleteVertexArray=t=>IP(e,(()=>e.deleteVertexArray(t))),this.getVertexArray=()=>IP(e,(()=>e.getParameter(e.VERTEX_ARRAY_BINDING)))}else if(null!=t){const e=t.getExtension("OES_vertex_array_object");if(null==e)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>IP(t,(()=>e.createVertexArrayOES())),this.bindVertexArray=n=>IP(t,(()=>e.bindVertexArrayOES(n))),this.deleteVertexArray=n=>IP(t,(()=>e.deleteVertexArrayOES(n))),this.getVertexArray=()=>IP(t,(()=>t.getParameter(e.VERTEX_ARRAY_BINDING_OES)))}let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===rm().getNumber("WEBGL_VERSION")){const t="OES_texture_float",e="OES_texture_half_float";if(this.textureFloatExtension=TP(this.gl,t),VP(this.gl,e))this.textureHalfFloatExtension=TP(this.gl,e);else if(rm().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),VP(this.gl,r))this.colorBufferHalfFloatExtension=TP(this.gl,r);else if(rm().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",VP(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!VP(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=NM(this.gl),this.indexBuffer=EM(this.gl),this.framebuffer=function(t){return FP(t,(()=>t.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=kP(this.gl,this.textureHalfFloatExtension)}get debug(){return rm().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;IP(t,(()=>t.finish())),IP(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),IP(t,(()=>t.deleteFramebuffer(this.framebuffer))),IP(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,null))),IP(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null))),IP(t,(()=>t.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=vP(e,n);return RM(t,i,s,$M(r),r.textureFormatFloat,t.FLOAT)}(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=vP(e,n);return RM(t,i,s,_M(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=vP(e,n);return RM(t,i,s,AM(r),t.RGBA,t.UNSIGNED_BYTE)}(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),function(t,e,n){IP(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),n.data instanceof Uint8Array?2===rm().getNumber("WEBGL_VERSION")?IP(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data))):IP(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data))):2===rm().getNumber("WEBGL_VERSION")?IP(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n))):IP(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n))),IP(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,r){this.throwIfDisposed(),function(t,e,n,r,i,s){let o,a,u;IP(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),i instanceof Uint8Array?(o=new Uint8Array(n*r*4),a=t.UNSIGNED_BYTE,u=t.RGBA):(o=new Float32Array(n*r*4),a=t.FLOAT,u=s.internalFormatPackedFloat),o.set(i),2===rm().getNumber("WEBGL_VERSION")?IP(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,a,o))):IP(t,(()=>t.texImage2D(t.TEXTURE_2D,0,u,n,r,0,t.RGBA,a,o))),IP(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=wP(e,n);return RM(t,i,s,FM(r),t.RGBA,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=wP(e,n);return RM(t,i,s,DM(r),t.RGBA,t.FLOAT)}(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(AP(this.gl,this.framebuffer),this.outputTexture=null),IP(this.gl,(()=>this.gl.deleteTexture(t)))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n,r){const[i,s]=vP(e,n),o=new Uint8Array(e*n*4);return IP(t,(()=>t.readPixels(0,0,i,s,r.downloadTextureFormat,t.UNSIGNED_BYTE,o))),new Float32Array(o.buffer)}(this.gl,e,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(t,e,n,r,i,s){return OM(this.gl,t,0,0,0,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return function(t,e,n){const r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const r=function(t,e,n,r){const i=t.createBuffer();IP(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i)));const s=16*e*n;return IP(t,(()=>t.bufferData(t.PIXEL_PACK_BUFFER,s,t.STREAM_READ))),IP(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0))),IP(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null))),i}(this.gl,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if(rm().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=r.clientWaitSync(i,0,0);return t===r.ALREADY_SIGNALED||t===r.CONDITION_SATISFIED},e=i}else rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n){const r=new Float32Array(e*n*4);return IP(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r))),r}(this.gl,e,n)))}createProgram(t){this.throwIfDisposed();const e=this.gl;null==this.vertexShader&&(this.vertexShader=CM(e));const n=function(t){return FP(t,(()=>t.createProgram()),"Unable to create WebGLProgram.")}(e);let r;return IP(e,(()=>e.attachShader(n,this.vertexShader))),IP(e,(()=>e.attachShader(n,t))),function(t,e){if(IP(t,(()=>t.linkProgram(e))),!rm().get("ENGINE_COMPILE_ONLY")&&!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}(e,n),r=Object.assign(n,{vao:this.createVertexArray()}),this.bindVertexArray(r.vao),IP(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer))),console.assert(function(t,e,n){return IP(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),RP(t,e,"clipSpacePos",n,3,20,0)&&RP(t,e,"uv",n,2,20,12)}(e,r,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&EP(e,r),this.setProgram(r),r}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&(IP(this.gl,(()=>this.gl.deleteProgram(t))),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&(this.bindVertexArray(this.program.vao),this.debug&&EP(this.gl,this.program)),IP(this.gl,(()=>this.gl.useProgram(t)))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?function(t,e,n){return FP(t,(()=>t.getUniformLocation(e,n)),'uniform "'+n+'" not present in program.')}(this.gl,t,e):function(t,e,n){return t.getUniformLocation(e,n)}(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),IP(this.gl,(()=>this.gl.getAttribLocation(t,e)))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(t,e,n,r){IP(t,(()=>$P(t,e,r))),IP(t,(()=>t.uniform1i(n,r)))}(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[r,i]=wP(e,n);this.setOutputMatrixTextureDriver(t,r,i)}setOutputMatrixWriteRegion(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&EP(this.gl,this.program),DP(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}IP(t,(()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),IP(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=TP(this.gl,2===rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await Ag((()=>this.disposed||this.isQueryAvailable(t,rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(t,rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl;return e.getQueryParameter(t,e.QUERY_RESULT)/1e6}{const e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){const t=function(t){let e=0;for(;e<t.length;++e){if(!t[e]())break}return e-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in rm().platform&&(n=rm().platform.setTimeoutCustom.bind(rm().platform)),Ag((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),_P(this.gl,t,this.framebuffer),this.debug&&DP(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(_P(this.gl,this.outputTexture,this.framebuffer),this.debug&&DP(this.gl)):AP(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const r=this.gl;_P(r,t,this.framebuffer),this.debug&&DP(r),this.outputTexture=t,IP(r,(()=>r.viewport(0,0,e,n))),IP(r,(()=>r.scissor(0,0,e,n)))}setOutputMatrixWriteRegionDriver(t,e,n,r){this.throwIfDisposed(),IP(this.gl,(()=>this.gl.scissor(t,e,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{addImpl:PM,bincountImpl:MM,bincountReduceImpl:zM,castImpl:BM,ceilImpl:UM,concatImpl:VM,equalImpl:WM,expImpl:GM,expm1Impl:jM,floorImpl:HM,gatherNdImpl:qM,gatherV2Impl:KM,greaterImpl:XM,greaterEqualImpl:YM,lessImpl:QM,lessEqualImpl:JM,linSpaceImpl:ZM,logImpl:tz,maxImpl:ez,maximumImpl:nz,minimumImpl:rz,multiplyImpl:iz,negImpl:sz,notEqualImpl:oz,prodImpl:az,raggedGatherImpl:uz,raggedRangeImpl:lz,raggedTensorToTensorImpl:cz,rangeImpl:hz,rsqrtImpl:dz,scatterImpl:pz,sigmoidImpl:fz,simpleAbsImpl:gz,sliceImpl:mz,sparseFillEmptyRowsImpl:yz,sparseReshapeImpl:bz,sparseSegmentReductionImpl:vz,sqrtImpl:xz,staticRegexReplaceImpl:wz,stridedSliceImpl:kz,stringNGramsImpl:Iz,stringSplitImpl:Sz,stringToHashBucketFastImpl:Tz,subImpl:Cz,tileImpl:Nz,topKImpl:Ez,transposeImpl:Rz,uniqueImpl:$z}=eF;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _z(t,e){return["x","y","z","w","u","v"].slice(0,e).map((e=>`${t}.${e}`))}function Az(t,e){return 1===e?[t]:_z(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Dz{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=bM(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const t=Az("rc",this.rank),e=hM(this.rank),n=this.getOutOfBoundsCondition(t),r=this.getSetup(t),i=this.getOutput(t);this.userCode=`\n        void main() {\n          ${e} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${i}));\n          }\n        }\n      `}}getSourceCoordsArr(t){const e=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let i=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let e=2;e<this.rank;e++)i=`${t[t.length-1-e]},`+i;e.push(i)}return e}getOutOfBoundsCondition(t){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let n=this.rank-2;n<this.rank;n++)e+=`${t[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(e+="||");return e}getSetup(t){if(1===this.rank)return"";const e=t.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${e[0]};\n      int c = ${e[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(t){const e=this.getSourceCoordsArr(t);if(1===this.rank){return`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`}return`getA(${e[0]}),\n            cEdge ? 0. : getA(${e[1]}),\n            rEdge ? 0. : getA(${e[2]}),\n            rEdge || cEdge ? 0. : getA(${e[3]})`}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fz{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=bM(this.outputShape.length);let n="";for(let s=0;s<4;s++){let t="thisRC = rc;";s%2==1&&(t+="thisRC.z += 1;"),s>1&&(t+="thisRC.y += 1;"),n+=`\n        ${t}\n        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${s}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${s>0?"}":""}\n      `}var r,i;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */this.userCode=`\n      ${r=e,i=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${i?QP(["r","c","d"],"inputShape"):XP(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":JP(t)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class Oz{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,e,n){const r=Pz(e,n),i=Mz(t,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const s=Lz(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const t=this.freeTextures[i].pop();return this.usedTextures[i].push(t),t}let o;return r===yP.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===yP.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===yP.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===yP.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===yP.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(o),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),o}releaseTexture(t,e,n,r){if(null==this.freeTextures)return;const i=Pz(n,r),s=Mz(e,i,r);s in this.freeTextures||(this.freeTextures[s]=[]);const o=Lz(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),a=rm().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==a&&this._numBytesAllocated>a?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=o):(this.freeTextures[s].push(t),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const u=this.usedTextures[s],l=u&&u.indexOf(t);if(null==l||l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[l]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const t in this.freeTextures)this.freeTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));for(const t in this.usedTextures)this.usedTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Lz(t,e,n,r,i){const s=function(t,e){switch(t){case yP.PACKED_2X2_FLOAT32:return DM(e);case yP.PACKED_2X2_FLOAT16:return FM(e);case yP.UNPACKED_FLOAT32:return $M(e);case yP.UNPACKED_FLOAT16:return _M(e);case yP.PACKED_4X1_UNSIGNED_BYTE:return AM(e);default:throw new Error(`Unknown physical texture type ${t}`)}}(e,r);let o;if(i){const[e,n]=wP(t[0],t[1]);o=e*n}else{const[e,n]=vP(t[0],t[1]);o=e*n}return o*function(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}(n,s)}function Pz(t,e){if(t===gP.UPLOAD)return yP.PACKED_2X2_FLOAT32;if(t===gP.RENDER||null==t)return function(t){return rm().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?yP.PACKED_2X2_FLOAT32:yP.UNPACKED_FLOAT32:t?yP.PACKED_2X2_FLOAT16:yP.UNPACKED_FLOAT16}(e);if(t===gP.DOWNLOAD||t===gP.PIXELS)return yP.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function Mz(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zz{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=bM(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${e}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const Bz="return x;";class Uz{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=bM(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${e}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vz{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=bM(this.outputShape.length);const e=t.length,n=Az("rc",e),r=hM(e),i=function(t,e){if(1===t)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),s=n.slice(-2),o=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${i});\n\n        setOutput(getChannel(packedInput, ${o}));\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wz=Nk,Gz={};const jz=rm().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class Hz extends bg{nextDataId(){return Hz.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!rm().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(null!=t){if(t instanceof LM)e=t;else{const n=dP(rm().getNumber("WEBGL_VERSION"),t);e=new LM(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const t=dP(rm().getNumber("WEBGL_VERSION"));e=new LM(t),this.binaryCache=((n=rm().getNumber("WEBGL_VERSION"))in Gz||(Gz[n]={}),Gz[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Oz(this.gpgpu),this.numMBBeforeWarning=null==rm().global.screen?1024:rm().global.screen.height*rm().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new yg(this,Vb())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,e,n,r,i,s){const o=this.makeTensorInfo(e,n),a=this.texData.get(o.dataId);a.isPacked=!1,a.texture={texture:t,texShape:[r,i]},a.texShape=[r,i];const u=PP(e),l=new SM(u,!1,s),c=this.runWebGLProgram(l,[o],n,[[r,i]]);return c.shape=e,a.texture=null,this.disposeIntermediateTensorInfo(o),c.dataId}write(t,e,n){if((rm().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||rm().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:gP.UPLOAD,refCount:1}),r}refCount(t){if(this.texData.has(t)){return this.texData.get(t).refCount}return 0}incRef(t){this.texData.get(t).refCount++}decRef(t){if(this.texData.has(t)){this.texData.get(t).refCount--}}move(t,e,n,r,i){if(rm().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:gP.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:n,dtype:r,complexTensorInfos:i,slice:s,shape:o,isPacked:a}=e;if(null!=s){let e;e=a?new Uz(o,Bz):new zz(o,Bz);const n=this.runWebGLProgram(e,[{dataId:t,shape:o,dtype:r}],r),i=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;const u=null!=this.activeTimers;let l,c;if(u&&(l=sy()),"complex64"===r){c=pS(this.readSync(i.real.dataId),this.readSync(i.imag.dataId))}else c=this.getValuesFromTexture(t);return u&&(this.downloadWaitMs+=sy()-l),this.convertAndCacheOnCPU(t,c)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise((t=>e.push(t)))}const e=this.texData.get(t),{values:n,shape:r,slice:i,dtype:s,complexTensorInfos:o,isPacked:a}=e;if(null!=i){let e;e=a?new Uz(r,Bz):new zz(r,Bz);const n=this.runWebGLProgram(e,[{dataId:t,shape:r,dtype:s}],s),i=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if(rm().getBool("DEBUG")&&!rm().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===rm().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u,l,c=null;if("complex64"!==s&&rm().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(t);const e=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(e.texture.texture,...xP(r))}if(this.pendingRead.set(t,[]),"complex64"!==s&&await this.gpgpu.createAndWaitForFence(),"complex64"===s){const t=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]);l=pS(t[0],t[1])}else if(null==c)l=this.getValuesFromTexture(t);else{const t=Ng(r);l=this.gpgpu.downloadFloat32MatrixFromBuffer(c,t)}if(null!=u&&this.disposeIntermediateTensorInfo(u),null!=c){const t=this.gpgpu.gl;IP(t,(()=>t.deleteBuffer(c)))}const h=this.convertAndCacheOnCPU(t,l),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach((t=>t(h))),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Vb().removeDataId(t,this),this.pendingDeletes--),h}readToGPU(t,e={}){const n=this.texData.get(t),{values:r,shape:i,slice:s,dtype:o,isPacked:a,texture:u}=n;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=s){let n;n=a?new Uz(i,Bz):new zz(i,Bz);const r=this.runWebGLProgram(n,[{dataId:t,shape:i,dtype:o}],o),s=this.readToGPU(r,e);return this.disposeIntermediateTensorInfo(r),s}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const l=this.decode(t,e.customTexShape),c=Vb().makeTensorFromTensorInfo(l),h=this.texData.get(l.dataId);return Object.assign({tensorRef:c},h.texture)}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>ay(t)));return zb(t.shape,t.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return zb(t.shape,t.dtype,e)}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!SP(n)){if(rm().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:r}=this.texData.get(t),i=Ng(e);if(rm().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),r=this.texData.get(n.dataId),s=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...xP(e)).subarray(0,i);return this.disposeIntermediateTensorInfo(n),s}const s=rm().getBool("WEBGL_PACK")&&!0===r,o=s?PP(e):e,a=s?new kM(o):new wM(o),u=this.runWebGLProgram(a,[{shape:o,dtype:n,dataId:t}],"float32"),l=this.texData.get(u.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture.texture,l.texShape[0],l.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),c}timerAvailable(){return rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t();const i=ly(this.activeTimers.map((t=>t.query))).filter((t=>null!=t)),s=ly(this.activeTimers.map((t=>t.name))).filter((t=>null!=t));this.activeTimers=e,r&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(i);o.kernelMs=function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}(t),o.getExtraProfileInfo=()=>t.map(((t,e)=>({name:s[e],ms:t}))).map((t=>`${t.name}: ${t.ms}`)).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:sy(),endMs:null}}endTimer(t){return rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=sy(),t)}async getQueryTime(t){if(rm().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:n}=this.texData.get(t);return null!=n&&(this.disposeData(n.real.dataId,e),this.disposeData(n.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:n,texShape:r,usage:i,isPacked:s,slice:o}=this.texData.get(t),a=o&&o.origDataId||t,u=this.dataRefCount.get(a);u>1?this.dataRefCount.set(a,u-1):(this.dataRefCount.delete(a),null!=e&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(e,r,i,s)));const l=this.texData.get(t);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=jz){return rm().getBool("WEBGL_CPU_FORWARD")&&t.every((t=>null==this.texData.get(t.dataId).texture&&Ng(t.shape)<e))}getGPGPUContext(){return this.gpgpu}where(t){um("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return Wz(t.shape,e)}packedUnaryOp(t,e,n){const r=new Uz(t.shape,e),i=this.compileAndRun(r,[t],n);return Vb().makeTensorFromTensorInfo(i)}abs(t){if(this.shouldExecuteOnCPU([t])&&"complex64"!==t.dtype){const e=gz(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,e)}if(rm().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"return abs(x);",t.dtype);const e=new zz(t.shape,"return abs(x);"),n=this.compileAndRun(e,[t]);return Vb().makeTensorFromTensorInfo(n)}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&Bg(n[0])){const i=n.map((t=>oy(t)));r=this.write(i,t,e)}else r=this.write(n,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}}makeOutput(t,e,n){return Vb().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,n),this)}unpackTensor(t){const e=new Vz(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new Dz(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const n=[OP(t.shape),...LP(t.shape)],r={dtype:t.dtype,shape:n,dataId:t.dataId},i=[OP(e),...LP(e)],s=new Fz(i,n),o=[n],a=this.runWebGLProgram(s,[r],t.dtype,o,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}}decode(t,e){const n=this.texData.get(t),{isPacked:r,shape:i,dtype:s}=n;if(null!=e){Sg(Ng(i)<=e[0]*e[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const o=PP(i);let a;a=r?new xM(o):new vM(o);const u=[null!=e?e:xP(o)];return{dtype:s,shape:i,dataId:this.runWebGLProgram(a,[{shape:o,dtype:s,dataId:t}],s,u,!0,e).dataId}}runWebGLProgram(t,e,n,r,i=!1,s){const o=this.makeTensorInfo(t.outputShape,n),a=this.texData.get(o.dataId);if(t.packedOutput&&(a.isPacked=!0),t.outPackingScheme===pP.DENSE){const e=null!=s?s:xP(t.outputShape);a.texShape=e.map((t=>2*t))}if(null!=t.outTexUsage&&(a.usage=t.outTexUsage),0===Ng(o.shape))return a.values=Lg(o.dtype,0),o;const u=[],l=e.map((e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&Ng(e.shape)<=rm().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}if(this.uploadToGPU(e.dataId),!!n.isPacked!=!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),u.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!zP(n.shape,e.shape)){const t=e,r=e.shape;e.shape=n.shape,e=this.packedReshape(e,r),u.push(e),n=this.texData.get(e.dataId),t.shape=r}return{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);const c={shape:o.shape,texData:a,isUniform:!1},h=function(t,e,n){let r="";e.concat(n).forEach((e=>{const i=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!e.isUniform){const s=e.texData.texShape,{useSqueezeShape:o,uniformShape:a,keptDims:u}=dM(t.packedInputs,e.shape,s);let l="",c="",h="";if(1===a.length&&t.packedInputs){const t=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];l=`${t[0]>1}_${t[1]>1}`}else if(2!==a.length||t.packedInputs){if(a.length>2&&!t.packedInputs){const t=jg(a);h=`${t[0]===s[1]}_${t[t.length-1]===s[1]}`}}else c=`${a[0]>1}_${a[1]>1}`;const d=e.shape.length,p=2===a.length&&Eg(e.shape,s),f=1===Ng(e.shape),g=ux(e.shape,n.shape),m=!t.packedInputs&&d===n.shape.length&&Eg(s,n.texData.texShape),y=t.packedInputs||a.length>2?"":`${s[0]>1}_${s[1]>1}`;r+=`${d}_${m}_${o?u:""}_${a.length}_${f}_${g}_${p}_${l}_${c}_${h}_${y}_${i}`}else{const t=e.isUniform?"uniform":e.texData.texShape;r+=`${e.shape}_${t}_${i}`}}));const i=t.userCode;let s=t.constructor.name;return s+="_"+r+"_"+i+`${rm().getNumber("WEBGL_VERSION")}`,s}(t,l,c),d=this.getAndSaveBinary(h,(()=>gM(this.gpgpu,t,l,c))),p=null!=this.activeTimers;let f;p&&(f=this.startTimer()),rm().get("ENGINE_COMPILE_ONLY")||function(t,e,n,r,i){e.program.enableShapeUniforms||(yM(e.inShapeInfos,n),yM([e.outShapeInfo],[r]));const s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):t.setOutputMatrixTexture(s.texture,o[0],o[1]),t.setProgram(e.webGLProgram),1===rm().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN);for(let u=0;u<n.length;++u){const r=n[u],{uniform:i,offset:s,shape:o,texShape:a}=e.variablesLocations[u];if(o){const{uniformShape:n}=dM(e.program.packedInputs,r.shape,r.texData.texShape);switch(n.length){case 1:t.gl.uniform1iv(o,new Int32Array(n));break;case 2:t.gl.uniform2iv(o,new Int32Array(n));break;case 3:t.gl.uniform3iv(o,new Int32Array(n));break;case 4:t.gl.uniform4iv(o,new Int32Array(n))}}if(a&&t.gl.uniform2i(a,r.texData.texShape[0],r.texData.texShape[1]),null!=i)if(r.isUniform)if(Ng(r.shape)<2)t.gl.uniform1f(i,r.uniformValues[0]);else{let e=r.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(i,e)}else null!=r.texData.slice&&null!=s&&t.gl.uniform1i(s,r.texData.slice.flatOffset),t.setInputMatrixTexture(r.texData.texture.texture,i,u)}const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(r.shape))}if(e.outShapeStridesLocation){const n=jg(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(n));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(n));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(n))}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&i)for(let u=0;u<e.program.customUniforms.length;++u){const n=e.program.customUniforms[u],r=e.customUniformLocations[u],s=i[u];if("float"===n.type)t.gl.uniform1fv(r,s);else if("vec2"===n.type)t.gl.uniform2fv(r,s);else if("vec3"===n.type)t.gl.uniform3fv(r,s);else if("vec4"===n.type)t.gl.uniform4fv(r,s);else if("int"===n.type)t.gl.uniform1iv(r,s);else if("ivec2"===n.type)t.gl.uniform2iv(r,s);else if("ivec3"===n.type)t.gl.uniform3iv(r,s);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);t.gl.uniform4iv(r,s)}}t.executeProgram()}(this.gpgpu,d,l,c,r),u.forEach((t=>this.disposeIntermediateTensorInfo(t))),p&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)}));const g=rm().get("WEBGL_FLUSH_THRESHOLD");if(g>0){const t=sy();t-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=t)}if(!rm().getBool("WEBGL_LAZILY_UNPACK")&&a.isPacked&&!1===i){const t=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),t}return o}compileAndRun(t,e,n,r,i=!1){n=n||e[0].dtype;return this.runWebGLProgram(t,e,n,r,i)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!rm().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Gb((()=>{if(!rm().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=rm().getBool("DEBUG");rm().set("DEBUG",!1);const e=this.abs(Rx(1e-8)).dataSync()[0];if(rm().set("DEBUG",t),e>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:r,values:i,texture:s,usage:o,isPacked:a}=e;if(null!=s)return;const u=null!=this.activeTimers;let l;u&&(l=sy());let c=e.texShape;if(null==c&&(c=function(t,e=!1){let n=rm().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=rm().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&rm().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),e&&(n*=2,r*=2,1===(t=t.map(((e,n)=>n>=t.length-2?kg(t[n]):t[n]))).length&&(t=[2,t[0]])),2!==t.length){const e=Og(t);t=e.newShape}let i=Ng(t),s=null;t.length<=1&&i<=n?s=[1,i]:2===t.length&&t[0]<=n&&t[1]<=n?s=t:3===t.length&&t[0]*t[1]<=n&&t[2]<=n?s=[t[0]*t[1],t[2]]:3===t.length&&t[0]<=n&&t[1]*t[2]<=n?s=[t[0],t[1]*t[2]]:4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n?s=[t[0]*t[1]*t[2],t[3]]:4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(s=[t[0],t[1]*t[2]*t[3]]);const o=null!=s&&Math.max(...s)>r&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(null==s||o)if(e){const e=OP(t);let n=2,r=2;t.length&&([n,r]=LP(t)),i=e*(n/2)*(r/2),s=$g(i).map((t=>2*t))}else s=$g(i);return s}(n,a),e.texShape=c),null!=i){const t=PP(n);let s,o=c[1],h=c[0];const d=i instanceof Uint8Array||i instanceof Uint8ClampedArray;!a&&d||([o,h]=wP(c[0],c[1])),s=a?new TM(t,d):new SM(t,d);const p=d?[h,o]:c,f=this.makeTensorInfo(p,r),g=this.texData.get(f.dataId);g.usage=d?gP.PIXELS:gP.UPLOAD,g.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(f.dataId),o,h,i);const m=[[h,o]],y=!0,b=this.runWebGLProgram(s,[f],r,m,y),v=this.texData.get(b.dataId);e.texShape=v.texShape,e.isPacked=v.isPacked,e.usage=v.usage,rm().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(e.texture=v.texture,e.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(f),u&&(this.uploadWaitMs+=sy()-l)}else{const t=this.acquireTexture(c,o,r,a);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:r}=n;return null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error(`Unknown dtype ${e}`)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,r)),n.values}acquireTexture(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const t=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${t} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*zg(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}for(const[,e]of Object.entries(this.binaryCache)){const n=new Promise((t=>{try{this.checkCompletion_(e),t(!0)}catch(n){throw n}}));t.push(n)}return Promise.all(t)}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await YI(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(!1===this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw NP(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){const{variablesLocations:e,customUniformLocations:n,infLoc:r,nanLoc:i,outShapeLocation:s,outShapeStridesLocation:o,outTexShapeLocation:a}=mM(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=e,t.customUniformLocations=n,t.infLoc=r,t.nanLoc=i,t.outShapeLocation=s,t.outShapeStridesLocation=o,t.outTexShapeLocation=a}}createTensorFromGPUData(t,e,n){t.channels=t.channels||"RGBA";const{texture:r,height:i,width:s,channels:o}=t,a=Vb().backend;if(!a.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=a.writeTexture(r,e,n,i,s,o);return Vb().makeTensorFromDataId(u,e,n,a)}}Hz.nextDataId=0,Xy()&&qb("webgl",(()=>new Hz),2)
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;class qz{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=cx(e,n),this.enableShapeUniforms=bM(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kz="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class Xz{constructor(t,e,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=cx(e,n);const i=this.outputShape.length;this.enableShapeUniforms=bM(i);let s="";if(r)if(0===i||1===Ng(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{if(s=`\n          ${hM(i)} coords = getOutputCoords();\n        `,1===i)this.enableShapeUniforms?s+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":s+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=Az("coords",i);this.enableShapeUniforms?s+=`\n            bool nextRowOutOfBounds =\n              (${t[i-2]} + 1) >= outShape[${i} - 2];\n            bool nextColOutOfBounds =\n              (${t[i-1]} + 1) >= outShape[${i} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:s+=`\n            bool nextRowOutOfBounds =\n              (${t[i-2]} + 1) >= ${this.outputShape[i-2]};\n            bool nextColOutOfBounds =\n              (${t[i-1]} + 1) >= ${this.outputShape[i-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${s}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yz(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Qz={kernelName:"Identity",backendName:"webgl",kernelFunc:Yz};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jz(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(s.dataId),a=Yz({inputs:{x:r},backend:n}),u=Yz({inputs:{x:i},backend:n});return o.complexTensorInfos={real:a,imag:u},s}const Zz={kernelName:"Complex",backendName:"webgl",kernelFunc:Jz},tB="return (a < 0.) ? b * a : a;",eB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nB={kernelName:"LeakyRelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r,o=n.makeTensorInfo([],"float32",ry(s,"float32")),a=rm().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xz(eB,i.shape,o.shape):new qz(tB,i.shape,o.shape),u=n.runWebGLProgram(a,[i,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},rB="return (a < 0.) ? b * a : a;",iB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sB={kernelName:"Prelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e,s=rm().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xz(iB,r.shape,i.shape):new qz(rB,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:s})=>{const{x:o}=i,a=s,u=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&null!=n){const t=a.texData.get(o.dataId),e=n(t.values,u);return a.makeTensorInfo(o.shape,u,e)}let l;return l=rm().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=e?new Uz(o.shape,e):new zz(o.shape,t),a.runWebGLProgram(l,[o],u)}}function aB({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:s}){return({inputs:o,backend:a})=>{const{a:u,b:l}=o,c=a;if(r&&"complex64"===u.dtype){const e=c.texData.get(u.dataId),n=c.texData.get(l.dataId),[r,i]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,r]=e,i={dataId:n.dataId,dtype:n.dtype,shape:u.shape},s={dataId:r.dataId,dtype:r.dtype,shape:l.shape},o=new qz(t,u.shape,l.shape);return c.runWebGLProgram(o,[i,s],Oy(n.dtype,r.dtype))})),s=Jz({inputs:{real:r,imag:i},backend:c});return c.disposeIntermediateTensorInfo(r),c.disposeIntermediateTensorInfo(i),s}const h=s||Oy(u.dtype,l.dtype);if(("string"===u.dtype||"string"===l.dtype||c.shouldExecuteOnCPU([u,l]))&&null!=i){const t=c.texData.get(u.dataId).values,e=c.texData.get(l.dataId).values,n="string"===u.dtype?jS(t):t,r="string"===u.dtype?jS(e):e,[s,o]=i(u.shape,l.shape,n,r,h),a=c.makeTensorInfo(o,h);return c.texData.get(a.dataId).values=s,a}let d;return d=rm().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=e?new Xz(e,u.shape,l.shape,n):new qz(t,u.shape,l.shape),c.runWebGLProgram(d,[u,l],h)}}function uB(t,e=!1){if("linear"===t)return"return x;";if("relu"===t)return e?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===t)return e?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===t)return e?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===t)return e?iB:rB;if("leakyrelu"===t)return e?eB:tB;if("sigmoid"===t)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lB{constructor(t,e,n,r=!1,i=!1,s=!1,o=null,a=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=bM(this.outputShape.length);const l=r?t[1]:t[2],c=Math.ceil(l/2),h=r?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",m="";o&&(g=a?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${o}\n        }`:u?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${o}\n        }`:`vec4 activation(vec4 x) {\n          ${o}\n        }`,m="result = activation(result);");const y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";t[0]<e[0]?b=`imod(rc.x, ${t[0]})`:e[0]<t[0]&&(v=`imod(rc.x, ${e[0]})`),this.userCode=`\n      ${g}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${c}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ${b};\n        int batchB = ${v};\n        for (int i = 0; i < ${c}; i++) {\n          vec4 a = getMatrixA(batchA, ${h});\n          vec4 b = getMatrixB(batchB, ${d});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${f[0]});\n          result += (${p[1]} * ${f[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${m}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cB="return areal * breal - aimag * bimag;",hB="return areal * bimag + aimag * breal;";class dB{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=cx(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pB="return a * b;";function fB(t){const{inputs:e,backend:n}=t,{a:r,b:i}=e,s=Oy(r.dtype,i.dtype);if("complex64"===r.dtype){const t=n.texData.get(r.dataId),e=n.texData.get(i.dataId),s=new dB(cB,r.shape,i.shape),o=new dB(hB,r.shape,i.shape),a=[{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:r.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:i.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:i.shape}],u=n.runWebGLProgram(s,a,"float32"),l=n.runWebGLProgram(o,a,"float32"),c=Jz({inputs:{real:u,imag:l},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),c}if(n.shouldExecuteOnCPU([r,i])){const t=n.texData.get(r.dataId),e=n.texData.get(i.dataId),[o,a]=iz(r.shape,i.shape,t.values,e.values,s),u=n.makeTensorInfo(a,s);return n.texData.get(u.dataId).values=o,u}let o;return o=rm().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xz(pB,r.shape,i.shape):new qz(pB,r.shape,i.shape),n.runWebGLProgram(o,[r,i],s)}const gB={kernelName:"Multiply",backendName:"webgl",kernelFunc:fB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mB(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,o=n,a=Ng(i.shape),u=Dg(s,a),l=Ng(u);Sg(a===l,(()=>`The new shape (${u}) has ${l} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`));const c=o.texData.get(i.dataId);return!c.isPacked||zP(i.shape,u)||null!==c.texture&&zP(c.shape,u)?(o.incRef(i.dataId),{dataId:i.dataId,shape:u,dtype:i.dtype}):function(t,e,n){const r=[OP(t.shape),...LP(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},s=[OP(e),...LP(e)],o=new Fz(s,r),a=[r],u=n.runWebGLProgram(o,[i],t.dtype,a,!0);return{dataId:u.dataId,shape:e,dtype:u.dtype}}(i,u,o)}const yB={kernelName:"Reshape",backendName:"webgl",kernelFunc:mB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bB{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:s}=t;this.outputShape=[r,s];const o=4*Math.floor(n/4),a=n%4;let u="sumValue += dot(values, ones);";if(null!=e){const t=1/e;u=`sumValue += dot(values * ${Rg(t)?t.toPrecision(2):t}, ones);`}let l="";i%n>0&&(l=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${l}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===a}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${u}\n        } else if (${2===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${u}\n        } else if (${3===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vB{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:s}=t;this.outputShape=[r,s];let o="0.0",a="";"prod"===e?o="1.0":"min"===e?(o="1.0 / 1e-20",a="min"):"max"===e&&(o="-1.0 / 1e-20",a="max");let u=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");const l=4*Math.floor(n/4),c=n%4;let h=`\n      if (${"sum"===e}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===e}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${a}(values, minMaxValue);\n        if (${"min"===e} || ${"max"===e}) {\n          minMaxValue = ${a}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,d="vec4";"all"===e?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let p="";i%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${o};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${o});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${l}; i += 4) {\n          int inIdx = inOffset + i;\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${l};\n        if (${1===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${2===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${3===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${h}\n        }\n        setOutput(${u});\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(t,e,n,r){const i=function(t){const e=[];for(;0===e.length||1!==e[e.length-1].outSize;){const n=e.length?e[e.length-1].outSize:t[1],r=sS(n);e.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return e}(t.shape);let s=t;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:u,outSize:l}=i[o];let c,h;c="mean"===n?0===o?new bB({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:l},a):new bB({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:l}):new vB({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:l},n),h=s,s=r.runWebGLProgram(c,[s],e),h.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(h)}return s}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wB{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let s=0;s<n.length;s++)n[s]=t[e[s]];this.outputShape=n,this.rank=n.length;const r=hM(this.rank),i=function(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let i=0;i<t.length;i++)r[t[i]]=n[i];return r.join()}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${i}));\n    }\n    `}}class kB{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(t.length);for(let l=0;l<n.length;l++)n[l]=t[e[l]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=hM(this.rank),i=_z("rc",this.rank),s=new Array(this.rank);for(let l=0;l<e.length;l++)s[e[l]]=i[l];const o=`vec2(${s.slice(-2).join()})`,a=`++${i[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${s.join()}), ${o})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${u};\n      if(${a}) {\n        result[1] = ${u};\n      }\n      --${i[this.rank-1]};\n      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${u};\n        if(${a}) {\n          result[3] = ${u};\n        }\n      }\n      setOutput(result);\n    }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(t,e,n){const r=rm().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kB(t.shape,e):new wB(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SB(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;return function(t,e,n,r){const i=e,s=t.shape.length,o=Fg(i,t.shape);let a=o;const u=Ix(a,s),l=null!=u;let c=t;l&&(c=IB(t,u,r),a=Tx(a.length,s)),kx("sum",a,s);const[h,d]=xx(c.shape,a);let p=h;n&&(p=wx(h,o));const f=Ng(d),g=mB({inputs:{x:c},attrs:{shape:[Ng(t.shape)/f,f]},backend:r}),m=xB(g,Ly(t.dtype),"sum",r),y=mB({inputs:{x:m},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(m),l&&r.disposeIntermediateTensorInfo(c),y}(i,s,o,n)}const TB={kernelName:"Sum",backendName:"webgl",kernelFunc:SB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{perm:s}=r,o=n,a=i.shape.length,u=new Array(a);for(let c=0;c<u.length;c++)u[c]=i.shape[s[c]];let l;if(o.shouldExecuteOnCPU([i])){const t=o.texData.get(i.dataId).values,e=Rz(t,i.shape,i.dtype,s,u);l=o.makeTensorInfo(u,i.dtype);o.texData.get(l.dataId).values=e}else l=IB(i,s,o);return l}const NB={kernelName:"Transpose",backendName:"webgl",kernelFunc:CB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB({a:t,b:e,transposeA:n,transposeB:r,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:u=null}){const l=t.shape.length,c=e.shape.length,h=n?t.shape[l-2]:t.shape[l-1],d=r?e.shape[c-1]:e.shape[c-2],p=n?t.shape[l-1]:t.shape[l-2],f=r?e.shape[c-2]:e.shape[c-1],g=t.shape.slice(0,-2),m=e.shape.slice(0,-2),y=Ng(g),b=Ng(m),v=cx(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,f]);Sg(h===d,(()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${r} must match.`));const x=n?[y,h,p]:[y,p,h],w=r?[b,f,d]:[b,d,f],k=mB({inputs:{x:t},backend:i,attrs:{shape:x}}),I=mB({inputs:{x:e},backend:i,attrs:{shape:w}}),S=[k,I],T=Math.max(y,b),C=n?k.shape[1]:k.shape[2],N=null!=s,E=null!=o,R="leakyrelu"===u,$=null!=u?uB(u,!0):null;let _;if((1===p||1===f)&&C>1e3&&!1===(N||E||R||null!=$)){let t=k,e=I;n&&(t=CB({inputs:{x:k},backend:i,attrs:{perm:[0,2,1]}}),S.push(t)),r&&(e=CB({inputs:{x:I},backend:i,attrs:{perm:[0,2,1]}}),S.push(e));const s=1===f;let o=t;1!==f&&(o=mB({inputs:{x:t},backend:i,attrs:{shape:[T,C,1]}}),S.push(o));const a=1===f?2:1;let u=e;s&&(u=mB({inputs:{x:e},backend:i,attrs:{shape:[T,1,C]}}),S.push(u));const l=fB({inputs:{a:o,b:u},backend:i});_=SB({inputs:{x:l},backend:i,attrs:{axis:a,keepDims:!0}}),S.push(l)}else{const u=Oy(t.dtype,e.dtype),l=new lB(x,w,[T,p,f],n,r,N,$,E,R),c=[k,I];if(null!=s&&c.push(s),E&&c.push(o),R){const t=i.makeTensorInfo([],"float32",ry(a,"float32"));c.push(t),S.push(t)}_=i.runWebGLProgram(l,c,u)}const A=mB({inputs:{x:_},backend:i,attrs:{shape:v}});S.push(_);for(const D of S)i.disposeIntermediateTensorInfo(D);return A}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RB={kernelName:"_FusedMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:h}=r;return EB({a:i,b:s,transposeA:u,transposeB:l,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:c})}},$B="return abs(x);";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _B={kernelName:"Abs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const t=n.texData.get(r.dataId),e=gz(t.values);return n.makeTensorInfo(r.shape,r.dtype,e)}let i;return i=rm().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Uz(r.shape,$B):new zz(r.shape,$B),n.runWebGLProgram(i,[r],r.dtype)}},AB={kernelName:"Acos",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"})},DB={kernelName:"Acosh",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"})},FB="return a + b;",OB={kernelName:"Add",backendName:"webgl",kernelFunc:aB({opSnippet:FB,packedOpSnippet:FB,supportsComplex:!0,cpuKernelImpl:PM})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class LB{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`float v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PB{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MB={kernelName:"AddN",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,i=n;if(1===i.length)return Yz({inputs:{x:i[0]},backend:r});if(i.length>rm().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const e=Math.floor(i.length/2),n=t({inputs:i.slice(0,e),backend:r}),s=t({inputs:i.slice(e),backend:r});return t({inputs:[n,s],backend:r})}const s=i.map((t=>t.dtype)).reduce(((t,e)=>Oy(t,e))),o=i.map((t=>t.shape)),a=rm().getBool("WEBGL_PACK")?new PB(i[0].shape,o):new LB(i[0].shape,o);return r.runWebGLProgram(a,i,s)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zB={kernelName:"All",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,u=Fg(s,i.shape);let l=u;const c=Ix(l,a);let h=i;null!=c&&(h=CB({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Tx(l.length,a)),kx("all",l,a);const[d,p]=xx(h.shape,l),f=mB({inputs:{x:h},backend:n,attrs:{shape:[-1,Ng(p)]}}),g=xB(f,f.dtype,"all",n);let m;if(o){m=mB({inputs:{x:g},backend:n,attrs:{shape:wx(d,u)}})}else m=mB({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),null!=c&&n.disposeIntermediateTensorInfo(h),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BB={kernelName:"Any",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,u=Fg(s,i.shape);let l=u;const c=Ix(l,a);let h=i;null!=c&&(h=CB({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Tx(l.length,a)),kx("any",l,a);const[d,p]=xx(h.shape,l),f=mB({inputs:{x:h},backend:n,attrs:{shape:[-1,Ng(p)]}}),g=xB(f,f.dtype,"any",n);let m;if(o){m=mB({inputs:{x:g},backend:n,attrs:{shape:wx(d,u)}})}else m=mB({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),null!=c&&n.disposeIntermediateTensorInfo(h),m}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UB{constructor(t,e,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:s}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];const o="max"===e?">":"<",a=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${a};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${o} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VB{constructor(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Sg(t.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const i=t[t.length-1],s=Math.ceil(i/e);this.outputShape=t.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");const o=this.outputShape,a=o.length,u=hM(a),l=Az("coords",a);let c,h;if(1===s){h=a+1;const t=hM(h);c=`\n        ${t} sourceLocR = ${t}(${l.join()}, 0);\n        ++${l[a-1]};\n        ${t} sourceLocG = ${t}(${l.join()}, 0);\n        ++${l[a-2]};\n        ${t} sourceLocA = ${t}(${l.join()}, 0);\n        --${l[a-1]};\n        ${t} sourceLocB = ${t}(${l.join()}, 0);\n        --${l[a-2]};`}else h=a,c=`\n        ${u} sourceLocR = coords;\n        ++${l[a-1]};\n        ${u} sourceLocG = coords;\n        ++${l[a-2]};\n        ${u} sourceLocA = coords;\n        --${l[a-1]};\n        ${u} sourceLocB = coords;\n        --${l[a-2]};`;const d=["x","y","z","w","u","v"].slice(0,h),p="."+d[h-1],f=d.map((t=>"int "+t)),g=Az("sourceLocR",h-1).concat("inIdx.r"),m=Az("sourceLocG",h-1).concat("inIdx.g"),y=Az("sourceLocB",h-1).concat("inIdx.b"),b=Az("sourceLocA",h-1).concat("inIdx.a"),v="max"===n?"greaterThan":"lessThan",x=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,w=`vec4(\n            getAChannel(${g.join()}),\n            hasNextCol ? getAChannel(${m.join()}) : 0.,\n            hasNextRow ? getAChannel(${y.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,k=r?"":`\n      float getBestIndicesAChannel(${f.join()}) {\n        return getChannel(getBestIndicesA(${d.join()}),\n                                          vec2(${d.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${f.join()}) {\n        return getChannel(getA(${d.join()}),\n                               vec2(${d.slice(-2).join()}));\n      }\n      ${k}\n      void main() {\n        ${u} coords = getOutputCoords();\n        bool hasNextCol = ${l[a-1]} < ${o[a-1]-1};\n        bool hasNextRow = ${l[a-2]} < ${o[a-2]-1};\n        ${c}\n        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},\n          sourceLocB${p}, sourceLocA${p}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${w};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${x}\n          vec4 candidate = ${w};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WB(t,e,n,r=null){let i=e.shape[0],s=e.shape[1];null!=r&&(i=r.shape[0],s=r.shape[1]);const o=sS(s),a={windowSize:o,inSize:s,batchSize:i,outSize:Math.ceil(s/o)},u=new UB(a,n,null==r),l=[e];null!=r&&l.push(r);const c=t.runWebGLProgram(u,l,"int32");if(1===c.shape[1])return c;const h=WB(t,e,n,c);return t.disposeIntermediateTensorInfo(c),h}function GB(t,e,n,r=null){const i=null!=r?r.shape:e.shape,s=sS(i[i.length-1]),o=new VB(i,s,n,null==r),a=null==r?[e]:[e,r],u=t.runWebGLProgram(o,a,"int32");if(u.shape.length===e.shape.length){const r=GB(t,e,n,u);return t.disposeIntermediateTensorInfo(u),r}return u}function jB(t,e,n,r){const i=[n];if(kx("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,e.shape.length),!rm().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const n=[],s=t.texData.get(e.dataId);let o=e;null!==s&&s.isPacked&&(o=t.unpackTensor(e),n.push(o));const[a,u]=xx(o.shape,i),l=Ng(u),c=mB({inputs:{x:o},backend:t,attrs:{shape:[-1,l]}});n.push(c);const h=WB(t,c,r);n.push(h);const d=mB({inputs:{x:h},backend:t,attrs:{shape:a}});return n.forEach((e=>t.disposeIntermediateTensorInfo(e))),d}return GB(t,e,r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HB={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let o=Fg(s,i.shape);const a=Ix(o,i.shape.length);let u=i;const l=[];null!=a&&(u=CB({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=Tx(o.length,u.shape.length)),kx("argMax",[o[0]],u.shape.length);const c=jB(n,u,o[0],"max");return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qB={kernelName:"ArgMin",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let o=Fg(s,i.shape);const a=Ix(o,i.shape.length);let u=i;const l=[];null!=a&&(u=CB({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=Tx(o.length,u.shape.length)),kx("argMin",[o[0]],u.shape.length);const c=jB(n,u,o[0],"min");return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}},KB={kernelName:"Asin",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"})},XB={kernelName:"Asinh",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"})},YB={kernelName:"Atan",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"})},QB={kernelName:"Atan2",backendName:"webgl",kernelFunc:aB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"})},JB={kernelName:"Atanh",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ZB{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,o=t.strideHeight,a=t.strideWidth,u=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const f="avg"===e,g=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,m=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let y="0.0";if(f||(y="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${o}, ${a});\n        const ivec2 pads = ivec2(${d}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h};\n                wC += ${l}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${e} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?i?g:m:`wR * ${h} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(b="avgValue / max(count, 1.0)");const v=4*Math.floor(s/4),x=s%4,w=`\n      if (${f}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${o}, ${a});\n      const ivec2 pads = ivec2(${d}, ${p});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${u}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${v}; wC += 4) {\n            int xC = xCCorner + wC * ${l};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              getValue(batch, xR, xC + 3 * ${l}, d)\n            );\n\n            ${w}\n          }\n\n          int xC = xCCorner + ${v};\n          if (${1===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${2===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${3===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              initializationValue\n            );\n\n            ${w}\n          }\n        }\n        setOutput(${b});\n      }\n    `}}class tU{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,o=t.strideDepth,a=t.strideHeight,u=t.strideWidth,l=t.dilationDepth,c=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,f=t.effectiveFilterWidth,g=t.padInfo.front,m=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;const b="avg"===e;let v="0.0";if(b||(v="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${o}, ${a}, ${u});\n        const ivec3 pads = ivec3(${g}, ${m}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${d};\n              wD += ${l}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${c}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${f};\n                  wC += ${h}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${e} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?i?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${f} +\n                      wR * ${f} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let x=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(x="avgValue / max(count, 1.0)");const w=4*Math.floor(s/4),k=s%4,I=`\n      if (${b}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${o}, ${a}, ${u});\n      const ivec3 pads = ivec3(${g}, ${m}, ${y});\n      const float initializationValue = ${v};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${v});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${d};\n            wD += ${l}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${c}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${w}; wC += 4) {\n              int xC = xCCorner + wC * ${h};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${h}, ch)\n              );\n\n              ${I}\n            }\n\n            int xC = xCCorner + ${w};\n            if (${1===k}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${I}\n            } else if (${2===k}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${I}\n            } else if (${3===k}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                initializationValue\n              );\n\n              ${I}\n            }\n          }\n        }\n        setOutput(${x});\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eU={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;HP(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r;Sg(wv(o,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const l=hv(i.shape,s,o,1,a,u);if(1===l.filterWidth&&1===l.filterHeight&&Eg(l.inShape,l.outShape))return Yz({inputs:{x:i},backend:n});const c=new ZB(l,"avg",!1);return n.runWebGLProgram(c,[i],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nU={kernelName:"AvgPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r,c=dv(i.shape,s,o,[1,1,1],a,u,l),h=new tU(c,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rU{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s=t.dilationHeight,o=t.dilationWidth,a=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=a-1-t.padInfo.top,c=u-1-t.padInfo.left,h=1/(e*n);this.userCode=`\n      const ivec2 pads = ivec2(${l}, ${c});\n      const float avgMultiplier = float(${h});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${a};\n            wR += ${s}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${u};\n            wC+= ${o}) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class iU{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=c-1-t.padInfo.front,f=h-1-t.padInfo.top,g=d-1-t.padInfo.left,m=1/(e*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${f}, ${g});\n      const float avgMultiplier = float(${m});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${c};\n            wD += ${a}) {\n          float dyD = float(dyDCorner + wD) / ${i}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${h};\n              wR += ${u}) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${d};\n                wC += ${l}) {\n              float dyC = float(dyCCorner + wC) / ${o}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sU={kernelName:"AvgPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=r,h=dv(o.shape,a,u,[1,1,1],l,c),d=new iU(h);return n.runWebGLProgram(d,[i],o.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oU={kernelName:"AvgPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s;HP([i,s],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=r,c=hv(o.shape,a,u,1,l),h=new rU(c);return n.runWebGLProgram(h,[i],o.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aU={kernelName:"BatchMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:o,transposeB:a}=r;return EB({a:i,b:s,transposeA:o,transposeB:a,backend:n})}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uU{constructor(t,e,n,r,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],cx(t,e),cx(t,n);let o="0.0";null!=r&&(cx(t,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="1.0";null!=i&&(cx(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${o};\n        float scale = ${a};\n        float inv = scale * inversesqrt(variance + float(${s}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lU{constructor(t,e,n,r,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],cx(t,e),cx(t,n);let o="vec4(0.0)";null!=r&&(cx(t,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="vec4(1.0)";null!=i&&(cx(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${o};\n        vec4 scale = ${a};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${s}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cU={kernelName:"FusedBatchNorm",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,mean:i,variance:s,offset:o,scale:a}=t;Sg(i.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Sg(null==o||i.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Sg(null==a||i.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:u}=n;null==u&&(u=.001);const l=[r,i,s];let c=null;null!=o&&(c=o.shape,l.push(o));let h=null;null!=a&&(h=a.shape,l.push(a));const d=rm().getBool("WEBGL_PACK_NORMALIZATION")?new lU(r.shape,i.shape,s.shape,c,h,u):new uU(r.shape,i.shape,s.shape,c,h,u);return e.runWebGLProgram(d,l,l[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class hU{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=hM(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(t){if(1===t)return"sourceLoc";if(t<=6)return dU.slice(0,t).map((t=>"sourceLoc."+t)).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.rank);let r;r=`\n        ${e} sourceLoc;\n        ${e} coords = getOutputCoords();\n        ${t.map(((t,e)=>`sourceLoc.${dU[e]} = start[${e}] + coords.${dU[e]};`)).join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const dU=["x","y","z","w","u","v"];class pU{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=hM(this.rank),n=Az("coords",this.rank),r=Az("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${i})`,o=`\n      result.x = ${s};\n      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${s};\n        --${r[this.rank-1]};\n      }\n    `,a=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${s};\n        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${s};\n        }\n      }\n    `,u=this.rank<=4?`sourceLoc = coords +\n            ${e}(${t.map(((t,e)=>`start[${e}]`)).join()});`:t.map(((t,e)=>`${r[e]} = ${n[e]} + start[${e}];`)).join("\n");this.userCode=`\n      void main() {\n        ${e} coords = getOutputCoords();\n        ${e} sourceLoc;\n        ${u}\n        vec4 result = vec4(0.);\n        ${o}\n        ${a}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fU(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:o}=r,[a,u]=GI(i,s,o);if(AI(i,a,u),0===Ng(u))return n.makeTensorInfo(u,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){const t=n.texData.get(i.dataId),e=mz(t.values,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,e)}const{isPacked:l}=n.texData.get(i.dataId),c=VI(i.shape,a,u);if(l||!c){const t=rm().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pU(u):new hU(u),e=[a];return n.runWebGLProgram(t,[i],i.dtype,e)}return n.uploadToGPU(i.dataId),function(t,e,n,r){const i=r.texData.get(t.dataId),s=r.makeTensorInfo(n,t.dtype),o=r.texData.get(s.dataId);Object.assign(o,i),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=WI(e,jg(t.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||t.dataId};const u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),s}(i,a,u,n)}const gU={kernelName:"Slice",backendName:"webgl",kernelFunc:fU},mU={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:o}=r;Sg(i.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const a=s.reduce(((t,e)=>t*e)),u=aS(i.shape,s,a),l=uS(u.length,s.length),c=lS(i.shape,s,a),h=cS(o,s.length),d=hS(c,o,s.length),p=[],f=mB({inputs:{x:i},backend:n,attrs:{shape:u}}),g=CB({inputs:{x:f},backend:n,attrs:{perm:l}}),m=mB({inputs:{x:g},backend:n,attrs:{shape:c}}),y=fU({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return p.push(f),p.push(g),p.push(m),p.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yU={kernelName:"Bincount",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o}=r,a=n.readSync(i.dataId),u=n.readSync(s.dataId),l=MM(a,u,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,l)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU={kernelName:"BroadcastArgs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.readSync(r.dataId),o=n.readSync(i.dataId),a=cx(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}},vU=aB({opSnippet:"return float(a != b);",cpuKernelImpl:oz,dtype:"bool"}),xU={kernelName:"NotEqual",backendName:"webgl",kernelFunc:vU};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function wU(t){const{inputs:e,backend:n}=t,{input:r}=e;return Yz({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const kU={kernelName:"Real",backendName:"webgl",kernelFunc:wU};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IU={kernelName:"Cast",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function t(e){const{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{dtype:o}=i;if("complex64"===o){if("complex64"===s.dtype)return Yz({inputs:{x:s},backend:r});const e=mw(s.shape),n=t({inputs:{x:s},backend:r,attrs:{dtype:"float32"}}),i=Jz({inputs:{real:n,imag:e},backend:r});return e.dispose(),r.disposeIntermediateTensorInfo(n),i}if("complex64"===s.dtype){const e=wU({inputs:{input:s},backend:r}),n=t({inputs:{x:e},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(e),n}if(!Mg(s.dtype,o)){const t=Yz({inputs:{x:s},backend:r});return{dataId:t.dataId,shape:t.shape,dtype:o}}if(r.shouldExecuteOnCPU([s])){const t=r.texData.get(s.dataId).values,[e,n,i]=BM(t,s.shape,s.dtype,o);return r.makeTensorInfo(e,n,i)}if("int32"===o)return function(t,e){const n=new zz(t.shape,"return float(int(x));"),r=e.runWebGLProgram(n,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(s,r);if("bool"===o){const t=r.makeTensorInfo([],"bool",Lg("bool",1)),e=vU({inputs:{a:s,b:t},backend:r});return r.disposeIntermediateTensorInfo(t),e}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${o}`)}},SU="return ceil(x);",TU={kernelName:"Ceil",backendName:"webgl",kernelFunc:oB({opSnippet:SU,packedOpSnippet:SU,cpuKernelImpl:UM})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class CU{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NU{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{clipValueMin:s,clipValueMax:o}=r;let a;a=rm().getBool("WEBGL_PACK_CLIP")?new NU(i.shape):new CU(i.shape);const u=[[s],[o]];return n.runWebGLProgram(a,[i],i.dtype,u)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RU{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $U(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}const _U={kernelName:"ComplexAbs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=n.texData.get(r.dataId),s=new RU(r.shape),o=[$U(r,i.complexTensorInfos.real),$U(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AU{constructor(t){this.outputShape=[],this.outputShape=JI(t,1),this.variableNames=t.map(((t,e)=>`T${e}`));const e=new Array(t.length-1);e[0]=t[0][1];for(let s=1;s<e.length;s++)e[s]=e[s-1]+t[s][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<e.length;s++){const t=e[s-1];n.push(`else if (yC < ${e[s]}) setOutput(getT${s}(yR, yC-${t}));`)}const r=e.length,i=e[e.length-1];n.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DU{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=JI(t,e);const n=this.outputShape,r=n.length,i=hM(r),s=Az("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(((t,e)=>`T${e}`));const a=new Array(t.length-1);a[0]=t[0][e];for(let f=1;f<a.length;f++)a[f]=a[f-1]+t[f][e];const u=o[e],l=o.slice(-2),c=o.join();let h=`if (${u} < ${a[0]}) {\n        return getChannel(\n            getT0(${c}), vec2(${l.join()}));\n        }`;for(let f=1;f<a.length;f++){const t=a[f-1];h+=`\n        if (${u} < ${a[f]}  && ${u} >= ${a[f-1]}) {\n          return getChannel(\n            getT${f}(${FU(o,u,t)}),\n            vec2(${FU(l,u,t)}));\n        }`}const d=a.length,p=a[a.length-1];h+=`\n        return getChannel(\n          getT${d}(${FU(o,u,p)}),\n          vec2(${FU(l,u,p)}));`,this.userCode=`\n      float getValue(${o.map((t=>"int "+t))}) {\n        ${h}\n      }\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${s}), 0., 0., 0.);\n\n        ${s[r-1]} = ${s[r-1]} + 1;\n        if (${s[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${s});\n        }\n\n        ${s[r-2]} = ${s[r-2]} + 1;\n        if (${s[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${s});\n        }\n\n        ${s[r-1]} = ${s[r-1]} - 1;\n        if (${s[r-2]} < ${n[r-2]} &&\n            ${s[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${s});\n        }\n        setOutput(result);\n      }\n    `}}function FU(t,e,n){const r=t.indexOf(e);return t.map(((t,e)=>e===r?`${t} - ${n}`:t)).join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OU(t){const{inputs:e,backend:n}=t,{input:r}=e;return Yz({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const LU={kernelName:"Imag",backendName:"webgl",kernelFunc:OU};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PU(t,e,n){const r=t[0].dtype;if("complex64"===r){const r=t.map((t=>wU({inputs:{input:t},backend:n}))),i=t.map((t=>OU({inputs:{input:t},backend:n}))),s=PU(r,e,n),o=PU(i,e,n),a=Jz({inputs:{real:s,imag:o},backend:n});return r.forEach((t=>n.disposeIntermediateTensorInfo(t))),i.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),a}let i=n.shouldExecuteOnCPU(t);if("string"===r&&(i=!0),i){const i=t.map((t=>{const r=Ng(t.shape.slice(e));return mB({inputs:{x:t},backend:n,attrs:{shape:[-1,r]}})})),s=i.map((t=>({vals:n.readSync(t.dataId),shape:t.shape}))),o=JI(i.map((t=>t.shape)),1),a=1===i[0].shape[0],u=VM(s,o,r,a),l=JI(t.map((t=>t.shape)),e),c=n.makeTensorInfo(l,r,u);return i.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}const s=t.filter((t=>Ng(t.shape)>0)),o=rm().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(1===s.length){const e=o?new zz(t[0].shape,Bz):new Uz(t[0].shape,Bz);return n.runWebGLProgram(e,t,r)}const a=rm().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){const t=[];for(let i=0;i<s.length;i+=a){const r=s.slice(i,i+a);t.push(PU(r,e,n))}const r=PU(t,e,n);for(const e of t)n.disposeIntermediateTensorInfo(e);return r}if(o){const t=new DU(s.map((t=>t.shape)),e);return n.runWebGLProgram(t,s,r)}const{tensors2D:u,outShape:l}=function(t,e,n){const r=JI(t.map((t=>t.shape)),e);return{tensors2D:t.map((t=>mB({inputs:{x:t},attrs:{shape:[-1,Ng(t.shape.slice(e))]},backend:n}))),outShape:r}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(s,e,n),c=new AU(u.map((t=>t.shape))),h=n.runWebGLProgram(c,u,r);u.forEach((t=>n.disposeIntermediateTensorInfo(t)));const d=mB({inputs:{x:h},attrs:{shape:l},backend:n});return n.disposeIntermediateTensorInfo(h),d}function MU(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=Fg(i,e[0].shape)[0];QI(e.map((t=>t.shape)),s);const o=JI(e.map((t=>t.shape)),s);if(0===Ng(o))return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter((t=>Ng(t.shape)>0));return 1===a.length?Yz({inputs:{x:a[0]},backend:n}):PU(a,s,n)}const zU={kernelName:"Concat",backendName:"webgl",kernelFunc:MU};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BU{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const s=t.padInfo.top,o=t.padInfo.left,a=t.strideHeight,u=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4,g="channelsLast"===t.dataFormat,m=g?1:2,y=g?2:3,b=g?3:1;let v="",x="";n&&(v=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,x="result = activation(result);");const w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${a}, ${u});\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${b}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${m}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${h}; wR++) {\n          int xR = xRCorner + wR * ${l};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${d}; wC++) {\n            int xC = xCCorner + wC * ${c};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${g}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${g}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${g}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${g}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${w}\n        ${x}\n        setOutput(result);\n      }\n    `}}class UU{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterDepth,h=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${s}, ${o});\n      const ivec3 pads = ivec3(${e}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${c}; wF++) {\n          int xF = xFCorner + wF * ${a};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${h}; wR++) {\n            int xR = xRCorner + wR * ${u};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d}; wC++) {\n              int xC = xCCorner + wC * ${l};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===f}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===f}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===f}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VU{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=bM(this.outputShape.length);const s=t.padInfo.left,o=t.strideWidth,a=t.dilationWidth,u=t.filterHeight,l=t.filterWidth,c=l;let h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let g=0;g<l;g++)h+=`\n           vec4 xTexelC${2*g};\n           int xTexelC${2*g}Ready;\n           vec4 xTexelC${2*g+1};\n           int xTexelC${2*g+1}Ready;\n           vec4 xC${g};`;h+=`\n     for (int r = 0; r < ${u}; r++) {\n      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {\n       `;for(let g=0;g<l;g++)h+=`\n           xTexelC${2*g} = vec4(0.0);\n           xTexelC${2*g}Ready = 0;\n           xTexelC${2*g+1} = vec4(0.0);\n           xTexelC${2*g+1}Ready = 0;\n           xC${g} = vec4(0.0);`;h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let g=0;g<(c+1)/2;g++){const e=2*g;if(h+=`\n           xC = xCCorner + ${e*a};\n           `,1===o){if(e<l&&(s%2==1?(h+=`\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                   xTexelC${e} = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${e}.zw = vec2(0.0);\n                   }\n                   xTexelC${e}Ready = 1;\n                 }\n               `,h+=1===a&&e>0?`\n                 xC${e} = vec4(xTexelC${e-2}.zw, xTexelC${e}.xy);\n                 `:`\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC${e} = vec4(previous.zw, xTexelC${e}.xy);\n                   } else {\n                     xC${e} = vec4(0.0, 0.0, xTexelC${e}.xy);\n                   }\n                   `):h+=`\n                 if (xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                   xTexelC${e} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${e}.zw = vec2(0.0);\n                   }\n                   xTexelC${e}Ready = 1;\n                 }\n\n                 xC${e} = xTexelC${e};\n                 `,e+1<l)){const t=s%2==0?kg(a):a;a%2==0&&s%2==1||a%2!=0&&s%2!=1?(h+=`\n                   xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                     xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC${e+1}.zw = vec2(0.0);\n                     }\n                     xTexelC${e+1}Ready = 1;\n                   }\n                   `,h+=a>1?`\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC${e+1} = vec4(previous.zw, xTexelC${e+1}.xy);\n                     } else {\n                      xC${e+1} = vec4(0.0, 0.0, xTexelC${e+1}.xy);\n                     }\n                     `:`\n                     xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.xy);\n                     `):h+=1===t?`\n                     xC${e+1} = xTexelC${e};\n                     `:`\n                     xCOffset = xC + ${t};\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                       xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC${e+1}.zw = vec2(0.0);\n                       }\n                       xTexelC${e+1}Ready = 1;\n                     }\n\n                     xC${e+1} = xTexelC${e+1};\n                     `}}else e<l&&(s%2==1?(h+=`\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                   xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${e}.zw = vec2(0.0);\n                   }\n                   xTexelC${e}Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${e+1}Ready == 0) {\n                   xTexelC${e+1} = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC${e+1}.zw = vec2(0.0);\n                   }\n                   xTexelC${e+1}Ready = 1;\n                 }\n\n                 xC${e} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n               `,e+1<l&&(h+=`\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC${e+1} = vec4(xTexelC${e+1}.xy, final.xy);\n                 `)):(h+=`\n                 if(xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                   xTexelC${e} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${e}.zw = vec2(0.0);\n                   }\n                   xTexelC${e}Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                   xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${e+1}.zw = vec2(0.);\n                   }\n                   xTexelC${e+1}Ready = 1;\n                 }\n\n                 xC${e} = vec4(\n                   xTexelC${e}.xy, xTexelC${e+1}.xy);\n               `,e+1<l&&(h+=`\n                   xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n                 `)));e<l&&(h+=`\n             wTexel = getW(r, ${e}, d1, d2);\n             dotProd += xC${e}.xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ${t.inChannels}) {\n               dotProd += xC${e}.yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           `,e+1<l&&(h+=`\n               wTexel = getW(r, ${e+1}, d1, d2);\n               dotProd += xC${e+1}.xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ${t.inChannels}) {\n                 dotProd += xC${e+1}.yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             `))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";let d="",p="";n&&(d=r?`vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ${n}\n         }`:i?`vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ${n}\n         }`:`vec4 activation(vec4 x) {\n           ${n}\n         }`,p="result = activation(result);");const f=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n       ${d}\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ${h}\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ${f}\n         ${p}\n         setOutput(result);\n       }\n     `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WU{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=bM(this.outputShape.length);const{dataFormat:n}=e,r=KP(),i="channelsLast"===n,s=i?1:2,o=i?2:3,a=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let u="";for(let l=0;l<=1;l++)for(let t=0;t<=1;t++)u+=`\n          blockIndex = rc.z + ${t};\n          pos = rc.y + ${l};\n\n          ${a}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${s}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${o}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${i}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*l+t}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*l+t}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${u}\n\n        ${r.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GU(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&1===n&&t[0]>1?[t[0],1]:null}function jU({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const u=t.shape,l=r.texData.get(t.dataId),c=n.inChannels,h=u[0]*u[1]*u[2],d=n.outChannels,p="channelsLast"===n.dataFormat;let f;const g=[];if(null!=s){const t=GU(s.shape,p);null!=t&&(s=mB({inputs:{x:s},backend:r,attrs:{shape:t}}),g.push(s))}if(null!=i){const t=GU(i.shape,p);null!=t&&(i=mB({inputs:{x:i},backend:r,attrs:{shape:t}}),g.push(i))}if(!((1===h||1===d)&&c>1e3)&&l.isPacked&&p&&null!=l.texture&&u[2]%2!=0&&Eg(l.shape.slice(-3),u.slice(-3))){const c=u[0]*u[1]*(u[2]+1),h={dataId:t.dataId,shape:[1,c,n.inChannels],dtype:t.dtype},d=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,Sg(zP(l.shape,h.shape),(()=>`packed reshape ${l.shape} to ${h.shape} isn't free`));const p=mB({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});g.push(p);const m=EB({a:h,b:p,backend:r,transposeA:false,transposeB:false,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o}),y=r.texData.get(m.dataId);Sg(y.isPacked,(()=>"batchMatMul result is expected to be packed")),l.shape=d,y.shape=n.outShape,f=Yz({inputs:{x:m},backend:r}),f.shape=n.outShape,g.push(m)}else{const u=n.outHeight*n.outWidth,l=mB({inputs:{x:t},backend:r,attrs:{shape:p?[n.batchSize,u,n.inChannels]:[n.batchSize,n.inChannels,u]}}),c=mB({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),h=EB({a:p?l:c,b:p?c:l,transposeA:!p,transposeB:false,backend:r,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o});f=mB({inputs:{x:h},backend:r,attrs:{shape:n.outShape}}),g.push(l),g.push(c),g.push(h)}for(const m of g)r.disposeIntermediateTensorInfo(m);return f}function HU({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:h,outHeight:d,dataFormat:p}=n,f="channelsLast"===p,g=u*l*c,m=d*h,y=[n.batchSize,g,m],b=[];if(null!=s){const t=GU(s.shape,f);null!=t&&(s=mB({inputs:{x:s},backend:r,attrs:{shape:t}}),b.push(s))}if(null!=i){const t=GU(i.shape,f);null!=t&&(i=mB({inputs:{x:i},backend:r,attrs:{shape:t}}),b.push(i))}const v=mB({inputs:{x:e},backend:r,attrs:{shape:[1,g,Ng(e.shape)/g]}});b.push(v);const x=new WU(y,n),w=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],k=r.runWebGLProgram(x,[t],"float32",w),I=mB({inputs:{x:k},backend:r,attrs:{shape:y}});b.push(k),b.push(I);const S=null!=i,T=null!=s,C="leakyrelu"===a,N=a?uB(a,!0):null,E=new lB(f?I.shape:v.shape,f?v.shape:I.shape,f?[n.batchSize,m,n.outChannels]:[n.batchSize,n.outChannels,m],!0,!1,S,N,T,C),R=f?[I,v]:[v,I];if(i&&R.push(i),T&&R.push(s),C){const t=r.makeTensorInfo([],"float32",ry(o,"float32"));R.push(t),b.push(t)}const $=r.runWebGLProgram(E,R,"float32"),_=mB({inputs:{x:$},backend:r,attrs:{shape:n.outShape}});b.push($);for(const A of b)r.disposeIntermediateTensorInfo(A);return _}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=r,h=Iv(u),d=pv(i.shape,s.shape,o,l,a,c,!1,h);let p;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&rm().getBool("WEBGL_EXP_CONV")){const t=new VU(d),e=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=n.runWebGLProgram(t,[i,s],"float32",e)}else if(rm().getBool("WEBGL_CONV_IM2COL"))p=HU({x:i,filter:s,convInfo:d,backend:n});else{const t=new BU(d);p=n.runWebGLProgram(t,[i,s],"float32")}else p=jU({x:i,filter:s,convInfo:d,backend:n});const f=mB({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KU{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,s="channelsLast"===t.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              ${s?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);"}\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class XU{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s="channelsLast"===t.dataFormat,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,u=s?1:2,l=s?2:3,c=s?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${c}];\n\n        ivec2 dyCorner = ivec2(coords[${u}], coords[${l}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${s}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class YU{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,s=t.padInfo.top,o=t.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${e} - ${i};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${s};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${o};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class QU{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=e-1-t.padInfo.front,u=n-1-t.padInfo.top,l=r-1-t.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${a}, ${u}, ${l});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${i}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${o}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU={kernelName:"Conv2DBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=r,h=Iv(u),d=pv(i.shape,c,o,1,a,l,!1,h),p=new KU(d);return n.runWebGLProgram(p,[i,s],"float32")}};
/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZU{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=bM(this.outputShape.length);const e=t.filterHeight,n=t.filterWidth,r=e-1-t.padInfo.top,i=n-1-t.padInfo.left;this.userCode=`\n      const ivec2 pads = ivec2(${r}, ${i});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            int wCPerm = ${n} - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tV={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=r,h=Iv(l),d=pv(o,s.shape,a,1,u,c,!1,h);if(rm().getBool("WEBGL_PACK")&&"channelsLast"===h){const t=[[d.strideHeight,d.strideWidth]],e=new ZU(d);return n.runWebGLProgram(e,[i,s],"float32",t)}{const t=new XU(d);return n.runWebGLProgram(t,[i,s],"float32")}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eV={kernelName:"Conv3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:u}=r,l=fv(i.shape,s.shape,o,u,a),c=new UU(l);return n.runWebGLProgram(c,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nV={kernelName:"Conv3DBackpropFilterV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,filterShape:u}=r,l=fv(i.shape,u,o,1,a),c=new YU(l);return n.runWebGLProgram(c,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rV={kernelName:"Conv3DBackpropInputV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:o,strides:a,inputShape:u}=r,l=fv(u,s.shape,a,1,o),c=new QU(l);return n.runWebGLProgram(c,[i,s],"float32")}},iV={kernelName:"Cos",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n",packedOpSnippet:`\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ${Kz}\n  return result;\n`})},sV={kernelName:"Cosh",backendName:"webgl",kernelFunc:oB({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class oV{constructor(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,o,a,u]=t,[l]=e,[c,h]=n;this.outputShape=[l,c,h,u];const d="bilinear"===r?1:0,[p,f]=[o-1+".0",a-1+".0"],[g,m,y]=c>1?[""+(o-1)/(c-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,v,x]=h>1?[""+(a-1)/(h-1),"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`\n      const float height_ratio = float(${g});\n      const float width_ratio = float(${b});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${s}) {\n          return;\n        }\n\n        float height_scale = ${m};\n        float width_scale = ${v};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${d} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aV={kernelName:"CropAndResize",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:o}=e,{cropSize:a,method:u,extrapolationValue:l}=r,c=new oV(i.shape,s.shape,a,u,l);return n.runWebGLProgram(c,[i,s,o],"float32")}};var uV,lV;(lV=uV||(uV={})).Prod="*",lV.Sum="+";class cV{constructor(t,e,n,r){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,s=this.op===uV.Prod?"1.0":"0.0",o=n?s:`getX(${hV(i,"coords",this.op)})`,a=this.outputShape[this.outputShape.length-1];let u="",l="";n?(u=r?"end != "+(a-1):"end != 0",l=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${a}`:"end >= pow2",l=r?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${hM(i)} coords = getOutputCoords();\n        int end = ${dV(i,"coords",this.op)};\n        float val = ${o};\n        int pow2 = int(pow(2.0, index));\n        if (${u}) {\n          int idx = ${l};\n          ${dV(i,"coords",this.op)} = idx;\n          val ${this.op}= getX(${hV(i,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function hV(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function dV(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.y`;if(3===t)return`${e}.z`;if(4===t)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(t,e,n,r,i,s){const o=e.shape.length,a=Ix([r],o);let u=e;null!=a&&(u=CB({inputs:{x:e},backend:n,attrs:{perm:a}}));const l=Tx(1,o)[0];if(l!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const c=u.shape[l];let h=Yz({inputs:{x:u},backend:n});for(let d=0;d<=Math.ceil(Math.log2(c))-1;d++){const e=new cV(t,u.shape,!1,s),r=[[d]],i=h;h=n.runWebGLProgram(e,[h],h.dtype,r),n.disposeIntermediateTensorInfo(i)}if(i){const e=new cV(t,u.shape,i,s),r=h;h=n.runWebGLProgram(e,[h],h.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=a){const t=CB({inputs:{x:h},backend:n,attrs:{perm:Sx(a)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(u),t}return h}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fV={kernelName:"Cumprod",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;return pV(uV.Prod,i,n,s,o,a)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gV={kernelName:"Cumsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;return pV(uV.Sum,i,n,s,o,a)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mV={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o,binaryOutput:a}=r;if(1===i.shape.length){const t=n.readSync(i.dataId),e=n.readSync(s.dataId),r=MM(t,e,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,r)}if(2===i.shape.length){const t=n.bufferSync(i),e=n.bufferSync(s),r=zM(t,e,o,a);return n.makeTensorInfo(r.shape,s.dtype,r.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yV{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV={kernelName:"DepthToSpace",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:o}=r,a=i.shape[0],u=("NHWC"===o?i.shape[1]:i.shape[2])*s,l=("NHWC"===o?i.shape[2]:i.shape[3])*s,c=("NHWC"===o?i.shape[3]:i.shape[1])/(s*s),h=new yV("NHWC"===o?[a,u,l,c]:[a,c,u,l],s,o);return n.runWebGLProgram(h,[i],i.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vV{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=bM(this.outputShape.length);const s=t.filterHeight,o=t.filterWidth,a=t.outChannels/t.inChannels;let u="",l="";n&&(u=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,l="result = activation(result);");const c=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${u}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${a};\n        int q = d2 - d1 * ${a};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${s}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${o}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${c}\n        ${l}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xV{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=bM(this.outputShape.length);const s=t.outChannels/t.inChannels,o=t.padInfo.left,a=t.strideWidth,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,h=c;let d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let m=0;m<c;m++)d+=`\n          vec4 xTexelC${2*m};\n          int xTexelC${2*m}Ready;\n          vec4 xTexelC${2*m+1};\n          int xTexelC${2*m+1}Ready;\n          vec4 xC${m};`;d+=`\n    for (int r = 0; r < ${l}; r++) {\n      `;for(let m=0;m<c;m++)d+=`\n          xTexelC${2*m} = vec4(0.0);\n          xTexelC${2*m}Ready = 0;\n          xTexelC${2*m+1} = vec4(0.0);\n          xTexelC${2*m+1}Ready = 0;\n          xC${m} = vec4(0.0);`;d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let m=0;m<(h+1)/2;m++){const t=2*m;if(d+=`\n          xC = xCCorner + ${t*u};\n          `,1===a){if(t<c&&(o%2==1?(d+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n              `,d+=1===u&&t>0?`\n                xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${t} = vec4(previous.zw, xTexelC${t}.xy);\n                  } else {\n                    xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);\n                  }\n                  `):d+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xC${t} = xTexelC${t};\n                `,t+1<c)){const e=o%2==0?kg(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(d+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                    xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${t+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${t+1}Ready = 1;\n                  }\n                  `,d+=u>1?`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC${t+1} = vec4(previous.zw, xTexelC${t+1}.xy);\n                    } else {\n                     xC${t+1} = vec4(0.0, 0.0, xTexelC${t+1}.xy);\n                    }\n                    `:`\n                    xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);\n                    `):d+=1===e?`\n                    xC${t+1} = xTexelC${t};\n                    `:`\n                    xCOffset = xC + ${e};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                      xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${t+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${t+1}Ready = 1;\n                    }\n\n                    xC${t+1} = xTexelC${t+1};\n                    `}}else t<c&&(o%2==1?(d+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n              `,t+1<c&&(d+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);\n                `)):(d+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(\n                  xTexelC${t}.xy, xTexelC${t+1}.xy);\n              `,t+1<c&&(d+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n                `)));t<c&&(d+=`\n            wTexel = getW(r, ${t}, d1, q);\n            dotProd += xC${t} * vec4(wTexel.xz, wTexel.xz);\n          `,t+1<c&&(d+=`\n              wTexel = getW(r, ${t+1}, d1, q);\n              dotProd += xC${t+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}d+="\n    }\n  ",d+="\n      }\n    ";let p="",f="";n&&(p=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,f="result = activation(result);");const g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${p}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${s};\n        int q = d2 - d1 * ${s};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${d}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${g}\n        ${f}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wV={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=r;let c=u;null==c&&(c=[1,1]),Sg(wv(o,c),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`));const h=pv(i.shape,s.shape,o,c,a,l,!0);let d;d=rm().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels==1?new xV(h):new vV(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[i,s],"float32",p)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kV{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${s} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class IV{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s=e-1-t.padInfo.top,o=n-1-t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${a}; dm++) {\n              int d2 = d1 * ${a} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SV={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=r,h=pv(i.shape,c,o,a,u,l,!0),d=new kV(h);return n.runWebGLProgram(d,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TV={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=r,h=pv(c,s.shape,o,a,u,l,!0),d=new IV(h);return n.runWebGLProgram(d,[i,s],"float32")}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CV{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NV={kernelName:"Diag",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=[...r.shape,...r.shape],s=Ng(r.shape),o=mB({inputs:{x:r},backend:n,attrs:{shape:[s]}}),a=new CV(s),u=n.runWebGLProgram(a,[o],o.dtype),l=mB({inputs:{x:u},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),l}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EV{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:n,padInfo:r,strideHeight:i,strideWidth:s,filterHeight:o,filterWidth:a,dilationHeight:u,dilationWidth:l}=t,{top:c,left:h}=r;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${s});\n      const ivec2 pads = ivec2(${c}, ${h});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${o}; h++) {\n          int hIn = hBeg + h * ${u};\n\n          if (hIn >= 0 && hIn < ${e}) {\n            for (int w = 0; w < ${a}; w++) {\n              int wIn = wBeg + w * ${l};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RV={kernelName:"Dilation2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:u}=r,l=cv(i.shape,s.shape,o,a,"NHWC",u);let c;const h=new EV(l);c=n.runWebGLProgram(h,[i,s],"float32");const d=mB({inputs:{x:c},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(c),d}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $V={kernelName:"Einsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:o,summedDims:a,idDims:u}=kS(i,s.length);SS(o.length,u,s);const{path:l,steps:c}=TS(a,u),h=c.length;let d=null,p=o.length;const f=[];for(let g=0;g<h;++g){for(const t of c[g]){const{permutationIndices:e,expandDims:r}=IS(p,u[t]);let i;CS(e)?i=s[t]:(i=CB({inputs:{x:s[t]},backend:n,attrs:{perm:e}}),f.push(i));const o=i.shape.slice();for(let t=0;t<r.length;++t)o.splice(r[t],0,1);Eg(i.shape,o)||(i=mB({inputs:{x:i},backend:n,attrs:{shape:o}}),f.push(i)),null===d?d=i:(d=fB({inputs:{a:i,b:d},backend:n}),f.push(d))}g<h-1&&(l[g]>=0&&(d=SB({inputs:{x:d},backend:n,attrs:{axis:l[g]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const g of f)g!==d&&n.disposeIntermediateTensorInfo(g);return d}},_V={kernelName:"Elu",backendName:"webgl",kernelFunc:oB({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"})},AV={kernelName:"EluGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n}=t,{dy:r,y:i}=e,s=rm().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xz("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,i.shape):new qz("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,i.shape);return n.runWebGLProgram(s,[r,i],r.dtype)}},DV={kernelName:"Equal",backendName:"webgl",kernelFunc:aB({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:WM})},FV={kernelName:"Erf",backendName:"webgl",kernelFunc:oB({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n'})},OV=oB({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:GM,dtype:"float32"}),LV={kernelName:"Exp",backendName:"webgl",kernelFunc:OV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function PV(t){const{inputs:e,attrs:n,backend:r}=t,{dim:i}=n,{input:s}=e,o=s.shape.length,a=s.shape.slice();let u=i;return i<0&&(Sg(-(o+1)<=i,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),u=o+i+1),a.splice(u,0,1),mB({inputs:{x:s},backend:r,attrs:{shape:a}})}const MV={kernelName:"ExpandDims",backendName:"webgl",kernelFunc:PV},zV="return exp(x) - 1.0;",BV={kernelName:"Expm1",backendName:"webgl",kernelFunc:oB({opSnippet:zV,packedOpSnippet:zV,cpuKernelImpl:jM})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class UV{constructor(t,e,n){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${r}.0`:"1.0";let o;if("real"===t)o="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);o="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${o}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${s};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(t,e,n){const r=n.texData.get(t.dataId),i=Ng(t.shape),s=t.shape[t.shape.length-1],o=mB({inputs:{x:t},backend:n,attrs:{shape:[i/s,s]}}),a=o.shape,u=new UV("real",a,e),l=new UV("imag",a,e),c=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:a},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:a}],h=n.runWebGLProgram(u,c,"float32"),d=n.runWebGLProgram(l,c,"float32"),p=Jz({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const f=mB({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(p),f}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WV={kernelName:"FFT",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e;return VV(r,!1,n)}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GV{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jV(t){const{backend:e,attrs:n}=t,{shape:r,value:i}=n;let{dtype:s}=n;if(s=s||Vg(i),"string"===s){const t=Pg(s,Ng(r));return t.fill(i),e.makeTensorInfo(r,s,t)}{const t=new GV(r,i),n=[[i]];return e.runWebGLProgram(t,[],s,n)}}const HV={kernelName:"Fill",backendName:"webgl",kernelFunc:jV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qV{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KV={kernelName:"FlipLeftRight",backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,i=new qV(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}},XV="return floor(x);",YV={kernelName:"Floor",backendName:"webgl",kernelFunc:oB({opSnippet:XV,packedOpSnippet:XV,cpuKernelImpl:HM})},QV={kernelName:"FloorDiv",backendName:"webgl",kernelFunc:aB({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class JV{constructor(t){this.variableNames=["A"];const e=KP(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${e.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZV{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=KP(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${e.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tW={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:i}=e;const{numChannels:s}=r,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,a="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,[u,l]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=[l,u],h=[l,u,s];if(a||o){const t=rm().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=eW&&t===nW||(nW=t,eW=document.createElement("canvas").getContext("2d",{willReadFrequently:nW})),eW.canvas.width=u,eW.canvas.height=l,eW.drawImage(i,0,0,u,l),i=eW.canvas}const d=n.makeTensorInfo(c,"int32");n.texData.get(d.dataId).usage=gP.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);const p=rm().getBool("WEBGL_PACK")?new ZV(h):new JV(h),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */};let eW,nW=rm().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const rW={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,g=Iv(c),m=pv(i.shape,s.shape,u,h,l,d,!1,g);let y;const b=[],v=null!=o,x=null!=a,w="leakyrelu"===p,k=()=>{const t=[i,s],e=(t,e)=>{if("NCHW"===e&&1===t.shape.length&&1!==t.shape[0]){const e=mB({inputs:{x:t},backend:n,attrs:{shape:[t.shape[0],1,1]}});return b.push(e),e}return t};if(v&&t.push(e(o,c)),x&&t.push(e(a,c)),w){const e=n.makeTensorInfo([],"float32",ry(f,"float32"));t.push(e),b.push(e)}return t};if(1!==m.filterHeight||1!==m.filterWidth||1!==m.dilationHeight||1!==m.dilationWidth||1!==m.strideHeight||1!==m.strideWidth||"SAME"!==m.padInfo.type&&"VALID"!==m.padInfo.type)if(m.strideWidth<=2&&"channelsLast"===g&&rm().getBool("WEBGL_EXP_CONV")){const t=p?uB(p,!0):null,e=new VU(m,v,t,x,w),r=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],i=k();y=n.runWebGLProgram(e,i,"float32",r)}else if(rm().getBool("WEBGL_CONV_IM2COL"))y=HU({x:i,filter:s,convInfo:m,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else{const t=p?uB(p,!1):null,e=new BU(m,v,t,x,w),r=k();y=n.runWebGLProgram(e,r,"float32")}else y=jU({x:i,filter:s,convInfo:m,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});const I=mB({inputs:{x:y},backend:n,attrs:{shape:m.outShape}});return b.push(y),b.forEach((t=>n.disposeIntermediateTensorInfo(t))),I}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iW={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:u,pad:l,dilations:c,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r,f=[];let g=c;null==g&&(g=[1,1]),Sg(wv(u,g),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${g}'`));const m=pv(i.shape,s.shape,u,g,l,h,!0),y=rm().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels==1,b=d?uB(d,y):null,v=[i,s],x=null!=o,w=null!=a,k="leakyrelu"===d;if(x&&v.push(o),w&&v.push(a),k){const t=n.makeTensorInfo([],"float32",ry(p,"float32"));v.push(t),f.push(t)}let I;I=y?new xV(m,x,b,w,k):new vV(m,x,b,w,k);const S=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],T=n.runWebGLProgram(I,v,"float32",S);return f.forEach((t=>n.disposeIntermediateTensorInfo(t))),T}};class sW{constructor(t,e,n,r){this.sliceDim=t,this.strides=e,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const i=hM(n.length);let s="\n    int index;";for(let o=0;o<this.sliceDim;o++)s+=`\n          index = round(getIndices(coords[0], ${o}));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[o]};\n          flattenIndex += index * ${this.strides[o]};`;this.userCode=`\n         void main() {\n          ${i} coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ${s}\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oW={kernelName:"GatherNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=i.shape,o=s[s.length-1],a=Ng(r.shape),[u,l,c,h]=_I(r,i),d=mB({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),p=mB({inputs:{x:r},backend:n,attrs:{shape:[Ng(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,i])||"string"===r.dtype){const t=n.readSync(i.dataId),e=n.bufferSync(r),s=qM(t,e,r.dtype,l,o,c,h,r.shape,a);return n.makeTensorInfo(u,r.dtype,s.values)}const f=new sW(o,h,[l,c],r.shape),g=n.runWebGLProgram(f,[p,d],p.dtype),m=mB({inputs:{x:g},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aW{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const n=hM(this.rank),r=function(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let i=0;i<t.length;i++)2===i?r.push("index"):r.push(`${n[i]}`);return r.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${r}));\n      }\n    `}}function uW(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:o,batchDims:a}=r,u=Fg(o,i.shape)[0];if(rm().get("DEBUG")){const t=n.readSync(s.dataId),e=i.shape[u];for(let n=0;n<t.length;++n){const r=t[n];Sg(r<=e-1&&r>=0,(()=>`GatherV2: the index value ${r} is not in [0, ${e-1}]`))}}const l=WS(i,s,u,a),c=Ng(s.shape),h=[],d=mB({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),p=mB({inputs:{x:s},backend:n,attrs:{shape:[l.batchSize,c/l.batchSize]}});h.push(d),h.push(p);const f=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([i,s])||"string"===i.dtype){const t=n.bufferSync(p),e=n.bufferSync(d),r=KM(e,t,f);return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(l.outputShape,r.dtype,r.values)}const g=new aW(d.shape,f),m=n.runWebGLProgram(g,[d,p],d.dtype);h.push(m);const y=mB({inputs:{x:m},backend:n,attrs:{shape:l.outputShape}});return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}const lW={kernelName:"GatherV2",backendName:"webgl",kernelFunc:uW},cW={kernelName:"Greater",backendName:"webgl",kernelFunc:aB({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:XM,dtype:"bool"})},hW={kernelName:"GreaterEqual",backendName:"webgl",kernelFunc:aB({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:YM})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dW={kernelName:"IFFT",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{input:r}=e;return VV(r,!0,n)}},pW={kernelName:"IsFinite",backendName:"webgl",kernelFunc:oB({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},fW={kernelName:"IsInf",backendName:"webgl",kernelFunc:oB({opSnippet:"return float(isinf(x));",dtype:"bool"})},gW={kernelName:"IsNan",backendName:"webgl",kernelFunc:oB({opSnippet:"return float(isnan(x));",dtype:"bool"})},mW={kernelName:"Less",backendName:"webgl",kernelFunc:aB({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:QM,dtype:"bool"})},yW={kernelName:"LessEqual",backendName:"webgl",kernelFunc:aB({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:JM,dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bW={kernelName:"LinSpace",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,o=ZM(r,i,s);return e.makeTensorInfo([o.length],"float32",o)}},vW={kernelName:"Log",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:tz})},xW={kernelName:"Log1p",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"})},wW={kernelName:"LogicalAnd",backendName:"webgl",kernelFunc:aB({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"})},kW={kernelName:"LogicalNot",backendName:"webgl",kernelFunc:oB({opSnippet:"return float(!(x >= 1.0));"})},IW={kernelName:"LogicalOr",backendName:"webgl",kernelFunc:aB({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class SW{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];const s=e,o=t[3]-1;let a;this.outputShape=t;const u=`float(${n}) + float(${r}) * sum`;a=.5===i?`inversesqrt(${u})`:1===i?`1.0/(${u})`:`exp(log(${u}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${s}; j <= ${s}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${o}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${a};\n        setOutput(val);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TW{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=e,o=t[3]-1;let a;this.outputShape=t;const u=`float(${n}) + float(${r}) * sum`;a=.5===i?`inversesqrt(${u})`:1===i?`1.0/(${u})`:`exp(log(${u}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${s};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${s}; j <= ${s}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${a};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CW={kernelName:"LRN",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:o,alpha:a,beta:u}=r,l=rm().getBool("WEBGL_PACK_NORMALIZATION")?new TW(i.shape,s,o,a,u):new SW(i.shape,s,o,a,u);return n.runWebGLProgram(l,[i],i.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class NW{constructor(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${e})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${e} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${i})\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${i});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EW={kernelName:"LRNGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:o}=e,{depthRadius:a,bias:u,alpha:l,beta:c}=r,h=new NW(i.shape,a,u,l,c);return n.runWebGLProgram(h,[i,s,o],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function RW(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:o}=r,a=i.shape.length,u=Fg(s,i.shape);let l=u;const c=Ix(l,a),h=null!=c,d=n.shouldExecuteOnCPU([i]);let p=i;if(h){if(d){const t=n.texData.get(p.dataId).values,e=new Array(a);for(let n=0;n<e.length;n++)e[n]=i.shape[c[n]];const r=Rz(t,i.shape,i.dtype,c,e);p=n.makeTensorInfo(e,i.dtype);n.texData.get(p.dataId).values=r}else p=IB(i,c,n);l=Tx(l.length,a)}kx("max",l,a);const[f,g]=xx(p.shape,l);let m,y=f;if(o&&(y=wx(f,u)),d){const t=n.texData.get(p.dataId).values,e=ez(t,Ng(g),y,i.dtype);m=n.makeTensorInfo(y,i.dtype);n.texData.get(m.dataId).values=e}else m=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const i=Ng(e),s=mB({inputs:{x:t},attrs:{shape:[Ng(t.shape)/i,i]},backend:r}),o=xB(s,t.dtype,"max",r),a=mB({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}(p,g,y,n);return h&&n.disposeIntermediateTensorInfo(p),m}const $W={kernelName:"Max",backendName:"webgl",kernelFunc:RW},_W={kernelName:"Maximum",backendName:"webgl",kernelFunc:aB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:nz})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AW={kernelName:"MaxPool",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;HP(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r;Sg(wv(o,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const l=hv(i.shape,s,o,1,a,u);if(1===l.filterWidth&&1===l.filterHeight&&Eg(l.inShape,l.outShape))return Yz({inputs:{x:i},backend:n});const c=new ZB(l,"max",!1);return n.runWebGLProgram(c,[i],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DW={kernelName:"MaxPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dataFormat:u,dimRoundingMode:l}=r,c=dv(i.shape,s,o,[1,1,1],a,l,u),h=new tU(c,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FW{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,s=t.effectiveFilterWidth,o=i-1-t.padInfo.top,a=s-1-t.padInfo.left,u=i*s-1;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${i};\n          wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${e}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${s} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class OW{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,o=t.dilationWidth,a=t.effectiveFilterDepth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=a-1-t.padInfo.front,h=u-1-t.padInfo.top,d=l-1-t.padInfo.left,p=a*u*l-1;this.userCode=`\n      const ivec3 pads = ivec3(${c}, ${h}, ${d});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${a};\n           wD += ${i}) {\n          float dyD = float(dyDCorner + wD) / ${e}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${u};\n              wR += ${s}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${l};\n                wC += ${o}) {\n              float dyC = float(dyCCorner + wC) / ${r}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${u} * ${l} +\n                  wR * ${l} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LW={kernelName:"MaxPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=r,h=dv(o.shape,a,u,[1,1,1],l,c),d=new tU(h,"max",!0),p=n.runWebGLProgram(d,[o],o.dtype),f=new OW(h),g=n.runWebGLProgram(f,[i,p],o.dtype);return n.disposeIntermediateTensorInfo(p),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PW={kernelName:"MaxPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:o}=e,a=s;HP([s,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:h}=r,d=hv(a.shape,u,l,1,c,h),p=new ZB(d,"max",!0),f=n.runWebGLProgram(p,[a],a.dtype),g=new FW(d),m=n.runWebGLProgram(g,[i,f],a.dtype);return n.disposeIntermediateTensorInfo(f),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const MW={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=e,u=n;Sg(4===r.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`));const l=[1,1];Sg(wv(s,l),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${l}'`));const c=hv(r.shape,i,s,l,o),[h,d]=function(t,e,n,r){let i=new ZB(n,"max",!1);const s=r.runWebGLProgram(i,[t],"float32");return i=new ZB(n,"max",!0,!0,e),[s,r.runWebGLProgram(i,[t],"float32")]}(r,a,c,u);return[h,d]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const zW={kernelName:"Mean",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{keepDims:i,axis:s}=e,o=n,a=r.shape.length,u=Fg(s,r.shape);let l=u;const c=Ix(l,a),h=null!=c,d=o.shouldExecuteOnCPU([r]),p=[];let f=r;if(h){if(d){const t=o.texData.get(f.dataId).values,e=new Array(a);for(let i=0;i<e.length;i++)e[i]=r.shape[c[i]];const n=Rz(t,r.shape,r.dtype,c,e);f=o.makeTensorInfo(e,r.dtype);o.texData.get(f.dataId).values=n}else f=IB(r,c,o);p.push(f),l=Tx(l.length,a)}kx("sum",l,a);const[g,m]=xx(f.shape,l);let y=g;i&&(y=wx(g,u));const b=function(t,e,n,r){const i=Ng(e),s=mB({inputs:{x:t},attrs:{shape:[Ng(t.shape)/i,i]},backend:r}),o=xB(s,"float32","mean",r),a=mB({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}(f,m,y,o);for(const v of p)o.disposeIntermediateTensorInfo(v);return b}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BW={kernelName:"Min",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,u=Fg(s,i.shape);let l=u;const c=Ix(l,a);let h=i;null!=c&&(h=CB({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Tx(l.length,i.shape.length)),kx("min",l,a);const[d,p]=xx(h.shape,l),f=mB({inputs:{x:h},backend:n,attrs:{shape:[-1,Ng(p)]}}),g=xB(f,f.dtype,"min",n);let m;if(o){m=mB({inputs:{x:g},backend:n,attrs:{shape:wx(d,u)}})}else m=mB({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),null!=c&&n.disposeIntermediateTensorInfo(h),m}},UW={kernelName:"Minimum",backendName:"webgl",kernelFunc:aB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:rz})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class VW{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=hM(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u="reflect"===n?0:1;this.userCode=1!==r?`\n      ${i} start = ${i}(${s});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${u};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};\n          }\n        }\n        ${i} coords = outC - start;\n        setOutput(getX(${a}));\n      }\n    `:`\n        int start = ${s};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${u};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${u};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WW{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=hM(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=Az("rc",r),u=Az("source",r),l=`${a[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${u.slice(-2).join()})`,h="reflect"===n?0:1;let d="";if(1===r){const t=`\n        ${i} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${h};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${h};\n        }\n        source -= start;\n      `;d=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${u.join()}), ${c});\n        ${a[r-1]} += 1;\n        if(${l}) {\n          ${t}\n          result[1] = getChannel(getX(${u.join()}), ${c});\n        }\n      `}else{const t=`\n        ${i} source = rc;\n        ${i} lt = ${i}(lessThan(source, start));\n        ${i} gte = ${i}(greaterThanEqual(source, end));\n        ${i} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${h}) +\n                gte * ((end - 1) * 2 - source + ${h});\n        source -= start;\n      `;d=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${u.join()}), ${c});\n        ${a[r-1]} += 1;\n        if(${l}) {\n          ${t}\n          result[1] = getChannel(getX(${u.join()}), ${c});\n        }\n        rc = outputLoc;\n        ${a[r-2]} += 1;\n        if(${a[r-2]} < ${this.outputShape[r-2]}) {\n          ${t}\n          result[2] = getChannel(getX(${u.join()}), ${c});\n          ${a[r-1]} += 1;\n          if(${l}) {\n            ${t}\n            result[3] = getChannel(getX(${u.join()}), ${c});\n          }\n        }\n      `}this.userCode=`\n      const ${i} start = ${i}(${s});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${d}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GW={kernelName:"MirrorPad",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r}=t,{paddings:i,mode:s}=n,o=rm().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new WW(r.shape,i,s):new VW(r.shape,i,s);return e.runWebGLProgram(o,[r],r.dtype)}},jW={kernelName:"Mod",backendName:"webgl",kernelFunc:aB({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"})};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class HW{constructor(t,e,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${e-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${e-1}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qW=aB({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),KW={kernelName:"RealDiv",backendName:"webgl",kernelFunc:qW},XW="return a - b;",YW=aB({opSnippet:XW,packedOpSnippet:XW,supportsComplex:!0,cpuKernelImpl:Cz}),QW={kernelName:"Sub",backendName:"webgl",kernelFunc:YW};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function JW(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,o=Fg([s],i.shape),a=RW({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=wx(a.shape,o),l=mB({inputs:{x:a},backend:n,attrs:{shape:u}}),c=YW({inputs:{a:i,b:l},backend:n}),h=OV({inputs:{x:c},backend:n}),d=SB({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),p=mB({inputs:{x:d},backend:n,attrs:{shape:u}}),f=qW({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const ZW={kernelName:"Softmax",backendName:"webgl",kernelFunc:JW};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tG={kernelName:"Multinomial",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:o,normalized:a}=r,u=a?i:JW({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),l=u.shape[0],c=u.shape[1],h=new HW(l,c,s),d=[[o]],p=n.runWebGLProgram(h,[u],"int32",d);return a||n.disposeIntermediateTensorInfo(u),p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG={kernelName:"Neg",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])){const t=n.texData.get(r.dataId),[e,i]=sz(t.values,r.shape,r.dtype);return n.makeTensorInfo(i,r.dtype,e)}let i;return i=rm().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Uz(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new zz(r.shape,"if (isnan(x)) return x;\n  return -x;\n"),n.runWebGLProgram(i,[r],r.dtype)}},nG=qk;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:function(t){um("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=r,l=n.readSync(i.dataId),c=n.readSync(s.dataId),{selectedIndices:h}=nG(l,c,o,a,u);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},iG=Kk;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:"NonMaxSuppressionV4",backendName:"webgl",kernelFunc:function(t){um("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=r,c=n.readSync(i.dataId),h=n.readSync(s.dataId),{selectedIndices:d,validOutputs:p}=iG(c,h,o,a,u,l);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},oG=Xk;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG={kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){um("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=r,c=n.readSync(i.dataId),h=n.readSync(s.dataId),d=o,p=a,f=u,g=l,{selectedIndices:m,selectedScores:y}=oG(c,h,d,p,f,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uG{constructor(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lG={kernelName:"OneHot",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{dtype:s,depth:o,onValue:a,offValue:u}=r,l=Ng(i.shape),c=new uG(l,o,a,u),h=mB({inputs:{x:i},backend:n,attrs:{shape:[l]}}),d=n.runWebGLProgram(c,[h],s);n.disposeIntermediateTensorInfo(h);const p=mB({inputs:{x:d},backend:n,attrs:{shape:[...i.shape,o]}});return n.disposeIntermediateTensorInfo(d),p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cG(t){const{inputs:e,backend:n}=t,{x:r}=e;if("complex64"===r.dtype){const t=wU({inputs:{input:r},backend:n}),e=cG({inputs:{x:t},backend:n}),i=OU({inputs:{input:r},backend:n}),s=cG({inputs:{x:i},backend:n}),o=Jz({inputs:{real:e,imag:s},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),o}return jV({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const hG={kernelName:"ZerosLike",backendName:"webgl",kernelFunc:cG};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG={kernelName:"OnesLike",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===i.dtype){const e=wU({inputs:{input:i},backend:r}),n=t({inputs:{x:e},backend:r}),s=OU({inputs:{input:i},backend:r}),o=cG({inputs:{x:s},backend:r}),a=Jz({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}return jV({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:r})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG={kernelName:"Pack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(1===e.length)return PV({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,o=e[0].dtype;e.forEach((t=>{Tg(s,t.shape,"All tensors passed to stack must have matching shapes"),Sg(o===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],u=MU({inputs:e.map((t=>{const e=PV({inputs:{input:t},backend:n,attrs:{dim:i}});return a.push(e),e})),backend:n,attrs:{axis:i}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fG{constructor(t,e,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=hM(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${i} start = ${i}(${s});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${i} coords = outC - start;\n          setOutput(getX(${a}));\n        }\n      }\n    `:`\n        int start = ${s};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gG{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=hM(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=Az("rc",r),u=Az("source",r),l=`${a[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${u.slice(-2).join()})`,h=[`${i} rc = outputLoc;`,`${a[r-1]} += 1;\n       if(${l}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${a[r-2]} += 1;\n       if(${a[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${a[r-1]} += 1;\n         if(${l}) {`],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let f=0,g=1===r?2:4;f<g;f++)p+=`\n        ${h[f]}\n        if (${d}) {\n          result[${f}] = float(value);\n        } else {\n          ${i} source = rc - start;\n          result[${f}] = getChannel(getX(${u.join()}), ${c});\n        }\n      `;p+=1===r?"} ":"}}",this.userCode=`\n      const ${i} start = ${i}(${s});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:o}=r;if(0===Ng(i.shape)){return jV({backend:n,attrs:{shape:s.map(((t,e)=>t[0]+i.shape[e]+t[1])),value:o,dtype:i.dtype}})}const a=rm().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gG(i.shape,s,o):new fG(i.shape,s,o),u=[[o]];return n.runWebGLProgram(a,[i],i.dtype,u)},yG={kernelName:"PadV2",backendName:"webgl",kernelFunc:mG},bG={kernelName:"Pow",backendName:"webgl",kernelFunc:aB({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"})};const vG={kernelName:"Prod",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,u=[],l=Fg(s,i.shape);let c=l;const h=Ix(c,a);let d,p=i;if(null!=h&&(p=CB({inputs:{x:i},backend:n,attrs:{perm:h}}),c=Tx(c.length,a),u.push(p)),kx("prod",c,a),n.shouldExecuteOnCPU([p])){const t=n.texData.get(p.dataId).values,{outVals:e,outShape:r,outDtype:i}=az(p.shape,p.dtype,t,c);d=n.makeTensorInfo(r,i,e)}else{const[t,e]=xx(p.shape,c),r=Ng(e),s=mB({inputs:{x:p},backend:n,attrs:{shape:[-1,r]}}),o=xB(s,Ly(i.dtype),"prod",n);d=mB({inputs:{x:o},backend:n,attrs:{shape:t}}),u.push(s),u.push(o)}if(o){u.push(d);const t=wx(d.shape,l);d=mB({inputs:{x:d},backend:n,attrs:{shape:t}})}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),d}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:"RaggedGather",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=e,{outputRaggedRank:a}=r,u=i.map((t=>n.readSync(t.dataId))),l=i.map((t=>t.shape)),c=n.readSync(s.dataId),h=n.readSync(o.dataId),[d,p,f]=uz(u,l,c,s.shape,s.dtype,h,o.shape,a),g=d.map((t=>n.makeTensorInfo([t.length],"int32",t))),m=n.makeTensorInfo(f,s.dtype,p);return g.concat([m])}};
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG={kernelName:"RaggedRange",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{starts:r,limits:i,deltas:s}=e,o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=lz(o,r.shape,r.dtype,a,i.shape,u,s.shape);return[n.makeTensorInfo([l.length],"int32",l),n.makeTensorInfo([c.length],r.dtype,c)]}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG={kernelName:"RaggedTensorToTensor",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:u}=r,l=n.readSync(i.dataId),c=n.readSync(s.dataId),h=n.readSync(o.dataId),d=a.map((t=>n.readSync(t.dataId))),p=a.map((t=>t.shape)),[f,g]=cz(l,i.shape,c,s.shape,s.dtype,h,o.shape,d,p,u);return n.makeTensorInfo(f,s.dtype,g)}},IG=t=>{const{backend:e,attrs:n}=t,{start:r,stop:i,step:s,dtype:o}=n,a=hz(r,i,s,o);return e.makeTensorInfo([a.length],o,a)},SG={kernelName:"Range",backendName:"webgl",kernelFunc:IG},TG={kernelName:"Reciprocal",backendName:"webgl",kernelFunc:oB({opSnippet:"return 1.0 / x;"})},CG={kernelName:"Relu",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},NG={kernelName:"Relu6",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class EG{constructor(t,e,n,r,i){this.variableNames=["A"],this.outputShape=[];const[s,o,a,u]=t;this.outputShape=[s,e,n,u];const l=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];let h;h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RG{constructor(t,e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,o,a,u]=t;this.outputShape=[s,e,n,u];const l=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];let h;h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]},\n          ${l[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${o}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $G={kernelName:"ResizeBilinear",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r,[u,l]=a,c=rm().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new RG(i.shape,u,l,s,o):new EG(i.shape,u,l,s,o);return n.runWebGLProgram(c,[i],"float32")}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _G{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,s,o]=t,a=[n&&s>1?r-1:r,n&&o>1?i-1:i],u=[n&&s>1?s-1:s,n&&o>1?o-1:o],l=a[0]/u[0],c=a[1]/u[1],h=1/l,d=1/c,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${l});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG={kernelName:"ResizeBilinearGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r,a=new _G(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DG{constructor(t,e,n,r,i){this.variableNames=["A"],this.outputShape=[];const[s,o,a,u]=t;this.outputShape=[s,e,n,u];const l=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FG{constructor(t,e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,o,a,u]=t;this.outputShape=[s,e,n,u];const l=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]},\n          ${l[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${o}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG={kernelName:"ResizeNearestNeighbor",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r,[u,l]=a,c=rm().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new FG(i.shape,u,l,s,o):new DG(i.shape,u,l,s,o);return n.runWebGLProgram(c,[i],i.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LG{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,s,o]=t,a=[n&&s>1?r-1:r,n&&o>1?i-1:i],u=[n&&s>1?s-1:s,n&&o>1?o-1:o],l=a[0]/u[0],c=a[1]/u[1],h=1/l,d=1/c,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${l});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${a[0]}) *\n                (float(dyR) / float(${u[0]}));\n\n            float sourceFracCol =\n                float(${a[1]}) *\n                  (float(dyC) / float(${u[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG={kernelName:"ResizeNearestNeighborGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r,a=new LG(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MG{constructor(t,e){this.variableNames=["x"];const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${t[0]} - coord - 1));\n        }\n      `);const r=t.map(((n,r)=>(n=>-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),i=hM(n);this.userCode=`\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zG{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;const r=Az("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,o=hM(n);var a;function u(n){const r=t.map(((r,i)=>function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - ${r[n]} - 1`:`${r[n]}`}(i,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${t[0]} - rc - 1),\n            ${t[0]} - rc - 1);\n          if(${i}){\n              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),\n                ${t[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${o} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${a=r.slice(),u(a)};\n          if(${i}){\n            result.g = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",u(t)}(r.slice())};\n          }\n          if(${s}) {\n            result.b = ${function(t){return t[n-2]="("+t[n-2]+" + 1)",u(t)}(r.slice())};\n            if(${i}) {\n              result.a = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",u(t)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG={kernelName:"Reverse",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r,o=i.shape.length,a=Fg(s,i.shape);if(0===o)return Yz({inputs:{x:i},backend:n});const u=rm().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zG(i.shape,a):new MG(i.shape,a);return n.runWebGLProgram(u,[i],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UG{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=t[1],r=t[2];this.outputShape=t;let i="";i="number"==typeof e?`float outputValue = ${e.toFixed(2)};`:`\n        vec3 fill = vec3(${e.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${i}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VG={kernelName:"RotateWithOffset",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:o}=e,a=n,u=new UG(r.shape,s),[l,c]=oS(o,r.shape[1],r.shape[2]),h=[[l,c,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(u,[r],r.dtype,h)}},WG={kernelName:"Round",backendName:"webgl",kernelFunc:oB({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"})},GG={kernelName:"Rsqrt",backendName:"webgl",kernelFunc:oB({opSnippet:"return inversesqrt(x);",cpuKernelImpl:dz})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class jG{constructor(t,e,n,r,i,s,o=!0,a=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const u=hM(i.length),l=hM(s.length);let c="";1===n?c="i":2===n&&(c="i, j");const h=`getIndices(${c})`;let d="";1===r?d="i":2===r&&(d="i, coords[1]");const p=`getUpdates(${d})`;let f="";a&&(f="coords[0], coords[1]");const g=`getDefaultValue(${f})`,m=e>1?"strides[j]":"strides";this.userCode=`\n        ${u} strides = ${u}(${i});\n\n        void main() {\n          ${l} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${t}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${e}; j++) {\n              int index = round(${h});\n              flattenedIndex += index * ${m};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${p};\n              found = true;\n            }\n          }\n          setOutput(mix(${g}, sum, float(found)));\n        }\n      `}}
/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HG{constructor(t,e,n,r,i,s,o=!0,a=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;const u=hM(i.length),l=hM(s.length);let c="";1===n?c="i":2===n&&(c="i, j");const h=`getIndices(${c})`;let d="";1===r?d="i":2===r&&(d="i, coords[1]");const p=`getUpdates(${d})`;let f="";a&&(f="coords[0], coords[1]");const g=`getDefaultValue(${f})`,m=e>1?"strides[j]":"strides",y=e>1?"strides[j + 1]":"strides";this.userCode=`\n        ${u} strides = ${u}(${i});\n\n        void main() {\n          ${l} coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ${t}; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ${e}; j+=2) {\n              ivec4 index = round(${h});\n              flattenedIndex += index.xz * ${m};\n              if (j + 1 < ${e}) {\n                flattenedIndex += index.yw * ${y};\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ${p};\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(${g}, sum, found));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qG={kernelName:"ScatterNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:o}=r,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:h}=wk(0,i,o),d=[h/l,l];if(0===h)return n.makeTensorInfo(o,i.dtype);const p=mB({inputs:{x:i},backend:n,attrs:{shape:[u,a]}}),f=mB({inputs:{x:s},backend:n,attrs:{shape:[u,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let m;m=rm().getBool("WEBGL_PACK")?new HG(u,a,p.shape.length,f.shape.length,c,d):new jG(u,a,p.shape.length,f.shape.length,c,d);const y=n.runWebGLProgram(m,[f,p,g],f.dtype),b=mB({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KG{constructor(t,e,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,n];const i=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,s=2===rm().getNumber("WEBGL_VERSION")?"while (left < right) {":i,o="left"===r?"<":"<=";this.userCode=`\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ${s}\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ${o} value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     `}}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XG={kernelName:"SearchSorted",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:i,values:s}=e,{side:o}=r,a=new KG(i.shape[0],i.shape[1],s.shape[1],o),u=[[i.shape[1]]];return n.runWebGLProgram(a,[i,s],"int32",u)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YG{constructor(t,e,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],o=[];for(let r=0;r<e.length;r++)o.push(`${n[r]}`),r<t&&s.push(`${n[r]}`);r=s.join(),i=o.join()}const s=hM(n);this.userCode=`\n      void main() {\n        ${s} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${i}));\n        } else {\n          setOutput(getB(${i}));\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG={kernelName:"Select",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e,o=new YG(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[r,i,s],Oy(i.dtype,s.dtype))}},JG={kernelName:"Selu",backendName:"webgl",kernelFunc:oB({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = ${dS};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`})},ZG={kernelName:"Sigmoid",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:fz})},tj={kernelName:"Sign",backendName:"webgl",kernelFunc:oB({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"})},ej={kernelName:"Sin",backendName:"webgl",kernelFunc:oB({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n",packedOpSnippet:`\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ${Kz}\n  return result;\n`})},nj={kernelName:"Sinh",backendName:"webgl",kernelFunc:oB({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"})},rj={kernelName:"Softplus",backendName:"webgl",kernelFunc:oB({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"})},ij={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:o}=r;Sg(i.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const a=s.reduce(((t,e)=>t*e)),u=[[0,0]];u.push(...o);for(let y=1+s.length;y<i.shape.length;++y)u.push([0,0]);const l=[],c=mG({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),h=aS(c.shape,s,a,!1),d=uS(h.length,s.length,!1),p=lS(c.shape,s,a,!1),f=mB({inputs:{x:c},backend:n,attrs:{shape:h}}),g=CB({inputs:{x:f},backend:n,attrs:{perm:d}}),m=mB({inputs:{x:g},backend:n,attrs:{shape:p}});return l.push(c),l.push(f),l.push(g),l.forEach((t=>n.disposeIntermediateTensorInfo(t))),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sj={kernelName:"SparseFillEmptyRows",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:o}=e;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${s.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n         ${i.shape}`);if(0!==o.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${o.shape}`);const a=n.readSync(r.dataId),u=n.readSync(i.dataId),l=n.readSync(s.dataId),c=n.readSync(o.dataId)[0],[h,d,p,f,g]=yz(a,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oj={kernelName:"SparseReshape",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.readSync(i.dataId)),a=n.readSync(r.dataId),u=Array.from(n.readSync(s.dataId)),[l,c,h]=bz(a,r.shape,r.dtype,o,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aj={kernelName:"SparseSegmentMean",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=vz(o,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(c,r.dtype,l)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uj={kernelName:"SparseSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=vz(o,r.shape,r.dtype,a,u);return n.makeTensorInfo(c,r.dtype,l)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lj={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=wk(0,i,a);if("string"===s.dtype){const t=n.bufferSync(i),e=n.bufferSync(s),r=ay(n.readSync(o.dataId)[0]),p=pz(t,e,a,d,c,l,u,h,r,false);return n.makeTensorInfo(a,p.dtype,p.values)}const p=new jG(l,u,i.shape.length,s.shape.length,h,[d,1],false),f=n.runWebGLProgram(p,[s,i,o],s.dtype),g=mB({inputs:{x:f},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(f),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cj={kernelName:"SplitV",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:o}=r,a=Fg(o,i.shape)[0],u=ES(i,s,a),l=i.shape.length,c=new Array(l).fill(0),h=i.shape.slice();return u.map((t=>{const e=[...h];e[a]=t;const r=fU({inputs:{x:i},backend:n,attrs:{begin:c,size:e}});return c[a]+=t,r}))}},hj="return sqrt(x);",dj={kernelName:"Sqrt",backendName:"webgl",kernelFunc:oB({opSnippet:hj,packedOpSnippet:hj,cpuKernelImpl:xz})},pj={kernelName:"Square",backendName:"webgl",kernelFunc:oB({opSnippet:"return x * x;"})},fj={kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:aB({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gj={kernelName:"StaticRegexReplace",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;if("string"!==i.dtype)throw new Error("Input must be of datatype string");const s=jS(n.readSync(i.dataId)),o=wz(s,"string",r);return n.makeTensorInfo(i.shape,"string",o)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mj={kernelName:"Step",backendName:"webgl",kernelFunc:function({inputs:t,attrs:e,backend:n}){const{x:r}=t,i=`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${e.alpha});\n  `,s=new zz(r.shape,i);return n.runWebGLProgram(s,[r],r.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yj{constructor(t,e,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=hM(n.length),s=hM(n.length);let o="";if(1===r)o="coords * strides + begin";else{let t=0;o=n.map(((e,r)=>(t++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${t-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${i} begin = ${i}(${t});\n      ${i} strides = ${i}(${e});\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${o}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bj={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=r,{finalShapeSparse:p,finalShape:f,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:b,end:v,strides:x}=jI(i.shape,s,o,a,u,l,c,h,d);let w;if(g)w=mB({inputs:{x:i},backend:n,attrs:{shape:f}});else if(m||y){Sg(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const t=DI(b,v,x),e=fU({inputs:{x:i},backend:n,attrs:{begin:b,size:t}});w=mB({inputs:{x:e},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(e)}else{if(n.shouldExecuteOnCPU([i])){const t=n.readSync(i.dataId),e=zb(i.shape,i.dtype,t),r=kz(p,e,x,b);w=n.makeTensorInfo(f,i.dtype,r.values)}else{const t=new yj(b,x,p);w=n.runWebGLProgram(t,[i],i.dtype)}}const k=mB({inputs:{x:w},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(w),k}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vj={kernelName:"StringNGrams",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:h}=e,d=n.readSync(c.dataId),p=n.readSync(h.dataId),[f,g]=Iz(d,p,i,s,o,a,u,l);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xj={kernelName:"StringSplit",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:o}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==o.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[l,c,h]=Sz(a,u,i),d=c.length;return[n.makeTensorInfo([d,2],"int32",l),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wj={kernelName:"StringToHashBucketFast",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(s.dataId),a=Tz(o,i);return n.makeTensorInfo(s.shape,"int32",a)}},kj={kernelName:"Tan",backendName:"webgl",kernelFunc:oB({opSnippet:"return tan(x);"})},Ij={kernelName:"Tanh",backendName:"webgl",kernelFunc:oB({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sj={kernelName:"TensorScatterUpdate",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{tensor:i,indices:s,updates:o}=e,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:h}=wk(0,s,i.shape),d=[h/l,l];if(0===h)return n.makeTensorInfo(i.shape,s.dtype);const p=mB({inputs:{x:s},backend:n,attrs:{shape:[u,a]}}),f=mB({inputs:{x:o},backend:n,attrs:{shape:[u,l]}}),g=mB({inputs:{x:i},backend:n,attrs:{shape:d}}),m=new jG(u,a,p.shape.length,f.shape.length,c,d,!1,!0),y=n.runWebGLProgram(m,[f,p,g],g.dtype),b=mB({inputs:{x:y},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),b}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tj{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let s=0;s<n.length;s++)n[s]=t[s]*e[s];this.outputShape=n,this.rank=n.length;const r=hM(this.rank),i=function(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<t.length;i++)r.push(`imod(${n[i]}, ${t[i]})`);return r.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}function Cj(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;if("string"===i.dtype||i.shape.length>5){const t=n.readSync(i.dataId),e="string"===i.dtype?t.map((t=>ay(t))):t,r=zb(i.shape,i.dtype,e),o=Nz(r,s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const o=new Tj(i.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const Nj={kernelName:"Tile",backendName:"webgl",kernelFunc:Cj};class Ej{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class Rj{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $j(t,e){null!==e&&t.disposeIntermediateTensorInfo(e)}function _j(t){let e=1;for(;e<t;)e*=2;return e}const Aj={kernelName:"TopK",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:o}=r,a=rm().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=rm().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=i.shape,c=l[l.length-1];if(n.shouldExecuteOnCPU([i])||c<a||s>u){const t=n.readSync(i.dataId),[e,r]=Ez(t,l,i.dtype,s,o);return[n.makeTensorInfo(e.shape,e.dtype,e.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===s)return l[l.length-1]=0,[n.makeTensorInfo(l,i.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(1===c)return[i,jV({attrs:{shape:l,dtype:"int32",value:0},backend:n})];const h=n.texData.get(i.dataId),d=null!==h&&h.isPacked,p=d?n.unpackTensor(i):i,f=Ng(l)/c,g=mB({inputs:{x:p},attrs:{shape:[f,c]},backend:n});d&&$j(n,p);const m=_j(s),y=_j(c);let b=null;const v=()=>null===b?[g,g]:[g,b],x=(t,e,r)=>{const i=v(),s=new Ej(r),o=[[c],[null===b?1:0],[Number.NEGATIVE_INFINITY],[t],[e]],a=b;b=n.runWebGLProgram(s,i,"int32",o),$j(n,a)};for(let T=1;T<m;T*=2){const t=2*T;for(let e=T;e>=1;e/=2)x(t,e,[f,y])}for(let T=y;T>m;T/=2){const t=v(),e=new Rj([f,T/2]),r=[[c],[null===b?1:0],[m]],i=b;b=n.runWebGLProgram(e,t,"int32",r),$j(n,i);const s=m/2,o=2*s;for(let n=s;n>=1;n/=2)x(o,n,b.shape)}let w=b;b=fU({inputs:{x:b},backend:n,attrs:{begin:0,size:[f,s]}}),$j(n,w);let k=uW({inputs:{x:g,indices:b},backend:n,attrs:{axis:1,batchDims:1}});$j(n,g);const I=l.slice(0,-1);I.push(s),w=b,b=mB({inputs:{x:b},attrs:{shape:I},backend:n}),$j(n,w);const S=k;return k=mB({inputs:{x:k},attrs:{shape:I},backend:n}),$j(n,S),[k,b]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dj{constructor(t,e,n,r,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;const o="nearest"===n?1:2;let a;switch(r){case"constant":a=1;break;case"reflect":a=2;break;case"wrap":a=3;break;case"nearest":a=4;break;default:a=1}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${a} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${i});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${i});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${e}));\n                float mapY = mapCoord(inY, float(${t}));\n\n                if (${o} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fj={kernelName:"Transform",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=r,[c,h,d,p]=i.shape,[f,g]=null!=l?l:[h,d],m=new Dj(h,d,o,a,u,[c,f,g,p]);return n.runWebGLProgram(m,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oj={kernelName:"Unique",backendName:"webgl",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;HP(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(s.dataId),{outputValues:a,outputShape:u,indices:l}=$z(o,i,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lj={kernelName:"Unpack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i,a=o.shape.length,u=i.shape[s],l=new Array(a-1);let c=0;for(let g=0;g<a;g++)g!==s&&(l[c++]=o.shape[g]);const h=[],d=new Array(a).fill(0),p=o.shape.slice();p[s]=1;const f=new Array(u);for(let g=0;g<f.length;g++){d[s]=g;const t=fU({inputs:{x:o},backend:n,attrs:{begin:d,size:p}}),e=mB({inputs:{x:t},backend:n,attrs:{shape:l}});f[g]=e,h.push(t)}return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pj{constructor(t,e){this.variableNames=["x","segmentIds"];const n=t.windowSize,r=t.batchSize,i=t.inSize,s=t.numSegments,o=s*Math.ceil(i/n);this.outputShape=[r,o];const a=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ";let c="";i%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `);let h="";i%n>0&&(h=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${h}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${s})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${s})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${a}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${a};\n        if (${1===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${l}\n        } else if (${2===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${l}\n        } else if (${3===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mj=[RB,_B,AB,DB,OB,MB,zB,BB,HB,qB,KB,XB,YB,QB,JB,eU,nU,sU,oU,aU,cU,mU,yU,bU,IU,TU,EU,Zz,_U,zU,qU,JU,tV,eV,nV,rV,iV,sV,aV,fV,gV,mV,bV,wV,SV,TV,NV,RV,$V,_V,AV,DV,FV,LV,MV,BV,WV,HV,KV,YV,QV,tW,rW,iW,oW,lW,cW,hW,Qz,dW,LU,pW,fW,gW,nB,mW,yW,bW,vW,xW,wW,kW,IW,CW,EW,$W,_W,AW,DW,LW,PW,MW,zW,BW,UW,GW,jW,tG,gB,eG,rG,sG,aG,xU,lG,dG,pG,yG,bG,sB,vG,xG,wG,kG,SG,kU,KW,TG,CG,NG,yB,$G,AG,OG,PG,BG,VG,WG,GG,qG,XG,QG,JG,ZG,tj,ej,nj,gU,ZW,rj,ij,sj,oj,aj,uj,lj,cj,dj,pj,fj,gj,mj,bj,vj,xj,wj,QW,TB,kj,Ij,Sj,Nj,Aj,Fj,NB,Oj,Lj,{kernelName:"UnsortedSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:o}=r,a=i.shape.length,u=[];let l=0;const c=Ix([l],a);let h=i;null!=c&&(h=CB({inputs:{x:i},backend:n,attrs:{perm:c}}),u.push(h),l=Tx(1,a)[0]);const d=VS(h.shape,l,o),p=Ng([h.shape[l]]),f=mB({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});u.push(f);const g=Ly(i.dtype),m=(t,e,r,i,s)=>{const o=t.shape[0],a=t.shape[1],l=US(a,s),c=new Pj({windowSize:l,inSize:a,batchSize:o,numSegments:s},e),h=n.compileAndRun(c,[t,r],i);if(u.push(h),h.shape[1]===s)return h;const d=IG({backend:n,attrs:{start:0,stop:s,step:1,dtype:"float32"}}),p=Cj({inputs:{x:d},backend:n,attrs:{reps:[a/l]}});u.push(d),u.push(p);return m(h,e,p,i,s)},y=mB({inputs:{x:m(f,"unsortedSegmentSum",s,g,o)},backend:n,attrs:{shape:d}});let b=y;if(null!=c){u.push(y);const t=Sx(c);b=CB({inputs:{x:b},backend:n,attrs:{perm:t}})}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),b}},hG];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const Bj of Mj)fm(Bj);export{$I as a,rv as b,jb as d,te as f,CR as l,Rx as s};
